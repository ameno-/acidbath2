{
  "session_id": "a27dbf30-3ec6-4137-a5e8-6646f7d2350b",
  "prompts": [
    "# IDENTITY and PURPOSE\n\nYou extract surprising, insightful, and interesting information from text content. You are interested in insights related to the purpose and meaning of life, human flourishing, the role of technology in the future of humanity, artificial intelligence and its affect on humans, memes, learning, reading, books, continuous improvement, and similar topics.\n\nTake a step back and think step-by-step about how to achieve the best possible results by following the steps below.\n\n# STEPS\n\n- Extract a summary of the content in 25 words, including who is presenting and the content being discussed into a section called SUMMARY.\n\n- Extract 20 to 50 of the most surprising, insightful, and/or interesting ideas from the input in a section called IDEAS:. If there are less than 50 then collect all of them. Make sure you extract at least 20.\n\n- Extract 10 to 20 of the best insights from the input and from a combination of the raw input and the IDEAS above into a section called INSIGHTS. These INSIGHTS should be fewer, more refined, more insightful, and more abstracted versions of the best ideas in the content. \n\n- Extract 15 to 30 of the most surprising, insightful, and/or interesting quotes from the input into a section called QUOTES:. Use the exact quote text from the input. Include the name of the speaker of the quote at the end.\n\n- Extract 15 to 30 of the most practical and useful personal habits of the speakers, or mentioned by the speakers, in the content into a section called HABITS. Examples include but aren't limited to: sleep schedule, reading habits, things they always do, things they always avoid, productivity tips, diet, exercise, etc.\n\n- Extract 15 to 30 of the most surprising, insightful, and/or interesting valid facts about the greater world that were mentioned in the content into a section called FACTS:.\n\n- Extract all mentions of writing, art, tools, projects and other sources of inspiration mentioned by the speakers into a section called REFERENCES. This should include any and all references to something that the speaker mentioned.\n\n- Extract the most potent takeaway and recommendation into a section called ONE-SENTENCE TAKEAWAY. This should be a 15-word sentence that captures the most important essence of the content.\n\n- Extract the 15 to 30 of the most surprising, insightful, and/or interesting recommendations that can be collected from the content into a section called RECOMMENDATIONS.\n\n# OUTPUT INSTRUCTIONS\n\n- Only output Markdown.\n\n- Write the IDEAS bullets as exactly 16 words.\n\n- Write the RECOMMENDATIONS bullets as exactly 16 words.\n\n- Write the HABITS bullets as exactly 16 words.\n\n- Write the FACTS bullets as exactly 16 words.\n\n- Write the INSIGHTS bullets as exactly 16 words.\n\n- Extract at least 25 IDEAS from the content.\n\n- Extract at least 10 INSIGHTS from the content.\n\n- Extract at least 20 items for the other output sections.\n\n- Do not give warnings or notes; only output the requested sections.\n\n- You use bulleted lists for output, not numbered lists.\n\n- Do not repeat ideas, insights, quotes, habits, facts, or references.\n\n- Do not start items with the same opening words.\n\n- Ensure you follow ALL these instructions when creating your output.\n\n# INPUT\n\nINPUT:\n\n\n# INPUT\n\n# Cell 1 (markdown)\n# Parallel tool calls on Claude 3.7 Sonnet\n\n---\n\n# Cell 2 (markdown)\nClaude 3.7 Sonnet may be less likely to make make parallel tool calls in a response, even when you have not set `disable_parallel_tool_use`. To work around this, we recommend introducing a \"batch tool\" that can act as a meta-tool to wrap invocations to other tools simultaneously. We find that if this tool is present, the model will use it to simultaneously call multiple tools in parallel for you.\n\nLet's take a look at the problem, and examine this workaround in more detail.\n\n---\n\n# Cell 3 (code)\n```python\nfrom anthropic import Anthropic\n\nclient = Anthropic()\nMODEL_NAME = \"claude-sonnet-4-5\"\n```\n\n---\n\n# Cell 4 (markdown)\n## Performing a query with multiple tool calls\n\nRecall that the default behavior is for Claude to be allowed parallel tool calls. Combined with the default `tool_choice` of `auto`, this means that Claude can call any of the specified tools, or call more than one of them in a single assistant turn.\n\nLet's set Claude up with a `get_weather` and `get_time` tool.\n\n---\n\n# Cell 5 (code)\n```python\ndef get_weather(location):\n    # Pretend to get the weather, and just return a fixed value.\n    return f\"The weather in {location} is 72 degrees and sunny.\"\n\n\ndef get_time(location):\n    # Pretend to get the time, and just return a fixed value.\n    return f\"The time in {location} is 12:32 PM.\"\n\n\nweather_tool = {\n    \"name\": \"get_weather\",\n    \"description\": \"Gets the weather for in a given location\",\n    \"input_schema\": {\n        \"type\": \"object\",\n        \"properties\": {\n            \"location\": {\n                \"type\": \"string\",\n                \"description\": \"The city and state, e.g. San Francisco, CA\",\n            },\n        },\n        \"required\": [\"location\"],\n    },\n}\n\ntime_tool = {\n    \"name\": \"get_time\",\n    \"description\": \"Gets the time in a given location\",\n    \"input_schema\": {\n        \"type\": \"object\",\n        \"properties\": {\n            \"location\": {\n                \"type\": \"string\",\n                \"description\": \"The city and state, e.g. San Francisco, CA\",\n            },\n        },\n        \"required\": [\"location\"],\n    },\n}\n\n\ndef process_tool_call(tool_name, tool_input):\n    if tool_name == \"get_weather\":\n        return get_weather(tool_input[\"location\"])\n    elif tool_name == \"get_time\":\n        return get_time(tool_input[\"location\"])\n    else:\n        raise ValueError(f\"Unexpected tool name: {tool_name}\")\n```\n\n---\n\n# Cell 6 (markdown)\nNext, let's provide Claude with these tools and perform a query.\n\n---\n\n# Cell 7 (code)\n```python\ndef make_query_and_print_result(messages, tools=None):\n    response = client.messages.create(\n        model=MODEL_NAME,\n        messages=messages,\n        max_tokens=1000,\n        tool_choice={\"type\": \"auto\"},\n        tools=tools or [weather_tool, time_tool],\n    )\n\n    for block in response.content:\n        match block.type:\n            case \"text\":\n                print(block.text)\n            case \"tool_use\":\n                print(f\"Tool: {block.name}({block.input})\")\n            case _:\n                raise ValueError(f\"Unexpected block type: {block.type}\")\n\n    return response\n\n\nMESSAGES = [{\"role\": \"user\", \"content\": \"What's the weather and time in San Francisco?\"}]\n\nresponse = make_query_and_print_result(MESSAGES)\n```\n\n**Output:**\n```\nI'll check the current weather and time in San Francisco for you.\nTool: get_weather({'location': 'San Francisco, CA'})\n\n```\n\n---\n\n# Cell 8 (markdown)\nNotice how claude returned with a single tool call for the weather, even though we asked for both?\n\nLet's see what happens if we call the weather tool and proceed.\n\n---\n\n# Cell 9 (code)\n```python\nlast_tool_call = response.content[1]\n\nMESSAGES.append({\"role\": \"assistant\", \"content\": response.content})\nMESSAGES.append(\n    {\n        \"role\": \"user\",\n        \"content\": [\n            {\n                \"type\": \"tool_result\",\n                \"tool_use_id\": last_tool_call.id,\n                \"content\": process_tool_call(response.content[1].name, response.content[1].input),\n            }\n        ],\n    }\n)\n\nresponse = make_query_and_print_result(MESSAGES)\n```\n\n**Output:**\n```\nTool: get_time({'location': 'San Francisco, CA'})\n\n```\n\n---\n\n# Cell 10 (markdown)\nNotice now that Claude made a second tool call to get the time. While this technically happened immediately, this is potentially wasteful because it required \"back and forth\" \u2013 first Claude asked for the weather, then we had to process it, and _then_ Claude asked for the time, and now we have to process _that_.\n\nClaude will still do the right thing with the results, but it may be beneficial to encourage Claude to use both in one call, so we can process it simultaneously.\n\n---\n\n# Cell 11 (markdown)\n## Introducing a batch tool\n\nLet's introduce a `batch_tool`, so that Claude can have an opportunity to use it to combine multiple tool calls into one.\n\n---\n\n# Cell 12 (code)\n```python\nimport json\n\nbatch_tool = {\n    \"name\": \"batch_tool\",\n    \"description\": \"Invoke multiple other tool calls simultaneously\",\n    \"input_schema\": {\n        \"type\": \"object\",\n        \"properties\": {\n            \"invocations\": {\n                \"type\": \"array\",\n                \"description\": \"The tool calls to invoke\",\n                \"items\": {\n                    \"types\": \"object\",\n                    \"properties\": {\n                        \"name\": {\n                            \"types\": \"string\",\n                            \"description\": \"The name of the tool to invoke\",\n                        },\n                        \"arguments\": {\n                            \"types\": \"string\",\n                            \"description\": \"The arguments to the tool\",\n                        },\n                    },\n                    \"required\": [\"name\", \"arguments\"],\n                },\n            }\n        },\n        \"required\": [\"invocations\"],\n    },\n}\n\n\ndef process_tool_with_maybe_batch(tool_name, tool_input):\n    if tool_name == \"batch_tool\":\n        results = []\n        for invocation in tool_input[\"invocations\"]:\n            results.append(\n                process_tool_call(invocation[\"name\"], json.loads(invocation[\"arguments\"]))\n            )\n        return \"\\n\".join(results)\n    else:\n        return process_tool_call(tool_name, tool_input)\n```\n\n---\n\n# Cell 13 (markdown)\nNow let's try to provide Claude with the existing weather and time tool, along with this new batch tool, and see what happens when we make a query requiring the weather and time.\n\n---\n\n# Cell 14 (code)\n```python\nMESSAGES = [{\"role\": \"user\", \"content\": \"What's the weather and time in San Francisco?\"}]\n\nresponse = make_query_and_print_result(MESSAGES, tools=[weather_tool, time_tool, batch_tool])\n```\n\n**Output:**\n```\nI can help you check both the weather and the time in San Francisco. Let me get that information for you right away.\nTool: batch_tool({'invocations': [{'name': 'get_weather', 'arguments': '{\"location\": \"San Francisco, CA\"}'}, {'name': 'get_time', 'arguments': '{\"location\": \"San Francisco, CA\"}'}]})\n\n```\n\n---\n\n# Cell 15 (markdown)\nNotice how this time, Claude used the batch tool to query both the time and weather in one go. This allows us to process them simultaneously, potentially improving overall latency to the result.\n\n---\n\n# Cell 16 (code)\n```python\nlast_tool_call = response.content[1]\n\nMESSAGES.append({\"role\": \"assistant\", \"content\": response.content})\nMESSAGES.append(\n    {\n        \"role\": \"user\",\n        \"content\": [\n            {\n                \"type\": \"tool_result\",\n                \"tool_use_id\": last_tool_call.id,\n                \"content\": process_tool_with_maybe_batch(\n                    response.content[1].name, response.content[1].input\n                ),\n            }\n        ],\n    }\n)\n\nresponse = make_query_and_print_result(MESSAGES)\n```\n\n**Output:**\n```\nHere's the information you requested:\n\nWeather in San Francisco, CA: 72 degrees and sunny\nTime in San Francisco, CA: 12:32 PM\n\nIs there anything else you'd like to know about San Francisco?\n\n```\n\n---\n\n"
  ]
}