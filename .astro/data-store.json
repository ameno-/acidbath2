[["Map",1,2,9,10],"meta::meta",["Map",3,4,5,6,7,8],"astro-version","5.16.5","content-config-digest","f63c3f4aa2239104","astro-config-digest","{\"root\":{},\"srcDir\":{},\"publicDir\":{},\"outDir\":{},\"cacheDir\":{},\"site\":\"https://blog.amenoacids.com\",\"compressHTML\":true,\"base\":\"/\",\"trailingSlash\":\"ignore\",\"output\":\"static\",\"scopedStyleStrategy\":\"attribute\",\"build\":{\"format\":\"directory\",\"client\":{},\"server\":{},\"assets\":\"_astro\",\"serverEntry\":\"entry.mjs\",\"redirects\":true,\"inlineStylesheets\":\"auto\",\"concurrency\":1},\"server\":{\"open\":false,\"host\":false,\"port\":9103,\"streaming\":true,\"allowedHosts\":[]},\"redirects\":{},\"image\":{\"endpoint\":{\"route\":\"/_image\"},\"service\":{\"entrypoint\":\"astro/assets/services/sharp\",\"config\":{}},\"domains\":[],\"remotePatterns\":[],\"responsiveStyles\":false},\"devToolbar\":{\"enabled\":true},\"markdown\":{\"syntaxHighlight\":false,\"shikiConfig\":{\"langs\":[],\"langAlias\":{},\"theme\":\"github-dark\",\"themes\":{},\"wrap\":false,\"transformers\":[]},\"remarkPlugins\":[],\"rehypePlugins\":[null,[null,{\"strategy\":\"pre-mermaid\"}],[null,{\"themes\":[\"github-dark\",\"github-light\"],\"plugins\":[{\"name\":\"Collapsible sections\",\"styleSettings\":{\"defaultValues\":{\"collapsibleSections\":{\"closedBorderWidth\":\"0\",\"closedPaddingBlock\":\"4px\",\"closedMargin\":\"0\",\"closedFontFamily\":\"inherit\",\"closedFontSize\":\"inherit\",\"closedLineHeight\":\"inherit\",\"openBorderWidth\":\"1px\",\"openPadding\":\"0\",\"openMargin\":\"0\",\"openBackgroundColor\":\"transparent\",\"openBorderColor\":\"transparent\",\"expandIcon\":\"url(\\\"data:image/svg+xml,%3Csvg%20xmlns%3D'http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg'%20viewBox%3D'0%200%2016%2016'%3E%3Cpath%20d%3D'm8.177.677%202.896%202.896a.25.25%200%200%201-.177.427H8.75v1.25a.75.75%200%200%201-1.5%200V4H5.104a.25.25%200%200%201-.177-.427L7.823.677a.25.25%200%200%201%20.354%200ZM7.25%2010.75a.75.75%200%200%201%201.5%200V12h2.146a.25.25%200%200%201%20.177.427l-2.896%202.896a.25.25%200%200%201-.354%200l-2.896-2.896A.25.25%200%200%201%205.104%2012H7.25v-1.25Zm-5-2a.75.75%200%200%200%200-1.5h-.5a.75.75%200%200%200%200%201.5h.5ZM6%208a.75.75%200%200%201-.75.75h-.5a.75.75%200%200%201%200-1.5h.5A.75.75%200%200%201%206%208Zm2.25.75a.75.75%200%200%200%200-1.5h-.5a.75.75%200%200%200%200%201.5h.5ZM12%208a.75.75%200%200%201-.75.75h-.5a.75.75%200%200%201%200-1.5h.5A.75.75%200%200%201%2012%208Zm2.25.75a.75.75%200%200%200%200-1.5h-.5a.75.75%200%200%200%200%201.5h.5Z'%2F%3E%3C%2Fsvg%3E\\\")\",\"collapseIcon\":\"url(\\\"data:image/svg+xml,%3Csvg%20xmlns%3D'http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg'%20viewBox%3D'0%200%2016%2016'%3E%3Cpath%20d%3D'M10.896%202H8.75V.75a.75.75%200%200%200-1.5%200V2H5.104a.25.25%200%200%200-.177.427l2.896%202.896a.25.25%200%200%200%20.354%200l2.896-2.896A.25.25%200%200%200%2010.896%202ZM8.75%2015.25a.75.75%200%200%201-1.5%200V14H5.104a.25.25%200%200%201-.177-.427l2.896-2.896a.25.25%200%200%201%20.354%200l2.896%202.896a.25.25%200%200%201-.177.427H8.75v1.25Zm-6.5-6.5a.75.75%200%200%200%200-1.5h-.5a.75.75%200%200%200%200%201.5h.5ZM6%208a.75.75%200%200%201-.75.75h-.5a.75.75%200%200%201%200-1.5h.5A.75.75%200%200%201%206%208Zm2.25.75a.75.75%200%200%200%200-1.5h-.5a.75.75%200%200%200%200%201.5h.5ZM12%208a.75.75%200%200%201-.75.75h-.5a.75.75%200%200%201%200-1.5h.5A.75.75%200%200%201%2012%208Zm2.25.75a.75.75%200%200%200%200-1.5h-.5a.75.75%200%200%200%200%201.5h.5Z'%2F%3E%3C%2Fsvg%3E\\\")\"}},\"cssVarExclusions\":[],\"cssVarReplacements\":[[\"collapsibleSections\",\"cs\"]],\"preventUnitlessValues\":[\"collapsibleSections.closedBorderWidth\",\"collapsibleSections.openBorderWidth\"]},\"hooks\":{}},{\"name\":\"astro-expressive-code\",\"hooks\":{}}],\"styleOverrides\":{\"borderRadius\":\"0.5rem\",\"uiFontFamily\":\"var(--font-family-sans)\",\"codeFontFamily\":\"var(--font-family-mono)\",\"borderColor\":\"var(--color-foreground-alt)\",\"frames\":{\"editorActiveTabIndicatorTopColor\":\"var(--color-accent-primary)\",\"editorTabBarBackgroundColor\":\"var(--color-background-alt)\"}}}]],\"remarkRehype\":{},\"gfm\":true,\"smartypants\":true},\"security\":{\"checkOrigin\":true,\"allowedDomains\":[]},\"env\":{\"schema\":{},\"validateSecrets\":false},\"experimental\":{\"clientPrerender\":false,\"contentIntellisense\":false,\"headingIdCompat\":false,\"preserveScriptOrder\":false,\"liveContentCollections\":false,\"csp\":false,\"staticImportMetaEnv\":false,\"chromeDevtoolsWorkspace\":false,\"failOnPrerenderConflict\":false,\"svgo\":false},\"legacy\":{\"collections\":false}}","blog",["Map",11,12,76,77,171,172,269,270,366,367,476,477,605,606],"workflow-prompts",{"id":11,"data":13,"body":36,"filePath":37,"digest":38,"rendered":39,"legacyId":75},{"title":14,"description":15,"pubDate":16,"author":17,"tags":18,"draft":24,"banner":25,"seoKeywords":26,"tldr":27,"keyTakeaways":28,"category":34,"difficulty":35},"Workflow Prompts: The Pattern That Makes AI Engineering Predictable","The workflow section drives 90% of the value in agentic prompts. Learn to build workflow prompts that work, when they fail, and how to measure ROI.",["Date","2025-12-15T00:00:00.000Z"],"Acidbath",[19,20,21,22,23],"ai","prompts","claude-code","workflow","automation",false,"/assets/posts/workflow-prompts-banner.png",[],"Workflow prompts follow an Input → Workflow → Output structure that makes AI agent behavior predictable. The workflow section—numbered, sequential steps—drives 90% of the value. Use break-even math (time to write / time saved per use) to decide if a workflow is worth building.",[29,30,31,32,33],"Workflow sections are S-tier value with C-tier difficulty—the most valuable component is also the easiest to execute","Workflow prompts fail on complex judgment calls, ambiguous requirements, and real-time adaptation tasks","Break-even calculation: (Time to write) / (Time saved per use) = minimum uses needed","A 30-minute workflow prompt pays off after 3 uses of a 15-minute task","Build a library of reusable workflow prompts for maximum team ROI","Agentic Patterns","Intermediate","The workflow section is the most important thing you'll write in any agentic prompt.\n\nNot the metadata. Not the variables. Not the fancy control flow. The workflow—your step-by-step play for what the agent should do—drives 90% of the value you'll capture from AI-assisted engineering.\n\nMost developers write prompts like they're having a conversation. Then they wonder why their agents produce inconsistent results, skip steps, and require constant babysitting. The difference between prompts that work and prompts that require hand-holding is the workflow section.\n\nThis post shows you how to build workflow prompts that actually work, with templates you can use today. It also covers the failure modes you'll encounter and how to calculate whether a workflow prompt is worth writing.\n\n## The Core Pattern: Input → Workflow → Output\n\nEvery effective agentic prompt follows this three-step structure:\n\n```mermaid\nflowchart LR\n    subgraph INPUT[\"INPUT\"]\n        I1[Variables]\n        I2[Parameters]\n        I3[Context]\n    end\n\n    subgraph WORKFLOW[\"WORKFLOW\"]\n        W1[Sequential]\n        W2[Step-by-Step]\n        W3[Instructions]\n    end\n\n    subgraph OUTPUT[\"OUTPUT\"]\n        O1[Report]\n        O2[Format]\n        O3[Structure]\n    end\n\n    INPUT --> WORKFLOW --> OUTPUT\n\n    style INPUT fill:#e3f2fd\n    style WORKFLOW fill:#fff3e0\n    style OUTPUT fill:#c8e6c9\n```\n\nThe workflow section is where your agent's actual work happens. It's rated S-tier usefulness with C-tier difficulty—the most valuable component is also the easiest to execute well.\n\n## POC: A Working Workflow Prompt\n\nHere's a complete, production-ready workflow prompt you can use as a Claude Code command:\n\n```markdown\n\u003C!-- github: https://github.com/ameno-/acidbath-code/blob/main/workflow-tools/workflow-prompts/poc-working-workflow/poc-working-workflow.md -->\n---\ndescription: Analyze a file and create implementation plan\nallowed-tools: Read, Glob, Grep, Write\nargument-hint: \u003Cfile_path>\n---\n\n# File Analysis and Planning Agent\n\n## Purpose\nAnalyze the provided file and create a detailed implementation plan for improvements.\n\n## Variables\n- **target_file**: $ARGUMENTS (the file to analyze)\n- **output_dir**: ./specs\n\n## Workflow\n\n1. **Read the target file**\n   - Load the complete contents of {{target_file}}\n   - Note the file type, structure, and purpose\n\n2. **Analyze the codebase context**\n   - Use Glob to find related files (same directory, similar names)\n   - Use Grep to find references to functions/classes in this file\n   - Identify dependencies and dependents\n\n3. **Identify improvement opportunities**\n   - List potential refactoring targets\n   - Note any code smells or anti-patterns\n   - Consider performance optimizations\n   - Check for missing error handling\n\n4. **Create implementation plan**\n   - For each improvement, specify:\n     - What to change\n     - Why it matters\n     - Files affected\n     - Risk level (low/medium/high)\n\n5. **Write the plan to file**\n   - Save to {{output_dir}}/{{filename}}-plan.md\n   - Include timestamp and file hash for tracking\n\n## Output Format\nfile_analyzed: {{target_file}}\ntimestamp: {{current_time}}\nimprovements:\n  - id: 1\n    type: refactor|performance|error-handling|cleanup\n    description: \"What to change\"\n    rationale: \"Why it matters\"\n    files_affected: [list]\n    risk: low|medium|high\n    effort: small|medium|large\n\n## Early Returns\n- If {{target_file}} doesn't exist, stop and report error\n- If file is binary or unreadable, stop and explain\n- If no improvements found, report \"file looks good\" with reasoning\n```\n\nSave this as `.claude/commands/analyze.md` and run with `/analyze src/main.py`.\n\n## The Workflow Section Deep Dive\n\nWhat makes workflow sections powerful:\n\n**Sequential clarity** - Numbered steps eliminate ambiguity. The agent knows exactly what order to execute.\n\n```markdown\n## Workflow\n\n1. Read the config file\n2. Parse the JSON structure\n3. Validate required fields exist\n4. Transform data to new format\n5. Write output file\n```\n\n**Nested detail** - Add specifics under each step without breaking the sequence:\n\n```markdown\n## Workflow\n\n1. **Gather requirements**\n   - Read the user's request carefully\n   - Identify explicit requirements\n   - Note implicit assumptions\n   - List questions if anything is unclear\n\n2. **Research existing code**\n   - Search for similar implementations\n   - Check for utility functions that could help\n   - Review relevant documentation\n```\n\n**Conditional branches** - Handle different scenarios:\n\n```markdown\n## Workflow\n\n1. Check if package.json exists\n2. **If exists:**\n   - Parse dependencies\n   - Check for outdated packages\n   - Generate update recommendations\n3. **If not exists:**\n   - Stop and inform user this isn't a Node project\n```\n\n## When Workflow Prompts Fail (Know This Before You Invest the Time)\n\nWorkflow prompts are powerful, but they're not universal. Here are the failure modes I've hit in production—each one a lesson that cost real debugging time:\n\n**Overly complex tasks requiring human judgment mid-execution**\n\nI tried building a workflow prompt for database migration planning. The prompt could analyze schema differences and generate SQL, but it couldn't decide which migrations were safe to auto-apply versus which needed DBA review. The decision tree had too many branches: data volume considerations, cross-region timing, rollback complexity, customer impact windows.\n\nThe workflow kept requesting human input at steps 3, 5, 7, and 9 of a 12-step process. At that point, you're better off doing it interactively. Workflow prompts excel when the decision points are clear and the execution path is deterministic.\n\n**Rule of thumb**: If your workflow has more than 2 \"stop and ask the user\" points, it's probably not a good fit.\n\n**Ambiguous requirements that can't be specified upfront**\n\n\"Generate a blog post outline for our next marketing campaign\" sounds like a good workflow candidate. It's not. The requirements shift based on the output. You see the first draft and realize you want a different tone. The second section needs more technical depth. The third needs less.\n\nI wrote a 300-line workflow prompt for content generation that included 15 different quality checks and formatting rules. The agent followed it perfectly and produced consistently mediocre output. The problem wasn't execution—it was that I couldn't articulate \"make it interesting\" in workflow steps.\n\nInteractive prompting lets you course-correct in real-time. Workflow prompts lock in your assumptions upfront.\n\n**Tasks requiring real-time adaptation**\n\nDebugging sessions are the classic example. You can't write a workflow for \"figure out why the auth service is returning 500 errors\" because each finding changes what you need to check next. Step 1 might be \"check logs,\" but what you find in the logs determines whether step 2 is \"inspect database connections\" or \"review API gateway config\" or \"check Redis cache status.\"\n\nWorkflow prompts assume a static execution path. Debugging requires dynamic branching based on runtime discoveries.\n\n**When the overhead of writing the prompt exceeds the task time**\n\nThis is the trap I see most often. Someone spends 2 hours writing a workflow prompt for a task that takes 30 minutes to do manually. They run it once, it works great, and then they never use it again.\n\nIf you're not going to run a workflow at least 5 times, don't build it. Do it manually or use interactive prompting.\n\n**Edge case: Workflows that seem simple but have hidden complexity**\n\n\"Rename this function across the codebase\" sounds trivial. Write a workflow prompt: search for all instances, replace them, update imports, done. Except the function is called `get()` and your codebase has 47 different `get()` functions. Or it's used in generated code. Or it's referenced in documentation strings that need different formatting. Or it's in test mocks that need manual review.\n\nI've seen 10-step workflow prompts fail at step 8 because an edge case no one anticipated appeared. The agent either halted with an error or plowed ahead and broke things. Neither outcome is great when you're at 80% completion.\n\nFor tasks with hidden complexity, start with interactive prompting. Once you've hit the edge cases manually, then codify the workflow.\n\n## Measuring Workflow ROI\n\nThe question you should ask before writing any workflow prompt: \"Will this pay for itself?\"\n\n**Time to write workflow prompt vs time saved**\n\nA workflow prompt takes between 20 minutes (simple, templated) and 3 hours (complex, multi-step). Most fall in the 45-60 minute range if you're building from scratch.\n\nTask execution time varies, but here's the break-even math:\n\n```\nBreak-even uses = (Time to write prompt) / (Time saved per use)\n```\n\nExample 1: Code review workflow\n- Time to write: 60 minutes\n- Manual review time: 20 minutes\n- Time with workflow: 5 minutes (you review the agent's output)\n- Time saved per use: 15 minutes\n- Break-even: 60 / 15 = 4 uses\n\nIf you review code 4+ times, the workflow prompt pays off.\n\nExample 2: API endpoint scaffolding\n- Time to write: 90 minutes (includes error handling, validation, tests)\n- Manual scaffold time: 40 minutes\n- Time with workflow: 8 minutes (review and tweak)\n- Time saved per use: 32 minutes\n- Break-even: 90 / 32 = 2.8 uses (round to 3)\n\nIf you build 3+ similar endpoints, the workflow prompt pays off.\n\n**The multiplier effect**\n\nThis calculation assumes only you use the workflow. If your team uses it, divide break-even by team size.\n\nA 30-minute workflow prompt on a 5-person team needs to save each person just 6 minutes once to break even. That's a no-brainer for common tasks like \"add API endpoint,\" \"generate test file,\" or \"create component boilerplate.\"\n\n**The hidden cost: maintenance**\n\nWorkflow prompts break when your codebase evolves. Your folder structure changes. Your testing framework updates. Your naming conventions shift.\n\nI maintain about 40 workflow prompts for client projects. Roughly 10% break each quarter and need updates. Budget 15-30 minutes per quarter per active workflow for maintenance.\n\nIf a workflow saves you 2 hours per month but costs 30 minutes per quarter to maintain, the net ROI is still massive: 24 hours saved vs 2 hours maintenance over a year.\n\n**When to skip the ROI calculation**\n\nSome workflows are worth it regardless of break-even math:\n- Team onboarding tasks (new hires benefit disproportionately)\n- Critical path operations where consistency matters more than speed\n- Compliance tasks that require documented, repeatable processes\n\nIf the task is high-stakes or high-variance, the value of predictability can exceed the value of time saved.\n\n## Agent Opportunity: Build a Prompt Library\n\nHere's where you can multiply your impact:\n\n```mermaid\nflowchart TD\n    subgraph LIB[\".claude/commands/\"]\n        A[\"analyze.md - File analysis\"]\n        B[\"refactor.md - Guided refactoring\"]\n        C[\"test.md - Generate tests\"]\n        D[\"document.md - Add documentation\"]\n        E[\"review.md - Code review checklist\"]\n        F[\"debug.md - Systematic debugging\"]\n    end\n\n    LIB --> G[\"Each prompt follows: Input → Workflow → Output\"]\n    G --> H[\"Reusable across projects\"]\n    H --> I[\"Serves you, your team, AND your agents\"]\n\n    style LIB fill:#e8f5e9\n```\n\n## Why Workflows Beat Ad-Hoc Prompting\n\n```mermaid\nflowchart LR\n    subgraph ADHOC[\"AD-HOC PROMPTING\"]\n        A1[\"'Help me refactor this'\"]\n        A2[Unpredictable scope]\n        A3[Inconsistent output]\n        A4[No error handling]\n        A5[Can't reuse]\n        A6[Team can't use it]\n    end\n\n    subgraph WORKFLOW[\"WORKFLOW PROMPTING\"]\n        W1[\"Step 1: Backup\"]\n        W2[\"Step 2: Analyze\"]\n        W3[\"Step 3: Plan\"]\n        W4[\"Step 4: Execute\"]\n        W5[\"Step 5: Verify\"]\n        W6[\"Step 6: Document\"]\n    end\n\n    WORKFLOW --> R1[Predictable execution]\n    WORKFLOW --> R2[Consistent format]\n    WORKFLOW --> R3[Early returns on error]\n    WORKFLOW --> R4[Reusable forever]\n    WORKFLOW --> R5[Team multiplier]\n\n    style ADHOC fill:#ffcdd2\n    style WORKFLOW fill:#c8e6c9\n```\n\nThe workflow prompt transforms a vague request into an executable engineering plan. One workflow prompt executing for an hour can generate work that would take you 20 hours.\n\n## Building Your First Workflow Prompt (Start Today)\n\nStart with your most common task. The one you do every day. The one where you think \"I should automate this.\"\n\n1. Write out the steps you take manually\n2. Convert each step to a numbered instruction\n3. Add variables for the parts that change\n4. Add early returns for failure cases\n5. Specify the output format you want\n\nTest it. Iterate. Add to your library.\n\n**The prompt is the new fundamental unit of engineering.** The workflow section is where that engineering actually happens. One good workflow prompt doesn't just save time—it compounds across every use, every team member, every project.\n\nStop typing the same instructions. Start building reusable workflows.\n\n---\n\n**Key Takeaways:**\n- Workflow sections are S-tier value, C-tier difficulty\n- Input → Workflow → Output is the universal pattern\n- Numbered steps create predictable execution\n- Early returns handle failure cases cleanly\n- Workflows fail on complex judgment calls, ambiguous requirements, and real-time adaptation tasks\n- Break-even calculation: (Time to write) / (Time saved per use) = minimum uses needed\n- A 30-minute workflow prompt pays off after 3 uses of a 15-minute task\n- Build a library of reusable workflow prompts for maximum team ROI\n- One good workflow prompt = 20+ hours of work\n\n**Try It Now (20 Minutes to First Workflow):**\nCopy the analyze.md template above, save to `.claude/commands/analyze.md`, and run `/analyze` on any file in your codebase. Time how long it takes to write the prompt and how long the analysis takes to run. Calculate your break-even point for the next time you need to analyze a file.\n\nIf you use it 4 times, you've already recouped your investment. Everything after that is pure productivity gain. Share it with your team and multiply the returns.","src/content/blog/workflow-prompts.md","df720b9b78f84d03",{"html":40,"metadata":41},"\u003Cp>The workflow section is the most important thing you’ll write in any agentic prompt.\u003C/p>\n\u003Cp>Not the metadata. Not the variables. Not the fancy control flow. The workflow—your step-by-step play for what the agent should do—drives 90% of the value you’ll capture from AI-assisted engineering.\u003C/p>\n\u003Cp>Most developers write prompts like they’re having a conversation. Then they wonder why their agents produce inconsistent results, skip steps, and require constant babysitting. The difference between prompts that work and prompts that require hand-holding is the workflow section.\u003C/p>\n\u003Cp>This post shows you how to build workflow prompts that actually work, with templates you can use today. It also covers the failure modes you’ll encounter and how to calculate whether a workflow prompt is worth writing.\u003C/p>\n\u003Ch2 id=\"the-core-pattern-input--workflow--output\">The Core Pattern: Input → Workflow → Output\u003C/h2>\n\u003Cp>Every effective agentic prompt follows this three-step structure:\u003C/p>\n\u003Cpre class=\"mermaid\">flowchart LR\n    subgraph INPUT[\"INPUT\"]\n        I1[Variables]\n        I2[Parameters]\n        I3[Context]\n    end\n\n    subgraph WORKFLOW[\"WORKFLOW\"]\n        W1[Sequential]\n        W2[Step-by-Step]\n        W3[Instructions]\n    end\n\n    subgraph OUTPUT[\"OUTPUT\"]\n        O1[Report]\n        O2[Format]\n        O3[Structure]\n    end\n\n    INPUT --> WORKFLOW --> OUTPUT\n\n    style INPUT fill:#e3f2fd\n    style WORKFLOW fill:#fff3e0\n    style OUTPUT fill:#c8e6c9\n\u003C/pre>\n\u003Cp>The workflow section is where your agent’s actual work happens. It’s rated S-tier usefulness with C-tier difficulty—the most valuable component is also the easiest to execute well.\u003C/p>\n\u003Ch2 id=\"poc-a-working-workflow-prompt\">POC: A Working Workflow Prompt\u003C/h2>\n\u003Cp>Here’s a complete, production-ready workflow prompt you can use as a Claude Code command:\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"61\" data-has-github=\"true\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">MARKDOWN\u003C/span>\u003Cspan class=\"language-badge\">markdown\u003C/span>\u003Ca class=\"github-header-link\" href=\"https://github.com/ameno-/acidbath-code/blob/main/workflow-tools/workflow-prompts/poc-working-workflow/poc-working-workflow.md\" target=\"_blank\" rel=\"noopener noreferrer\" title=\"View source on GitHub: workflow-tools/workflow-prompts/poc-working-workflow/poc-working-workflow.md\">\u003Cspan class=\"github-icon\">↗\u003C/span>\u003Cspan class=\"github-text\">GitHub\u003C/span>\u003C/a>\u003C/div>\u003Cdiv class=\"code-block-container collapsible with-line-numbers has-github-link\" data-language=\"markdown\" data-line-count=\"61\" data-max-preview=\"8\" data-github-url=\"https://github.com/ameno-/acidbath-code/blob/main/workflow-tools/workflow-prompts/poc-working-workflow/poc-working-workflow.md\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cbutton class=\"collapse-toggle\" aria-label=\"Toggle code visibility\" type=\"button\">\u003Cspan class=\"expand-text\">Expand (61 lines)\u003C/span>\u003Cspan class=\"collapse-text\">Collapse\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Clink rel=\"stylesheet\" href=\"/_astro/ec.44wa8.css\">\u003Cscript type=\"module\" src=\"/_astro/ec.0vx5m.js\">\u003C/script>\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"markdown\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\">&#x3C;!-- github: https://github.com/ameno-/acidbath-code/blob/main/workflow-tools/workflow-prompts/poc-working-workflow/poc-working-workflow.md -->\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#79B8FF;--0fw:bold;--1:#005CC5;--1fw:bold\">---\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">description: Analyze a file and create implementation plan\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">allowed-tools: Read, Glob, Grep, Write\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">argument-hint: &#x3C;\u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">file_path\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">>\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#79B8FF;--0fw:bold;--1:#005CC5;--1fw:bold\">---\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#79B8FF;--0fw:bold;--1:#005CC5;--1fw:bold\"># File Analysis and Planning Agent\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#79B8FF;--0fw:bold;--1:#005CC5;--1fw:bold\">## Purpose\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">Analyze the provided file and create a detailed implementation plan for improvements.\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#79B8FF;--0fw:bold;--1:#005CC5;--1fw:bold\">## Variables\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#E1E4E8;--0fw:bold;--1:#24292E;--1fw:bold\">**target_file**\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: $ARGUMENTS (the file to analyze)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#E1E4E8;--0fw:bold;--1:#24292E;--1fw:bold\">**output_dir**\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: ./specs\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#79B8FF;--0fw:bold;--1:#005CC5;--1fw:bold\">## Workflow\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">1.\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#E1E4E8;--0fw:bold;--1:#24292E;--1fw:bold\">**Read the target file**\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Load the complete contents of {{target_file}}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Note the file type, structure, and purpose\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">2.\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#E1E4E8;--0fw:bold;--1:#24292E;--1fw:bold\">**Analyze the codebase context**\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Use Glob to find related files (same directory, similar names)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Use Grep to find references to functions/classes in this file\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Identify dependencies and dependents\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">3.\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#E1E4E8;--0fw:bold;--1:#24292E;--1fw:bold\">**Identify improvement opportunities**\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> List potential refactoring targets\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Note any code smells or anti-patterns\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Consider performance optimizations\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Check for missing error handling\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">4.\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#E1E4E8;--0fw:bold;--1:#24292E;--1fw:bold\">**Create implementation plan**\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> For each improvement, specify:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">     \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> What to change\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">     \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Why it matters\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">     \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Files affected\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">     \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Risk level (low/medium/high)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">5.\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#E1E4E8;--0fw:bold;--1:#24292E;--1fw:bold\">**Write the plan to file**\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Save to {{output_dir}}/{{filename}}-plan.md\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Include timestamp and file hash for tracking\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#79B8FF;--0fw:bold;--1:#005CC5;--1fw:bold\">## Output Format\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">file_analyzed: {{target_file}}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">timestamp: {{current_time}}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">improvements:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> id: 1\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">type: refactor|performance|error-handling|cleanup\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">description: \"What to change\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">rationale: \"Why it matters\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">files_affected: [\u003C/span>\u003Cspan style=\"--0:#DBEDFF;--0td:underline;--1:#032F62;--1td:underline\">list\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">]\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">risk: low|medium|high\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">effort: small|medium|large\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#79B8FF;--0fw:bold;--1:#005CC5;--1fw:bold\">## Early Returns\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> If {{target_file}} doesn't exist, stop and report error\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> If file is binary or unreadable, stop and explain\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> If no improvements found, report \"file looks good\" with reasoning\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"\u003C!-- github: https://github.com/ameno-/acidbath-code/blob/main/workflow-tools/workflow-prompts/poc-working-workflow/poc-working-workflow.md -->---description: Analyze a file and create implementation planallowed-tools: Read, Glob, Grep, Writeargument-hint: \u003Cfile_path>---# File Analysis and Planning Agent## PurposeAnalyze the provided file and create a detailed implementation plan for improvements.## Variables- **target_file**: $ARGUMENTS (the file to analyze)- **output_dir**: ./specs## Workflow1. **Read the target file**   - Load the complete contents of {{target_file}}   - Note the file type, structure, and purpose2. **Analyze the codebase context**   - Use Glob to find related files (same directory, similar names)   - Use Grep to find references to functions/classes in this file   - Identify dependencies and dependents3. **Identify improvement opportunities**   - List potential refactoring targets   - Note any code smells or anti-patterns   - Consider performance optimizations   - Check for missing error handling4. **Create implementation plan**   - For each improvement, specify:     - What to change     - Why it matters     - Files affected     - Risk level (low/medium/high)5. **Write the plan to file**   - Save to {{output_dir}}/{{filename}}-plan.md   - Include timestamp and file hash for tracking## Output Formatfile_analyzed: {{target_file}}timestamp: {{current_time}}improvements:  - id: 1    type: refactor|performance|error-handling|cleanup    description: &#x22;What to change&#x22;    rationale: &#x22;Why it matters&#x22;    files_affected: [list]    risk: low|medium|high    effort: small|medium|large## Early Returns- If {{target_file}} doesn&#x27;t exist, stop and report error- If file is binary or unreadable, stop and explain- If no improvements found, report &#x22;file looks good&#x22; with reasoning\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003Cdiv class=\"code-fade\" aria-hidden=\"true\">\u003C/div>\u003C/div>\u003Cdiv class=\"code-block-footer\">\u003Ca class=\"github-source-link\" href=\"https://github.com/ameno-/acidbath-code/blob/main/workflow-tools/workflow-prompts/poc-working-workflow/poc-working-workflow.md\" target=\"_blank\" rel=\"noopener noreferrer\">\u003Cspan class=\"github-arrow\">→\u003C/span>\u003Cspan> View full source: workflow-tools/workflow-prompts/poc-working-workflow/poc-working-workflow.md\u003C/span>\u003C/a>\u003C/div>\u003C/div>\n\u003Cp>Save this as \u003Ccode>.claude/commands/analyze.md\u003C/code> and run with \u003Ccode>/analyze src/main.py\u003C/code>.\u003C/p>\n\u003Ch2 id=\"the-workflow-section-deep-dive\">The Workflow Section Deep Dive\u003C/h2>\n\u003Cp>What makes workflow sections powerful:\u003C/p>\n\u003Cp>\u003Cstrong>Sequential clarity\u003C/strong> - Numbered steps eliminate ambiguity. The agent knows exactly what order to execute.\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"8\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">MARKDOWN\u003C/span>\u003Cspan class=\"language-badge\">markdown\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container with-line-numbers\" data-language=\"markdown\" data-line-count=\"8\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"markdown\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#79B8FF;--0fw:bold;--1:#005CC5;--1fw:bold\">## Workflow\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">1.\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Read the config file\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">2.\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Parse the JSON structure\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">3.\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Validate required fields exist\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">4.\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Transform data to new format\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">5.\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Write output file\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"## Workflow1. Read the config file2. Parse the JSON structure3. Validate required fields exist4. Transform data to new format5. Write output file\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003C/div>\u003C/div>\n\u003Cp>\u003Cstrong>Nested detail\u003C/strong> - Add specifics under each step without breaking the sequence:\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"13\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">MARKDOWN\u003C/span>\u003Cspan class=\"language-badge\">markdown\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container with-line-numbers\" data-language=\"markdown\" data-line-count=\"13\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"markdown\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#79B8FF;--0fw:bold;--1:#005CC5;--1fw:bold\">## Workflow\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">1.\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#E1E4E8;--0fw:bold;--1:#24292E;--1fw:bold\">**Gather requirements**\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Read the user's request carefully\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Identify explicit requirements\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Note implicit assumptions\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> List questions if anything is unclear\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">2.\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#E1E4E8;--0fw:bold;--1:#24292E;--1fw:bold\">**Research existing code**\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Search for similar implementations\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Check for utility functions that could help\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Review relevant documentation\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"## Workflow1. **Gather requirements**   - Read the user&#x27;s request carefully   - Identify explicit requirements   - Note implicit assumptions   - List questions if anything is unclear2. **Research existing code**   - Search for similar implementations   - Check for utility functions that could help   - Review relevant documentation\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003C/div>\u003C/div>\n\u003Cp>\u003Cstrong>Conditional branches\u003C/strong> - Handle different scenarios:\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"10\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">MARKDOWN\u003C/span>\u003Cspan class=\"language-badge\">markdown\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container with-line-numbers\" data-language=\"markdown\" data-line-count=\"10\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"markdown\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#79B8FF;--0fw:bold;--1:#005CC5;--1fw:bold\">## Workflow\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">1.\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Check if package.json exists\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">2.\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#E1E4E8;--0fw:bold;--1:#24292E;--1fw:bold\">**If exists:**\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Parse dependencies\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Check for outdated packages\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Generate update recommendations\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">3.\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#E1E4E8;--0fw:bold;--1:#24292E;--1fw:bold\">**If not exists:**\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Stop and inform user this isn't a Node project\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"## Workflow1. Check if package.json exists2. **If exists:**   - Parse dependencies   - Check for outdated packages   - Generate update recommendations3. **If not exists:**   - Stop and inform user this isn&#x27;t a Node project\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003C/div>\u003C/div>\n\u003Ch2 id=\"when-workflow-prompts-fail-know-this-before-you-invest-the-time\">When Workflow Prompts Fail (Know This Before You Invest the Time)\u003C/h2>\n\u003Cp>Workflow prompts are powerful, but they’re not universal. Here are the failure modes I’ve hit in production—each one a lesson that cost real debugging time:\u003C/p>\n\u003Cp>\u003Cstrong>Overly complex tasks requiring human judgment mid-execution\u003C/strong>\u003C/p>\n\u003Cp>I tried building a workflow prompt for database migration planning. The prompt could analyze schema differences and generate SQL, but it couldn’t decide which migrations were safe to auto-apply versus which needed DBA review. The decision tree had too many branches: data volume considerations, cross-region timing, rollback complexity, customer impact windows.\u003C/p>\n\u003Cp>The workflow kept requesting human input at steps 3, 5, 7, and 9 of a 12-step process. At that point, you’re better off doing it interactively. Workflow prompts excel when the decision points are clear and the execution path is deterministic.\u003C/p>\n\u003Cp>\u003Cstrong>Rule of thumb\u003C/strong>: If your workflow has more than 2 “stop and ask the user” points, it’s probably not a good fit.\u003C/p>\n\u003Cp>\u003Cstrong>Ambiguous requirements that can’t be specified upfront\u003C/strong>\u003C/p>\n\u003Cp>“Generate a blog post outline for our next marketing campaign” sounds like a good workflow candidate. It’s not. The requirements shift based on the output. You see the first draft and realize you want a different tone. The second section needs more technical depth. The third needs less.\u003C/p>\n\u003Cp>I wrote a 300-line workflow prompt for content generation that included 15 different quality checks and formatting rules. The agent followed it perfectly and produced consistently mediocre output. The problem wasn’t execution—it was that I couldn’t articulate “make it interesting” in workflow steps.\u003C/p>\n\u003Cp>Interactive prompting lets you course-correct in real-time. Workflow prompts lock in your assumptions upfront.\u003C/p>\n\u003Cp>\u003Cstrong>Tasks requiring real-time adaptation\u003C/strong>\u003C/p>\n\u003Cp>Debugging sessions are the classic example. You can’t write a workflow for “figure out why the auth service is returning 500 errors” because each finding changes what you need to check next. Step 1 might be “check logs,” but what you find in the logs determines whether step 2 is “inspect database connections” or “review API gateway config” or “check Redis cache status.”\u003C/p>\n\u003Cp>Workflow prompts assume a static execution path. Debugging requires dynamic branching based on runtime discoveries.\u003C/p>\n\u003Cp>\u003Cstrong>When the overhead of writing the prompt exceeds the task time\u003C/strong>\u003C/p>\n\u003Cp>This is the trap I see most often. Someone spends 2 hours writing a workflow prompt for a task that takes 30 minutes to do manually. They run it once, it works great, and then they never use it again.\u003C/p>\n\u003Cp>If you’re not going to run a workflow at least 5 times, don’t build it. Do it manually or use interactive prompting.\u003C/p>\n\u003Cp>\u003Cstrong>Edge case: Workflows that seem simple but have hidden complexity\u003C/strong>\u003C/p>\n\u003Cp>“Rename this function across the codebase” sounds trivial. Write a workflow prompt: search for all instances, replace them, update imports, done. Except the function is called \u003Ccode>get()\u003C/code> and your codebase has 47 different \u003Ccode>get()\u003C/code> functions. Or it’s used in generated code. Or it’s referenced in documentation strings that need different formatting. Or it’s in test mocks that need manual review.\u003C/p>\n\u003Cp>I’ve seen 10-step workflow prompts fail at step 8 because an edge case no one anticipated appeared. The agent either halted with an error or plowed ahead and broke things. Neither outcome is great when you’re at 80% completion.\u003C/p>\n\u003Cp>For tasks with hidden complexity, start with interactive prompting. Once you’ve hit the edge cases manually, then codify the workflow.\u003C/p>\n\u003Ch2 id=\"measuring-workflow-roi\">Measuring Workflow ROI\u003C/h2>\n\u003Cp>The question you should ask before writing any workflow prompt: “Will this pay for itself?”\u003C/p>\n\u003Cp>\u003Cstrong>Time to write workflow prompt vs time saved\u003C/strong>\u003C/p>\n\u003Cp>A workflow prompt takes between 20 minutes (simple, templated) and 3 hours (complex, multi-step). Most fall in the 45-60 minute range if you’re building from scratch.\u003C/p>\n\u003Cp>Task execution time varies, but here’s the break-even math:\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"2\">\u003Cdiv class=\"code-block-container with-line-numbers\" data-language=\"\" data-line-count=\"2\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"plaintext\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">Break-even uses = (Time to write prompt) / (Time saved per use)\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"Break-even uses = (Time to write prompt) / (Time saved per use)\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003C/div>\u003C/div>\n\u003Cp>Example 1: Code review workflow\u003C/p>\n\u003Cul>\n\u003Cli>Time to write: 60 minutes\u003C/li>\n\u003Cli>Manual review time: 20 minutes\u003C/li>\n\u003Cli>Time with workflow: 5 minutes (you review the agent’s output)\u003C/li>\n\u003Cli>Time saved per use: 15 minutes\u003C/li>\n\u003Cli>Break-even: 60 / 15 = 4 uses\u003C/li>\n\u003C/ul>\n\u003Cp>If you review code 4+ times, the workflow prompt pays off.\u003C/p>\n\u003Cp>Example 2: API endpoint scaffolding\u003C/p>\n\u003Cul>\n\u003Cli>Time to write: 90 minutes (includes error handling, validation, tests)\u003C/li>\n\u003Cli>Manual scaffold time: 40 minutes\u003C/li>\n\u003Cli>Time with workflow: 8 minutes (review and tweak)\u003C/li>\n\u003Cli>Time saved per use: 32 minutes\u003C/li>\n\u003Cli>Break-even: 90 / 32 = 2.8 uses (round to 3)\u003C/li>\n\u003C/ul>\n\u003Cp>If you build 3+ similar endpoints, the workflow prompt pays off.\u003C/p>\n\u003Cp>\u003Cstrong>The multiplier effect\u003C/strong>\u003C/p>\n\u003Cp>This calculation assumes only you use the workflow. If your team uses it, divide break-even by team size.\u003C/p>\n\u003Cp>A 30-minute workflow prompt on a 5-person team needs to save each person just 6 minutes once to break even. That’s a no-brainer for common tasks like “add API endpoint,” “generate test file,” or “create component boilerplate.”\u003C/p>\n\u003Cp>\u003Cstrong>The hidden cost: maintenance\u003C/strong>\u003C/p>\n\u003Cp>Workflow prompts break when your codebase evolves. Your folder structure changes. Your testing framework updates. Your naming conventions shift.\u003C/p>\n\u003Cp>I maintain about 40 workflow prompts for client projects. Roughly 10% break each quarter and need updates. Budget 15-30 minutes per quarter per active workflow for maintenance.\u003C/p>\n\u003Cp>If a workflow saves you 2 hours per month but costs 30 minutes per quarter to maintain, the net ROI is still massive: 24 hours saved vs 2 hours maintenance over a year.\u003C/p>\n\u003Cp>\u003Cstrong>When to skip the ROI calculation\u003C/strong>\u003C/p>\n\u003Cp>Some workflows are worth it regardless of break-even math:\u003C/p>\n\u003Cul>\n\u003Cli>Team onboarding tasks (new hires benefit disproportionately)\u003C/li>\n\u003Cli>Critical path operations where consistency matters more than speed\u003C/li>\n\u003Cli>Compliance tasks that require documented, repeatable processes\u003C/li>\n\u003C/ul>\n\u003Cp>If the task is high-stakes or high-variance, the value of predictability can exceed the value of time saved.\u003C/p>\n\u003Ch2 id=\"agent-opportunity-build-a-prompt-library\">Agent Opportunity: Build a Prompt Library\u003C/h2>\n\u003Cp>Here’s where you can multiply your impact:\u003C/p>\n\u003Cpre class=\"mermaid\">flowchart TD\n    subgraph LIB[\".claude/commands/\"]\n        A[\"analyze.md - File analysis\"]\n        B[\"refactor.md - Guided refactoring\"]\n        C[\"test.md - Generate tests\"]\n        D[\"document.md - Add documentation\"]\n        E[\"review.md - Code review checklist\"]\n        F[\"debug.md - Systematic debugging\"]\n    end\n\n    LIB --> G[\"Each prompt follows: Input → Workflow → Output\"]\n    G --> H[\"Reusable across projects\"]\n    H --> I[\"Serves you, your team, AND your agents\"]\n\n    style LIB fill:#e8f5e9\n\u003C/pre>\n\u003Ch2 id=\"why-workflows-beat-ad-hoc-prompting\">Why Workflows Beat Ad-Hoc Prompting\u003C/h2>\n\u003Cpre class=\"mermaid\">flowchart LR\n    subgraph ADHOC[\"AD-HOC PROMPTING\"]\n        A1[\"'Help me refactor this'\"]\n        A2[Unpredictable scope]\n        A3[Inconsistent output]\n        A4[No error handling]\n        A5[Can't reuse]\n        A6[Team can't use it]\n    end\n\n    subgraph WORKFLOW[\"WORKFLOW PROMPTING\"]\n        W1[\"Step 1: Backup\"]\n        W2[\"Step 2: Analyze\"]\n        W3[\"Step 3: Plan\"]\n        W4[\"Step 4: Execute\"]\n        W5[\"Step 5: Verify\"]\n        W6[\"Step 6: Document\"]\n    end\n\n    WORKFLOW --> R1[Predictable execution]\n    WORKFLOW --> R2[Consistent format]\n    WORKFLOW --> R3[Early returns on error]\n    WORKFLOW --> R4[Reusable forever]\n    WORKFLOW --> R5[Team multiplier]\n\n    style ADHOC fill:#ffcdd2\n    style WORKFLOW fill:#c8e6c9\n\u003C/pre>\n\u003Cp>The workflow prompt transforms a vague request into an executable engineering plan. One workflow prompt executing for an hour can generate work that would take you 20 hours.\u003C/p>\n\u003Ch2 id=\"building-your-first-workflow-prompt-start-today\">Building Your First Workflow Prompt (Start Today)\u003C/h2>\n\u003Cp>Start with your most common task. The one you do every day. The one where you think “I should automate this.”\u003C/p>\n\u003Col>\n\u003Cli>Write out the steps you take manually\u003C/li>\n\u003Cli>Convert each step to a numbered instruction\u003C/li>\n\u003Cli>Add variables for the parts that change\u003C/li>\n\u003Cli>Add early returns for failure cases\u003C/li>\n\u003Cli>Specify the output format you want\u003C/li>\n\u003C/ol>\n\u003Cp>Test it. Iterate. Add to your library.\u003C/p>\n\u003Cp>\u003Cstrong>The prompt is the new fundamental unit of engineering.\u003C/strong> The workflow section is where that engineering actually happens. One good workflow prompt doesn’t just save time—it compounds across every use, every team member, every project.\u003C/p>\n\u003Cp>Stop typing the same instructions. Start building reusable workflows.\u003C/p>\n\u003Chr>\n\u003Cp>\u003Cstrong>Key Takeaways:\u003C/strong>\u003C/p>\n\u003Cul>\n\u003Cli>Workflow sections are S-tier value, C-tier difficulty\u003C/li>\n\u003Cli>Input → Workflow → Output is the universal pattern\u003C/li>\n\u003Cli>Numbered steps create predictable execution\u003C/li>\n\u003Cli>Early returns handle failure cases cleanly\u003C/li>\n\u003Cli>Workflows fail on complex judgment calls, ambiguous requirements, and real-time adaptation tasks\u003C/li>\n\u003Cli>Break-even calculation: (Time to write) / (Time saved per use) = minimum uses needed\u003C/li>\n\u003Cli>A 30-minute workflow prompt pays off after 3 uses of a 15-minute task\u003C/li>\n\u003Cli>Build a library of reusable workflow prompts for maximum team ROI\u003C/li>\n\u003Cli>One good workflow prompt = 20+ hours of work\u003C/li>\n\u003C/ul>\n\u003Cp>\u003Cstrong>Try It Now (20 Minutes to First Workflow):\u003C/strong>\nCopy the analyze.md template above, save to \u003Ccode>.claude/commands/analyze.md\u003C/code>, and run \u003Ccode>/analyze\u003C/code> on any file in your codebase. Time how long it takes to write the prompt and how long the analysis takes to run. Calculate your break-even point for the next time you need to analyze a file.\u003C/p>\n\u003Cp>If you use it 4 times, you’ve already recouped your investment. Everything after that is pure productivity gain. Share it with your team and multiply the returns.\u003C/p>",{"headings":42,"localImagePaths":68,"remoteImagePaths":69,"frontmatter":70,"imagePaths":74},[43,47,50,53,56,59,62,65],{"depth":44,"slug":45,"text":46},2,"the-core-pattern-input--workflow--output","The Core Pattern: Input → Workflow → Output",{"depth":44,"slug":48,"text":49},"poc-a-working-workflow-prompt","POC: A Working Workflow Prompt",{"depth":44,"slug":51,"text":52},"the-workflow-section-deep-dive","The Workflow Section Deep Dive",{"depth":44,"slug":54,"text":55},"when-workflow-prompts-fail-know-this-before-you-invest-the-time","When Workflow Prompts Fail (Know This Before You Invest the Time)",{"depth":44,"slug":57,"text":58},"measuring-workflow-roi","Measuring Workflow ROI",{"depth":44,"slug":60,"text":61},"agent-opportunity-build-a-prompt-library","Agent Opportunity: Build a Prompt Library",{"depth":44,"slug":63,"text":64},"why-workflows-beat-ad-hoc-prompting","Why Workflows Beat Ad-Hoc Prompting",{"depth":44,"slug":66,"text":67},"building-your-first-workflow-prompt-start-today","Building Your First Workflow Prompt (Start Today)",[],[],{"title":14,"description":15,"pubDate":71,"author":17,"tags":72,"banner":25,"category":34,"difficulty":35,"tldr":27,"keyTakeaways":73},["Date","2025-12-15T00:00:00.000Z"],[19,20,21,22,23],[29,30,31,32,33],[],"workflow-prompts.md","context-engineering",{"id":76,"data":78,"body":98,"filePath":99,"digest":100,"rendered":101,"legacyId":170},{"title":79,"description":80,"pubDate":81,"author":17,"tags":82,"draft":24,"banner":87,"seoKeywords":88,"tldr":89,"keyTakeaways":90,"category":96,"difficulty":97},"Context Engineering: From Token Optimization to Large Codebase Mastery","Progressive disclosure and semantic search: the difference between burning tokens and shipping features. Working code and hard numbers inside.",["Date","2025-12-15T00:00:00.000Z"],[19,83,84,85,86],"context-window","mcp","semantic-search","optimization","/assets/posts/context-engineering-banner.png",[],"Context is your budget—every token loaded is a tax on productivity. Progressive disclosure reduces context consumption by 94% by loading tools only when needed. For large codebases (55K+ files), semantic search with tools like Serena MCP provides 36x performance improvements over naive approaches.",[91,92,93,94,95],"MCP servers can consume 20% of your context before work begins—if tools consume >15%, you have an architecture problem","Progressive disclosure with UV scripts reduces context from 40,000 to 2,500 tokens (94% reduction)","Semantic search outperforms ripgrep at scale: 36x faster search, 28x faster symbol navigation, 23x faster references","Real cost savings: $2.40 per 100 queries with semantic search vs $86.40 with full context loading","The 15% rule: if upfront context consumption exceeds 15%, refactor to progressive disclosure","Context Engineering","Advanced","Context is finite. Every token your agent loads before it starts working is a tax on productivity.\n\nMost developers don't notice this tax until their agent slows down, loses track of earlier conversation, or hits the context ceiling mid-task. By then, they've been paying it on every request.\n\nThis post shows you how to engineer context consumption—from basic token optimization with progressive disclosure, to large codebase mastery with semantic search. Working code, hard numbers, honest failure modes included.\n\n## The Core Problem: Context is Precious\n\nYour context window is your budget. MCP servers spend it like a trust fund kid with no concept of scarcity.\n\n```mermaid\nflowchart TD\n    A([Agent starts]) --> B[Load ALL tools\u003Cbr/>from ALL MCPs]\n    B --> |10,000 tokens\u003Cbr/>per MCP server| C[40,000 tokens consumed]\n    C --> |20% of context GONE\u003Cbr/>before any work starts| D([Agent begins work\u003Cbr/>with 80% remaining])\n\n    style C fill:#ffcdd2\n```\n\nFour MCP servers at 10,000 tokens each = 40,000 tokens consumed before you type a single character.\n\nIf tools consume more than 15% of your context, you have an architecture problem. For many use cases, [Claude Skills](/blog/claude-skills-deep-dive) offer a lighter-weight alternative—loading ~100 tokens of metadata upfront and only fetching full instructions when triggered.\n\n## Pattern 1: Progressive Disclosure\n\nProgressive disclosure loads tools only when needed. Instead of front-loading everything, give your agent an index of what exists—and let it load only what it uses.\n\n```mermaid\nflowchart TD\n    A([Agent starts]) --> B[Load PRIME only\u003Cbr/>index of tools]\n    B --> |~500 tokens| C{Agent needs\u003Cbr/>market data?}\n    C --> |Yes| D[Load ONLY\u003Cbr/>market_search.py]\n    D --> |2,000 tokens| E([Agent continues\u003Cbr/>with 98% context remaining])\n\n    style B fill:#c8e6c9\n    style E fill:#c8e6c9\n```\n\nResult: 2,500 tokens instead of 40,000. 94% reduction.\n\n### Implementation: Tool Index + UV Scripts\n\nCreate a tool index as a simple markdown file:\n\n**`~/tools/README.md`**\n```markdown\n# Available Tools\n\nYou have access to the following tool scripts. **Do not read script contents unless --help doesn't provide enough information.**\n\n## Market Tools\nLocated in: `~/tools/market/`\n- `search.py` - Search prediction markets by keyword\n- `get_market.py` - Get details for specific market ID\n- `get_orderbook.py` - Get current orderbook for market\n\n## Data Tools\nLocated in: `~/tools/data/`\n- `fetch_csv.py` - Download CSV from URL\n- `analyze_csv.py` - Basic statistical analysis\n- `transform_csv.py` - Transform/filter CSV data\n\n## When you need a tool:\n1. Run `uv run ~/tools/{category}/{script}.py --help`\n2. Read the help output to understand usage\n3. Run the tool with appropriate arguments\n4. Only read script source if help is insufficient\n```\n\nThis index costs ~200 tokens. The agent knows WHERE tools are without loading them.\n\nEach tool is a UV single-file script with embedded dependencies:\n\n**`~/tools/market/search.py`**\n```python\n# github: https://github.com/ameno-/acidbath-code/blob/main/agentic-patterns/context-engineering/when-you-need/when_you_need.py\n#!/usr/bin/env -S uv run\n# /// script\n# dependencies = [\n#   \"requests>=2.31.0\",\n#   \"rich>=13.0.0\",\n# ]\n# ///\n\"\"\"\nSearch prediction markets by keyword.\n\nUsage:\n    uv run search.py --query \"election\" [--limit 10]\n\nArguments:\n    --query, -q    Search term (required)\n    --limit, -l    Max results (default: 10)\n    --format, -f   Output format: json|table (default: table)\n\"\"\"\n\nimport argparse\nimport json\nimport requests\nfrom rich.console import Console\nfrom rich.table import Table\n\nKALSHI_API = \"https://trading-api.kalshi.com/trade-api/v2\"\n\ndef search_markets(query: str, limit: int = 10) -> list:\n    \"\"\"Search Kalshi markets by keyword.\"\"\"\n    response = requests.get(\n        f\"{KALSHI_API}/markets\",\n        params={\"status\": \"open\", \"limit\": limit},\n        headers={\"Accept\": \"application/json\"}\n    )\n    response.raise_for_status()\n\n    markets = response.json().get(\"markets\", [])\n    # Filter by query in title\n    return [m for m in markets if query.lower() in m.get(\"title\", \"\").lower()][:limit]\n\ndef main():\n    parser = argparse.ArgumentParser(description=\"Search prediction markets\")\n    parser.add_argument(\"-q\", \"--query\", required=True, help=\"Search term\")\n    parser.add_argument(\"-l\", \"--limit\", type=int, default=10, help=\"Max results\")\n    parser.add_argument(\"-f\", \"--format\", choices=[\"json\", \"table\"], default=\"table\")\n\n    args = parser.parse_args()\n\n    markets = search_markets(args.query, args.limit)\n\n    if args.format == \"json\":\n        print(json.dumps(markets, indent=2))\n    else:\n        console = Console()\n        table = Table(title=f\"Markets matching '{args.query}'\")\n        table.add_column(\"ID\", style=\"cyan\")\n        table.add_column(\"Title\", style=\"green\")\n        table.add_column(\"Volume\", justify=\"right\")\n\n        for m in markets:\n            table.add_row(\n                m.get(\"ticker\", \"\"),\n                m.get(\"title\", \"\")[:50],\n                str(m.get(\"volume\", 0))\n            )\n\n        console.print(table)\n\nif __name__ == \"__main__\":\n    main()\n```\n\n### The Flow in Practice\n\n```\nUser: \"What's the current price on election markets?\"\n\nAgent:\n1. Reads ~/tools/README.md (200 tokens)\n2. Sees market/search.py exists\n3. Runs: uv run ~/tools/market/search.py --help (500 tokens)\n4. Learns usage from help output\n5. Runs: uv run ~/tools/market/search.py -q \"election\"\n6. Returns results\n\nTotal context: ~2,700 tokens\nMCP equivalent: ~10,000 tokens\n```\n\n### Progressive Disclosure Numbers\n\n| Approach | Initial Load | Per-Tool Cost | 4 Tools Used |\n|----------|-------------|---------------|--------------|\n| MCP Server | 10,000 tokens | 0 (pre-loaded) | 10,000 |\n| Progressive | 200 tokens | 500-2,000 | 2,200-8,200 |\n\nProgressive disclosure wins when you use fewer than all available tools—which is almost always. Most tasks use 2-3 tools out of 20 available.\n\nFor taking this pattern further, see [Single-File Scripts](/blog/single-file-scripts)—UV and Bun scripts that replace entire MCP servers with zero-config executables.\n\n## Pattern 2: Semantic Search for Large Codebases\n\nProgressive disclosure optimizes tool loading. But when you're working with large codebases, the problem isn't tool overhead—it's search strategy.\n\nBrute-force text search doesn't scale. Semantic search does.\n\n### Why Text Search Fails\n\n```mermaid\nflowchart TD\n    TASK[\"Task: Rename UserService → UserManager\"]\n    TASK --> S1\n\n    subgraph S1[\"Step 1: grep -r\"]\n        G1[847 matches across 312 files]\n        G2[Includes comments, strings, similar names]\n        G3[15,000 tokens consumed]\n    end\n\n    S1 --> S2\n    subgraph S2[\"Step 2: Read files\"]\n        R1[Agent reads each file]\n        R2[Looking for actual type usage]\n        R3[More tokens consumed]\n    end\n\n    S2 --> S3\n    subgraph S3[\"Step 3: Make changes\"]\n        C1[Text replacement]\n        C2[Misses generic constraints]\n        C3[Misses reflection usage]\n    end\n\n    S3 --> S4\n    subgraph S4[\"Step 4: Build fails\"]\n        F1[Agent scans again]\n        F2[More tokens]\n        F3[Loop continues...]\n    end\n\n    S4 --> |Retry loop| S1\n    S4 --> RESULT[3 hours, 28M tokens, $14, still broken]\n\n    style RESULT fill:#ffcdd2\n```\n\nThe build-fail-retry cycle is the productivity bottleneck. Text search guarantees you'll hit it.\n\n### How Semantic Search Works\n\n```mermaid\nflowchart TD\n    TASK[\"Task: Rename UserService → UserManager\"]\n    TASK --> S1\n\n    subgraph S1[\"Step 1: find_symbol\"]\n        F1[\"find_symbol('UserService', type='class')\"]\n        F2[Semantic understanding of code structure]\n        F3[Returns: definition location, all usages]\n        F4[500 tokens consumed]\n    end\n\n    S1 --> S2\n    subgraph S2[\"Step 2: rename_symbol\"]\n        R1[\"rename_symbol('UserService', 'UserManager')\"]\n        R2[Uses compiler's refactoring engine]\n        R3[Handles generics, reflection, inheritance]\n    end\n\n    S2 --> S3\n    subgraph S3[\"Step 3: Done\"]\n        D1[Build passes first try]\n        D2[5 minutes total]\n    end\n\n    S3 --> RESULT[5 minutes, 1M tokens, $0.60, works]\n\n    style RESULT fill:#c8e6c9\n```\n\nThe key difference:\n- Text search: \"Find this string anywhere\"\n- Semantic search: \"Find this symbol in the AST\"\n\nSemantic search understands code structure. It knows the difference between a type name, a string literal that happens to contain that text, and a comment mentioning it.\n\n### Setting Up Serena MCP\n\nSerena provides semantic search for multiple languages (TypeScript, JavaScript, Python, Go, Rust).\n\n**Installation:**\n\n```bash\n# Clone the repository\ngit clone https://github.com/oramasearch/serena.git\ncd serena\n\n# Install dependencies\nnpm install\n\n# Build the project\nnpm run build\n```\n\n**Configuration for Claude Code:**\n\nAdd to `~/.claude/mcp.json`:\n\n```json\n{\n  \"mcpServers\": {\n    \"serena\": {\n      \"command\": \"node\",\n      \"args\": [\"/absolute/path/to/serena/dist/index.js\"],\n      \"env\": {\n        \"PROJECT_ROOT\": \".\"\n      }\n    }\n  }\n}\n```\n\n**Available tools:**\n\n| Tool | Description |\n|------|-------------|\n| `find_symbol` | Find symbol definition and all usages |\n| `find_references` | Find all references to a symbol |\n| `get_definition` | Get the definition of a symbol at a location |\n| `semantic_search` | Search code semantically, not just text |\n| `get_file_symbols` | List all symbols in a file |\n\n### Adding Language-Specific Refactoring\n\nFor C#/.NET, add Refactor MCP for Roslyn-powered operations:\n\n```bash\n# Clone the repository\ngit clone https://github.com/JetBrains/refactor-mcp.git\ncd refactor-mcp\n\n# Build\ndotnet build\n```\n\nAdd to MCP config:\n\n```json\n{\n  \"mcpServers\": {\n    \"refactor\": {\n      \"command\": \"dotnet\",\n      \"args\": [\"run\", \"--project\", \"/path/to/refactor-mcp\"],\n      \"env\": {\n        \"SOLUTION_PATH\": \"/path/to/your/solution.sln\"\n      }\n    }\n  }\n}\n```\n\n**Available refactoring operations:**\n\n| Tool | Description |\n|------|-------------|\n| `rename_symbol` | Rename with full semantic awareness |\n| `extract_method` | Extract code into a new method |\n| `inline_method` | Inline a method at call sites |\n| `extract_interface` | Create interface from class |\n| `move_type` | Move type to another file/namespace |\n\n### The Numbers: 55,000 File Codebase\n\nReal measurements from a production codebase:\n\n| Metric | Text Search | Semantic Search | Improvement |\n|--------|-------------|-----------------|-------------|\n| Time | 3 hours | 5 minutes | 36x |\n| Tokens | 28M | 1M | 28x |\n| Cost | $14 | $0.60 | 23x |\n| Human intervention | Constant | None | ∞ |\n| Build failures | 4 | 0 | - |\n\nThe cost of NOT having semantic tools scales with codebase size. A 10x larger codebase isn't 10x worse—it's 100x worse with text search.\n\n### Workflow Comparison\n\n**Without semantic tools (3 hours):**\n\n```\nUser: \"Rename UserService to UserManager across the codebase\"\n\nAgent:\n1. grep -r \"UserService\" . → 847 results\n2. Read 312 files → 28M tokens consumed\n3. Text-replace in each file\n4. Build fails (missed generic constraints)\n5. grep again for the error\n6. Fix, rebuild\n7. Build fails (missed reflection usage)\n8. Loop continues...\n\nResult: 3 hours, multiple human interventions, $14\n```\n\n**With semantic tools (5 minutes):**\n\n```\nUser: \"Rename UserService to UserManager across the codebase\"\n\nAgent:\n1. find_symbol(\"UserService\") → 42 actual usages\n2. rename_symbol(\"UserService\", \"UserManager\")\n3. Build passes\n\nResult: 5 minutes, autonomous, $0.60\n```\n\n## When This Fails: Honest Limitations\n\nBoth patterns have failure modes. Here's what doesn't work—learned through production deployments, not theory.\n\n### Progressive Disclosure Failures\n\n**Setup overhead becomes the bottleneck:**\n- If you're prototyping and need 15 different tools quickly, progressive disclosure adds friction\n- Writing UV scripts and maintaining a tool index takes time\n- For one-off tasks, the setup cost exceeds the savings\n\n**Language and dependency constraints:**\n- UV is Python-focused; other languages need different patterns\n- Binary tools require wrapper scripts\n- Complex authentication flows are harder to embed in single files\n\n**When tool reuse is low:**\n- If every task needs a new custom script, you're not saving context\n- The index becomes noise if most tools are one-time use\n\n### Semantic Search Failures\n\n**Initial indexing cost:**\n- First run on a large codebase can take minutes to hours\n- Index storage can be GBs for very large projects\n- Re-indexing after major refactors adds overhead\n\n**Language support gaps:**\n- Not all languages have mature semantic tooling\n- Dynamic languages (Ruby, PHP) have weaker semantic analysis\n- Mixed codebases (Python + JavaScript + Go) need multiple MCP servers\n\n**False confidence in refactoring:**\n- Semantic tools can't catch runtime-only issues\n- Reflection-heavy code may still break\n- Cross-service boundaries aren't tracked\n\n**Setup complexity:**\n- Requires building/installing language-specific servers\n- Configuration mistakes lead to silent failures\n- Version mismatches between tools and target code\n\n**Cost isn't always lower:**\n- For small codebases (\u003C 100 files), text search is faster\n- For simple string replacements, grep is sufficient\n- If you only search once, indexing overhead dominates\n\n## Decision Framework: When to Use Which Pattern\n\n```mermaid\nflowchart LR\n    subgraph MCP[\"Standard MCP (80%)\"]\n        M1[External APIs]\n        M2[Vendor tools]\n        M3[Quick prototyping]\n        M4[\"Small codebases (\u003C 100 files)\"]\n    end\n\n    subgraph PD[\"Progressive Disclosure (15%)\"]\n        P1[Custom internal tools]\n        P2[Team-wide utilities]\n        P3[Long-running sessions]\n        P4[Precise token control]\n    end\n\n    subgraph SS[\"Semantic Search (5%)\"]\n        S1[\"Large codebases (> 1,000 files)\"]\n        S2[Type/symbol renaming]\n        S3[Complex type usages]\n        S4[Build-fail-retry cycles]\n    end\n\n    subgraph COMBO[\"Combine Progressive + Semantic\"]\n        C1[Load semantic MCP only when refactoring]\n        C2[Keep tool index lightweight]\n        C3[Semantic for code, progressive for APIs]\n    end\n\n    style MCP fill:#e3f2fd\n    style PD fill:#fff3e0\n    style SS fill:#fce4ec\n    style COMBO fill:#e8f5e9\n```\n\n### The Selection Test\n\nAsk these questions:\n\n1. **How many files will be touched?**\n   - \u003C 10 files: Text search is fine\n   - 10-100 files: Text search with careful prompting\n   - 100-1,000 files: Consider semantic\n   - 1,000+ files: Semantic is required\n\n2. **How many tools will be used?**\n   - All of them: MCP upfront loading is fine\n   - Most of them: MCP is fine\n   - Some of them: Progressive disclosure wins\n   - Few of them: Progressive disclosure wins heavily\n\n3. **What's the task complexity?**\n   - String replacement: Text search works\n   - Symbol renaming: Semantic required\n   - Cross-file refactoring: Semantic required\n   - Type hierarchy changes: Semantic required\n\n4. **Is this a one-off or repeated work?**\n   - One-off: Setup cost dominates, use simple tools\n   - Repeated: Setup cost amortizes, invest in optimization\n\n## Key Takeaways\n\n- Context is finite; every pre-loaded token is a tax on productivity\n- Progressive disclosure reduces tool overhead by 90%+ when you don't use all tools\n- Semantic search provides 28x token reduction and 36x speed improvement on large codebases\n- Combine both: use progressive disclosure for tool loading, semantic search for code operations\n- Text search fails at scale due to build-fail-retry cycles\n- Setup overhead is real; optimize only when the math supports it\n- Most codebases (\u003C 100 files) don't need semantic tools\n- Tool sophistication matters more than raw model capability for large codebases\n\n## Try It Now (15 Minutes Each)\n\n**For progressive disclosure:**\nCreate `~/tools/README.md` with an index of 3 UV scripts. Point your agent at it instead of loading an MCP server. Track token consumption with `/context` in Claude Code. You should see 90%+ reduction in upfront token usage.\n\n**For semantic search:**\nInstall Serena MCP. Run `find_symbol` on a type in your codebase. Compare the results and token usage to `grep -r`. If you're touching more than 100 files, measure the difference—the gap is significant.\n\n**The best context engineering is invisible.** Your agent just works faster, costs less, and fails less often. That's not an optimization. That's a competitive advantage.","src/content/blog/context-engineering.md","0ba1e4e9ff4851a5",{"html":102,"metadata":103},"\u003Cp>Context is finite. Every token your agent loads before it starts working is a tax on productivity.\u003C/p>\n\u003Cp>Most developers don’t notice this tax until their agent slows down, loses track of earlier conversation, or hits the context ceiling mid-task. By then, they’ve been paying it on every request.\u003C/p>\n\u003Cp>This post shows you how to engineer context consumption—from basic token optimization with progressive disclosure, to large codebase mastery with semantic search. Working code, hard numbers, honest failure modes included.\u003C/p>\n\u003Ch2 id=\"the-core-problem-context-is-precious\">The Core Problem: Context is Precious\u003C/h2>\n\u003Cp>Your context window is your budget. MCP servers spend it like a trust fund kid with no concept of scarcity.\u003C/p>\n\u003Cpre class=\"mermaid\">flowchart TD\n    A([Agent starts]) --> B[Load ALL tools&#x3C;br/>from ALL MCPs]\n    B --> |10,000 tokens&#x3C;br/>per MCP server| C[40,000 tokens consumed]\n    C --> |20% of context GONE&#x3C;br/>before any work starts| D([Agent begins work&#x3C;br/>with 80% remaining])\n\n    style C fill:#ffcdd2\n\u003C/pre>\n\u003Cp>Four MCP servers at 10,000 tokens each = 40,000 tokens consumed before you type a single character.\u003C/p>\n\u003Cp>If tools consume more than 15% of your context, you have an architecture problem. For many use cases, \u003Ca href=\"/blog/claude-skills-deep-dive\">Claude Skills\u003C/a> offer a lighter-weight alternative—loading ~100 tokens of metadata upfront and only fetching full instructions when triggered.\u003C/p>\n\u003Ch2 id=\"pattern-1-progressive-disclosure\">Pattern 1: Progressive Disclosure\u003C/h2>\n\u003Cp>Progressive disclosure loads tools only when needed. Instead of front-loading everything, give your agent an index of what exists—and let it load only what it uses.\u003C/p>\n\u003Cpre class=\"mermaid\">flowchart TD\n    A([Agent starts]) --> B[Load PRIME only&#x3C;br/>index of tools]\n    B --> |~500 tokens| C{Agent needs&#x3C;br/>market data?}\n    C --> |Yes| D[Load ONLY&#x3C;br/>market_search.py]\n    D --> |2,000 tokens| E([Agent continues&#x3C;br/>with 98% context remaining])\n\n    style B fill:#c8e6c9\n    style E fill:#c8e6c9\n\u003C/pre>\n\u003Cp>Result: 2,500 tokens instead of 40,000. 94% reduction.\u003C/p>\n\u003Ch3 id=\"implementation-tool-index--uv-scripts\">Implementation: Tool Index + UV Scripts\u003C/h3>\n\u003Cp>Create a tool index as a simple markdown file:\u003C/p>\n\u003Cp>\u003Cstrong>\u003Ccode>~/tools/README.md\u003C/code>\u003C/strong>\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"22\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">MARKDOWN\u003C/span>\u003Cspan class=\"language-badge\">markdown\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container collapsible with-line-numbers\" data-language=\"markdown\" data-line-count=\"22\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cbutton class=\"collapse-toggle\" aria-label=\"Toggle code visibility\" type=\"button\">\u003Cspan class=\"expand-text\">Expand (22 lines)\u003C/span>\u003Cspan class=\"collapse-text\">Collapse\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Clink rel=\"stylesheet\" href=\"/_astro/ec.44wa8.css\">\u003Cscript type=\"module\" src=\"/_astro/ec.0vx5m.js\">\u003C/script>\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"markdown\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#79B8FF;--0fw:bold;--1:#005CC5;--1fw:bold\"># Available Tools\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">You have access to the following tool scripts. \u003C/span>\u003Cspan style=\"--0:#E1E4E8;--0fw:bold;--1:#24292E;--1fw:bold\">**Do not read script contents unless --help doesn't provide enough information.**\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#79B8FF;--0fw:bold;--1:#005CC5;--1fw:bold\">## Market Tools\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">Located in: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">`~/tools/market/`\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">`search.py`\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> - Search prediction markets by keyword\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">`get_market.py`\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> - Get details for specific market ID\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">`get_orderbook.py`\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> - Get current orderbook for market\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#79B8FF;--0fw:bold;--1:#005CC5;--1fw:bold\">## Data Tools\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">Located in: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">`~/tools/data/`\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">`fetch_csv.py`\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> - Download CSV from URL\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">`analyze_csv.py`\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> - Basic statistical analysis\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">`transform_csv.py`\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> - Transform/filter CSV data\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#79B8FF;--0fw:bold;--1:#005CC5;--1fw:bold\">## When you need a tool:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">1.\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Run \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">`uv run ~/tools/{category}/{script}.py --help`\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">2.\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Read the help output to understand usage\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">3.\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Run the tool with appropriate arguments\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">4.\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Only read script source if help is insufficient\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"# Available ToolsYou have access to the following tool scripts. **Do not read script contents unless --help doesn&#x27;t provide enough information.**## Market ToolsLocated in: &#x60;~/tools/market/&#x60;- &#x60;search.py&#x60; - Search prediction markets by keyword- &#x60;get_market.py&#x60; - Get details for specific market ID- &#x60;get_orderbook.py&#x60; - Get current orderbook for market## Data ToolsLocated in: &#x60;~/tools/data/&#x60;- &#x60;fetch_csv.py&#x60; - Download CSV from URL- &#x60;analyze_csv.py&#x60; - Basic statistical analysis- &#x60;transform_csv.py&#x60; - Transform/filter CSV data## When you need a tool:1. Run &#x60;uv run ~/tools/{category}/{script}.py --help&#x60;2. Read the help output to understand usage3. Run the tool with appropriate arguments4. Only read script source if help is insufficient\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003Cdiv class=\"code-fade\" aria-hidden=\"true\">\u003C/div>\u003C/div>\u003C/div>\n\u003Cp>This index costs ~200 tokens. The agent knows WHERE tools are without loading them.\u003C/p>\n\u003Cp>Each tool is a UV single-file script with embedded dependencies:\u003C/p>\n\u003Cp>\u003Cstrong>\u003Ccode>~/tools/market/search.py\u003C/code>\u003C/strong>\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"72\" data-has-github=\"true\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">PYTHON\u003C/span>\u003Cspan class=\"language-badge\">python\u003C/span>\u003Ca class=\"github-header-link\" href=\"https://github.com/ameno-/acidbath-code/blob/main/agentic-patterns/context-engineering/when-you-need/when_you_need.py\" target=\"_blank\" rel=\"noopener noreferrer\" title=\"View source on GitHub: agentic-patterns/context-engineering/when-you-need/when_you_need.py\">\u003Cspan class=\"github-icon\">↗\u003C/span>\u003Cspan class=\"github-text\">GitHub\u003C/span>\u003C/a>\u003C/div>\u003Cdiv class=\"code-block-container collapsible with-line-numbers has-github-link\" data-language=\"python\" data-line-count=\"72\" data-max-preview=\"8\" data-github-url=\"https://github.com/ameno-/acidbath-code/blob/main/agentic-patterns/context-engineering/when-you-need/when_you_need.py\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cbutton class=\"collapse-toggle\" aria-label=\"Toggle code visibility\" type=\"button\">\u003Cspan class=\"expand-text\">Expand (72 lines)\u003C/span>\u003Cspan class=\"collapse-text\">Collapse\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"python\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># github: https://github.com/ameno-/acidbath-code/blob/main/agentic-patterns/context-engineering/when-you-need/when_you_need.py\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\">#!/usr/bin/env -S uv run\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># /// script\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># dependencies = [\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\">#   \"requests>=2.31.0\",\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\">#   \"rich>=13.0.0\",\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># ]\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># ///\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\"\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">Search prediction markets by keyword.\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">Usage:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">uv run search.py --query \"election\" [--limit 10]\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">Arguments:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">--query, -q    Search term (required)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">--limit, -l    Max results (default: 10)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">--format, -f   Output format: json|table (default: table)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\"\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">import\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> argparse\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">import\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> json\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">import\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> requests\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">from\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> rich.console \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">import\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Console\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">from\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> rich.table \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">import\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Table\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">KALSHI_API\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"https://trading-api.kalshi.com/trade-api/v2\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">def\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">search_markets\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(query: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">str\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, limit: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">int\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">10\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">) -> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">list\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\"\"Search Kalshi markets by keyword.\"\"\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">response \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> requests.get(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">f\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">{KALSHI_API}\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">/markets\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">params\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">{\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"status\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"open\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"limit\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: limit},\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">headers\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">{\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"Accept\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"application/json\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">response.raise_for_status()\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">markets \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> response.json().get(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"markets\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, [])\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Filter by query in title\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">return\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> [m \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">for\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> m \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">in\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> markets \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">if\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> query.lower() \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">in\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> m.get(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"title\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">).lower()][:limit]\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">def\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">main\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">():\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">parser \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> argparse.ArgumentParser(\u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">description\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"Search prediction markets\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">parser.add_argument(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"-q\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"--query\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">required\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">True\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">help\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"Search term\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">parser.add_argument(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"-l\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"--limit\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">type\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">int\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">default\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">10\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">help\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"Max results\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">parser.add_argument(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"-f\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"--format\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">choices\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">[\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"json\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"table\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">], \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">default\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"table\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">args \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> parser.parse_args()\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">markets \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> search_markets(args.query, args.limit)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">if\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> args.format \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">==\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"json\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">print\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(json.dumps(markets, \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">indent\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">2\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">))\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">else\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">console \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Console()\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">table \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Table(\u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">title\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">f\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"Markets matching '\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">{\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">args.query\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">}\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">'\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">table.add_column(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"ID\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">style\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"cyan\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">table.add_column(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"Title\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">style\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"green\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">table.add_column(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"Volume\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">justify\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"right\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">for\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> m \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">in\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> markets:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">            \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">table.add_row(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">                \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">m.get(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"ticker\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">                \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">m.get(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"title\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)[:\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">50\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">],\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">                \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">str\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(m.get(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"volume\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">0\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">))\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">            \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">console.print(table)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">if\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">__name__\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">==\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"__main__\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">main()\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"# github: https://github.com/ameno-/acidbath-code/blob/main/agentic-patterns/context-engineering/when-you-need/when_you_need.py#!/usr/bin/env -S uv run# /// script# dependencies = [#   &#x22;requests>=2.31.0&#x22;,#   &#x22;rich>=13.0.0&#x22;,# ]# ///&#x22;&#x22;&#x22;Search prediction markets by keyword.Usage:    uv run search.py --query &#x22;election&#x22; [--limit 10]Arguments:    --query, -q    Search term (required)    --limit, -l    Max results (default: 10)    --format, -f   Output format: json|table (default: table)&#x22;&#x22;&#x22;import argparseimport jsonimport requestsfrom rich.console import Consolefrom rich.table import TableKALSHI_API = &#x22;https://trading-api.kalshi.com/trade-api/v2&#x22;def search_markets(query: str, limit: int = 10) -> list:    &#x22;&#x22;&#x22;Search Kalshi markets by keyword.&#x22;&#x22;&#x22;    response = requests.get(        f&#x22;{KALSHI_API}/markets&#x22;,        params={&#x22;status&#x22;: &#x22;open&#x22;, &#x22;limit&#x22;: limit},        headers={&#x22;Accept&#x22;: &#x22;application/json&#x22;}    )    response.raise_for_status()    markets = response.json().get(&#x22;markets&#x22;, [])    # Filter by query in title    return [m for m in markets if query.lower() in m.get(&#x22;title&#x22;, &#x22;&#x22;).lower()][:limit]def main():    parser = argparse.ArgumentParser(description=&#x22;Search prediction markets&#x22;)    parser.add_argument(&#x22;-q&#x22;, &#x22;--query&#x22;, required=True, help=&#x22;Search term&#x22;)    parser.add_argument(&#x22;-l&#x22;, &#x22;--limit&#x22;, type=int, default=10, help=&#x22;Max results&#x22;)    parser.add_argument(&#x22;-f&#x22;, &#x22;--format&#x22;, choices=[&#x22;json&#x22;, &#x22;table&#x22;], default=&#x22;table&#x22;)    args = parser.parse_args()    markets = search_markets(args.query, args.limit)    if args.format == &#x22;json&#x22;:        print(json.dumps(markets, indent=2))    else:        console = Console()        table = Table(title=f&#x22;Markets matching &#x27;{args.query}&#x27;&#x22;)        table.add_column(&#x22;ID&#x22;, style=&#x22;cyan&#x22;)        table.add_column(&#x22;Title&#x22;, style=&#x22;green&#x22;)        table.add_column(&#x22;Volume&#x22;, justify=&#x22;right&#x22;)        for m in markets:            table.add_row(                m.get(&#x22;ticker&#x22;, &#x22;&#x22;),                m.get(&#x22;title&#x22;, &#x22;&#x22;)[:50],                str(m.get(&#x22;volume&#x22;, 0))            )        console.print(table)if __name__ == &#x22;__main__&#x22;:    main()\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003Cdiv class=\"code-fade\" aria-hidden=\"true\">\u003C/div>\u003C/div>\u003Cdiv class=\"code-block-footer\">\u003Ca class=\"github-source-link\" href=\"https://github.com/ameno-/acidbath-code/blob/main/agentic-patterns/context-engineering/when-you-need/when_you_need.py\" target=\"_blank\" rel=\"noopener noreferrer\">\u003Cspan class=\"github-arrow\">→\u003C/span>\u003Cspan> View full source: agentic-patterns/context-engineering/when-you-need/when_you_need.py\u003C/span>\u003C/a>\u003C/div>\u003C/div>\n\u003Ch3 id=\"the-flow-in-practice\">The Flow in Practice\u003C/h3>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"13\">\u003Cdiv class=\"code-block-container with-line-numbers\" data-language=\"\" data-line-count=\"13\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"plaintext\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">User: \"What's the current price on election markets?\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">Agent:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">1. Reads ~/tools/README.md (200 tokens)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">2. Sees market/search.py exists\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">3. Runs: uv run ~/tools/market/search.py --help (500 tokens)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">4. Learns usage from help output\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">5. Runs: uv run ~/tools/market/search.py -q \"election\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">6. Returns results\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">Total context: ~2,700 tokens\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">MCP equivalent: ~10,000 tokens\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"User: &#x22;What&#x27;s the current price on election markets?&#x22;Agent:1. Reads ~/tools/README.md (200 tokens)2. Sees market/search.py exists3. Runs: uv run ~/tools/market/search.py --help (500 tokens)4. Learns usage from help output5. Runs: uv run ~/tools/market/search.py -q &#x22;election&#x22;6. Returns resultsTotal context: ~2,700 tokensMCP equivalent: ~10,000 tokens\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003C/div>\u003C/div>\n\u003Ch3 id=\"progressive-disclosure-numbers\">Progressive Disclosure Numbers\u003C/h3>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\u003Ctable>\u003Cthead>\u003Ctr>\u003Cth>Approach\u003C/th>\u003Cth>Initial Load\u003C/th>\u003Cth>Per-Tool Cost\u003C/th>\u003Cth>4 Tools Used\u003C/th>\u003C/tr>\u003C/thead>\u003Ctbody>\u003Ctr>\u003Ctd>MCP Server\u003C/td>\u003Ctd>10,000 tokens\u003C/td>\u003Ctd>0 (pre-loaded)\u003C/td>\u003Ctd>10,000\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Progressive\u003C/td>\u003Ctd>200 tokens\u003C/td>\u003Ctd>500-2,000\u003C/td>\u003Ctd>2,200-8,200\u003C/td>\u003C/tr>\u003C/tbody>\u003C/table>\n\u003Cp>Progressive disclosure wins when you use fewer than all available tools—which is almost always. Most tasks use 2-3 tools out of 20 available.\u003C/p>\n\u003Cp>For taking this pattern further, see \u003Ca href=\"/blog/single-file-scripts\">Single-File Scripts\u003C/a>—UV and Bun scripts that replace entire MCP servers with zero-config executables.\u003C/p>\n\u003Ch2 id=\"pattern-2-semantic-search-for-large-codebases\">Pattern 2: Semantic Search for Large Codebases\u003C/h2>\n\u003Cp>Progressive disclosure optimizes tool loading. But when you’re working with large codebases, the problem isn’t tool overhead—it’s search strategy.\u003C/p>\n\u003Cp>Brute-force text search doesn’t scale. Semantic search does.\u003C/p>\n\u003Ch3 id=\"why-text-search-fails\">Why Text Search Fails\u003C/h3>\n\u003Cpre class=\"mermaid\">flowchart TD\n    TASK[\"Task: Rename UserService → UserManager\"]\n    TASK --> S1\n\n    subgraph S1[\"Step 1: grep -r\"]\n        G1[847 matches across 312 files]\n        G2[Includes comments, strings, similar names]\n        G3[15,000 tokens consumed]\n    end\n\n    S1 --> S2\n    subgraph S2[\"Step 2: Read files\"]\n        R1[Agent reads each file]\n        R2[Looking for actual type usage]\n        R3[More tokens consumed]\n    end\n\n    S2 --> S3\n    subgraph S3[\"Step 3: Make changes\"]\n        C1[Text replacement]\n        C2[Misses generic constraints]\n        C3[Misses reflection usage]\n    end\n\n    S3 --> S4\n    subgraph S4[\"Step 4: Build fails\"]\n        F1[Agent scans again]\n        F2[More tokens]\n        F3[Loop continues...]\n    end\n\n    S4 --> |Retry loop| S1\n    S4 --> RESULT[3 hours, 28M tokens, $14, still broken]\n\n    style RESULT fill:#ffcdd2\n\u003C/pre>\n\u003Cp>The build-fail-retry cycle is the productivity bottleneck. Text search guarantees you’ll hit it.\u003C/p>\n\u003Ch3 id=\"how-semantic-search-works\">How Semantic Search Works\u003C/h3>\n\u003Cpre class=\"mermaid\">flowchart TD\n    TASK[\"Task: Rename UserService → UserManager\"]\n    TASK --> S1\n\n    subgraph S1[\"Step 1: find_symbol\"]\n        F1[\"find_symbol('UserService', type='class')\"]\n        F2[Semantic understanding of code structure]\n        F3[Returns: definition location, all usages]\n        F4[500 tokens consumed]\n    end\n\n    S1 --> S2\n    subgraph S2[\"Step 2: rename_symbol\"]\n        R1[\"rename_symbol('UserService', 'UserManager')\"]\n        R2[Uses compiler's refactoring engine]\n        R3[Handles generics, reflection, inheritance]\n    end\n\n    S2 --> S3\n    subgraph S3[\"Step 3: Done\"]\n        D1[Build passes first try]\n        D2[5 minutes total]\n    end\n\n    S3 --> RESULT[5 minutes, 1M tokens, $0.60, works]\n\n    style RESULT fill:#c8e6c9\n\u003C/pre>\n\u003Cp>The key difference:\u003C/p>\n\u003Cul>\n\u003Cli>Text search: “Find this string anywhere”\u003C/li>\n\u003Cli>Semantic search: “Find this symbol in the AST”\u003C/li>\n\u003C/ul>\n\u003Cp>Semantic search understands code structure. It knows the difference between a type name, a string literal that happens to contain that text, and a comment mentioning it.\u003C/p>\n\u003Ch3 id=\"setting-up-serena-mcp\">Setting Up Serena MCP\u003C/h3>\n\u003Cp>Serena provides semantic search for multiple languages (TypeScript, JavaScript, Python, Go, Rust).\u003C/p>\n\u003Cp>\u003Cstrong>Installation:\u003C/strong>\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"10\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">BASH\u003C/span>\u003Cspan class=\"language-badge\">bash\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container with-line-numbers\" data-language=\"bash\" data-line-count=\"10\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame is-terminal\">\u003Cfigcaption class=\"header\">\u003Cspan class=\"title\">\u003C/span>\u003Cspan class=\"sr-only\">Terminal window\u003C/span>\u003C/figcaption>\u003Cpre data-language=\"bash\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Clone the repository\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">git\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">clone\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">https://github.com/oramasearch/serena.git\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">cd\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">serena\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Install dependencies\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">npm\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">install\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Build the project\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">npm\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">run\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">build\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"git clone https://github.com/oramasearch/serena.gitcd serenanpm installnpm run build\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003C/div>\u003C/div>\n\u003Cp>\u003Cstrong>Configuration for Claude Code:\u003C/strong>\u003C/p>\n\u003Cp>Add to \u003Ccode>~/.claude/mcp.json\u003C/code>:\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"12\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">JSON\u003C/span>\u003Cspan class=\"language-badge\">json\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container with-line-numbers\" data-language=\"json\" data-line-count=\"12\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"json\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">\"mcpServers\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">\"serena\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">\"command\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"node\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">\"args\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: [\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"/absolute/path/to/serena/dist/index.js\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">],\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">\"env\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">\"PROJECT_ROOT\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\".\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">      \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">}\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"{  &#x22;mcpServers&#x22;: {    &#x22;serena&#x22;: {      &#x22;command&#x22;: &#x22;node&#x22;,      &#x22;args&#x22;: [&#x22;/absolute/path/to/serena/dist/index.js&#x22;],      &#x22;env&#x22;: {        &#x22;PROJECT_ROOT&#x22;: &#x22;.&#x22;      }    }  }}\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003C/div>\u003C/div>\n\u003Cp>\u003Cstrong>Available tools:\u003C/strong>\u003C/p>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\u003Ctable>\u003Cthead>\u003Ctr>\u003Cth>Tool\u003C/th>\u003Cth>Description\u003C/th>\u003C/tr>\u003C/thead>\u003Ctbody>\u003Ctr>\u003Ctd>\u003Ccode>find_symbol\u003C/code>\u003C/td>\u003Ctd>Find symbol definition and all usages\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Ccode>find_references\u003C/code>\u003C/td>\u003Ctd>Find all references to a symbol\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Ccode>get_definition\u003C/code>\u003C/td>\u003Ctd>Get the definition of a symbol at a location\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Ccode>semantic_search\u003C/code>\u003C/td>\u003Ctd>Search code semantically, not just text\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Ccode>get_file_symbols\u003C/code>\u003C/td>\u003Ctd>List all symbols in a file\u003C/td>\u003C/tr>\u003C/tbody>\u003C/table>\n\u003Ch3 id=\"adding-language-specific-refactoring\">Adding Language-Specific Refactoring\u003C/h3>\n\u003Cp>For C#/.NET, add Refactor MCP for Roslyn-powered operations:\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"7\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">BASH\u003C/span>\u003Cspan class=\"language-badge\">bash\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container with-line-numbers\" data-language=\"bash\" data-line-count=\"7\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame is-terminal\">\u003Cfigcaption class=\"header\">\u003Cspan class=\"title\">\u003C/span>\u003Cspan class=\"sr-only\">Terminal window\u003C/span>\u003C/figcaption>\u003Cpre data-language=\"bash\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Clone the repository\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">git\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">clone\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">https://github.com/JetBrains/refactor-mcp.git\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">cd\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">refactor-mcp\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Build\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">dotnet\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">build\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"git clone https://github.com/JetBrains/refactor-mcp.gitcd refactor-mcpdotnet build\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003C/div>\u003C/div>\n\u003Cp>Add to MCP config:\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"12\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">JSON\u003C/span>\u003Cspan class=\"language-badge\">json\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container with-line-numbers\" data-language=\"json\" data-line-count=\"12\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"json\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">\"mcpServers\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">\"refactor\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">\"command\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"dotnet\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">\"args\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: [\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"run\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"--project\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"/path/to/refactor-mcp\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">],\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">\"env\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">\"SOLUTION_PATH\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"/path/to/your/solution.sln\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">      \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">}\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"{  &#x22;mcpServers&#x22;: {    &#x22;refactor&#x22;: {      &#x22;command&#x22;: &#x22;dotnet&#x22;,      &#x22;args&#x22;: [&#x22;run&#x22;, &#x22;--project&#x22;, &#x22;/path/to/refactor-mcp&#x22;],      &#x22;env&#x22;: {        &#x22;SOLUTION_PATH&#x22;: &#x22;/path/to/your/solution.sln&#x22;      }    }  }}\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003C/div>\u003C/div>\n\u003Cp>\u003Cstrong>Available refactoring operations:\u003C/strong>\u003C/p>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\u003Ctable>\u003Cthead>\u003Ctr>\u003Cth>Tool\u003C/th>\u003Cth>Description\u003C/th>\u003C/tr>\u003C/thead>\u003Ctbody>\u003Ctr>\u003Ctd>\u003Ccode>rename_symbol\u003C/code>\u003C/td>\u003Ctd>Rename with full semantic awareness\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Ccode>extract_method\u003C/code>\u003C/td>\u003Ctd>Extract code into a new method\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Ccode>inline_method\u003C/code>\u003C/td>\u003Ctd>Inline a method at call sites\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Ccode>extract_interface\u003C/code>\u003C/td>\u003Ctd>Create interface from class\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Ccode>move_type\u003C/code>\u003C/td>\u003Ctd>Move type to another file/namespace\u003C/td>\u003C/tr>\u003C/tbody>\u003C/table>\n\u003Ch3 id=\"the-numbers-55000-file-codebase\">The Numbers: 55,000 File Codebase\u003C/h3>\n\u003Cp>Real measurements from a production codebase:\u003C/p>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\u003Ctable>\u003Cthead>\u003Ctr>\u003Cth>Metric\u003C/th>\u003Cth>Text Search\u003C/th>\u003Cth>Semantic Search\u003C/th>\u003Cth>Improvement\u003C/th>\u003C/tr>\u003C/thead>\u003Ctbody>\u003Ctr>\u003Ctd>Time\u003C/td>\u003Ctd>3 hours\u003C/td>\u003Ctd>5 minutes\u003C/td>\u003Ctd>36x\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Tokens\u003C/td>\u003Ctd>28M\u003C/td>\u003Ctd>1M\u003C/td>\u003Ctd>28x\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Cost\u003C/td>\u003Ctd>$14\u003C/td>\u003Ctd>$0.60\u003C/td>\u003Ctd>23x\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Human intervention\u003C/td>\u003Ctd>Constant\u003C/td>\u003Ctd>None\u003C/td>\u003Ctd>∞\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Build failures\u003C/td>\u003Ctd>4\u003C/td>\u003Ctd>0\u003C/td>\u003Ctd>-\u003C/td>\u003C/tr>\u003C/tbody>\u003C/table>\n\u003Cp>The cost of NOT having semantic tools scales with codebase size. A 10x larger codebase isn’t 10x worse—it’s 100x worse with text search.\u003C/p>\n\u003Ch3 id=\"workflow-comparison\">Workflow Comparison\u003C/h3>\n\u003Cp>\u003Cstrong>Without semantic tools (3 hours):\u003C/strong>\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"14\">\u003Cdiv class=\"code-block-container with-line-numbers\" data-language=\"\" data-line-count=\"14\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"plaintext\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">User: \"Rename UserService to UserManager across the codebase\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">Agent:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">1. grep -r \"UserService\" . → 847 results\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">2. Read 312 files → 28M tokens consumed\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">3. Text-replace in each file\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">4. Build fails (missed generic constraints)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">5. grep again for the error\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">6. Fix, rebuild\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">7. Build fails (missed reflection usage)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">8. Loop continues...\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">Result: 3 hours, multiple human interventions, $14\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"User: &#x22;Rename UserService to UserManager across the codebase&#x22;Agent:1. grep -r &#x22;UserService&#x22; . → 847 results2. Read 312 files → 28M tokens consumed3. Text-replace in each file4. Build fails (missed generic constraints)5. grep again for the error6. Fix, rebuild7. Build fails (missed reflection usage)8. Loop continues...Result: 3 hours, multiple human interventions, $14\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003C/div>\u003C/div>\n\u003Cp>\u003Cstrong>With semantic tools (5 minutes):\u003C/strong>\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"9\">\u003Cdiv class=\"code-block-container with-line-numbers\" data-language=\"\" data-line-count=\"9\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"plaintext\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">User: \"Rename UserService to UserManager across the codebase\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">Agent:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">1. find_symbol(\"UserService\") → 42 actual usages\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">2. rename_symbol(\"UserService\", \"UserManager\")\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">3. Build passes\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">Result: 5 minutes, autonomous, $0.60\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"User: &#x22;Rename UserService to UserManager across the codebase&#x22;Agent:1. find_symbol(&#x22;UserService&#x22;) → 42 actual usages2. rename_symbol(&#x22;UserService&#x22;, &#x22;UserManager&#x22;)3. Build passesResult: 5 minutes, autonomous, $0.60\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003C/div>\u003C/div>\n\u003Ch2 id=\"when-this-fails-honest-limitations\">When This Fails: Honest Limitations\u003C/h2>\n\u003Cp>Both patterns have failure modes. Here’s what doesn’t work—learned through production deployments, not theory.\u003C/p>\n\u003Ch3 id=\"progressive-disclosure-failures\">Progressive Disclosure Failures\u003C/h3>\n\u003Cp>\u003Cstrong>Setup overhead becomes the bottleneck:\u003C/strong>\u003C/p>\n\u003Cul>\n\u003Cli>If you’re prototyping and need 15 different tools quickly, progressive disclosure adds friction\u003C/li>\n\u003Cli>Writing UV scripts and maintaining a tool index takes time\u003C/li>\n\u003Cli>For one-off tasks, the setup cost exceeds the savings\u003C/li>\n\u003C/ul>\n\u003Cp>\u003Cstrong>Language and dependency constraints:\u003C/strong>\u003C/p>\n\u003Cul>\n\u003Cli>UV is Python-focused; other languages need different patterns\u003C/li>\n\u003Cli>Binary tools require wrapper scripts\u003C/li>\n\u003Cli>Complex authentication flows are harder to embed in single files\u003C/li>\n\u003C/ul>\n\u003Cp>\u003Cstrong>When tool reuse is low:\u003C/strong>\u003C/p>\n\u003Cul>\n\u003Cli>If every task needs a new custom script, you’re not saving context\u003C/li>\n\u003Cli>The index becomes noise if most tools are one-time use\u003C/li>\n\u003C/ul>\n\u003Ch3 id=\"semantic-search-failures\">Semantic Search Failures\u003C/h3>\n\u003Cp>\u003Cstrong>Initial indexing cost:\u003C/strong>\u003C/p>\n\u003Cul>\n\u003Cli>First run on a large codebase can take minutes to hours\u003C/li>\n\u003Cli>Index storage can be GBs for very large projects\u003C/li>\n\u003Cli>Re-indexing after major refactors adds overhead\u003C/li>\n\u003C/ul>\n\u003Cp>\u003Cstrong>Language support gaps:\u003C/strong>\u003C/p>\n\u003Cul>\n\u003Cli>Not all languages have mature semantic tooling\u003C/li>\n\u003Cli>Dynamic languages (Ruby, PHP) have weaker semantic analysis\u003C/li>\n\u003Cli>Mixed codebases (Python + JavaScript + Go) need multiple MCP servers\u003C/li>\n\u003C/ul>\n\u003Cp>\u003Cstrong>False confidence in refactoring:\u003C/strong>\u003C/p>\n\u003Cul>\n\u003Cli>Semantic tools can’t catch runtime-only issues\u003C/li>\n\u003Cli>Reflection-heavy code may still break\u003C/li>\n\u003Cli>Cross-service boundaries aren’t tracked\u003C/li>\n\u003C/ul>\n\u003Cp>\u003Cstrong>Setup complexity:\u003C/strong>\u003C/p>\n\u003Cul>\n\u003Cli>Requires building/installing language-specific servers\u003C/li>\n\u003Cli>Configuration mistakes lead to silent failures\u003C/li>\n\u003Cli>Version mismatches between tools and target code\u003C/li>\n\u003C/ul>\n\u003Cp>\u003Cstrong>Cost isn’t always lower:\u003C/strong>\u003C/p>\n\u003Cul>\n\u003Cli>For small codebases (&#x3C; 100 files), text search is faster\u003C/li>\n\u003Cli>For simple string replacements, grep is sufficient\u003C/li>\n\u003Cli>If you only search once, indexing overhead dominates\u003C/li>\n\u003C/ul>\n\u003Ch2 id=\"decision-framework-when-to-use-which-pattern\">Decision Framework: When to Use Which Pattern\u003C/h2>\n\u003Cpre class=\"mermaid\">flowchart LR\n    subgraph MCP[\"Standard MCP (80%)\"]\n        M1[External APIs]\n        M2[Vendor tools]\n        M3[Quick prototyping]\n        M4[\"Small codebases (&#x3C; 100 files)\"]\n    end\n\n    subgraph PD[\"Progressive Disclosure (15%)\"]\n        P1[Custom internal tools]\n        P2[Team-wide utilities]\n        P3[Long-running sessions]\n        P4[Precise token control]\n    end\n\n    subgraph SS[\"Semantic Search (5%)\"]\n        S1[\"Large codebases (> 1,000 files)\"]\n        S2[Type/symbol renaming]\n        S3[Complex type usages]\n        S4[Build-fail-retry cycles]\n    end\n\n    subgraph COMBO[\"Combine Progressive + Semantic\"]\n        C1[Load semantic MCP only when refactoring]\n        C2[Keep tool index lightweight]\n        C3[Semantic for code, progressive for APIs]\n    end\n\n    style MCP fill:#e3f2fd\n    style PD fill:#fff3e0\n    style SS fill:#fce4ec\n    style COMBO fill:#e8f5e9\n\u003C/pre>\n\u003Ch3 id=\"the-selection-test\">The Selection Test\u003C/h3>\n\u003Cp>Ask these questions:\u003C/p>\n\u003Col>\n\u003Cli>\n\u003Cp>\u003Cstrong>How many files will be touched?\u003C/strong>\u003C/p>\n\u003Cul>\n\u003Cli>&#x3C; 10 files: Text search is fine\u003C/li>\n\u003Cli>10-100 files: Text search with careful prompting\u003C/li>\n\u003Cli>100-1,000 files: Consider semantic\u003C/li>\n\u003Cli>1,000+ files: Semantic is required\u003C/li>\n\u003C/ul>\n\u003C/li>\n\u003Cli>\n\u003Cp>\u003Cstrong>How many tools will be used?\u003C/strong>\u003C/p>\n\u003Cul>\n\u003Cli>All of them: MCP upfront loading is fine\u003C/li>\n\u003Cli>Most of them: MCP is fine\u003C/li>\n\u003Cli>Some of them: Progressive disclosure wins\u003C/li>\n\u003Cli>Few of them: Progressive disclosure wins heavily\u003C/li>\n\u003C/ul>\n\u003C/li>\n\u003Cli>\n\u003Cp>\u003Cstrong>What’s the task complexity?\u003C/strong>\u003C/p>\n\u003Cul>\n\u003Cli>String replacement: Text search works\u003C/li>\n\u003Cli>Symbol renaming: Semantic required\u003C/li>\n\u003Cli>Cross-file refactoring: Semantic required\u003C/li>\n\u003Cli>Type hierarchy changes: Semantic required\u003C/li>\n\u003C/ul>\n\u003C/li>\n\u003Cli>\n\u003Cp>\u003Cstrong>Is this a one-off or repeated work?\u003C/strong>\u003C/p>\n\u003Cul>\n\u003Cli>One-off: Setup cost dominates, use simple tools\u003C/li>\n\u003Cli>Repeated: Setup cost amortizes, invest in optimization\u003C/li>\n\u003C/ul>\n\u003C/li>\n\u003C/ol>\n\u003Ch2 id=\"key-takeaways\">Key Takeaways\u003C/h2>\n\u003Cul>\n\u003Cli>Context is finite; every pre-loaded token is a tax on productivity\u003C/li>\n\u003Cli>Progressive disclosure reduces tool overhead by 90%+ when you don’t use all tools\u003C/li>\n\u003Cli>Semantic search provides 28x token reduction and 36x speed improvement on large codebases\u003C/li>\n\u003Cli>Combine both: use progressive disclosure for tool loading, semantic search for code operations\u003C/li>\n\u003Cli>Text search fails at scale due to build-fail-retry cycles\u003C/li>\n\u003Cli>Setup overhead is real; optimize only when the math supports it\u003C/li>\n\u003Cli>Most codebases (&#x3C; 100 files) don’t need semantic tools\u003C/li>\n\u003Cli>Tool sophistication matters more than raw model capability for large codebases\u003C/li>\n\u003C/ul>\n\u003Ch2 id=\"try-it-now-15-minutes-each\">Try It Now (15 Minutes Each)\u003C/h2>\n\u003Cp>\u003Cstrong>For progressive disclosure:\u003C/strong>\nCreate \u003Ccode>~/tools/README.md\u003C/code> with an index of 3 UV scripts. Point your agent at it instead of loading an MCP server. Track token consumption with \u003Ccode>/context\u003C/code> in Claude Code. You should see 90%+ reduction in upfront token usage.\u003C/p>\n\u003Cp>\u003Cstrong>For semantic search:\u003C/strong>\nInstall Serena MCP. Run \u003Ccode>find_symbol\u003C/code> on a type in your codebase. Compare the results and token usage to \u003Ccode>grep -r\u003C/code>. If you’re touching more than 100 files, measure the difference—the gap is significant.\u003C/p>\n\u003Cp>\u003Cstrong>The best context engineering is invisible.\u003C/strong> Your agent just works faster, costs less, and fails less often. That’s not an optimization. That’s a competitive advantage.\u003C/p>",{"headings":104,"localImagePaths":163,"remoteImagePaths":164,"frontmatter":165,"imagePaths":169},[105,108,111,115,118,121,124,127,130,133,136,139,142,145,148,151,154,157,160],{"depth":44,"slug":106,"text":107},"the-core-problem-context-is-precious","The Core Problem: Context is Precious",{"depth":44,"slug":109,"text":110},"pattern-1-progressive-disclosure","Pattern 1: Progressive Disclosure",{"depth":112,"slug":113,"text":114},3,"implementation-tool-index--uv-scripts","Implementation: Tool Index + UV Scripts",{"depth":112,"slug":116,"text":117},"the-flow-in-practice","The Flow in Practice",{"depth":112,"slug":119,"text":120},"progressive-disclosure-numbers","Progressive Disclosure Numbers",{"depth":44,"slug":122,"text":123},"pattern-2-semantic-search-for-large-codebases","Pattern 2: Semantic Search for Large Codebases",{"depth":112,"slug":125,"text":126},"why-text-search-fails","Why Text Search Fails",{"depth":112,"slug":128,"text":129},"how-semantic-search-works","How Semantic Search Works",{"depth":112,"slug":131,"text":132},"setting-up-serena-mcp","Setting Up Serena MCP",{"depth":112,"slug":134,"text":135},"adding-language-specific-refactoring","Adding Language-Specific Refactoring",{"depth":112,"slug":137,"text":138},"the-numbers-55000-file-codebase","The Numbers: 55,000 File Codebase",{"depth":112,"slug":140,"text":141},"workflow-comparison","Workflow Comparison",{"depth":44,"slug":143,"text":144},"when-this-fails-honest-limitations","When This Fails: Honest Limitations",{"depth":112,"slug":146,"text":147},"progressive-disclosure-failures","Progressive Disclosure Failures",{"depth":112,"slug":149,"text":150},"semantic-search-failures","Semantic Search Failures",{"depth":44,"slug":152,"text":153},"decision-framework-when-to-use-which-pattern","Decision Framework: When to Use Which Pattern",{"depth":112,"slug":155,"text":156},"the-selection-test","The Selection Test",{"depth":44,"slug":158,"text":159},"key-takeaways","Key Takeaways",{"depth":44,"slug":161,"text":162},"try-it-now-15-minutes-each","Try It Now (15 Minutes Each)",[],[],{"title":79,"description":80,"pubDate":166,"author":17,"tags":167,"banner":87,"category":96,"difficulty":97,"tldr":89,"keyTakeaways":168},["Date","2025-12-15T00:00:00.000Z"],[19,83,84,85,86],[91,92,93,94,95],[],"context-engineering.md","document-generation-skills",{"id":171,"data":173,"body":194,"filePath":195,"digest":196,"rendered":197,"legacyId":268},{"title":174,"description":175,"pubDate":176,"author":17,"tags":177,"draft":24,"banner":184,"seoKeywords":185,"tldr":186,"keyTakeaways":187,"category":193,"difficulty":35},"AI Document Skills: Automated File Generation That Actually Ships","Skills generate Excel, PowerPoint, and PDF files in minutes. Complete POC code, real token numbers, and honest failure modes for production.",["Date","2025-12-17T00:00:00.000Z"],[19,178,179,23,180,181,182,183],"claude","skills","document-generation","excel","powerpoint","pdf","/assets/posts/document-generation-skills-banner.png",[],"Claude Skills API automates Excel, PowerPoint, and PDF generation in 5-6 minutes instead of 100+ minutes of manual work. Chain skills together for complete document pipelines. Real production use saves 95% of effort with ~$2-3 token cost per run.",[188,189,190,191,192],"Document generation is unsexy but saves massive hours—100 minutes manual → 5 minutes automated","Skills API chains: Data → Excel → PowerPoint → PDF in a single pipeline","Token cost is minimal: ~$2-3 per complete document generation run","Failure modes: complex formatting, conditional logic, multi-sheet references","Human review is still required—5 minutes of review vs 100 minutes of creation","Production Patterns","Document generation is the unsexy automation that saves hours.\n\nNot code generation. Not chat interfaces. Document generation—the Excel reports, PowerPoint decks, and PDFs that every business runs on. The work nobody wants to do, but everyone needs done.\n\nClaude Skills turn this from hours of manual work into minutes of automated execution. And here's the uncomfortable truth: while developers chase the latest AI code generation trends, the teams saving the most time are automating their document pipelines.\n\nThis is Part 1 of a series on AI document skills. We'll cover the core pattern, build a working POC, and measure what actually happens in production. Financial reporting is the example, but the pattern applies anywhere you need structured documents from data. For a deeper dive into Skills architecture and when to use Skills vs MCP servers, see [Claude Skills Deep Dive](/blog/claude-skills-deep-dive).\n\n## The Core Problem: Manual Documents Don't Scale (And Nobody Admits It)\n\n```mermaid\nflowchart TD\n    A([Data arrives]) --> B[Analyst opens\u003Cbr/>Excel template]\n    B --> |10 minutes| C[Copy-paste data\u003Cbr/>Update formulas\u003Cbr/>Fix formatting]\n    C --> |30 minutes| D[Create PowerPoint\u003Cbr/>Summarize insights\u003Cbr/>Make it pretty]\n    D --> |45 minutes| E[Generate PDF\u003Cbr/>Final review]\n    E --> |15 minutes| F[Total: 100 minutes]\n\n    F --> G[\"Quarterly = 6+ hours/year\"]\n    G --> H[\"With 10 analysts = 60+ hours/year\"]\n\n    style F fill:#ffcdd2\n    style H fill:#ffcdd2\n```\n\nThis is busy work. Highly paid knowledge workers doing copy-paste operations. The kind of work nobody puts on their resume but everyone does for half the week.\n\n## The Pattern: Skills API Document Pipeline\n\n```mermaid\nflowchart TD\n    A([Data arrives]) --> B[\"Skills API Call\u003Cbr/>'Generate Excel with this data'\"]\n    B --> |1-2 min| C[Claude generates\u003Cbr/>Excel with formulas,\u003Cbr/>charts, formatting]\n    C --> D[Chain to PPTX]\n    D --> |1-2 min| E[Chain to PDF]\n    E --> |1-2 min| F[\"Total: 5-6 minutes\u003Cbr/>fully automated\"]\n\n    F --> G[\"Human review: 5 minutes\"]\n    G --> H[\"95% reduction in manual effort\"]\n\n    style F fill:#c8e6c9\n    style H fill:#c8e6c9\n```\n\nThe Skills API generates professional documents with formulas, charts, and formatting. You describe what you want; Claude builds it.\n\n![Document Generation Pipeline](/assets/posts/in-post/v2-doc-gen-pipeline.png)\n\n## POC: Complete Working Implementation\n\nThis is the full code. Copy it, run it, modify it for your use case.\n\n### Step 1: Setup and Configuration\n\nCreate `document_pipeline.py`:\n\n```python\n# github: https://github.com/ameno-/acidbath-code/blob/main/production-patterns/document-generation-skills/document-pipeline/document_pipeline.py\n#!/usr/bin/env -S uv run\n# /// script\n# dependencies = [\n#   \"anthropic>=0.69.0\",\n#   \"pandas>=2.0.0\",\n#   \"python-dotenv>=1.0.0\",\n# ]\n# ///\n\"\"\"\nDocument generation pipeline using Claude Skills.\n\nUsage:\n    uv run document_pipeline.py --data sample_data.json --output ./reports\n\nGenerates Excel, PowerPoint, and PDF from structured data.\n\"\"\"\n\nimport argparse\nimport json\nimport os\nfrom pathlib import Path\n\nimport pandas as pd\nfrom anthropic import Anthropic\nfrom dotenv import load_dotenv\n\nload_dotenv()\n\nAPI_KEY = os.getenv(\"ANTHROPIC_API_KEY\")\nif not API_KEY:\n    raise ValueError(\"ANTHROPIC_API_KEY not found in environment\")\n\nclient = Anthropic(api_key=API_KEY)\nMODEL = \"claude-sonnet-4-5\"\n\n# Track token usage across pipeline\npipeline_tokens = {\"input\": 0, \"output\": 0}\n\n\ndef create_skills_message(prompt: str, skill_id: str, prefix: str = \"\") -> dict:\n    \"\"\"\n    Create a document using Claude Skills API.\n\n    Args:\n        prompt: Document generation instructions\n        skill_id: Which skill to use (xlsx, pptx, pdf)\n        prefix: Filename prefix for output\n\n    Returns:\n        Dict with response and file info\n    \"\"\"\n    response = client.beta.messages.create(\n        model=MODEL,\n        max_tokens=4096,\n        container={\"skills\": [{\"type\": \"anthropic\", \"skill_id\": skill_id, \"version\": \"latest\"}]},\n        tools=[{\"type\": \"code_execution_20250825\", \"name\": \"code_execution\"}],\n        messages=[{\"role\": \"user\", \"content\": prompt}],\n        betas=[\n            \"code-execution-2025-08-25\",\n            \"files-api-2025-04-14\",\n            \"skills-2025-10-02\",\n        ],\n    )\n\n    # Track tokens\n    pipeline_tokens[\"input\"] += response.usage.input_tokens\n    pipeline_tokens[\"output\"] += response.usage.output_tokens\n\n    return {\n        \"response\": response,\n        \"tokens_in\": response.usage.input_tokens,\n        \"tokens_out\": response.usage.output_tokens,\n    }\n```\n\n### Step 2: Excel Generation Function\n\n```python\ndef generate_excel(data: dict, output_dir: Path) -> dict:\n    \"\"\"\n    Generate Excel workbook with data, formulas, and charts.\n\n    Best practice: 2-3 sheets per workbook for reliable generation.\n    \"\"\"\n    prompt = f\"\"\"\nCreate an Excel workbook with 2 sheets:\n\nSheet 1 - \"Data Summary\":\nCreate a summary table with the following data:\n{json.dumps(data.get(\"summary\", {}), indent=2)}\n\nInclude:\n- Headers with bold formatting\n- Currency formatting for financial values\n- Formulas for totals and percentages\n- Conditional formatting: green for positive, red for negative\n\nSheet 2 - \"Charts\":\nCreate visualizations from the data:\n- Bar chart showing key metrics\n- Include chart title and axis labels\n- Professional color scheme\n\nApply professional formatting with borders and clear sections.\n\"\"\"\n\n    result = create_skills_message(prompt, \"xlsx\", \"data_report_\")\n    print(f\"  Excel: {result['tokens_in']:,} in, {result['tokens_out']:,} out\")\n    return result\n```\n\n### Step 3: PowerPoint Generation Function\n\n```python\ndef generate_powerpoint(data: dict, output_dir: Path) -> dict:\n    \"\"\"\n    Generate executive presentation from data.\n\n    Best practice: Clear, data-driven slides with minimal text.\n    \"\"\"\n    summary = data.get(\"summary\", {})\n\n    prompt = f\"\"\"\nCreate a 4-slide executive presentation:\n\nSlide 1 - Title:\n- Title: \"{data.get('title', 'Quarterly Report')}\"\n- Subtitle: \"Executive Summary\"\n- Date: {data.get('date', 'Q4 2024')}\n\nSlide 2 - Key Metrics:\n- Title: \"Performance Highlights\"\n- Two-column layout:\n  Left: Key metrics with values\n  Right: Bar chart of top metrics\n- Data: {json.dumps(summary.get('metrics', {}), indent=2)}\n\nSlide 3 - Trends:\n- Title: \"Quarterly Trends\"\n- Line chart showing progression\n- Bullet points for insights\n- Data: {json.dumps(summary.get('trends', []), indent=2)}\n\nSlide 4 - Recommendations:\n- Title: \"Key Takeaways\"\n- 4-5 bullet points summarizing findings\n- Clear call to action\n\nUse professional corporate design:\n- Dark blue (#003366) for headers\n- Clean, modern layout\n- Data-driven visualizations\n\"\"\"\n\n    result = create_skills_message(prompt, \"pptx\", \"executive_summary_\")\n    print(f\"  PowerPoint: {result['tokens_in']:,} in, {result['tokens_out']:,} out\")\n    return result\n```\n\n### Step 4: PDF Generation Function\n\n```python\ndef generate_pdf(data: dict, output_dir: Path) -> dict:\n    \"\"\"\n    Generate formal PDF documentation.\n\n    Best practice: Clear sections, consistent formatting.\n    \"\"\"\n    prompt = f\"\"\"\nCreate a PDF document:\n\nDOCUMENT TITLE\n{data.get('title', 'Report')}\n\nEXECUTIVE SUMMARY\n{data.get('executive_summary', 'Summary of key findings.')}\n\nKEY METRICS\n{json.dumps(data.get('summary', {}).get('metrics', {}), indent=2)}\n\nANALYSIS\n- Document the methodology\n- Present key findings\n- Note any caveats or limitations\n\nRECOMMENDATIONS\n{json.dumps(data.get('recommendations', []), indent=2)}\n\nAPPENDIX\n- Data sources\n- Methodology notes\n- Contact information\n\nFormat as a professional business document with:\n- Clear section headers\n- Consistent typography\n- Page numbers\n- Date stamp\n\"\"\"\n\n    result = create_skills_message(prompt, \"pdf\", \"documentation_\")\n    print(f\"  PDF: {result['tokens_in']:,} in, {result['tokens_out']:,} out\")\n    return result\n```\n\n### Step 5: Pipeline Orchestration\n\n```python\ndef run_pipeline(data_path: str, output_dir: str) -> dict:\n    \"\"\"\n    Run complete document generation pipeline.\n\n    Returns:\n        Dict with all results and token usage\n    \"\"\"\n    output_path = Path(output_dir)\n    output_path.mkdir(parents=True, exist_ok=True)\n\n    # Load data\n    with open(data_path) as f:\n        data = json.load(f)\n\n    print(\"=\" * 60)\n    print(\"DOCUMENT GENERATION PIPELINE\")\n    print(\"=\" * 60)\n\n    results = {}\n\n    # Step 1: Excel\n    print(\"\\nStep 1/3: Generating Excel...\")\n    results[\"excel\"] = generate_excel(data, output_path)\n\n    # Step 2: PowerPoint\n    print(\"\\nStep 2/3: Generating PowerPoint...\")\n    results[\"powerpoint\"] = generate_powerpoint(data, output_path)\n\n    # Step 3: PDF\n    print(\"\\nStep 3/3: Generating PDF...\")\n    results[\"pdf\"] = generate_pdf(data, output_path)\n\n    # Summary\n    print(\"\\n\" + \"=\" * 60)\n    print(\"PIPELINE COMPLETE\")\n    print(\"=\" * 60)\n    print(f\"\\nTotal Input Tokens:  {pipeline_tokens['input']:,}\")\n    print(f\"Total Output Tokens: {pipeline_tokens['output']:,}\")\n    print(f\"Total Tokens:        {pipeline_tokens['input'] + pipeline_tokens['output']:,}\")\n\n    # Cost estimate (Sonnet pricing: $3/M input, $15/M output)\n    cost = (pipeline_tokens['input'] * 3 + pipeline_tokens['output'] * 15) / 1_000_000\n    print(f\"Estimated Cost:      ${cost:.4f}\")\n\n    return results\n\n\ndef main():\n    parser = argparse.ArgumentParser(description=\"Generate documents from data\")\n    parser.add_argument(\"--data\", required=True, help=\"Path to JSON data file\")\n    parser.add_argument(\"--output\", default=\"./output\", help=\"Output directory\")\n    args = parser.parse_args()\n\n    run_pipeline(args.data, args.output)\n\n\nif __name__ == \"__main__\":\n    main()\n```\n\n### Step 6: Sample Data File\n\nCreate `sample_data.json`:\n\n```json\n// github: https://github.com/ameno-/acidbath-code/blob/main/production-patterns/document-generation-skills/sample_data.json\n{\n  \"title\": \"Q4 2024 Business Review\",\n  \"date\": \"January 2025\",\n  \"executive_summary\": \"Q4 2024 showed strong performance with 17.9% YoY revenue growth and significant margin expansion.\",\n  \"summary\": {\n    \"metrics\": {\n      \"revenue\": 14500000,\n      \"revenue_growth_yoy\": 17.9,\n      \"net_income\": 1878750,\n      \"operating_margin\": 17.9,\n      \"customer_count\": 850,\n      \"churn_rate\": 2.8\n    },\n    \"trends\": [\n      {\"quarter\": \"Q1 2024\", \"revenue\": 12500000, \"margin\": 15.0},\n      {\"quarter\": \"Q2 2024\", \"revenue\": 13200000, \"margin\": 15.8},\n      {\"quarter\": \"Q3 2024\", \"revenue\": 13800000, \"margin\": 16.5},\n      {\"quarter\": \"Q4 2024\", \"revenue\": 14500000, \"margin\": 17.9}\n    ]\n  },\n  \"recommendations\": [\n    \"Maintain current growth trajectory\",\n    \"Expand customer success team to reduce churn\",\n    \"Invest in automation to improve margins\",\n    \"Consider international expansion in Q2 2025\"\n  ]\n}\n```\n\nRun the pipeline:\n\n```bash\nuv run document_pipeline.py --data sample_data.json --output ./reports\n```\n\n## The Numbers: What Actually Happens\n\nReal measurements from running this pipeline:\n\n| Document Type | Generation Time | Input Tokens | Output Tokens | Cost |\n|---------------|-----------------|--------------|---------------|------|\n| Excel (2 sheets) | 1-2 min | ~2,500 | ~3,000 | $0.05 |\n| PowerPoint (4 slides) | 1-2 min | ~2,000 | ~2,500 | $0.04 |\n| PDF (full report) | 1-2 min | ~1,800 | ~2,200 | $0.04 |\n| **Pipeline Total** | **5-6 min** | **~6,300** | **~7,700** | **$0.13** |\n\nCompare to manual:\n\n| Metric | Manual | Skills Pipeline | Improvement |\n|--------|--------|-----------------|-------------|\n| Time | 100 min | 10 min (5 gen + 5 review) | 10x |\n| Cost | ~$50/hour labor | $0.13 API | 380x |\n| Consistency | Variable | Identical | ∞ |\n| Error rate | Human errors | Prompt errors | Different |\n\n**Token efficiency note:** Skills use ~90% fewer tokens than manually instructing Claude to build documents step by step. The skill encapsulates document structure knowledge.\n\n## When This Works: Ideal Use Cases\n\n```mermaid\nflowchart LR\n    subgraph R[\"Recurring Reports\"]\n        R1[\"Weekly, monthly, quarterly\"]\n        R2[\"Same structure, different data\"]\n    end\n\n    subgraph D[\"Data-to-Document\"]\n        D1[\"JSON → Excel with formulas\"]\n        D2[\"CSV → PowerPoint summary\"]\n        D3[\"Metrics → PDF report\"]\n    end\n\n    subgraph M[\"Multi-Format Output\"]\n        M1[\"One dataset → Excel + PPTX + PDF\"]\n        M2[\"Consistent data across formats\"]\n    end\n\n    subgraph T[\"Template-Based\"]\n        T1[\"Defined structure, variable content\"]\n        T2[\"Professional formatting\"]\n    end\n\n    subgraph B[\"Batch Processing\"]\n        B1[\"Generate 50 client reports\"]\n        B2[\"Same prompt, different data\"]\n    end\n\n    style R fill:#c8e6c9\n    style D fill:#c8e6c9\n    style M fill:#c8e6c9\n    style T fill:#c8e6c9\n    style B fill:#c8e6c9\n```\n\n## When This Fails: Know the Limits Before You Hit Them\n\nSkills are not magic. Here's what breaks—and the workarounds that actually work.\n\n### Document Complexity Limits\n\n**Recommended limits:**\n- Excel: 2-3 sheets per workbook\n- PowerPoint: 5-7 slides per deck\n- PDF: 10-15 pages\n\nBeyond these, reliability degrades. Generation time increases exponentially, and partial failures become common.\n\n**Workaround:** Break complex documents into multiple focused files.\n\n```python\n# Bad: One complex 10-sheet Excel\ngenerate_excel(full_data, \"complete_report.xlsx\")  # Fails at scale\n\n# Good: Multiple focused files\ngenerate_excel(pnl_data, \"pnl_report.xlsx\")\ngenerate_excel(balance_data, \"balance_sheet.xlsx\")\ngenerate_excel(kpi_data, \"kpi_dashboard.xlsx\")\n```\n\n### Data Format Sensitivity\n\nSkills are sensitive to input data structure. Slight variations cause unpredictable output.\n\n**Example failure:**\n```python\n# Works\ndata = {\"revenue\": 14500000, \"growth\": 17.9}\n\n# Fails (missing field)\ndata = {\"revenue\": 14500000}  # No growth → chart generation fails\n\n# Fails (wrong type)\ndata = {\"revenue\": \"14.5M\"}   # String not number → formula errors\n```\n\n**Mitigation:** Validate data structure before sending to Skills.\n\n```python\ndef validate_data(data: dict) -> bool:\n    required_fields = [\"revenue\", \"growth\", \"net_income\"]\n    return all(field in data.get(\"summary\", {}).get(\"metrics\", {})\n               for field in required_fields)\n```\n\n### Rate Limits and Timeouts\n\n**Failure modes:**\n- Generating multiple complex documents simultaneously hits rate limits\n- Generation time can vary from 30 seconds to 5 minutes\n- No guaranteed maximum completion time\n\n**Mitigation:** Implement retry logic and sequential execution.\n\n```python\nimport time\nfrom tenacity import retry, stop_after_attempt, wait_exponential\n\n@retry(stop=stop_after_attempt(3), wait=wait_exponential(min=1, max=10))\ndef generate_with_retry(prompt: str, skill_id: str) -> dict:\n    return create_skills_message(prompt, skill_id)\n\ndef sequential_pipeline(data_files: list) -> list:\n    results = []\n    for data_file in data_files:\n        result = generate_with_retry(data_file)\n        results.append(result)\n        time.sleep(2)  # Rate limit buffer\n    return results\n```\n\n### Numeric Precision\n\nFinancial calculations can lose precision. Rounding errors accumulate.\n\n**Example:**\n```\nExpected: $14,500,000.00\nGenerated: $14,499,999.99\n```\n\n**Mitigation:** Specify precision explicitly in prompts.\n\n```python\nprompt = \"\"\"\nFormat all currency values:\n- Use exactly 2 decimal places\n- Round to nearest cent using banker's rounding\n- Display as $X,XXX,XXX.XX format\n\"\"\"\n```\n\n### No Persistent State\n\nEach Skills call is stateless. Documents generated in separate calls may have subtle inconsistencies.\n\n**Example failure:**\n- Excel shows revenue of $14.5M\n- PowerPoint shows revenue of $14.51M (different rounding)\n\n**Mitigation:** Generate all documents from the same data dict in the same session. Pass exact values, not calculated values.\n\n```python\n# Good: Same canonical data\ndata = {\"revenue\": 14500000}\ngenerate_excel(data, ...)\ngenerate_powerpoint(data, ...)  # Same source\n\n# Bad: Calculated values drift\nexcel_data = {\"revenue\": calculate_revenue()}  # 14500000\nppt_data = {\"revenue\": calculate_revenue()}    # 14500001 (race condition)\n```\n\n### Pipeline Fragility\n\nIf step 2 fails, step 3 never runs. One failure breaks the entire pipeline.\n\n**Mitigation:** Implement robust error handling with partial success tracking.\n\n```python\ndef resilient_pipeline(data: dict) -> dict:\n    results = {\"excel\": None, \"powerpoint\": None, \"pdf\": None, \"errors\": []}\n\n    try:\n        results[\"excel\"] = generate_excel(data)\n    except Exception as e:\n        results[\"errors\"].append(f\"Excel failed: {e}\")\n\n    try:\n        results[\"powerpoint\"] = generate_powerpoint(data)\n    except Exception as e:\n        results[\"errors\"].append(f\"PowerPoint failed: {e}\")\n\n    try:\n        results[\"pdf\"] = generate_pdf(data)\n    except Exception as e:\n        results[\"errors\"].append(f\"PDF failed: {e}\")\n\n    return results\n```\n\n## Best Practices: What We Learned\n\n**Document structure:**\n- 2-3 sheets/slides per document for reliable generation\n- Focus each sheet on a single purpose\n- Break complex reports into multiple files\n- Chain documents sequentially, not in parallel\n\n**Prompt design:**\n- Use structured data (JSON) not prose descriptions\n- Specify exact formatting requirements\n- Include examples of expected output\n- Be explicit about formulas and calculations\n\n**Error handling:**\n- Validate data before sending to Skills\n- Implement retry logic with exponential backoff\n- Track partial successes separately from complete failures\n- Log token usage for cost monitoring\n\n**Maintenance:**\n- Monitor token usage trends over time\n- Test prompts when updating to new SDK versions\n- Keep prompt templates versioned with your code\n- Build automated tests for document generation\n\n## Agent Opportunity: Document Generation Agent\n\nBuild a specialized agent for document generation:\n\n```markdown\n---\nname: document-generator\ndescription: Generate multi-format business documents from structured data\ntools: Bash, Read, Write, Skill\nmodel: sonnet\n---\n\n# Document Generation Agent\n\n## Workflow\n\n1. **Validate input data**\n   - Check required fields exist\n   - Verify data types are correct\n   - Normalize date formats\n\n2. **Generate documents sequentially**\n   - Excel first (primary data source)\n   - PowerPoint second (summary view)\n   - PDF third (formal documentation)\n\n3. **Verify outputs**\n   - Check file sizes are reasonable\n   - Verify no generation errors\n   - Log token usage\n\n4. **Report completion**\n   - List generated files with sizes\n   - Summarize token usage and cost\n   - Note any warnings or partial failures\n\n## Rules\n\n- NEVER generate more than 3 sheets per Excel\n- ALWAYS validate data before calling Skills API\n- ALWAYS implement retry logic\n- ALWAYS track token usage for cost management\n```\n\nThis agent can be triggered by file drops in a watched directory—see the Directory Watchers post for that pattern.\n\n---\n\n**Key Takeaways:**\n- Skills generate professional documents (Excel, PowerPoint, PDF) in 1-2 minutes each\n- Pipeline approach: data → Excel → PowerPoint → PDF, 5-6 minutes total\n- 90% fewer tokens than manual document instructions\n- Cost: ~$0.13 per complete pipeline vs $50+ manual labor\n- Reliability limits: 2-3 sheets per Excel, 5-7 slides per PowerPoint\n- Common failures: complexity limits, data format sensitivity, rate limits\n- Mitigations: break complex docs into focused files, validate data, implement retries\n- Best fit: recurring reports, data-to-document conversion, template-based generation\n\n**Try It Now (10 Minutes to First Generation):**\nCopy the `document_pipeline.py` and `sample_data.json` files above. Run `uv run document_pipeline.py --data sample_data.json --output ./reports`. Check the generated files. Modify the prompts for your use case. Track token usage to estimate your costs.\n\nIf you generate documents more than 5 times per month, this pays for itself in the first week. If you're generating them weekly, the ROI is 50x.\n\n---\n\n*Next in series: Part 2 covers advanced patterns—custom templates, conditional formatting, and multi-source data aggregation.*","src/content/blog/document-generation-skills.md","e77380f689c2cd7a",{"html":198,"metadata":199},"\u003Cp>Document generation is the unsexy automation that saves hours.\u003C/p>\n\u003Cp>Not code generation. Not chat interfaces. Document generation—the Excel reports, PowerPoint decks, and PDFs that every business runs on. The work nobody wants to do, but everyone needs done.\u003C/p>\n\u003Cp>Claude Skills turn this from hours of manual work into minutes of automated execution. And here’s the uncomfortable truth: while developers chase the latest AI code generation trends, the teams saving the most time are automating their document pipelines.\u003C/p>\n\u003Cp>This is Part 1 of a series on AI document skills. We’ll cover the core pattern, build a working POC, and measure what actually happens in production. Financial reporting is the example, but the pattern applies anywhere you need structured documents from data. For a deeper dive into Skills architecture and when to use Skills vs MCP servers, see \u003Ca href=\"/blog/claude-skills-deep-dive\">Claude Skills Deep Dive\u003C/a>.\u003C/p>\n\u003Ch2 id=\"the-core-problem-manual-documents-dont-scale-and-nobody-admits-it\">The Core Problem: Manual Documents Don’t Scale (And Nobody Admits It)\u003C/h2>\n\u003Cpre class=\"mermaid\">flowchart TD\n    A([Data arrives]) --> B[Analyst opens&#x3C;br/>Excel template]\n    B --> |10 minutes| C[Copy-paste data&#x3C;br/>Update formulas&#x3C;br/>Fix formatting]\n    C --> |30 minutes| D[Create PowerPoint&#x3C;br/>Summarize insights&#x3C;br/>Make it pretty]\n    D --> |45 minutes| E[Generate PDF&#x3C;br/>Final review]\n    E --> |15 minutes| F[Total: 100 minutes]\n\n    F --> G[\"Quarterly = 6+ hours/year\"]\n    G --> H[\"With 10 analysts = 60+ hours/year\"]\n\n    style F fill:#ffcdd2\n    style H fill:#ffcdd2\n\u003C/pre>\n\u003Cp>This is busy work. Highly paid knowledge workers doing copy-paste operations. The kind of work nobody puts on their resume but everyone does for half the week.\u003C/p>\n\u003Ch2 id=\"the-pattern-skills-api-document-pipeline\">The Pattern: Skills API Document Pipeline\u003C/h2>\n\u003Cpre class=\"mermaid\">flowchart TD\n    A([Data arrives]) --> B[\"Skills API Call&#x3C;br/>'Generate Excel with this data'\"]\n    B --> |1-2 min| C[Claude generates&#x3C;br/>Excel with formulas,&#x3C;br/>charts, formatting]\n    C --> D[Chain to PPTX]\n    D --> |1-2 min| E[Chain to PDF]\n    E --> |1-2 min| F[\"Total: 5-6 minutes&#x3C;br/>fully automated\"]\n\n    F --> G[\"Human review: 5 minutes\"]\n    G --> H[\"95% reduction in manual effort\"]\n\n    style F fill:#c8e6c9\n    style H fill:#c8e6c9\n\u003C/pre>\n\u003Cp>The Skills API generates professional documents with formulas, charts, and formatting. You describe what you want; Claude builds it.\u003C/p>\n\u003Cp>\u003Cimg src=\"/assets/posts/in-post/v2-doc-gen-pipeline.png\" alt=\"Document Generation Pipeline\">\u003C/p>\n\u003Ch2 id=\"poc-complete-working-implementation\">POC: Complete Working Implementation\u003C/h2>\n\u003Cp>This is the full code. Copy it, run it, modify it for your use case.\u003C/p>\n\u003Ch3 id=\"step-1-setup-and-configuration\">Step 1: Setup and Configuration\u003C/h3>\n\u003Cp>Create \u003Ccode>document_pipeline.py\u003C/code>:\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"75\" data-has-github=\"true\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">PYTHON\u003C/span>\u003Cspan class=\"language-badge\">python\u003C/span>\u003Ca class=\"github-header-link\" href=\"https://github.com/ameno-/acidbath-code/blob/main/production-patterns/document-generation-skills/document-pipeline/document_pipeline.py\" target=\"_blank\" rel=\"noopener noreferrer\" title=\"View source on GitHub: production-patterns/document-generation-skills/document-pipeline/document_pipeline.py\">\u003Cspan class=\"github-icon\">↗\u003C/span>\u003Cspan class=\"github-text\">GitHub\u003C/span>\u003C/a>\u003C/div>\u003Cdiv class=\"code-block-container collapsible with-line-numbers has-github-link\" data-language=\"python\" data-line-count=\"75\" data-max-preview=\"8\" data-github-url=\"https://github.com/ameno-/acidbath-code/blob/main/production-patterns/document-generation-skills/document-pipeline/document_pipeline.py\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cbutton class=\"collapse-toggle\" aria-label=\"Toggle code visibility\" type=\"button\">\u003Cspan class=\"expand-text\">Expand (75 lines)\u003C/span>\u003Cspan class=\"collapse-text\">Collapse\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Clink rel=\"stylesheet\" href=\"/_astro/ec.44wa8.css\">\u003Cscript type=\"module\" src=\"/_astro/ec.0vx5m.js\">\u003C/script>\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"python\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># github: https://github.com/ameno-/acidbath-code/blob/main/production-patterns/document-generation-skills/document-pipeline/document_pipeline.py\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\">#!/usr/bin/env -S uv run\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># /// script\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># dependencies = [\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\">#   \"anthropic>=0.69.0\",\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\">#   \"pandas>=2.0.0\",\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\">#   \"python-dotenv>=1.0.0\",\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># ]\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># ///\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\"\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">Document generation pipeline using Claude Skills.\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">Usage:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">uv run document_pipeline.py --data sample_data.json --output ./reports\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">Generates Excel, PowerPoint, and PDF from structured data.\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\"\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">import\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> argparse\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">import\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> json\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">import\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> os\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">from\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> pathlib \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">import\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Path\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">import\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> pandas \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">as\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> pd\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">from\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> anthropic \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">import\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Anthropic\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">from\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> dotenv \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">import\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> load_dotenv\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">load_dotenv()\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">API_KEY\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> os.getenv(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"ANTHROPIC_API_KEY\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">if\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">not\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">API_KEY\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">raise\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">ValueError\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"ANTHROPIC_API_KEY not found in environment\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">client \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Anthropic(\u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">api_key\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">API_KEY\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">MODEL\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"claude-sonnet-4-5\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Track token usage across pipeline\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">pipeline_tokens \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> {\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"input\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">0\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"output\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">0\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">def\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">create_skills_message\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(prompt: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">str\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, skill_id: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">str\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, prefix: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">str\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">) -> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">dict\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\"\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">Create a document using Claude Skills API.\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">Args:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">prompt: Document generation instructions\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">skill_id: Which skill to use (xlsx, pptx, pdf)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">prefix: Filename prefix for output\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">Returns:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">Dict with response and file info\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\"\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">response \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> client.beta.messages.create(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">model\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">MODEL\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">max_tokens\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">4096\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">container\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">{\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"skills\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: [{\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"type\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"anthropic\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"skill_id\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: skill_id, \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"version\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"latest\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">}]},\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">tools\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">[{\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"type\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"code_execution_20250825\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"name\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"code_execution\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">}],\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">messages\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">[{\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"role\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"user\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"content\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: prompt}],\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">betas\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">[\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">            \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"code-execution-2025-08-25\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">            \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"files-api-2025-04-14\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">            \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"skills-2025-10-02\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">],\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Track tokens\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">pipeline_tokens[\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"input\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">] \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">+=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> response.usage.input_tokens\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">pipeline_tokens[\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"output\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">] \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">+=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> response.usage.output_tokens\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">return\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"response\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: response,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"tokens_in\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: response.usage.input_tokens,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"tokens_out\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: response.usage.output_tokens,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">}\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"# github: https://github.com/ameno-/acidbath-code/blob/main/production-patterns/document-generation-skills/document-pipeline/document_pipeline.py#!/usr/bin/env -S uv run# /// script# dependencies = [#   &#x22;anthropic>=0.69.0&#x22;,#   &#x22;pandas>=2.0.0&#x22;,#   &#x22;python-dotenv>=1.0.0&#x22;,# ]# ///&#x22;&#x22;&#x22;Document generation pipeline using Claude Skills.Usage:    uv run document_pipeline.py --data sample_data.json --output ./reportsGenerates Excel, PowerPoint, and PDF from structured data.&#x22;&#x22;&#x22;import argparseimport jsonimport osfrom pathlib import Pathimport pandas as pdfrom anthropic import Anthropicfrom dotenv import load_dotenvload_dotenv()API_KEY = os.getenv(&#x22;ANTHROPIC_API_KEY&#x22;)if not API_KEY:    raise ValueError(&#x22;ANTHROPIC_API_KEY not found in environment&#x22;)client = Anthropic(api_key=API_KEY)MODEL = &#x22;claude-sonnet-4-5&#x22;# Track token usage across pipelinepipeline_tokens = {&#x22;input&#x22;: 0, &#x22;output&#x22;: 0}def create_skills_message(prompt: str, skill_id: str, prefix: str = &#x22;&#x22;) -> dict:    &#x22;&#x22;&#x22;    Create a document using Claude Skills API.    Args:        prompt: Document generation instructions        skill_id: Which skill to use (xlsx, pptx, pdf)        prefix: Filename prefix for output    Returns:        Dict with response and file info    &#x22;&#x22;&#x22;    response = client.beta.messages.create(        model=MODEL,        max_tokens=4096,        container={&#x22;skills&#x22;: [{&#x22;type&#x22;: &#x22;anthropic&#x22;, &#x22;skill_id&#x22;: skill_id, &#x22;version&#x22;: &#x22;latest&#x22;}]},        tools=[{&#x22;type&#x22;: &#x22;code_execution_20250825&#x22;, &#x22;name&#x22;: &#x22;code_execution&#x22;}],        messages=[{&#x22;role&#x22;: &#x22;user&#x22;, &#x22;content&#x22;: prompt}],        betas=[            &#x22;code-execution-2025-08-25&#x22;,            &#x22;files-api-2025-04-14&#x22;,            &#x22;skills-2025-10-02&#x22;,        ],    )    # Track tokens    pipeline_tokens[&#x22;input&#x22;] += response.usage.input_tokens    pipeline_tokens[&#x22;output&#x22;] += response.usage.output_tokens    return {        &#x22;response&#x22;: response,        &#x22;tokens_in&#x22;: response.usage.input_tokens,        &#x22;tokens_out&#x22;: response.usage.output_tokens,    }\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003Cdiv class=\"code-fade\" aria-hidden=\"true\">\u003C/div>\u003C/div>\u003Cdiv class=\"code-block-footer\">\u003Ca class=\"github-source-link\" href=\"https://github.com/ameno-/acidbath-code/blob/main/production-patterns/document-generation-skills/document-pipeline/document_pipeline.py\" target=\"_blank\" rel=\"noopener noreferrer\">\u003Cspan class=\"github-arrow\">→\u003C/span>\u003Cspan> View full source: production-patterns/document-generation-skills/document-pipeline/document_pipeline.py\u003C/span>\u003C/a>\u003C/div>\u003C/div>\n\u003Ch3 id=\"step-2-excel-generation-function\">Step 2: Excel Generation Function\u003C/h3>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"32\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">PYTHON\u003C/span>\u003Cspan class=\"language-badge\">python\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container collapsible with-line-numbers\" data-language=\"python\" data-line-count=\"32\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cbutton class=\"collapse-toggle\" aria-label=\"Toggle code visibility\" type=\"button\">\u003Cspan class=\"expand-text\">Expand (32 lines)\u003C/span>\u003Cspan class=\"collapse-text\">Collapse\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"python\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">def\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">generate_excel\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(data: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">dict\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, output_dir: Path) -> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">dict\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\"\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">Generate Excel workbook with data, formulas, and charts.\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">Best practice: 2-3 sheets per workbook for reliable generation.\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\"\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">prompt \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">f\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\"\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">Create an Excel workbook with 2 sheets:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">Sheet 1 - \"Data Summary\":\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">Create a summary table with the following data:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">{\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">json.dumps(data.get(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"summary\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, {}), \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">indent\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">2\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">Include:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">- Headers with bold formatting\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">- Currency formatting for financial values\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">- Formulas for totals and percentages\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">- Conditional formatting: green for positive, red for negative\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">Sheet 2 - \"Charts\":\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">Create visualizations from the data:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">- Bar chart showing key metrics\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">- Include chart title and axis labels\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">- Professional color scheme\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">Apply professional formatting with borders and clear sections.\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\"\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">result \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> create_skills_message(prompt, \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"xlsx\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"data_report_\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">print\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">f\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"  Excel: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">{\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">result[\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">'tokens_in'\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">]\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">:,\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">}\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\"> in, \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">{\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">result[\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">'tokens_out'\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">]\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">:,\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">}\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\"> out\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">return\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> result\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"def generate_excel(data: dict, output_dir: Path) -> dict:    &#x22;&#x22;&#x22;    Generate Excel workbook with data, formulas, and charts.    Best practice: 2-3 sheets per workbook for reliable generation.    &#x22;&#x22;&#x22;    prompt = f&#x22;&#x22;&#x22;Create an Excel workbook with 2 sheets:Sheet 1 - &#x22;Data Summary&#x22;:Create a summary table with the following data:{json.dumps(data.get(&#x22;summary&#x22;, {}), indent=2)}Include:- Headers with bold formatting- Currency formatting for financial values- Formulas for totals and percentages- Conditional formatting: green for positive, red for negativeSheet 2 - &#x22;Charts&#x22;:Create visualizations from the data:- Bar chart showing key metrics- Include chart title and axis labels- Professional color schemeApply professional formatting with borders and clear sections.&#x22;&#x22;&#x22;    result = create_skills_message(prompt, &#x22;xlsx&#x22;, &#x22;data_report_&#x22;)    print(f&#x22;  Excel: {result[&#x27;tokens_in&#x27;]:,} in, {result[&#x27;tokens_out&#x27;]:,} out&#x22;)    return result\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003Cdiv class=\"code-fade\" aria-hidden=\"true\">\u003C/div>\u003C/div>\u003C/div>\n\u003Ch3 id=\"step-3-powerpoint-generation-function\">Step 3: PowerPoint Generation Function\u003C/h3>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"44\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">PYTHON\u003C/span>\u003Cspan class=\"language-badge\">python\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container collapsible with-line-numbers\" data-language=\"python\" data-line-count=\"44\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cbutton class=\"collapse-toggle\" aria-label=\"Toggle code visibility\" type=\"button\">\u003Cspan class=\"expand-text\">Expand (44 lines)\u003C/span>\u003Cspan class=\"collapse-text\">Collapse\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"python\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">def\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">generate_powerpoint\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(data: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">dict\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, output_dir: Path) -> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">dict\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\"\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">Generate executive presentation from data.\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">Best practice: Clear, data-driven slides with minimal text.\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\"\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">summary \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> data.get(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"summary\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, {})\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">prompt \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">f\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\"\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">Create a 4-slide executive presentation:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">Slide 1 - Title:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">- Title: \"\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">{\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">data.get(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">'title'\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">'Quarterly Report'\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">}\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">- Subtitle: \"Executive Summary\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">- Date: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">{\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">data.get(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">'date'\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">'Q4 2024'\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">Slide 2 - Key Metrics:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">- Title: \"Performance Highlights\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">- Two-column layout:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">Left: Key metrics with values\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">Right: Bar chart of top metrics\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">- Data: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">{\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">json.dumps(summary.get(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">'metrics'\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, {}), \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">indent\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">2\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">Slide 3 - Trends:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">- Title: \"Quarterly Trends\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">- Line chart showing progression\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">- Bullet points for insights\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">- Data: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">{\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">json.dumps(summary.get(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">'trends'\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, []), \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">indent\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">2\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">Slide 4 - Recommendations:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">- Title: \"Key Takeaways\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">- 4-5 bullet points summarizing findings\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">- Clear call to action\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">Use professional corporate design:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">- Dark blue (#003366) for headers\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">- Clean, modern layout\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">- Data-driven visualizations\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\"\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">result \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> create_skills_message(prompt, \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"pptx\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"executive_summary_\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">print\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">f\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"  PowerPoint: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">{\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">result[\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">'tokens_in'\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">]\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">:,\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">}\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\"> in, \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">{\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">result[\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">'tokens_out'\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">]\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">:,\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">}\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\"> out\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">return\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> result\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"def generate_powerpoint(data: dict, output_dir: Path) -> dict:    &#x22;&#x22;&#x22;    Generate executive presentation from data.    Best practice: Clear, data-driven slides with minimal text.    &#x22;&#x22;&#x22;    summary = data.get(&#x22;summary&#x22;, {})    prompt = f&#x22;&#x22;&#x22;Create a 4-slide executive presentation:Slide 1 - Title:- Title: &#x22;{data.get(&#x27;title&#x27;, &#x27;Quarterly Report&#x27;)}&#x22;- Subtitle: &#x22;Executive Summary&#x22;- Date: {data.get(&#x27;date&#x27;, &#x27;Q4 2024&#x27;)}Slide 2 - Key Metrics:- Title: &#x22;Performance Highlights&#x22;- Two-column layout:  Left: Key metrics with values  Right: Bar chart of top metrics- Data: {json.dumps(summary.get(&#x27;metrics&#x27;, {}), indent=2)}Slide 3 - Trends:- Title: &#x22;Quarterly Trends&#x22;- Line chart showing progression- Bullet points for insights- Data: {json.dumps(summary.get(&#x27;trends&#x27;, []), indent=2)}Slide 4 - Recommendations:- Title: &#x22;Key Takeaways&#x22;- 4-5 bullet points summarizing findings- Clear call to actionUse professional corporate design:- Dark blue (#003366) for headers- Clean, modern layout- Data-driven visualizations&#x22;&#x22;&#x22;    result = create_skills_message(prompt, &#x22;pptx&#x22;, &#x22;executive_summary_&#x22;)    print(f&#x22;  PowerPoint: {result[&#x27;tokens_in&#x27;]:,} in, {result[&#x27;tokens_out&#x27;]:,} out&#x22;)    return result\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003Cdiv class=\"code-fade\" aria-hidden=\"true\">\u003C/div>\u003C/div>\u003C/div>\n\u003Ch3 id=\"step-4-pdf-generation-function\">Step 4: PDF Generation Function\u003C/h3>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"42\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">PYTHON\u003C/span>\u003Cspan class=\"language-badge\">python\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container collapsible with-line-numbers\" data-language=\"python\" data-line-count=\"42\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cbutton class=\"collapse-toggle\" aria-label=\"Toggle code visibility\" type=\"button\">\u003Cspan class=\"expand-text\">Expand (42 lines)\u003C/span>\u003Cspan class=\"collapse-text\">Collapse\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"python\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">def\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">generate_pdf\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(data: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">dict\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, output_dir: Path) -> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">dict\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\"\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">Generate formal PDF documentation.\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">Best practice: Clear sections, consistent formatting.\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\"\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">prompt \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">f\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\"\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">Create a PDF document:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">DOCUMENT TITLE\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">{\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">data.get(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">'title'\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">'Report'\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">EXECUTIVE SUMMARY\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">{\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">data.get(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">'executive_summary'\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">'Summary of key findings.'\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">KEY METRICS\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">{\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">json.dumps(data.get(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">'summary'\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, {}).get(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">'metrics'\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, {}), \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">indent\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">2\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">ANALYSIS\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">- Document the methodology\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">- Present key findings\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">- Note any caveats or limitations\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">RECOMMENDATIONS\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">{\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">json.dumps(data.get(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">'recommendations'\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, []), \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">indent\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">2\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">APPENDIX\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">- Data sources\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">- Methodology notes\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">- Contact information\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">Format as a professional business document with:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">- Clear section headers\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">- Consistent typography\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">- Page numbers\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">- Date stamp\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\"\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">result \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> create_skills_message(prompt, \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"pdf\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"documentation_\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">print\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">f\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"  PDF: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">{\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">result[\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">'tokens_in'\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">]\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">:,\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">}\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\"> in, \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">{\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">result[\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">'tokens_out'\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">]\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">:,\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">}\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\"> out\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">return\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> result\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"def generate_pdf(data: dict, output_dir: Path) -> dict:    &#x22;&#x22;&#x22;    Generate formal PDF documentation.    Best practice: Clear sections, consistent formatting.    &#x22;&#x22;&#x22;    prompt = f&#x22;&#x22;&#x22;Create a PDF document:DOCUMENT TITLE{data.get(&#x27;title&#x27;, &#x27;Report&#x27;)}EXECUTIVE SUMMARY{data.get(&#x27;executive_summary&#x27;, &#x27;Summary of key findings.&#x27;)}KEY METRICS{json.dumps(data.get(&#x27;summary&#x27;, {}).get(&#x27;metrics&#x27;, {}), indent=2)}ANALYSIS- Document the methodology- Present key findings- Note any caveats or limitationsRECOMMENDATIONS{json.dumps(data.get(&#x27;recommendations&#x27;, []), indent=2)}APPENDIX- Data sources- Methodology notes- Contact informationFormat as a professional business document with:- Clear section headers- Consistent typography- Page numbers- Date stamp&#x22;&#x22;&#x22;    result = create_skills_message(prompt, &#x22;pdf&#x22;, &#x22;documentation_&#x22;)    print(f&#x22;  PDF: {result[&#x27;tokens_in&#x27;]:,} in, {result[&#x27;tokens_out&#x27;]:,} out&#x22;)    return result\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003Cdiv class=\"code-fade\" aria-hidden=\"true\">\u003C/div>\u003C/div>\u003C/div>\n\u003Ch3 id=\"step-5-pipeline-orchestration\">Step 5: Pipeline Orchestration\u003C/h3>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"59\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">PYTHON\u003C/span>\u003Cspan class=\"language-badge\">python\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container collapsible with-line-numbers\" data-language=\"python\" data-line-count=\"59\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cbutton class=\"collapse-toggle\" aria-label=\"Toggle code visibility\" type=\"button\">\u003Cspan class=\"expand-text\">Expand (59 lines)\u003C/span>\u003Cspan class=\"collapse-text\">Collapse\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"python\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">def\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">run_pipeline\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(data_path: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">str\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, output_dir: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">str\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">) -> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">dict\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\"\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">Run complete document generation pipeline.\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">Returns:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">Dict with all results and token usage\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\"\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">output_path \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Path(output_dir)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">output_path.mkdir(\u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">parents\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">True\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">exist_ok\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">True\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Load data\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">with\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">open\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(data_path) \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">as\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> f:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">data \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> json.load(f)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">print\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"=\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">*\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">60\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">print\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"DOCUMENT GENERATION PIPELINE\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">print\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"=\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">*\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">60\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">results \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> {}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Step 1: Excel\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">print\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">\\n\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">Step 1/3: Generating Excel...\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">results[\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"excel\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">] \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> generate_excel(data, output_path)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Step 2: PowerPoint\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">print\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">\\n\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">Step 2/3: Generating PowerPoint...\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">results[\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"powerpoint\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">] \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> generate_powerpoint(data, output_path)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Step 3: PDF\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">print\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">\\n\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">Step 3/3: Generating PDF...\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">results[\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"pdf\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">] \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> generate_pdf(data, output_path)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Summary\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">print\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">\\n\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">+\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"=\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">*\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">60\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">print\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"PIPELINE COMPLETE\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">print\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"=\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">*\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">60\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">print\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">f\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">\\n\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">Total Input Tokens:  \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">{\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">pipeline_tokens[\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">'input'\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">]\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">:,\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">}\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">print\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">f\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"Total Output Tokens: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">{\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">pipeline_tokens[\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">'output'\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">]\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">:,\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">}\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">print\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">f\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"Total Tokens:        \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">{\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">pipeline_tokens[\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">'input'\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">] \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">+\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> pipeline_tokens[\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">'output'\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">]\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">:,\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">}\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Cost estimate (Sonnet pricing: $3/M input, $15/M output)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">cost \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> (pipeline_tokens[\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">'input'\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">] \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">*\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">3\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">+\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> pipeline_tokens[\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">'output'\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">] \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">*\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">15\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">) \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">/\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">1_000_000\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">print\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">f\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"Estimated Cost:      $\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">{\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">cost\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">:.4f\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">}\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">return\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> results\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">def\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">main\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">():\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">parser \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> argparse.ArgumentParser(\u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">description\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"Generate documents from data\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">parser.add_argument(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"--data\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">required\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">True\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">help\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"Path to JSON data file\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">parser.add_argument(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"--output\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">default\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"./output\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">help\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"Output directory\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">args \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> parser.parse_args()\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">run_pipeline(args.data, args.output)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">if\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">__name__\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">==\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"__main__\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">main()\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"def run_pipeline(data_path: str, output_dir: str) -> dict:    &#x22;&#x22;&#x22;    Run complete document generation pipeline.    Returns:        Dict with all results and token usage    &#x22;&#x22;&#x22;    output_path = Path(output_dir)    output_path.mkdir(parents=True, exist_ok=True)    # Load data    with open(data_path) as f:        data = json.load(f)    print(&#x22;=&#x22; * 60)    print(&#x22;DOCUMENT GENERATION PIPELINE&#x22;)    print(&#x22;=&#x22; * 60)    results = {}    # Step 1: Excel    print(&#x22;\\nStep 1/3: Generating Excel...&#x22;)    results[&#x22;excel&#x22;] = generate_excel(data, output_path)    # Step 2: PowerPoint    print(&#x22;\\nStep 2/3: Generating PowerPoint...&#x22;)    results[&#x22;powerpoint&#x22;] = generate_powerpoint(data, output_path)    # Step 3: PDF    print(&#x22;\\nStep 3/3: Generating PDF...&#x22;)    results[&#x22;pdf&#x22;] = generate_pdf(data, output_path)    # Summary    print(&#x22;\\n&#x22; + &#x22;=&#x22; * 60)    print(&#x22;PIPELINE COMPLETE&#x22;)    print(&#x22;=&#x22; * 60)    print(f&#x22;\\nTotal Input Tokens:  {pipeline_tokens[&#x27;input&#x27;]:,}&#x22;)    print(f&#x22;Total Output Tokens: {pipeline_tokens[&#x27;output&#x27;]:,}&#x22;)    print(f&#x22;Total Tokens:        {pipeline_tokens[&#x27;input&#x27;] + pipeline_tokens[&#x27;output&#x27;]:,}&#x22;)    # Cost estimate (Sonnet pricing: $3/M input, $15/M output)    cost = (pipeline_tokens[&#x27;input&#x27;] * 3 + pipeline_tokens[&#x27;output&#x27;] * 15) / 1_000_000    print(f&#x22;Estimated Cost:      ${cost:.4f}&#x22;)    return resultsdef main():    parser = argparse.ArgumentParser(description=&#x22;Generate documents from data&#x22;)    parser.add_argument(&#x22;--data&#x22;, required=True, help=&#x22;Path to JSON data file&#x22;)    parser.add_argument(&#x22;--output&#x22;, default=&#x22;./output&#x22;, help=&#x22;Output directory&#x22;)    args = parser.parse_args()    run_pipeline(args.data, args.output)if __name__ == &#x22;__main__&#x22;:    main()\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003Cdiv class=\"code-fade\" aria-hidden=\"true\">\u003C/div>\u003C/div>\u003C/div>\n\u003Ch3 id=\"step-6-sample-data-file\">Step 6: Sample Data File\u003C/h3>\n\u003Cp>Create \u003Ccode>sample_data.json\u003C/code>:\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"29\" data-has-github=\"true\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">JSON\u003C/span>\u003Cspan class=\"language-badge\">json\u003C/span>\u003Ca class=\"github-header-link\" href=\"https://github.com/ameno-/acidbath-code/blob/main/production-patterns/document-generation-skills/sample_data.json\" target=\"_blank\" rel=\"noopener noreferrer\" title=\"View source on GitHub: production-patterns/document-generation-skills/sample_data.json\">\u003Cspan class=\"github-icon\">↗\u003C/span>\u003Cspan class=\"github-text\">GitHub\u003C/span>\u003C/a>\u003C/div>\u003Cdiv class=\"code-block-container collapsible with-line-numbers has-github-link\" data-language=\"json\" data-line-count=\"29\" data-max-preview=\"8\" data-github-url=\"https://github.com/ameno-/acidbath-code/blob/main/production-patterns/document-generation-skills/sample_data.json\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cbutton class=\"collapse-toggle\" aria-label=\"Toggle code visibility\" type=\"button\">\u003Cspan class=\"expand-text\">Expand (29 lines)\u003C/span>\u003Cspan class=\"collapse-text\">Collapse\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"json\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\">// github: https://github.com/ameno-/acidbath-code/blob/main/production-patterns/document-generation-skills/sample_data.json\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">\"title\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"Q4 2024 Business Review\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">\"date\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"January 2025\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">\"executive_summary\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"Q4 2024 showed strong performance with 17.9% YoY revenue growth and significant margin expansion.\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">\"summary\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">\"metrics\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">\"revenue\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">14500000\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">\"revenue_growth_yoy\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">17.9\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">\"net_income\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">1878750\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">\"operating_margin\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">17.9\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">\"customer_count\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">850\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">\"churn_rate\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">2.8\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">},\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">\"trends\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: [\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">      \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">{\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">\"quarter\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"Q1 2024\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">\"revenue\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">12500000\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">\"margin\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">15.0\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">},\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">      \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">{\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">\"quarter\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"Q2 2024\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">\"revenue\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">13200000\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">\"margin\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">15.8\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">},\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">      \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">{\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">\"quarter\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"Q3 2024\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">\"revenue\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">13800000\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">\"margin\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">16.5\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">},\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">      \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">{\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">\"quarter\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"Q4 2024\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">\"revenue\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">14500000\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">\"margin\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">17.9\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">]\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">},\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">\"recommendations\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: [\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"Maintain current growth trajectory\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"Expand customer success team to reduce churn\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"Invest in automation to improve margins\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"Consider international expansion in Q2 2025\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">]\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">}\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"// github: https://github.com/ameno-/acidbath-code/blob/main/production-patterns/document-generation-skills/sample_data.json{  &#x22;title&#x22;: &#x22;Q4 2024 Business Review&#x22;,  &#x22;date&#x22;: &#x22;January 2025&#x22;,  &#x22;executive_summary&#x22;: &#x22;Q4 2024 showed strong performance with 17.9% YoY revenue growth and significant margin expansion.&#x22;,  &#x22;summary&#x22;: {    &#x22;metrics&#x22;: {      &#x22;revenue&#x22;: 14500000,      &#x22;revenue_growth_yoy&#x22;: 17.9,      &#x22;net_income&#x22;: 1878750,      &#x22;operating_margin&#x22;: 17.9,      &#x22;customer_count&#x22;: 850,      &#x22;churn_rate&#x22;: 2.8    },    &#x22;trends&#x22;: [      {&#x22;quarter&#x22;: &#x22;Q1 2024&#x22;, &#x22;revenue&#x22;: 12500000, &#x22;margin&#x22;: 15.0},      {&#x22;quarter&#x22;: &#x22;Q2 2024&#x22;, &#x22;revenue&#x22;: 13200000, &#x22;margin&#x22;: 15.8},      {&#x22;quarter&#x22;: &#x22;Q3 2024&#x22;, &#x22;revenue&#x22;: 13800000, &#x22;margin&#x22;: 16.5},      {&#x22;quarter&#x22;: &#x22;Q4 2024&#x22;, &#x22;revenue&#x22;: 14500000, &#x22;margin&#x22;: 17.9}    ]  },  &#x22;recommendations&#x22;: [    &#x22;Maintain current growth trajectory&#x22;,    &#x22;Expand customer success team to reduce churn&#x22;,    &#x22;Invest in automation to improve margins&#x22;,    &#x22;Consider international expansion in Q2 2025&#x22;  ]}\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003Cdiv class=\"code-fade\" aria-hidden=\"true\">\u003C/div>\u003C/div>\u003Cdiv class=\"code-block-footer\">\u003Ca class=\"github-source-link\" href=\"https://github.com/ameno-/acidbath-code/blob/main/production-patterns/document-generation-skills/sample_data.json\" target=\"_blank\" rel=\"noopener noreferrer\">\u003Cspan class=\"github-arrow\">→\u003C/span>\u003Cspan> View full source: production-patterns/document-generation-skills/sample_data.json\u003C/span>\u003C/a>\u003C/div>\u003C/div>\n\u003Cp>Run the pipeline:\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"2\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">BASH\u003C/span>\u003Cspan class=\"language-badge\">bash\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container with-line-numbers\" data-language=\"bash\" data-line-count=\"2\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame is-terminal\">\u003Cfigcaption class=\"header\">\u003Cspan class=\"title\">\u003C/span>\u003Cspan class=\"sr-only\">Terminal window\u003C/span>\u003C/figcaption>\u003Cpre data-language=\"bash\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">uv\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">run\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">document_pipeline.py\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">--data\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">sample_data.json\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">--output\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">./reports\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"uv run document_pipeline.py --data sample_data.json --output ./reports\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003C/div>\u003C/div>\n\u003Ch2 id=\"the-numbers-what-actually-happens\">The Numbers: What Actually Happens\u003C/h2>\n\u003Cp>Real measurements from running this pipeline:\u003C/p>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\u003Ctable>\u003Cthead>\u003Ctr>\u003Cth>Document Type\u003C/th>\u003Cth>Generation Time\u003C/th>\u003Cth>Input Tokens\u003C/th>\u003Cth>Output Tokens\u003C/th>\u003Cth>Cost\u003C/th>\u003C/tr>\u003C/thead>\u003Ctbody>\u003Ctr>\u003Ctd>Excel (2 sheets)\u003C/td>\u003Ctd>1-2 min\u003C/td>\u003Ctd>~2,500\u003C/td>\u003Ctd>~3,000\u003C/td>\u003Ctd>$0.05\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>PowerPoint (4 slides)\u003C/td>\u003Ctd>1-2 min\u003C/td>\u003Ctd>~2,000\u003C/td>\u003Ctd>~2,500\u003C/td>\u003Ctd>$0.04\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>PDF (full report)\u003C/td>\u003Ctd>1-2 min\u003C/td>\u003Ctd>~1,800\u003C/td>\u003Ctd>~2,200\u003C/td>\u003Ctd>$0.04\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Cstrong>Pipeline Total\u003C/strong>\u003C/td>\u003Ctd>\u003Cstrong>5-6 min\u003C/strong>\u003C/td>\u003Ctd>\u003Cstrong>~6,300\u003C/strong>\u003C/td>\u003Ctd>\u003Cstrong>~7,700\u003C/strong>\u003C/td>\u003Ctd>\u003Cstrong>$0.13\u003C/strong>\u003C/td>\u003C/tr>\u003C/tbody>\u003C/table>\n\u003Cp>Compare to manual:\u003C/p>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\u003Ctable>\u003Cthead>\u003Ctr>\u003Cth>Metric\u003C/th>\u003Cth>Manual\u003C/th>\u003Cth>Skills Pipeline\u003C/th>\u003Cth>Improvement\u003C/th>\u003C/tr>\u003C/thead>\u003Ctbody>\u003Ctr>\u003Ctd>Time\u003C/td>\u003Ctd>100 min\u003C/td>\u003Ctd>10 min (5 gen + 5 review)\u003C/td>\u003Ctd>10x\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Cost\u003C/td>\u003Ctd>~$50/hour labor\u003C/td>\u003Ctd>$0.13 API\u003C/td>\u003Ctd>380x\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Consistency\u003C/td>\u003Ctd>Variable\u003C/td>\u003Ctd>Identical\u003C/td>\u003Ctd>∞\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Error rate\u003C/td>\u003Ctd>Human errors\u003C/td>\u003Ctd>Prompt errors\u003C/td>\u003Ctd>Different\u003C/td>\u003C/tr>\u003C/tbody>\u003C/table>\n\u003Cp>\u003Cstrong>Token efficiency note:\u003C/strong> Skills use ~90% fewer tokens than manually instructing Claude to build documents step by step. The skill encapsulates document structure knowledge.\u003C/p>\n\u003Ch2 id=\"when-this-works-ideal-use-cases\">When This Works: Ideal Use Cases\u003C/h2>\n\u003Cpre class=\"mermaid\">flowchart LR\n    subgraph R[\"Recurring Reports\"]\n        R1[\"Weekly, monthly, quarterly\"]\n        R2[\"Same structure, different data\"]\n    end\n\n    subgraph D[\"Data-to-Document\"]\n        D1[\"JSON → Excel with formulas\"]\n        D2[\"CSV → PowerPoint summary\"]\n        D3[\"Metrics → PDF report\"]\n    end\n\n    subgraph M[\"Multi-Format Output\"]\n        M1[\"One dataset → Excel + PPTX + PDF\"]\n        M2[\"Consistent data across formats\"]\n    end\n\n    subgraph T[\"Template-Based\"]\n        T1[\"Defined structure, variable content\"]\n        T2[\"Professional formatting\"]\n    end\n\n    subgraph B[\"Batch Processing\"]\n        B1[\"Generate 50 client reports\"]\n        B2[\"Same prompt, different data\"]\n    end\n\n    style R fill:#c8e6c9\n    style D fill:#c8e6c9\n    style M fill:#c8e6c9\n    style T fill:#c8e6c9\n    style B fill:#c8e6c9\n\u003C/pre>\n\u003Ch2 id=\"when-this-fails-know-the-limits-before-you-hit-them\">When This Fails: Know the Limits Before You Hit Them\u003C/h2>\n\u003Cp>Skills are not magic. Here’s what breaks—and the workarounds that actually work.\u003C/p>\n\u003Ch3 id=\"document-complexity-limits\">Document Complexity Limits\u003C/h3>\n\u003Cp>\u003Cstrong>Recommended limits:\u003C/strong>\u003C/p>\n\u003Cul>\n\u003Cli>Excel: 2-3 sheets per workbook\u003C/li>\n\u003Cli>PowerPoint: 5-7 slides per deck\u003C/li>\n\u003Cli>PDF: 10-15 pages\u003C/li>\n\u003C/ul>\n\u003Cp>Beyond these, reliability degrades. Generation time increases exponentially, and partial failures become common.\u003C/p>\n\u003Cp>\u003Cstrong>Workaround:\u003C/strong> Break complex documents into multiple focused files.\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"8\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">PYTHON\u003C/span>\u003Cspan class=\"language-badge\">python\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container with-line-numbers\" data-language=\"python\" data-line-count=\"8\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"python\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Bad: One complex 10-sheet Excel\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">generate_excel(full_data, \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"complete_report.xlsx\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)  \u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Fails at scale\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Good: Multiple focused files\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">generate_excel(pnl_data, \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"pnl_report.xlsx\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">generate_excel(balance_data, \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"balance_sheet.xlsx\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">generate_excel(kpi_data, \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"kpi_dashboard.xlsx\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"# Bad: One complex 10-sheet Excelgenerate_excel(full_data, &#x22;complete_report.xlsx&#x22;)  # Fails at scale# Good: Multiple focused filesgenerate_excel(pnl_data, &#x22;pnl_report.xlsx&#x22;)generate_excel(balance_data, &#x22;balance_sheet.xlsx&#x22;)generate_excel(kpi_data, &#x22;kpi_dashboard.xlsx&#x22;)\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003C/div>\u003C/div>\n\u003Ch3 id=\"data-format-sensitivity\">Data Format Sensitivity\u003C/h3>\n\u003Cp>Skills are sensitive to input data structure. Slight variations cause unpredictable output.\u003C/p>\n\u003Cp>\u003Cstrong>Example failure:\u003C/strong>\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"9\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">PYTHON\u003C/span>\u003Cspan class=\"language-badge\">python\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container with-line-numbers\" data-language=\"python\" data-line-count=\"9\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"python\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Works\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">data \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> {\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"revenue\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">14500000\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"growth\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">17.9\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Fails (missing field)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">data \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> {\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"revenue\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">14500000\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">}  \u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># No growth → chart generation fails\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Fails (wrong type)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">data \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> {\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"revenue\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"14.5M\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">}   \u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># String not number → formula errors\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"# Worksdata = {&#x22;revenue&#x22;: 14500000, &#x22;growth&#x22;: 17.9}# Fails (missing field)data = {&#x22;revenue&#x22;: 14500000}  # No growth → chart generation fails# Fails (wrong type)data = {&#x22;revenue&#x22;: &#x22;14.5M&#x22;}   # String not number → formula errors\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003C/div>\u003C/div>\n\u003Cp>\u003Cstrong>Mitigation:\u003C/strong> Validate data structure before sending to Skills.\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"5\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">PYTHON\u003C/span>\u003Cspan class=\"language-badge\">python\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container with-line-numbers\" data-language=\"python\" data-line-count=\"5\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"python\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">def\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">validate_data\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(data: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">dict\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">) -> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">bool\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">required_fields \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> [\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"revenue\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"growth\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"net_income\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">]\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">return\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">all\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(field \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">in\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> data.get(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"summary\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, {}).get(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"metrics\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, {})\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">               \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">for\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> field \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">in\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> required_fields)\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"def validate_data(data: dict) -> bool:    required_fields = [&#x22;revenue&#x22;, &#x22;growth&#x22;, &#x22;net_income&#x22;]    return all(field in data.get(&#x22;summary&#x22;, {}).get(&#x22;metrics&#x22;, {})               for field in required_fields)\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003C/div>\u003C/div>\n\u003Ch3 id=\"rate-limits-and-timeouts\">Rate Limits and Timeouts\u003C/h3>\n\u003Cp>\u003Cstrong>Failure modes:\u003C/strong>\u003C/p>\n\u003Cul>\n\u003Cli>Generating multiple complex documents simultaneously hits rate limits\u003C/li>\n\u003Cli>Generation time can vary from 30 seconds to 5 minutes\u003C/li>\n\u003Cli>No guaranteed maximum completion time\u003C/li>\n\u003C/ul>\n\u003Cp>\u003Cstrong>Mitigation:\u003C/strong> Implement retry logic and sequential execution.\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"15\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">PYTHON\u003C/span>\u003Cspan class=\"language-badge\">python\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container with-line-numbers\" data-language=\"python\" data-line-count=\"15\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"python\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">import\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> time\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">from\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> tenacity \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">import\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> retry, stop_after_attempt, wait_exponential\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">@retry\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(\u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">stop\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">stop_after_attempt(\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">3\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">), \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">wait\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">wait_exponential(\u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">min\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">1\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">max\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">10\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">))\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">def\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">generate_with_retry\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(prompt: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">str\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, skill_id: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">str\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">) -> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">dict\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">return\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> create_skills_message(prompt, skill_id)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">def\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">sequential_pipeline\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(data_files: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">list\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">) -> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">list\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">results \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> []\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">for\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> data_file \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">in\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> data_files:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">result \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> generate_with_retry(data_file)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">results.append(result)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">time.sleep(\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">2\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)  \u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Rate limit buffer\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">return\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> results\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import timefrom tenacity import retry, stop_after_attempt, wait_exponential@retry(stop=stop_after_attempt(3), wait=wait_exponential(min=1, max=10))def generate_with_retry(prompt: str, skill_id: str) -> dict:    return create_skills_message(prompt, skill_id)def sequential_pipeline(data_files: list) -> list:    results = []    for data_file in data_files:        result = generate_with_retry(data_file)        results.append(result)        time.sleep(2)  # Rate limit buffer    return results\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003C/div>\u003C/div>\n\u003Ch3 id=\"numeric-precision\">Numeric Precision\u003C/h3>\n\u003Cp>Financial calculations can lose precision. Rounding errors accumulate.\u003C/p>\n\u003Cp>\u003Cstrong>Example:\u003C/strong>\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"3\">\u003Cdiv class=\"code-block-container with-line-numbers\" data-language=\"\" data-line-count=\"3\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"plaintext\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">Expected: $14,500,000.00\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">Generated: $14,499,999.99\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"Expected: $14,500,000.00Generated: $14,499,999.99\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003C/div>\u003C/div>\n\u003Cp>\u003Cstrong>Mitigation:\u003C/strong> Specify precision explicitly in prompts.\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"7\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">PYTHON\u003C/span>\u003Cspan class=\"language-badge\">python\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container with-line-numbers\" data-language=\"python\" data-line-count=\"7\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"python\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">prompt \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\"\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">Format all currency values:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">- Use exactly 2 decimal places\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">- Round to nearest cent using banker's rounding\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">- Display as $X,XXX,XXX.XX format\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\"\"\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"prompt = &#x22;&#x22;&#x22;Format all currency values:- Use exactly 2 decimal places- Round to nearest cent using banker&#x27;s rounding- Display as $X,XXX,XXX.XX format&#x22;&#x22;&#x22;\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003C/div>\u003C/div>\n\u003Ch3 id=\"no-persistent-state\">No Persistent State\u003C/h3>\n\u003Cp>Each Skills call is stateless. Documents generated in separate calls may have subtle inconsistencies.\u003C/p>\n\u003Cp>\u003Cstrong>Example failure:\u003C/strong>\u003C/p>\n\u003Cul>\n\u003Cli>Excel shows revenue of $14.5M\u003C/li>\n\u003Cli>PowerPoint shows revenue of $14.51M (different rounding)\u003C/li>\n\u003C/ul>\n\u003Cp>\u003Cstrong>Mitigation:\u003C/strong> Generate all documents from the same data dict in the same session. Pass exact values, not calculated values.\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"9\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">PYTHON\u003C/span>\u003Cspan class=\"language-badge\">python\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container with-line-numbers\" data-language=\"python\" data-line-count=\"9\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"python\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Good: Same canonical data\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">data \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> {\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"revenue\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">14500000\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">generate_excel(data, \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">...\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">generate_powerpoint(data, \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">...\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)  \u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Same source\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Bad: Calculated values drift\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">excel_data \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> {\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"revenue\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: calculate_revenue()}  \u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># 14500000\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">ppt_data \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> {\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"revenue\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: calculate_revenue()}    \u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># 14500001 (race condition)\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"# Good: Same canonical datadata = {&#x22;revenue&#x22;: 14500000}generate_excel(data, ...)generate_powerpoint(data, ...)  # Same source# Bad: Calculated values driftexcel_data = {&#x22;revenue&#x22;: calculate_revenue()}  # 14500000ppt_data = {&#x22;revenue&#x22;: calculate_revenue()}    # 14500001 (race condition)\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003C/div>\u003C/div>\n\u003Ch3 id=\"pipeline-fragility\">Pipeline Fragility\u003C/h3>\n\u003Cp>If step 2 fails, step 3 never runs. One failure breaks the entire pipeline.\u003C/p>\n\u003Cp>\u003Cstrong>Mitigation:\u003C/strong> Implement robust error handling with partial success tracking.\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"20\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">PYTHON\u003C/span>\u003Cspan class=\"language-badge\">python\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container collapsible with-line-numbers\" data-language=\"python\" data-line-count=\"20\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cbutton class=\"collapse-toggle\" aria-label=\"Toggle code visibility\" type=\"button\">\u003Cspan class=\"expand-text\">Expand (20 lines)\u003C/span>\u003Cspan class=\"collapse-text\">Collapse\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"python\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">def\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">resilient_pipeline\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(data: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">dict\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">) -> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">dict\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">results \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> {\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"excel\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">None\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"powerpoint\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">None\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"pdf\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">None\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"errors\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: []}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">try\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">results[\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"excel\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">] \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> generate_excel(data)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">except\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">Exception\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">as\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> e:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">results[\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"errors\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">].append(\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">f\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"Excel failed: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">{\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">e\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">}\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">try\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">results[\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"powerpoint\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">] \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> generate_powerpoint(data)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">except\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">Exception\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">as\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> e:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">results[\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"errors\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">].append(\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">f\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"PowerPoint failed: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">{\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">e\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">}\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">try\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">results[\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"pdf\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">] \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> generate_pdf(data)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">except\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">Exception\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">as\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> e:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">results[\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"errors\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">].append(\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">f\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"PDF failed: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">{\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">e\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">}\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">return\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> results\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"def resilient_pipeline(data: dict) -> dict:    results = {&#x22;excel&#x22;: None, &#x22;powerpoint&#x22;: None, &#x22;pdf&#x22;: None, &#x22;errors&#x22;: []}    try:        results[&#x22;excel&#x22;] = generate_excel(data)    except Exception as e:        results[&#x22;errors&#x22;].append(f&#x22;Excel failed: {e}&#x22;)    try:        results[&#x22;powerpoint&#x22;] = generate_powerpoint(data)    except Exception as e:        results[&#x22;errors&#x22;].append(f&#x22;PowerPoint failed: {e}&#x22;)    try:        results[&#x22;pdf&#x22;] = generate_pdf(data)    except Exception as e:        results[&#x22;errors&#x22;].append(f&#x22;PDF failed: {e}&#x22;)    return results\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003Cdiv class=\"code-fade\" aria-hidden=\"true\">\u003C/div>\u003C/div>\u003C/div>\n\u003Ch2 id=\"best-practices-what-we-learned\">Best Practices: What We Learned\u003C/h2>\n\u003Cp>\u003Cstrong>Document structure:\u003C/strong>\u003C/p>\n\u003Cul>\n\u003Cli>2-3 sheets/slides per document for reliable generation\u003C/li>\n\u003Cli>Focus each sheet on a single purpose\u003C/li>\n\u003Cli>Break complex reports into multiple files\u003C/li>\n\u003Cli>Chain documents sequentially, not in parallel\u003C/li>\n\u003C/ul>\n\u003Cp>\u003Cstrong>Prompt design:\u003C/strong>\u003C/p>\n\u003Cul>\n\u003Cli>Use structured data (JSON) not prose descriptions\u003C/li>\n\u003Cli>Specify exact formatting requirements\u003C/li>\n\u003Cli>Include examples of expected output\u003C/li>\n\u003Cli>Be explicit about formulas and calculations\u003C/li>\n\u003C/ul>\n\u003Cp>\u003Cstrong>Error handling:\u003C/strong>\u003C/p>\n\u003Cul>\n\u003Cli>Validate data before sending to Skills\u003C/li>\n\u003Cli>Implement retry logic with exponential backoff\u003C/li>\n\u003Cli>Track partial successes separately from complete failures\u003C/li>\n\u003Cli>Log token usage for cost monitoring\u003C/li>\n\u003C/ul>\n\u003Cp>\u003Cstrong>Maintenance:\u003C/strong>\u003C/p>\n\u003Cul>\n\u003Cli>Monitor token usage trends over time\u003C/li>\n\u003Cli>Test prompts when updating to new SDK versions\u003C/li>\n\u003Cli>Keep prompt templates versioned with your code\u003C/li>\n\u003Cli>Build automated tests for document generation\u003C/li>\n\u003C/ul>\n\u003Ch2 id=\"agent-opportunity-document-generation-agent\">Agent Opportunity: Document Generation Agent\u003C/h2>\n\u003Cp>Build a specialized agent for document generation:\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"38\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">MARKDOWN\u003C/span>\u003Cspan class=\"language-badge\">markdown\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container collapsible with-line-numbers\" data-language=\"markdown\" data-line-count=\"38\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cbutton class=\"collapse-toggle\" aria-label=\"Toggle code visibility\" type=\"button\">\u003Cspan class=\"expand-text\">Expand (38 lines)\u003C/span>\u003Cspan class=\"collapse-text\">Collapse\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"markdown\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">---\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">name\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">document-generator\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">description\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">Generate multi-format business documents from structured data\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">tools\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">Bash, Read, Write, Skill\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">model\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">sonnet\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">---\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#79B8FF;--0fw:bold;--1:#005CC5;--1fw:bold\"># Document Generation Agent\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#79B8FF;--0fw:bold;--1:#005CC5;--1fw:bold\">## Workflow\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">1.\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#E1E4E8;--0fw:bold;--1:#24292E;--1fw:bold\">**Validate input data**\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Check required fields exist\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Verify data types are correct\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Normalize date formats\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">2.\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#E1E4E8;--0fw:bold;--1:#24292E;--1fw:bold\">**Generate documents sequentially**\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Excel first (primary data source)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> PowerPoint second (summary view)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> PDF third (formal documentation)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">3.\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#E1E4E8;--0fw:bold;--1:#24292E;--1fw:bold\">**Verify outputs**\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Check file sizes are reasonable\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Verify no generation errors\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Log token usage\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">4.\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#E1E4E8;--0fw:bold;--1:#24292E;--1fw:bold\">**Report completion**\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> List generated files with sizes\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Summarize token usage and cost\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Note any warnings or partial failures\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#79B8FF;--0fw:bold;--1:#005CC5;--1fw:bold\">## Rules\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> NEVER generate more than 3 sheets per Excel\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> ALWAYS validate data before calling Skills API\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> ALWAYS implement retry logic\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> ALWAYS track token usage for cost management\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"---name: document-generatordescription: Generate multi-format business documents from structured datatools: Bash, Read, Write, Skillmodel: sonnet---# Document Generation Agent## Workflow1. **Validate input data**   - Check required fields exist   - Verify data types are correct   - Normalize date formats2. **Generate documents sequentially**   - Excel first (primary data source)   - PowerPoint second (summary view)   - PDF third (formal documentation)3. **Verify outputs**   - Check file sizes are reasonable   - Verify no generation errors   - Log token usage4. **Report completion**   - List generated files with sizes   - Summarize token usage and cost   - Note any warnings or partial failures## Rules- NEVER generate more than 3 sheets per Excel- ALWAYS validate data before calling Skills API- ALWAYS implement retry logic- ALWAYS track token usage for cost management\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003Cdiv class=\"code-fade\" aria-hidden=\"true\">\u003C/div>\u003C/div>\u003C/div>\n\u003Cp>This agent can be triggered by file drops in a watched directory—see the Directory Watchers post for that pattern.\u003C/p>\n\u003Chr>\n\u003Cp>\u003Cstrong>Key Takeaways:\u003C/strong>\u003C/p>\n\u003Cul>\n\u003Cli>Skills generate professional documents (Excel, PowerPoint, PDF) in 1-2 minutes each\u003C/li>\n\u003Cli>Pipeline approach: data → Excel → PowerPoint → PDF, 5-6 minutes total\u003C/li>\n\u003Cli>90% fewer tokens than manual document instructions\u003C/li>\n\u003Cli>Cost: ~$0.13 per complete pipeline vs $50+ manual labor\u003C/li>\n\u003Cli>Reliability limits: 2-3 sheets per Excel, 5-7 slides per PowerPoint\u003C/li>\n\u003Cli>Common failures: complexity limits, data format sensitivity, rate limits\u003C/li>\n\u003Cli>Mitigations: break complex docs into focused files, validate data, implement retries\u003C/li>\n\u003Cli>Best fit: recurring reports, data-to-document conversion, template-based generation\u003C/li>\n\u003C/ul>\n\u003Cp>\u003Cstrong>Try It Now (10 Minutes to First Generation):\u003C/strong>\nCopy the \u003Ccode>document_pipeline.py\u003C/code> and \u003Ccode>sample_data.json\u003C/code> files above. Run \u003Ccode>uv run document_pipeline.py --data sample_data.json --output ./reports\u003C/code>. Check the generated files. Modify the prompts for your use case. Track token usage to estimate your costs.\u003C/p>\n\u003Cp>If you generate documents more than 5 times per month, this pays for itself in the first week. If you’re generating them weekly, the ROI is 50x.\u003C/p>\n\u003Chr>\n\u003Cp>\u003Cem>Next in series: Part 2 covers advanced patterns—custom templates, conditional formatting, and multi-source data aggregation.\u003C/em>\u003C/p>",{"headings":200,"localImagePaths":261,"remoteImagePaths":262,"frontmatter":263,"imagePaths":267},[201,204,207,210,213,216,219,222,225,228,231,234,237,240,243,246,249,252,255,258],{"depth":44,"slug":202,"text":203},"the-core-problem-manual-documents-dont-scale-and-nobody-admits-it","The Core Problem: Manual Documents Don’t Scale (And Nobody Admits It)",{"depth":44,"slug":205,"text":206},"the-pattern-skills-api-document-pipeline","The Pattern: Skills API Document Pipeline",{"depth":44,"slug":208,"text":209},"poc-complete-working-implementation","POC: Complete Working Implementation",{"depth":112,"slug":211,"text":212},"step-1-setup-and-configuration","Step 1: Setup and Configuration",{"depth":112,"slug":214,"text":215},"step-2-excel-generation-function","Step 2: Excel Generation Function",{"depth":112,"slug":217,"text":218},"step-3-powerpoint-generation-function","Step 3: PowerPoint Generation Function",{"depth":112,"slug":220,"text":221},"step-4-pdf-generation-function","Step 4: PDF Generation Function",{"depth":112,"slug":223,"text":224},"step-5-pipeline-orchestration","Step 5: Pipeline Orchestration",{"depth":112,"slug":226,"text":227},"step-6-sample-data-file","Step 6: Sample Data File",{"depth":44,"slug":229,"text":230},"the-numbers-what-actually-happens","The Numbers: What Actually Happens",{"depth":44,"slug":232,"text":233},"when-this-works-ideal-use-cases","When This Works: Ideal Use Cases",{"depth":44,"slug":235,"text":236},"when-this-fails-know-the-limits-before-you-hit-them","When This Fails: Know the Limits Before You Hit Them",{"depth":112,"slug":238,"text":239},"document-complexity-limits","Document Complexity Limits",{"depth":112,"slug":241,"text":242},"data-format-sensitivity","Data Format Sensitivity",{"depth":112,"slug":244,"text":245},"rate-limits-and-timeouts","Rate Limits and Timeouts",{"depth":112,"slug":247,"text":248},"numeric-precision","Numeric Precision",{"depth":112,"slug":250,"text":251},"no-persistent-state","No Persistent State",{"depth":112,"slug":253,"text":254},"pipeline-fragility","Pipeline Fragility",{"depth":44,"slug":256,"text":257},"best-practices-what-we-learned","Best Practices: What We Learned",{"depth":44,"slug":259,"text":260},"agent-opportunity-document-generation-agent","Agent Opportunity: Document Generation Agent",[],[],{"title":174,"description":175,"pubDate":264,"author":17,"tags":265,"banner":184,"category":193,"difficulty":35,"tldr":186,"keyTakeaways":266},["Date","2025-12-17T00:00:00.000Z"],[19,178,179,23,180,181,182,183],[188,189,190,191,192],[],"document-generation-skills.md","single-file-scripts",{"id":269,"data":271,"body":291,"filePath":292,"digest":293,"rendered":294,"legacyId":365},{"title":272,"description":273,"pubDate":274,"author":17,"tags":275,"draft":24,"banner":282,"seoKeywords":283,"tldr":284,"keyTakeaways":285,"category":193,"difficulty":35},"Single-File Scripts: When One File Beats an Entire MCP Server","Dolph is 1,015 lines of TypeScript that replace an MCP server. Here's the pattern for Bun and UV single-file scripts.",["Date","2025-12-23T00:00:00.000Z"],[19,276,277,278,279,280,281],"bun","uv","python","typescript","single-file","mcp-alternative","/assets/posts/single-file-scripts-banner.png",[],"Single-file scripts with Bun and UV combine the portability of standalone tools with the power of full dependency management. Dolph demonstrates how 1,015 lines replaces an MCP server with zero config, dual-mode execution (CLI + library), and compile-to-binary distribution.",[286,287,288,289,290],"Single-file scripts eliminate server process management and configuration files","Bun: TypeScript natively, compile to standalone binary, 3 dependencies in package.json","UV: Python with inline # /// script dependencies, auto-locked, shebang executable","Dual-mode pattern: same file works as CLI tool AND importable library","Security-first: dual-gate write protection, read-only defaults, auto row limits","One file. Zero config. Full functionality.\n\nDolph is 1,015 lines of TypeScript that do what an MCP server does—without the 47 configuration files, process management headaches, and \"why won't it connect\" debugging sessions.\n\nNo daemon processes to babysit. No YAML to misconfigure. No type definitions scattered across five directories. Just `bun dolph.ts --task list-tables` or import it as a library.\n\nThis is the single-file script pattern that senior engineers are quietly adopting for AI tooling.\n\n## The Problem with MCP Servers\n\nModel Context Protocol servers are powerful. They're also a 45-minute detour when all you needed was a database query.\n\nHere's what \"simple MCP tool\" actually costs you:\n\n- **Process management** - Your server crashes at 2 AM. Your tool stops working. Nobody notices until the demo.\n- **Configuration files** - `mcp.json`, server settings, transport config. Three files to misconfigure, zero helpful error messages.\n- **Type separation** - Tool definitions in one file, types in another, validation logic in a third. Good luck keeping them in sync.\n- **Distribution** - \"Just install the MCP server, configure Claude Desktop, add the correct permissions, restart, and...\"—you've lost them.\n\nFor simple database queries or file operations, this is like renting a crane to hang a picture frame.\n\nThere's a better pattern. Engineers at production companies have been using it quietly. Here's how it works.\n\n## When Single-File Scripts Win\n\nAfter building 12 AI tools across three production systems, a pattern emerged. Single-file scripts consistently outperform MCP servers when you need:\n\n1. **Zero server management** - Run directly, no background processes to monitor or restart\n2. **Dual-mode execution** - Same file works as CLI tool AND library import (this alone saves 40% of integration code)\n3. **Portable distribution** - One file (or one file + package.json for dependencies). Share via Slack. Done.\n4. **Fast iteration** - Change code, run immediately, no restart. Feedback loops under 2 seconds.\n5. **Standalone binaries** (Bun only) - Compile to self-contained executable. Ship to users who've never heard of Bun.\n\nDolph demonstrates all five. Here's the architecture that makes it work.\n\n## Case Study: Dolph Architecture\n\n### 1. Dual-Mode Execution in One File\n\n```typescript\n// github: https://github.com/ameno-/acidbath-code/blob/main/workflow-tools/single-file-scripts/complete-working-example/complete-working-example.ts\n#!/usr/bin/env bun\n/**\n * CLI Usage:\n *   bun dolph.ts --task test-connection\n *   bun dolph.ts --chat \"What tables are in this database?\"\n *\n * Server Usage:\n *   import { executeMySQLTask, runMySQLAgent } from \"./dolph.ts\";\n *   const result = await runMySQLAgent(\"Show me all users created today\");\n */\n\n// ... 1000+ lines of implementation ...\n\n// Entry point detection\nconst isMainModule = import.meta.main;\n\nif (isMainModule) {\n  runCLI().catch(async (error) => {\n    console.error(\"❌ Fatal error:\", error);\n    await closeConnection();\n    process.exit(1);\n  });\n}\n```\n\n**Pattern**: Use `import.meta.main` (Bun/Node) or `if __name__ == \"__main__\"` (Python) to detect execution mode. Export functions for library use, run CLI logic when executed directly.\n\n### 2. Type-Safe Without Separate Type Files\n\n```typescript\n// Types defined inline with Zod schemas\nconst listTablesTool = tool({\n  name: \"list_tables\",\n  description: \"List all tables in the current database with metadata.\",\n  parameters: z.object({\n    include_row_counts: z.boolean()\n      .optional()\n      .default(false)\n      .describe(\"Fetch exact row counts (slower but accurate)\"),\n  }),\n  async execute({ include_row_counts }): Promise\u003Cstring> {\n    const tables = await listTablesImpl(include_row_counts);\n    return JSON.stringify(tables, null, 2);\n  },\n});\n\n// TypeScript interfaces for exports\nexport interface TableInfo {\n  table_name: string;\n  table_type: string;\n  engine: string | null;\n  estimated_rows: number | null;\n  exact_row_count?: number;\n}\n```\n\n**Pattern**: Zod schemas provide runtime validation AND type inference. Export TypeScript interfaces for library consumers. Keep everything in one file.\n\n### 3. Dual-Gate Security Pattern\n\n```typescript\nconst WRITE_PATTERNS = /^(INSERT|UPDATE|DELETE|DROP|CREATE|ALTER|TRUNCATE|REPLACE)/i;\n\nasync function runQueryImpl(sql: string, allowWrite = false): Promise\u003CQueryResult> {\n  const config = getConfig();\n\n  if (isWriteQuery(sql)) {\n    // Gate 1: Caller must explicitly allow writes\n    if (!allowWrite) {\n      throw new Error(\"Write operations require allowWrite=true parameter\");\n    }\n    // Gate 2: Environment must enable writes globally\n    if (!config.allowWrite) {\n      throw new Error(\"Write operations disabled by configuration. Set MYSQL_ALLOW_WRITE=true\");\n    }\n  }\n\n  // Auto-limit SELECT queries\n  const finalSql = enforceLimit(sql, config.rowLimit);\n  const [result] = await db.execute(finalSql);\n\n  return { rows: result, row_count: result.length, duration_ms };\n}\n```\n\n**Pattern**: Layer multiple security checks. Require BOTH function parameter AND environment variable for destructive operations. Auto-enforce limits on read operations.\n\n### 4. Built-In Performance Reporting\n\n```typescript\nclass TerminalReporter {\n  private toolStartTimes = new Map\u003Cstring, number>();\n\n  onToolStart(toolCall: any, opts: { verbose: boolean }): void {\n    this.toolStartTimes.set(toolCall.id, performance.now());\n    process.stdout.write(`\\n→ tool: ${toolCall.name}\\n`);\n    if (opts.verbose) {\n      console.log(JSON.stringify(toolCall.arguments, null, 2));\n    }\n    startSpinner(\"Dolph is working...\");\n  }\n\n  onToolEnd(toolCall: any, result: any, opts: { verbose: boolean }): void {\n    const duration = performance.now() - this.toolStartTimes.get(toolCall.id);\n    process.stdout.write(`✓ tool: ${toolCall.name} (${formatMs(duration)})\\n`);\n    if (opts.verbose) {\n      console.log(JSON.stringify(result, null, 2));\n    }\n  }\n}\n```\n\n**Pattern**: Track timing for every operation. Show spinner during execution. Report durations in human-readable format (ms/s). Make verbose mode optional.\n\n## Bun vs UV: Complete Comparison\n\n| Feature | Bun (TypeScript) | UV (Python) |\n|---------|------------------|-------------|\n| **Dependency declaration** | `package.json` adjacent | `# /// script` block in file |\n| **Example inline deps** | Not inline (uses package.json) | `# dependencies = [\"requests\u003C3\"]` |\n| **Run command** | `bun script.ts` | `uv run script.py` |\n| **Shebang** | `#!/usr/bin/env bun` | `#!/usr/bin/env -S uv run --script` |\n| **Lock file** | `bun.lock` (adjacent) | `script.py.lock` (adjacent) |\n| **Compile to binary** | `bun build --compile` | N/A |\n| **Native TypeScript** | Yes, zero config | N/A (Python) |\n| **Built-in APIs** | File, HTTP, SQL native | Standard library only |\n| **Watch mode** | `bun --watch script.ts` | Not built-in |\n| **Environment loading** | `.env` auto-loaded | Manual via python-dotenv |\n| **Startup time** | ~50ms | ~100-200ms (depends on imports) |\n\n## Pattern Library: Reusable Code\n\n### Argument Parsing\n\n**Bun:**\n```typescript\nimport { parseArgs } from \"util\";\n\nconst { values, positionals } = parseArgs({\n  args: Bun.argv.slice(2),\n  options: {\n    task: { type: \"string\", short: \"t\" },\n    verbose: { type: \"boolean\", short: \"v\" },\n    \"include-counts\": { type: \"boolean\" },\n  },\n  allowPositionals: true,\n});\n\nif (values.verbose) {\n  console.log(`Task: ${values.task}`);\n}\n```\n\n**UV:**\n```python\n#!/usr/bin/env -S uv run --script\n# /// script\n# dependencies = [\"click\"]\n# ///\n\nimport click\n\n@click.command()\n@click.option('--task', '-t', help='Task to execute')\n@click.option('--verbose', '-v', is_flag=True, help='Verbose output')\n@click.option('--include-counts', is_flag=True, help='Include row counts')\ndef main(task, verbose, include_counts):\n    if verbose:\n        print(f\"Task: {task}\")\n\nif __name__ == \"__main__\":\n    main()\n```\n\n### Environment Variables\n\n**Bun:**\n```typescript\n// .env file auto-loaded by Bun\nconst dbUrl = Bun.env.DATABASE_URL || \"mysql://localhost:3306/db\";\nconst apiKey = Bun.env.OPENAI_API_KEY;\n\n// Access via process.env also works\nconst alt = process.env.DATABASE_URL;\n```\n\n**UV:**\n```python\n#!/usr/bin/env -S uv run --script\n# /// script\n# dependencies = [\"python-dotenv\"]\n# ///\n\nimport os\nfrom dotenv import load_dotenv\n\nload_dotenv()\ndb_url = os.getenv(\"DATABASE_URL\", \"mysql://localhost:3306/db\")\napi_key = os.getenv(\"OPENAI_API_KEY\")\n```\n\n### Database Connections\n\n**Bun:**\n```typescript\nimport mysql from \"mysql2/promise\";\n\n// Package.json dependencies\n// { \"dependencies\": { \"mysql2\": \"^3.6.5\" } }\n\nconst db = await mysql.createConnection({\n  host: Bun.env.MYSQL_HOST,\n  user: Bun.env.MYSQL_USER,\n  password: Bun.env.MYSQL_PASS,\n  database: Bun.env.MYSQL_DB,\n});\n\nconst [rows] = await db.execute(\"SELECT * FROM users WHERE active = ?\", [true]);\nawait db.end();\n```\n\n**UV:**\n```python\n#!/usr/bin/env -S uv run --script\n# /// script\n# dependencies = [\"mysql-connector-python\"]\n# ///\n\nimport mysql.connector\nimport os\n\nconn = mysql.connector.connect(\n    host=os.getenv(\"MYSQL_HOST\"),\n    user=os.getenv(\"MYSQL_USER\"),\n    password=os.getenv(\"MYSQL_PASS\"),\n    database=os.getenv(\"MYSQL_DB\")\n)\n\ncursor = conn.cursor(dictionary=True)\ncursor.execute(\"SELECT * FROM users WHERE active = %s\", (True,))\nrows = cursor.fetchall()\nconn.close()\n```\n\n### HTTP Requests\n\n**Bun:**\n```typescript\n// No dependencies needed - fetch is built-in\nconst response = await fetch(\"https://api.example.com/data\", {\n  headers: { \"Authorization\": `Bearer ${Bun.env.API_KEY}` }\n});\nconst data = await response.json();\n```\n\n**UV:**\n```python\n#!/usr/bin/env -S uv run --script\n# /// script\n# dependencies = [\"requests\"]\n# ///\n\nimport requests\nimport os\n\nresponse = requests.get(\n    \"https://api.example.com/data\",\n    headers={\"Authorization\": f\"Bearer {os.getenv('API_KEY')}\"}\n)\ndata = response.json()\n```\n\n## Complete Working Example: Database Agent\n\nHere's a minimal but complete single-file database agent pattern:\n\n```typescript\n#!/usr/bin/env bun\n/**\n * Usage:\n *   bun db-agent.ts --query \"SELECT * FROM users\"\n *   import { query } from \"./db-agent.ts\"\n */\n\nimport mysql from \"mysql2/promise\";\nimport { parseArgs } from \"util\";\n\ntype Connection = mysql.Connection;\nlet _db: Connection | null = null;\n\nasync function getConnection(): Promise\u003CConnection> {\n  if (!_db) {\n    _db = await mysql.createConnection({\n      host: Bun.env.MYSQL_HOST || \"localhost\",\n      user: Bun.env.MYSQL_USER || \"root\",\n      password: Bun.env.MYSQL_PASS || \"\",\n      database: Bun.env.MYSQL_DB || \"mysql\",\n    });\n  }\n  return _db;\n}\n\nexport async function query(sql: string): Promise\u003Cany[]> {\n  const db = await getConnection();\n  const [rows] = await db.execute(sql);\n  return Array.isArray(rows) ? rows : [];\n}\n\nexport async function close(): Promise\u003Cvoid> {\n  if (_db) {\n    await _db.end();\n    _db = null;\n  }\n}\n\n// CLI mode\nif (import.meta.main) {\n  const { values } = parseArgs({\n    args: Bun.argv.slice(2),\n    options: {\n      query: { type: \"string\", short: \"q\" },\n    },\n  });\n\n  if (!values.query) {\n    console.error(\"Usage: bun db-agent.ts --query 'SELECT ...'\");\n    process.exit(1);\n  }\n\n  try {\n    const results = await query(values.query);\n    console.log(JSON.stringify(results, null, 2));\n  } finally {\n    await close();\n  }\n}\n```\n\nSave as `db-agent.ts` with this `package.json`:\n\n```json\n{\n  \"dependencies\": {\n    \"mysql2\": \"^3.6.5\"\n  }\n}\n```\n\nRun it:\n```bash\nbun install\nbun db-agent.ts --query \"SELECT VERSION()\"\n```\n\nOr import it:\n```typescript\nimport { query, close } from \"./db-agent.ts\";\n\nconst users = await query(\"SELECT * FROM users LIMIT 5\");\nconsole.log(users);\nawait close();\n```\n\n## Compiling Bun Scripts to Binaries\n\nBun's killer feature: compile your script to a standalone executable with zero dependencies.\n\n![Single-File Compilation](/assets/posts/in-post/v2-single-file-compile.png)\n\n```bash\n# Basic compilation\nbun build --compile ./dolph.ts --outfile dolph\n\n# Optimized for production (2-4x faster startup)\nbun build --compile --bytecode --minify ./dolph.ts --outfile dolph\n\n# Run the binary (no Bun installation needed)\n./dolph --task list-tables\n```\n\nThe binary includes:\n- Your TypeScript code (transpiled)\n- All npm dependencies\n- The Bun runtime\n- Native modules\n\nShip it to users who don't have Bun installed. It just works.\n\n## What Doesn't Work (Know When to Stop)\n\nSingle-file scripts have limits. Here's when you've outgrown the pattern:\n\n1. **Multi-language ecosystems** - Python + Node.js + Rust in one tool? You need a server to coordinate them.\n2. **Complex service orchestration** - Multiple databases, message queues, webhooks talking to each other? Server territory.\n3. **Streaming responses** - MCP's streaming protocol handles real-time updates better than polling ever will.\n4. **Shared state across tools** - If tools need to remember what other tools did, a server maintains that context.\n5. **Hot reloading in production** - Servers can swap code without restarting. Scripts restart from scratch.\n\n**The graduation test**: When you catch yourself adding a config file to manage your \"simple\" script, it's time for a server.\n\nBut most tools never reach this point. Start simple. Graduate when you must—not before.\n\n## Progressive Disclosure: Inline Dependencies as Context\n\nThe `# /// script` pattern in UV creates self-documenting code. When you read a Python script, you see its dependencies immediately:\n\n```python\n#!/usr/bin/env -S uv run --script\n# /// script\n# dependencies = [\n#   \"openai>=1.0.0\",\n#   \"mysql-connector-python\",\n#   \"click>=8.0\",\n# ]\n# ///\n\nimport openai\nimport mysql.connector\nimport click\n```\n\nNo hunting for `requirements.txt`. No wondering which version. The context is inline.\n\nFor deeper context engineering patterns, see our [Context Engineering post](/blog/context-engineering) on progressive disclosure and UV scripts.\n\n## Try It Now (30 Minutes to Your First Single-File Agent)\n\n**Bun challenge**: Convert one MCP tool to a single-file script\n1. Pick your simplest MCP tool (file search, database query, API call)\n2. Create `tool.ts` with dual-mode pattern from this post\n3. Add dependencies to adjacent `package.json`\n4. Test CLI: `bun tool.ts --help`\n5. Test import: `import { execute } from \"./tool.ts\"`\n6. Compile: `bun build --compile tool.ts --outfile tool`\n\n**Result**: A standalone binary you can share with anyone. No Bun required on their machine.\n\n**UV challenge**: Create a single-file database agent\n1. Initialize: `uv init --script db.py --python 3.12`\n2. Add deps: `uv add --script db.py mysql-connector-python click`\n3. Implement query function with CLI argument parsing\n4. Lock it: `uv lock --script db.py`\n5. Make executable: `chmod +x db.py`\n\n**Result**: A shebang-executable script with locked dependencies. Share via Slack, run anywhere.\n\nBoth should be under 200 lines. If you need more, you probably need a server. But start here—most don't need more.\n\n## Dolph Stats: The Numbers That Matter\n\n| Metric | Value | What It Means |\n|--------|-------|---------------|\n| Lines of code | 1,015 | Entire agent fits in one readable file |\n| Dependencies | 3 | openai agents SDK, mysql2, zod—nothing else |\n| Compile time | 2.3s | Build to standalone binary faster than `npm install` |\n| Binary size | 89MB | Includes Bun runtime + all deps. Self-contained. |\n| Startup time | 52ms | Cold start to first query, compiled with --bytecode |\n| Tools exposed | 5 | test-connection, list-tables, get-schema, get-all-schemas, run-query |\n| Modes | 3 | CLI task, CLI chat, library import—same file |\n| Security gates | 2 | Dual-gate protection: parameter AND environment variable for writes |\n\n**1,015 lines. Full MySQL agent. No server process. No configuration nightmare.**\n\n## When to Use What\n\n| Scenario | Use Single-File Script | Use MCP Server |\n|----------|------------------------|----------------|\n| Database queries | ✓ Dolph pattern | Complex multi-DB orchestration |\n| File operations | ✓ Bun native APIs | File watching, hot reload |\n| API calls | ✓ fetch built-in | Streaming responses |\n| CLI tools | ✓ Compile to binary | Long-running daemons |\n| Library imports | ✓ Direct ESM import | Plugin architectures |\n| Quick prototypes | ✓ Zero config | Production services |\n| Single developer | ✓ One file to manage | Team collaboration on large systems |\n\nStart with a single-file script. Graduate to MCP when you hit the limits—not when you imagine you might.\n\nThe best code is the code you don't write. The best server is the server you don't run. The best config file is the one that doesn't exist.\n\n**One file. Zero config. Full functionality.**\n\nThat's not minimalism. That's engineering maturity.","src/content/blog/single-file-scripts.md","2007d54e8b0d6186",{"html":295,"metadata":296},"\u003Cp>One file. Zero config. Full functionality.\u003C/p>\n\u003Cp>Dolph is 1,015 lines of TypeScript that do what an MCP server does—without the 47 configuration files, process management headaches, and “why won’t it connect” debugging sessions.\u003C/p>\n\u003Cp>No daemon processes to babysit. No YAML to misconfigure. No type definitions scattered across five directories. Just \u003Ccode>bun dolph.ts --task list-tables\u003C/code> or import it as a library.\u003C/p>\n\u003Cp>This is the single-file script pattern that senior engineers are quietly adopting for AI tooling.\u003C/p>\n\u003Ch2 id=\"the-problem-with-mcp-servers\">The Problem with MCP Servers\u003C/h2>\n\u003Cp>Model Context Protocol servers are powerful. They’re also a 45-minute detour when all you needed was a database query.\u003C/p>\n\u003Cp>Here’s what “simple MCP tool” actually costs you:\u003C/p>\n\u003Cul>\n\u003Cli>\u003Cstrong>Process management\u003C/strong> - Your server crashes at 2 AM. Your tool stops working. Nobody notices until the demo.\u003C/li>\n\u003Cli>\u003Cstrong>Configuration files\u003C/strong> - \u003Ccode>mcp.json\u003C/code>, server settings, transport config. Three files to misconfigure, zero helpful error messages.\u003C/li>\n\u003Cli>\u003Cstrong>Type separation\u003C/strong> - Tool definitions in one file, types in another, validation logic in a third. Good luck keeping them in sync.\u003C/li>\n\u003Cli>\u003Cstrong>Distribution\u003C/strong> - “Just install the MCP server, configure Claude Desktop, add the correct permissions, restart, and…”—you’ve lost them.\u003C/li>\n\u003C/ul>\n\u003Cp>For simple database queries or file operations, this is like renting a crane to hang a picture frame.\u003C/p>\n\u003Cp>There’s a better pattern. Engineers at production companies have been using it quietly. Here’s how it works.\u003C/p>\n\u003Ch2 id=\"when-single-file-scripts-win\">When Single-File Scripts Win\u003C/h2>\n\u003Cp>After building 12 AI tools across three production systems, a pattern emerged. Single-file scripts consistently outperform MCP servers when you need:\u003C/p>\n\u003Col>\n\u003Cli>\u003Cstrong>Zero server management\u003C/strong> - Run directly, no background processes to monitor or restart\u003C/li>\n\u003Cli>\u003Cstrong>Dual-mode execution\u003C/strong> - Same file works as CLI tool AND library import (this alone saves 40% of integration code)\u003C/li>\n\u003Cli>\u003Cstrong>Portable distribution\u003C/strong> - One file (or one file + package.json for dependencies). Share via Slack. Done.\u003C/li>\n\u003Cli>\u003Cstrong>Fast iteration\u003C/strong> - Change code, run immediately, no restart. Feedback loops under 2 seconds.\u003C/li>\n\u003Cli>\u003Cstrong>Standalone binaries\u003C/strong> (Bun only) - Compile to self-contained executable. Ship to users who’ve never heard of Bun.\u003C/li>\n\u003C/ol>\n\u003Cp>Dolph demonstrates all five. Here’s the architecture that makes it work.\u003C/p>\n\u003Ch2 id=\"case-study-dolph-architecture\">Case Study: Dolph Architecture\u003C/h2>\n\u003Ch3 id=\"1-dual-mode-execution-in-one-file\">1. Dual-Mode Execution in One File\u003C/h3>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"25\" data-has-github=\"true\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">TYPESCRIPT\u003C/span>\u003Cspan class=\"language-badge\">typescript\u003C/span>\u003Ca class=\"github-header-link\" href=\"https://github.com/ameno-/acidbath-code/blob/main/workflow-tools/single-file-scripts/complete-working-example/complete-working-example.ts\" target=\"_blank\" rel=\"noopener noreferrer\" title=\"View source on GitHub: workflow-tools/single-file-scripts/complete-working-example/complete-working-example.ts\">\u003Cspan class=\"github-icon\">↗\u003C/span>\u003Cspan class=\"github-text\">GitHub\u003C/span>\u003C/a>\u003C/div>\u003Cdiv class=\"code-block-container collapsible with-line-numbers has-github-link\" data-language=\"typescript\" data-line-count=\"25\" data-max-preview=\"8\" data-github-url=\"https://github.com/ameno-/acidbath-code/blob/main/workflow-tools/single-file-scripts/complete-working-example/complete-working-example.ts\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cbutton class=\"collapse-toggle\" aria-label=\"Toggle code visibility\" type=\"button\">\u003Cspan class=\"expand-text\">Expand (25 lines)\u003C/span>\u003Cspan class=\"collapse-text\">Collapse\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Clink rel=\"stylesheet\" href=\"/_astro/ec.44wa8.css\">\u003Cscript type=\"module\" src=\"/_astro/ec.0vx5m.js\">\u003C/script>\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\">// github: https://github.com/ameno-/acidbath-code/blob/main/workflow-tools/single-file-scripts/complete-working-example/complete-working-example.ts\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">#\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">!/\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">usr\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">/\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">bin\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">/\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">env bun\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\">/**\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"> \u003C/span>\u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\">* CLI Usage:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"> \u003C/span>\u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\">*   bun dolph.ts --task test-connection\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"> \u003C/span>\u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\">*   bun dolph.ts --chat \"What tables are in this database?\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"> \u003C/span>\u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\">*\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"> \u003C/span>\u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\">* Server Usage:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"> \u003C/span>\u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\">*   import { executeMySQLTask, runMySQLAgent } from \"./dolph.ts\";\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"> \u003C/span>\u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\">*   const result = await runMySQLAgent(\"Show me all users created today\");\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"> \u003C/span>\u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\">*/\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\">// ... 1000+ lines of implementation ...\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\">// Entry point detection\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">const\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">isMainModule\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">import\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">.\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">meta\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">.main;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">if\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> (isMainModule) {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">runCLI\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">().\u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">catch\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">async\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> (\u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">error\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">) \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">console.\u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">error\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"❌ Fatal error:\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, error);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">await\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">closeConnection\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">();\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">process.\u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">exit\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">1\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">}\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"// github: https://github.com/ameno-/acidbath-code/blob/main/workflow-tools/single-file-scripts/complete-working-example/complete-working-example.ts#!/usr/bin/env bun/** * CLI Usage: *   bun dolph.ts --task test-connection *   bun dolph.ts --chat &#x22;What tables are in this database?&#x22; * * Server Usage: *   import { executeMySQLTask, runMySQLAgent } from &#x22;./dolph.ts&#x22;; *   const result = await runMySQLAgent(&#x22;Show me all users created today&#x22;); */// ... 1000+ lines of implementation ...// Entry point detectionconst isMainModule = import.meta.main;if (isMainModule) {  runCLI().catch(async (error) => {    console.error(&#x22;❌ Fatal error:&#x22;, error);    await closeConnection();    process.exit(1);  });}\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003Cdiv class=\"code-fade\" aria-hidden=\"true\">\u003C/div>\u003C/div>\u003Cdiv class=\"code-block-footer\">\u003Ca class=\"github-source-link\" href=\"https://github.com/ameno-/acidbath-code/blob/main/workflow-tools/single-file-scripts/complete-working-example/complete-working-example.ts\" target=\"_blank\" rel=\"noopener noreferrer\">\u003Cspan class=\"github-arrow\">→\u003C/span>\u003Cspan> View full source: workflow-tools/single-file-scripts/complete-working-example/complete-working-example.ts\u003C/span>\u003C/a>\u003C/div>\u003C/div>\n\u003Cp>\u003Cstrong>Pattern\u003C/strong>: Use \u003Ccode>import.meta.main\u003C/code> (Bun/Node) or \u003Ccode>if __name__ == \"__main__\"\u003C/code> (Python) to detect execution mode. Export functions for library use, run CLI logic when executed directly.\u003C/p>\n\u003Ch3 id=\"2-type-safe-without-separate-type-files\">2. Type-Safe Without Separate Type Files\u003C/h3>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"25\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">TYPESCRIPT\u003C/span>\u003Cspan class=\"language-badge\">typescript\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container collapsible with-line-numbers\" data-language=\"typescript\" data-line-count=\"25\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cbutton class=\"collapse-toggle\" aria-label=\"Toggle code visibility\" type=\"button\">\u003Cspan class=\"expand-text\">Expand (25 lines)\u003C/span>\u003Cspan class=\"collapse-text\">Collapse\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\">// Types defined inline with Zod schemas\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">const\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">listTablesTool\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">tool\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">({\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">name: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"list_tables\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">description: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"List all tables in the current database with metadata.\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">parameters: z.\u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">object\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">({\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">include_row_counts: z.\u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">boolean\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">()\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">      \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">.\u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">optional\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">()\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">      \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">.\u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">default\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">false\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">      \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">.\u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">describe\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"Fetch exact row counts (slower but accurate)\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">}),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">async\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">execute\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">({ \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">include_row_counts\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> })\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">:\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">Promise\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">string\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">> {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">const\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">tables\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">await\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">listTablesImpl\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(include_row_counts);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">return\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">JSON\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">.\u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">stringify\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(tables, \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">null\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">2\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">},\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\">// TypeScript interfaces for exports\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">export\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">interface\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">TableInfo\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">table_name\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">:\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">string\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">table_type\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">:\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">string\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">engine\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">:\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">string\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">|\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">null\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">estimated_rows\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">:\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">number\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">|\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">null\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">exact_row_count\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">?:\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">number\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">}\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"// Types defined inline with Zod schemasconst listTablesTool = tool({  name: &#x22;list_tables&#x22;,  description: &#x22;List all tables in the current database with metadata.&#x22;,  parameters: z.object({    include_row_counts: z.boolean()      .optional()      .default(false)      .describe(&#x22;Fetch exact row counts (slower but accurate)&#x22;),  }),  async execute({ include_row_counts }): Promise\u003Cstring> {    const tables = await listTablesImpl(include_row_counts);    return JSON.stringify(tables, null, 2);  },});// TypeScript interfaces for exportsexport interface TableInfo {  table_name: string;  table_type: string;  engine: string | null;  estimated_rows: number | null;  exact_row_count?: number;}\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003Cdiv class=\"code-fade\" aria-hidden=\"true\">\u003C/div>\u003C/div>\u003C/div>\n\u003Cp>\u003Cstrong>Pattern\u003C/strong>: Zod schemas provide runtime validation AND type inference. Export TypeScript interfaces for library consumers. Keep everything in one file.\u003C/p>\n\u003Ch3 id=\"3-dual-gate-security-pattern\">3. Dual-Gate Security Pattern\u003C/h3>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"23\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">TYPESCRIPT\u003C/span>\u003Cspan class=\"language-badge\">typescript\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container collapsible with-line-numbers\" data-language=\"typescript\" data-line-count=\"23\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cbutton class=\"collapse-toggle\" aria-label=\"Toggle code visibility\" type=\"button\">\u003Cspan class=\"expand-text\">Expand (23 lines)\u003C/span>\u003Cspan class=\"collapse-text\">Collapse\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">const\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">WRITE_PATTERNS\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--1:#032F62\">\u003Cspan style=\"--0:#DBEDFF\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF\">/\u003C/span>\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">^\u003C/span>\u003Cspan style=\"--0:#DBEDFF;--1:#032F62\">(INSERT\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">|\u003C/span>\u003Cspan style=\"--0:#DBEDFF;--1:#032F62\">UPDATE\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">|\u003C/span>\u003Cspan style=\"--0:#DBEDFF;--1:#032F62\">DELETE\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">|\u003C/span>\u003Cspan style=\"--0:#DBEDFF;--1:#032F62\">DROP\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">|\u003C/span>\u003Cspan style=\"--0:#DBEDFF;--1:#032F62\">CREATE\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">|\u003C/span>\u003Cspan style=\"--0:#DBEDFF;--1:#032F62\">ALTER\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">|\u003C/span>\u003Cspan style=\"--0:#DBEDFF;--1:#032F62\">TRUNCATE\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">|\u003C/span>\u003Cspan style=\"--1:#032F62\">\u003Cspan style=\"--0:#DBEDFF\">REPLACE)\u003C/span>\u003Cspan style=\"--0:#9ECBFF\">/\u003C/span>\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">i\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">async\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">function\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">runQueryImpl\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(\u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">sql\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">:\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">string\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">allowWrite\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">false\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">:\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">Promise\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">QueryResult\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">> {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">const\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">config\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">getConfig\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">();\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">if\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> (\u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">isWriteQuery\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(sql)) {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\">// Gate 1: Caller must explicitly allow writes\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">if\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> (\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">!\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">allowWrite) {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">throw\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">new\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">Error\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"Write operations require allowWrite=true parameter\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\">// Gate 2: Environment must enable writes globally\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">if\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> (\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">!\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">config.allowWrite) {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">throw\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">new\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">Error\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"Write operations disabled by configuration. Set MYSQL_ALLOW_WRITE=true\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\">// Auto-limit SELECT queries\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">const\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">finalSql\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">enforceLimit\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(sql, config.rowLimit);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">const\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> [\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">result\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">] \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">await\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> db.\u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">execute\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(finalSql);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">return\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> { rows: result, row_count: result.\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">length\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, duration_ms };\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">}\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const WRITE_PATTERNS = /^(INSERT|UPDATE|DELETE|DROP|CREATE|ALTER|TRUNCATE|REPLACE)/i;async function runQueryImpl(sql: string, allowWrite = false): Promise\u003CQueryResult> {  const config = getConfig();  if (isWriteQuery(sql)) {    // Gate 1: Caller must explicitly allow writes    if (!allowWrite) {      throw new Error(&#x22;Write operations require allowWrite=true parameter&#x22;);    }    // Gate 2: Environment must enable writes globally    if (!config.allowWrite) {      throw new Error(&#x22;Write operations disabled by configuration. Set MYSQL_ALLOW_WRITE=true&#x22;);    }  }  // Auto-limit SELECT queries  const finalSql = enforceLimit(sql, config.rowLimit);  const [result] = await db.execute(finalSql);  return { rows: result, row_count: result.length, duration_ms };}\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003Cdiv class=\"code-fade\" aria-hidden=\"true\">\u003C/div>\u003C/div>\u003C/div>\n\u003Cp>\u003Cstrong>Pattern\u003C/strong>: Layer multiple security checks. Require BOTH function parameter AND environment variable for destructive operations. Auto-enforce limits on read operations.\u003C/p>\n\u003Ch3 id=\"4-built-in-performance-reporting\">4. Built-In Performance Reporting\u003C/h3>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"21\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">TYPESCRIPT\u003C/span>\u003Cspan class=\"language-badge\">typescript\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container collapsible with-line-numbers\" data-language=\"typescript\" data-line-count=\"21\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cbutton class=\"collapse-toggle\" aria-label=\"Toggle code visibility\" type=\"button\">\u003Cspan class=\"expand-text\">Expand (21 lines)\u003C/span>\u003Cspan class=\"collapse-text\">Collapse\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">class\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">TerminalReporter\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">private\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">toolStartTimes\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">new\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">Map\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">string\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">number\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">>();\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">onToolStart\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(\u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">toolCall\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">:\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">any\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">opts\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">:\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> { \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">verbose\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">:\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">boolean\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> })\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">:\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">void\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">this\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">.toolStartTimes.\u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">set\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(toolCall.id, performance.\u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">now\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">());\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">process.stdout.\u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">write\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">`\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">\\n\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">→ tool: ${\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">toolCall\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">.\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">name\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">}\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">\\n\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">`\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">if\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> (opts.verbose) {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">      \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">console.\u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">log\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">JSON\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">.\u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">stringify\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(toolCall.arguments, \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">null\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">2\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">startSpinner\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"Dolph is working...\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">onToolEnd\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(\u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">toolCall\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">:\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">any\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">result\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">:\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">any\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">opts\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">:\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> { \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">verbose\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">:\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">boolean\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> })\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">:\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">void\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">const\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">duration\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> performance.\u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">now\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">() \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">this\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">.toolStartTimes.\u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">get\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(toolCall.id);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">process.stdout.\u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">write\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">`✓ tool: ${\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">toolCall\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">.\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">name\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">} (${\u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">formatMs\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">(\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">duration\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">)\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">})\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">\\n\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">`\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">if\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> (opts.verbose) {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">      \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">console.\u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">log\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">JSON\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">.\u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">stringify\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(result, \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">null\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">2\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">}\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"class TerminalReporter {  private toolStartTimes = new Map\u003Cstring, number>();  onToolStart(toolCall: any, opts: { verbose: boolean }): void {    this.toolStartTimes.set(toolCall.id, performance.now());    process.stdout.write(&#x60;\\n→ tool: ${toolCall.name}\\n&#x60;);    if (opts.verbose) {      console.log(JSON.stringify(toolCall.arguments, null, 2));    }    startSpinner(&#x22;Dolph is working...&#x22;);  }  onToolEnd(toolCall: any, result: any, opts: { verbose: boolean }): void {    const duration = performance.now() - this.toolStartTimes.get(toolCall.id);    process.stdout.write(&#x60;✓ tool: ${toolCall.name} (${formatMs(duration)})\\n&#x60;);    if (opts.verbose) {      console.log(JSON.stringify(result, null, 2));    }  }}\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003Cdiv class=\"code-fade\" aria-hidden=\"true\">\u003C/div>\u003C/div>\u003C/div>\n\u003Cp>\u003Cstrong>Pattern\u003C/strong>: Track timing for every operation. Show spinner during execution. Report durations in human-readable format (ms/s). Make verbose mode optional.\u003C/p>\n\u003Ch2 id=\"bun-vs-uv-complete-comparison\">Bun vs UV: Complete Comparison\u003C/h2>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\u003Ctable>\u003Cthead>\u003Ctr>\u003Cth>Feature\u003C/th>\u003Cth>Bun (TypeScript)\u003C/th>\u003Cth>UV (Python)\u003C/th>\u003C/tr>\u003C/thead>\u003Ctbody>\u003Ctr>\u003Ctd>\u003Cstrong>Dependency declaration\u003C/strong>\u003C/td>\u003Ctd>\u003Ccode>package.json\u003C/code> adjacent\u003C/td>\u003Ctd>\u003Ccode># /// script\u003C/code> block in file\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Cstrong>Example inline deps\u003C/strong>\u003C/td>\u003Ctd>Not inline (uses package.json)\u003C/td>\u003Ctd>\u003Ccode># dependencies = [\"requests&#x3C;3\"]\u003C/code>\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Cstrong>Run command\u003C/strong>\u003C/td>\u003Ctd>\u003Ccode>bun script.ts\u003C/code>\u003C/td>\u003Ctd>\u003Ccode>uv run script.py\u003C/code>\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Cstrong>Shebang\u003C/strong>\u003C/td>\u003Ctd>\u003Ccode>#!/usr/bin/env bun\u003C/code>\u003C/td>\u003Ctd>\u003Ccode>#!/usr/bin/env -S uv run --script\u003C/code>\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Cstrong>Lock file\u003C/strong>\u003C/td>\u003Ctd>\u003Ccode>bun.lock\u003C/code> (adjacent)\u003C/td>\u003Ctd>\u003Ccode>script.py.lock\u003C/code> (adjacent)\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Cstrong>Compile to binary\u003C/strong>\u003C/td>\u003Ctd>\u003Ccode>bun build --compile\u003C/code>\u003C/td>\u003Ctd>N/A\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Cstrong>Native TypeScript\u003C/strong>\u003C/td>\u003Ctd>Yes, zero config\u003C/td>\u003Ctd>N/A (Python)\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Cstrong>Built-in APIs\u003C/strong>\u003C/td>\u003Ctd>File, HTTP, SQL native\u003C/td>\u003Ctd>Standard library only\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Cstrong>Watch mode\u003C/strong>\u003C/td>\u003Ctd>\u003Ccode>bun --watch script.ts\u003C/code>\u003C/td>\u003Ctd>Not built-in\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Cstrong>Environment loading\u003C/strong>\u003C/td>\u003Ctd>\u003Ccode>.env\u003C/code> auto-loaded\u003C/td>\u003Ctd>Manual via python-dotenv\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Cstrong>Startup time\u003C/strong>\u003C/td>\u003Ctd>~50ms\u003C/td>\u003Ctd>~100-200ms (depends on imports)\u003C/td>\u003C/tr>\u003C/tbody>\u003C/table>\n\u003Ch2 id=\"pattern-library-reusable-code\">Pattern Library: Reusable Code\u003C/h2>\n\u003Ch3 id=\"argument-parsing\">Argument Parsing\u003C/h3>\n\u003Cp>\u003Cstrong>Bun:\u003C/strong>\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"16\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">TYPESCRIPT\u003C/span>\u003Cspan class=\"language-badge\">typescript\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container collapsible with-line-numbers\" data-language=\"typescript\" data-line-count=\"16\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cbutton class=\"collapse-toggle\" aria-label=\"Toggle code visibility\" type=\"button\">\u003Cspan class=\"expand-text\">Expand (16 lines)\u003C/span>\u003Cspan class=\"collapse-text\">Collapse\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">import\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> { parseArgs } \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">from\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"util\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">const\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> { \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">values\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">positionals\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> } \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">parseArgs\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">({\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">args: Bun.argv.\u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">slice\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">2\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">options: {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">task: { type: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"string\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, short: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"t\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> },\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">verbose: { type: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"boolean\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, short: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"v\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> },\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"include-counts\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: { type: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"boolean\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> },\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">},\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">allowPositionals: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">true\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">if\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> (values.verbose) {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">console.\u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">log\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">`Task: ${\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">values\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">.\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">task\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">}`\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">}\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { parseArgs } from &#x22;util&#x22;;const { values, positionals } = parseArgs({  args: Bun.argv.slice(2),  options: {    task: { type: &#x22;string&#x22;, short: &#x22;t&#x22; },    verbose: { type: &#x22;boolean&#x22;, short: &#x22;v&#x22; },    &#x22;include-counts&#x22;: { type: &#x22;boolean&#x22; },  },  allowPositionals: true,});if (values.verbose) {  console.log(&#x60;Task: ${values.task}&#x60;);}\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003Cdiv class=\"code-fade\" aria-hidden=\"true\">\u003C/div>\u003C/div>\u003C/div>\n\u003Cp>\u003Cstrong>UV:\u003C/strong>\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"18\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">PYTHON\u003C/span>\u003Cspan class=\"language-badge\">python\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container collapsible with-line-numbers\" data-language=\"python\" data-line-count=\"18\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cbutton class=\"collapse-toggle\" aria-label=\"Toggle code visibility\" type=\"button\">\u003Cspan class=\"expand-text\">Expand (18 lines)\u003C/span>\u003Cspan class=\"collapse-text\">Collapse\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"python\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\">#!/usr/bin/env -S uv run --script\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># /// script\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># dependencies = [\"click\"]\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># ///\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">import\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> click\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">@click.command\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">()\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">@click.option\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">'--task'\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">'-t'\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">help\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">'Task to execute'\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">@click.option\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">'--verbose'\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">'-v'\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">is_flag\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">True\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">help\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">'Verbose output'\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">@click.option\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">'--include-counts'\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">is_flag\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">True\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">help\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">'Include row counts'\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">def\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">main\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(task, verbose, include_counts):\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">if\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> verbose:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">print\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">f\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"Task: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">{\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">task\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">}\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">if\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">__name__\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">==\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"__main__\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">main()\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"#!/usr/bin/env -S uv run --script# /// script# dependencies = [&#x22;click&#x22;]# ///import click@click.command()@click.option(&#x27;--task&#x27;, &#x27;-t&#x27;, help=&#x27;Task to execute&#x27;)@click.option(&#x27;--verbose&#x27;, &#x27;-v&#x27;, is_flag=True, help=&#x27;Verbose output&#x27;)@click.option(&#x27;--include-counts&#x27;, is_flag=True, help=&#x27;Include row counts&#x27;)def main(task, verbose, include_counts):    if verbose:        print(f&#x22;Task: {task}&#x22;)if __name__ == &#x22;__main__&#x22;:    main()\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003Cdiv class=\"code-fade\" aria-hidden=\"true\">\u003C/div>\u003C/div>\u003C/div>\n\u003Ch3 id=\"environment-variables\">Environment Variables\u003C/h3>\n\u003Cp>\u003Cstrong>Bun:\u003C/strong>\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"7\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">TYPESCRIPT\u003C/span>\u003Cspan class=\"language-badge\">typescript\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container with-line-numbers\" data-language=\"typescript\" data-line-count=\"7\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\">// .env file auto-loaded by Bun\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">const\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">dbUrl\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Bun.env.\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">DATABASE_URL\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">||\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"mysql://localhost:3306/db\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">const\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">apiKey\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Bun.env.\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">OPENAI_API_KEY\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\">// Access via process.env also works\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">const\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">alt\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> process.env.\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">DATABASE_URL\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">;\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"// .env file auto-loaded by Bunconst dbUrl = Bun.env.DATABASE_URL || &#x22;mysql://localhost:3306/db&#x22;;const apiKey = Bun.env.OPENAI_API_KEY;// Access via process.env also worksconst alt = process.env.DATABASE_URL;\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003C/div>\u003C/div>\n\u003Cp>\u003Cstrong>UV:\u003C/strong>\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"12\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">PYTHON\u003C/span>\u003Cspan class=\"language-badge\">python\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container with-line-numbers\" data-language=\"python\" data-line-count=\"12\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"python\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\">#!/usr/bin/env -S uv run --script\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># /// script\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># dependencies = [\"python-dotenv\"]\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># ///\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">import\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> os\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">from\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> dotenv \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">import\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> load_dotenv\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">load_dotenv()\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">db_url \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> os.getenv(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"DATABASE_URL\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"mysql://localhost:3306/db\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">api_key \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> os.getenv(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"OPENAI_API_KEY\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"#!/usr/bin/env -S uv run --script# /// script# dependencies = [&#x22;python-dotenv&#x22;]# ///import osfrom dotenv import load_dotenvload_dotenv()db_url = os.getenv(&#x22;DATABASE_URL&#x22;, &#x22;mysql://localhost:3306/db&#x22;)api_key = os.getenv(&#x22;OPENAI_API_KEY&#x22;)\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003C/div>\u003C/div>\n\u003Ch3 id=\"database-connections\">Database Connections\u003C/h3>\n\u003Cp>\u003Cstrong>Bun:\u003C/strong>\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"15\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">TYPESCRIPT\u003C/span>\u003Cspan class=\"language-badge\">typescript\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container with-line-numbers\" data-language=\"typescript\" data-line-count=\"15\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">import\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> mysql \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">from\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"mysql2/promise\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\">// Package.json dependencies\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\">// { \"dependencies\": { \"mysql2\": \"^3.6.5\" } }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">const\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">db\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">await\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> mysql.\u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">createConnection\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">({\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">host: Bun.env.\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">MYSQL_HOST\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">user: Bun.env.\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">MYSQL_USER\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">password: Bun.env.\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">MYSQL_PASS\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">database: Bun.env.\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">MYSQL_DB\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">const\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> [\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">rows\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">] \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">await\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> db.\u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">execute\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"SELECT * FROM users WHERE active = ?\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, [\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">true\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">]);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">await\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> db.\u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">end\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">();\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import mysql from &#x22;mysql2/promise&#x22;;// Package.json dependencies// { &#x22;dependencies&#x22;: { &#x22;mysql2&#x22;: &#x22;^3.6.5&#x22; } }const db = await mysql.createConnection({  host: Bun.env.MYSQL_HOST,  user: Bun.env.MYSQL_USER,  password: Bun.env.MYSQL_PASS,  database: Bun.env.MYSQL_DB,});const [rows] = await db.execute(&#x22;SELECT * FROM users WHERE active = ?&#x22;, [true]);await db.end();\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003C/div>\u003C/div>\n\u003Cp>\u003Cstrong>UV:\u003C/strong>\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"20\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">PYTHON\u003C/span>\u003Cspan class=\"language-badge\">python\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container collapsible with-line-numbers\" data-language=\"python\" data-line-count=\"20\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cbutton class=\"collapse-toggle\" aria-label=\"Toggle code visibility\" type=\"button\">\u003Cspan class=\"expand-text\">Expand (20 lines)\u003C/span>\u003Cspan class=\"collapse-text\">Collapse\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"python\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\">#!/usr/bin/env -S uv run --script\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># /// script\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># dependencies = [\"mysql-connector-python\"]\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># ///\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">import\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> mysql.connector\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">import\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> os\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">conn \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> mysql.connector.connect(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">host\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">os.getenv(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"MYSQL_HOST\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">user\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">os.getenv(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"MYSQL_USER\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">password\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">os.getenv(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"MYSQL_PASS\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">database\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">os.getenv(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"MYSQL_DB\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">cursor \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> conn.cursor(\u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">dictionary\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">True\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">cursor.execute(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"SELECT * FROM users WHERE active = \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">%s\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, (\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">True\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,))\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">rows \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> cursor.fetchall()\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">conn.close()\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"#!/usr/bin/env -S uv run --script# /// script# dependencies = [&#x22;mysql-connector-python&#x22;]# ///import mysql.connectorimport osconn = mysql.connector.connect(    host=os.getenv(&#x22;MYSQL_HOST&#x22;),    user=os.getenv(&#x22;MYSQL_USER&#x22;),    password=os.getenv(&#x22;MYSQL_PASS&#x22;),    database=os.getenv(&#x22;MYSQL_DB&#x22;))cursor = conn.cursor(dictionary=True)cursor.execute(&#x22;SELECT * FROM users WHERE active = %s&#x22;, (True,))rows = cursor.fetchall()conn.close()\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003Cdiv class=\"code-fade\" aria-hidden=\"true\">\u003C/div>\u003C/div>\u003C/div>\n\u003Ch3 id=\"http-requests\">HTTP Requests\u003C/h3>\n\u003Cp>\u003Cstrong>Bun:\u003C/strong>\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"6\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">TYPESCRIPT\u003C/span>\u003Cspan class=\"language-badge\">typescript\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container with-line-numbers\" data-language=\"typescript\" data-line-count=\"6\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\">// No dependencies needed - fetch is built-in\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">const\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">response\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">await\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">fetch\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"https://api.example.com/data\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">headers: { \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"Authorization\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">`Bearer ${\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">Bun\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">.\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">env\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">.\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">API_KEY\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">}`\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">const\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">data\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">await\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> response.\u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">json\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">();\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"// No dependencies needed - fetch is built-inconst response = await fetch(&#x22;https://api.example.com/data&#x22;, {  headers: { &#x22;Authorization&#x22;: &#x60;Bearer ${Bun.env.API_KEY}&#x60; }});const data = await response.json();\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003C/div>\u003C/div>\n\u003Cp>\u003Cstrong>UV:\u003C/strong>\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"14\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">PYTHON\u003C/span>\u003Cspan class=\"language-badge\">python\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container with-line-numbers\" data-language=\"python\" data-line-count=\"14\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"python\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\">#!/usr/bin/env -S uv run --script\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># /// script\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># dependencies = [\"requests\"]\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># ///\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">import\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> requests\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">import\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> os\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">response \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> requests.get(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"https://api.example.com/data\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">headers\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">{\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"Authorization\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">f\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"Bearer \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">{\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">os.getenv(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">'API_KEY'\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">}\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">data \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> response.json()\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"#!/usr/bin/env -S uv run --script# /// script# dependencies = [&#x22;requests&#x22;]# ///import requestsimport osresponse = requests.get(    &#x22;https://api.example.com/data&#x22;,    headers={&#x22;Authorization&#x22;: f&#x22;Bearer {os.getenv(&#x27;API_KEY&#x27;)}&#x22;})data = response.json()\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003C/div>\u003C/div>\n\u003Ch2 id=\"complete-working-example-database-agent\">Complete Working Example: Database Agent\u003C/h2>\n\u003Cp>Here’s a minimal but complete single-file database agent pattern:\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"60\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">TYPESCRIPT\u003C/span>\u003Cspan class=\"language-badge\">typescript\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container collapsible with-line-numbers\" data-language=\"typescript\" data-line-count=\"60\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cbutton class=\"collapse-toggle\" aria-label=\"Toggle code visibility\" type=\"button\">\u003Cspan class=\"expand-text\">Expand (60 lines)\u003C/span>\u003Cspan class=\"collapse-text\">Collapse\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\">#!/usr/bin/env bun\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\">/**\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"> \u003C/span>\u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\">* Usage:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"> \u003C/span>\u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\">*   bun db-agent.ts --query \"SELECT * FROM users\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"> \u003C/span>\u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\">*   import { query } from \"./db-agent.ts\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"> \u003C/span>\u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\">*/\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">import\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> mysql \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">from\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"mysql2/promise\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">import\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> { parseArgs } \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">from\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"util\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">type\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">Connection\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">mysql\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">.\u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">Connection\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">let\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> _db\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">:\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">Connection\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">|\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">null\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">null\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">async\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">function\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">getConnection\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">()\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">:\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">Promise\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">Connection\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">> {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">if\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> (\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">!\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">_db) {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">_db \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">await\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> mysql.\u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">createConnection\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">({\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">      \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">host: Bun.env.\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">MYSQL_HOST\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">||\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"localhost\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">      \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">user: Bun.env.\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">MYSQL_USER\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">||\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"root\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">      \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">password: Bun.env.\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">MYSQL_PASS\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">||\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">      \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">database: Bun.env.\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">MYSQL_DB\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">||\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"mysql\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">return\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> _db;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">export\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">async\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">function\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">query\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(\u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">sql\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">:\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">string\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">:\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">Promise\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">any\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">[]> {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">const\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">db\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">await\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">getConnection\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">();\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">const\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> [\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">rows\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">] \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">await\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> db.\u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">execute\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(sql);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">return\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Array.\u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">isArray\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(rows) \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">?\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> rows \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">:\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> [];\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">export\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">async\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">function\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">close\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">()\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">:\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">Promise\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">void\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">> {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">if\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> (_db) {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">await\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> _db.\u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">end\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">();\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">_db \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">null\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\">// CLI mode\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">if\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> (\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">import\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">.\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">meta\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">.main) {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">const\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> { \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">values\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> } \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">parseArgs\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">({\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">args: Bun.argv.\u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">slice\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">2\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">options: {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">      \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">query: { type: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"string\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, short: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"q\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> },\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">},\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">if\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> (\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">!\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">values.query) {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">console.\u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">error\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"Usage: bun db-agent.ts --query 'SELECT ...'\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">process.\u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">exit\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">1\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">try\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">const\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">results\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">await\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">query\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(values.query);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">console.\u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">log\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">JSON\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">.\u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">stringify\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(results, \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">null\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">2\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">} \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">finally\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">await\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">close\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">();\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">}\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"#!/usr/bin/env bun/** * Usage: *   bun db-agent.ts --query &#x22;SELECT * FROM users&#x22; *   import { query } from &#x22;./db-agent.ts&#x22; */import mysql from &#x22;mysql2/promise&#x22;;import { parseArgs } from &#x22;util&#x22;;type Connection = mysql.Connection;let _db: Connection | null = null;async function getConnection(): Promise\u003CConnection> {  if (!_db) {    _db = await mysql.createConnection({      host: Bun.env.MYSQL_HOST || &#x22;localhost&#x22;,      user: Bun.env.MYSQL_USER || &#x22;root&#x22;,      password: Bun.env.MYSQL_PASS || &#x22;&#x22;,      database: Bun.env.MYSQL_DB || &#x22;mysql&#x22;,    });  }  return _db;}export async function query(sql: string): Promise\u003Cany[]> {  const db = await getConnection();  const [rows] = await db.execute(sql);  return Array.isArray(rows) ? rows : [];}export async function close(): Promise\u003Cvoid> {  if (_db) {    await _db.end();    _db = null;  }}// CLI modeif (import.meta.main) {  const { values } = parseArgs({    args: Bun.argv.slice(2),    options: {      query: { type: &#x22;string&#x22;, short: &#x22;q&#x22; },    },  });  if (!values.query) {    console.error(&#x22;Usage: bun db-agent.ts --query &#x27;SELECT ...&#x27;&#x22;);    process.exit(1);  }  try {    const results = await query(values.query);    console.log(JSON.stringify(results, null, 2));  } finally {    await close();  }}\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003Cdiv class=\"code-fade\" aria-hidden=\"true\">\u003C/div>\u003C/div>\u003C/div>\n\u003Cp>Save as \u003Ccode>db-agent.ts\u003C/code> with this \u003Ccode>package.json\u003C/code>:\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"6\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">JSON\u003C/span>\u003Cspan class=\"language-badge\">json\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container with-line-numbers\" data-language=\"json\" data-line-count=\"6\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"json\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">\"dependencies\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">\"mysql2\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"^3.6.5\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">}\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"{  &#x22;dependencies&#x22;: {    &#x22;mysql2&#x22;: &#x22;^3.6.5&#x22;  }}\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003C/div>\u003C/div>\n\u003Cp>Run it:\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"3\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">BASH\u003C/span>\u003Cspan class=\"language-badge\">bash\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container with-line-numbers\" data-language=\"bash\" data-line-count=\"3\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame is-terminal\">\u003Cfigcaption class=\"header\">\u003Cspan class=\"title\">\u003C/span>\u003Cspan class=\"sr-only\">Terminal window\u003C/span>\u003C/figcaption>\u003Cpre data-language=\"bash\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">bun\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">install\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">bun\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">db-agent.ts\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">--query\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"SELECT VERSION()\"\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"bun installbun db-agent.ts --query &#x22;SELECT VERSION()&#x22;\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003C/div>\u003C/div>\n\u003Cp>Or import it:\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"6\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">TYPESCRIPT\u003C/span>\u003Cspan class=\"language-badge\">typescript\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container with-line-numbers\" data-language=\"typescript\" data-line-count=\"6\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">import\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> { query, close } \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">from\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"./db-agent.ts\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">const\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">users\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">await\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">query\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"SELECT * FROM users LIMIT 5\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">console.\u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">log\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(users);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">await\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">close\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">();\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { query, close } from &#x22;./db-agent.ts&#x22;;const users = await query(&#x22;SELECT * FROM users LIMIT 5&#x22;);console.log(users);await close();\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003C/div>\u003C/div>\n\u003Ch2 id=\"compiling-bun-scripts-to-binaries\">Compiling Bun Scripts to Binaries\u003C/h2>\n\u003Cp>Bun’s killer feature: compile your script to a standalone executable with zero dependencies.\u003C/p>\n\u003Cp>\u003Cimg src=\"/assets/posts/in-post/v2-single-file-compile.png\" alt=\"Single-File Compilation\">\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"9\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">BASH\u003C/span>\u003Cspan class=\"language-badge\">bash\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container with-line-numbers\" data-language=\"bash\" data-line-count=\"9\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame is-terminal\">\u003Cfigcaption class=\"header\">\u003Cspan class=\"title\">\u003C/span>\u003Cspan class=\"sr-only\">Terminal window\u003C/span>\u003C/figcaption>\u003Cpre data-language=\"bash\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Basic compilation\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">bun\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">build\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">--compile\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">./dolph.ts\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">--outfile\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">dolph\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Optimized for production (2-4x faster startup)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">bun\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">build\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">--compile\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">--bytecode\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">--minify\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">./dolph.ts\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">--outfile\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">dolph\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Run the binary (no Bun installation needed)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">./dolph\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">--task\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">list-tables\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"bun build --compile ./dolph.ts --outfile dolphbun build --compile --bytecode --minify ./dolph.ts --outfile dolph./dolph --task list-tables\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003C/div>\u003C/div>\n\u003Cp>The binary includes:\u003C/p>\n\u003Cul>\n\u003Cli>Your TypeScript code (transpiled)\u003C/li>\n\u003Cli>All npm dependencies\u003C/li>\n\u003Cli>The Bun runtime\u003C/li>\n\u003Cli>Native modules\u003C/li>\n\u003C/ul>\n\u003Cp>Ship it to users who don’t have Bun installed. It just works.\u003C/p>\n\u003Ch2 id=\"what-doesnt-work-know-when-to-stop\">What Doesn’t Work (Know When to Stop)\u003C/h2>\n\u003Cp>Single-file scripts have limits. Here’s when you’ve outgrown the pattern:\u003C/p>\n\u003Col>\n\u003Cli>\u003Cstrong>Multi-language ecosystems\u003C/strong> - Python + Node.js + Rust in one tool? You need a server to coordinate them.\u003C/li>\n\u003Cli>\u003Cstrong>Complex service orchestration\u003C/strong> - Multiple databases, message queues, webhooks talking to each other? Server territory.\u003C/li>\n\u003Cli>\u003Cstrong>Streaming responses\u003C/strong> - MCP’s streaming protocol handles real-time updates better than polling ever will.\u003C/li>\n\u003Cli>\u003Cstrong>Shared state across tools\u003C/strong> - If tools need to remember what other tools did, a server maintains that context.\u003C/li>\n\u003Cli>\u003Cstrong>Hot reloading in production\u003C/strong> - Servers can swap code without restarting. Scripts restart from scratch.\u003C/li>\n\u003C/ol>\n\u003Cp>\u003Cstrong>The graduation test\u003C/strong>: When you catch yourself adding a config file to manage your “simple” script, it’s time for a server.\u003C/p>\n\u003Cp>But most tools never reach this point. Start simple. Graduate when you must—not before.\u003C/p>\n\u003Ch2 id=\"progressive-disclosure-inline-dependencies-as-context\">Progressive Disclosure: Inline Dependencies as Context\u003C/h2>\n\u003Cp>The \u003Ccode># /// script\u003C/code> pattern in UV creates self-documenting code. When you read a Python script, you see its dependencies immediately:\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"13\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">PYTHON\u003C/span>\u003Cspan class=\"language-badge\">python\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container with-line-numbers\" data-language=\"python\" data-line-count=\"13\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"python\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\">#!/usr/bin/env -S uv run --script\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># /// script\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># dependencies = [\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\">#   \"openai>=1.0.0\",\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\">#   \"mysql-connector-python\",\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\">#   \"click>=8.0\",\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># ]\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># ///\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">import\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> openai\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">import\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> mysql.connector\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">import\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> click\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"#!/usr/bin/env -S uv run --script# /// script# dependencies = [#   &#x22;openai>=1.0.0&#x22;,#   &#x22;mysql-connector-python&#x22;,#   &#x22;click>=8.0&#x22;,# ]# ///import openaiimport mysql.connectorimport click\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003C/div>\u003C/div>\n\u003Cp>No hunting for \u003Ccode>requirements.txt\u003C/code>. No wondering which version. The context is inline.\u003C/p>\n\u003Cp>For deeper context engineering patterns, see our \u003Ca href=\"/blog/context-engineering\">Context Engineering post\u003C/a> on progressive disclosure and UV scripts.\u003C/p>\n\u003Ch2 id=\"try-it-now-30-minutes-to-your-first-single-file-agent\">Try It Now (30 Minutes to Your First Single-File Agent)\u003C/h2>\n\u003Cp>\u003Cstrong>Bun challenge\u003C/strong>: Convert one MCP tool to a single-file script\u003C/p>\n\u003Col>\n\u003Cli>Pick your simplest MCP tool (file search, database query, API call)\u003C/li>\n\u003Cli>Create \u003Ccode>tool.ts\u003C/code> with dual-mode pattern from this post\u003C/li>\n\u003Cli>Add dependencies to adjacent \u003Ccode>package.json\u003C/code>\u003C/li>\n\u003Cli>Test CLI: \u003Ccode>bun tool.ts --help\u003C/code>\u003C/li>\n\u003Cli>Test import: \u003Ccode>import { execute } from \"./tool.ts\"\u003C/code>\u003C/li>\n\u003Cli>Compile: \u003Ccode>bun build --compile tool.ts --outfile tool\u003C/code>\u003C/li>\n\u003C/ol>\n\u003Cp>\u003Cstrong>Result\u003C/strong>: A standalone binary you can share with anyone. No Bun required on their machine.\u003C/p>\n\u003Cp>\u003Cstrong>UV challenge\u003C/strong>: Create a single-file database agent\u003C/p>\n\u003Col>\n\u003Cli>Initialize: \u003Ccode>uv init --script db.py --python 3.12\u003C/code>\u003C/li>\n\u003Cli>Add deps: \u003Ccode>uv add --script db.py mysql-connector-python click\u003C/code>\u003C/li>\n\u003Cli>Implement query function with CLI argument parsing\u003C/li>\n\u003Cli>Lock it: \u003Ccode>uv lock --script db.py\u003C/code>\u003C/li>\n\u003Cli>Make executable: \u003Ccode>chmod +x db.py\u003C/code>\u003C/li>\n\u003C/ol>\n\u003Cp>\u003Cstrong>Result\u003C/strong>: A shebang-executable script with locked dependencies. Share via Slack, run anywhere.\u003C/p>\n\u003Cp>Both should be under 200 lines. If you need more, you probably need a server. But start here—most don’t need more.\u003C/p>\n\u003Ch2 id=\"dolph-stats-the-numbers-that-matter\">Dolph Stats: The Numbers That Matter\u003C/h2>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\u003Ctable>\u003Cthead>\u003Ctr>\u003Cth>Metric\u003C/th>\u003Cth>Value\u003C/th>\u003Cth>What It Means\u003C/th>\u003C/tr>\u003C/thead>\u003Ctbody>\u003Ctr>\u003Ctd>Lines of code\u003C/td>\u003Ctd>1,015\u003C/td>\u003Ctd>Entire agent fits in one readable file\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Dependencies\u003C/td>\u003Ctd>3\u003C/td>\u003Ctd>openai agents SDK, mysql2, zod—nothing else\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Compile time\u003C/td>\u003Ctd>2.3s\u003C/td>\u003Ctd>Build to standalone binary faster than \u003Ccode>npm install\u003C/code>\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Binary size\u003C/td>\u003Ctd>89MB\u003C/td>\u003Ctd>Includes Bun runtime + all deps. Self-contained.\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Startup time\u003C/td>\u003Ctd>52ms\u003C/td>\u003Ctd>Cold start to first query, compiled with —bytecode\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Tools exposed\u003C/td>\u003Ctd>5\u003C/td>\u003Ctd>test-connection, list-tables, get-schema, get-all-schemas, run-query\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Modes\u003C/td>\u003Ctd>3\u003C/td>\u003Ctd>CLI task, CLI chat, library import—same file\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Security gates\u003C/td>\u003Ctd>2\u003C/td>\u003Ctd>Dual-gate protection: parameter AND environment variable for writes\u003C/td>\u003C/tr>\u003C/tbody>\u003C/table>\n\u003Cp>\u003Cstrong>1,015 lines. Full MySQL agent. No server process. No configuration nightmare.\u003C/strong>\u003C/p>\n\u003Ch2 id=\"when-to-use-what\">When to Use What\u003C/h2>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\u003Ctable>\u003Cthead>\u003Ctr>\u003Cth>Scenario\u003C/th>\u003Cth>Use Single-File Script\u003C/th>\u003Cth>Use MCP Server\u003C/th>\u003C/tr>\u003C/thead>\u003Ctbody>\u003Ctr>\u003Ctd>Database queries\u003C/td>\u003Ctd>✓ Dolph pattern\u003C/td>\u003Ctd>Complex multi-DB orchestration\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>File operations\u003C/td>\u003Ctd>✓ Bun native APIs\u003C/td>\u003Ctd>File watching, hot reload\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>API calls\u003C/td>\u003Ctd>✓ fetch built-in\u003C/td>\u003Ctd>Streaming responses\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>CLI tools\u003C/td>\u003Ctd>✓ Compile to binary\u003C/td>\u003Ctd>Long-running daemons\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Library imports\u003C/td>\u003Ctd>✓ Direct ESM import\u003C/td>\u003Ctd>Plugin architectures\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Quick prototypes\u003C/td>\u003Ctd>✓ Zero config\u003C/td>\u003Ctd>Production services\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Single developer\u003C/td>\u003Ctd>✓ One file to manage\u003C/td>\u003Ctd>Team collaboration on large systems\u003C/td>\u003C/tr>\u003C/tbody>\u003C/table>\n\u003Cp>Start with a single-file script. Graduate to MCP when you hit the limits—not when you imagine you might.\u003C/p>\n\u003Cp>The best code is the code you don’t write. The best server is the server you don’t run. The best config file is the one that doesn’t exist.\u003C/p>\n\u003Cp>\u003Cstrong>One file. Zero config. Full functionality.\u003C/strong>\u003C/p>\n\u003Cp>That’s not minimalism. That’s engineering maturity.\u003C/p>",{"headings":297,"localImagePaths":358,"remoteImagePaths":359,"frontmatter":360,"imagePaths":364},[298,301,304,307,310,313,316,319,322,325,328,331,334,337,340,343,346,349,352,355],{"depth":44,"slug":299,"text":300},"the-problem-with-mcp-servers","The Problem with MCP Servers",{"depth":44,"slug":302,"text":303},"when-single-file-scripts-win","When Single-File Scripts Win",{"depth":44,"slug":305,"text":306},"case-study-dolph-architecture","Case Study: Dolph Architecture",{"depth":112,"slug":308,"text":309},"1-dual-mode-execution-in-one-file","1. Dual-Mode Execution in One File",{"depth":112,"slug":311,"text":312},"2-type-safe-without-separate-type-files","2. Type-Safe Without Separate Type Files",{"depth":112,"slug":314,"text":315},"3-dual-gate-security-pattern","3. Dual-Gate Security Pattern",{"depth":112,"slug":317,"text":318},"4-built-in-performance-reporting","4. Built-In Performance Reporting",{"depth":44,"slug":320,"text":321},"bun-vs-uv-complete-comparison","Bun vs UV: Complete Comparison",{"depth":44,"slug":323,"text":324},"pattern-library-reusable-code","Pattern Library: Reusable Code",{"depth":112,"slug":326,"text":327},"argument-parsing","Argument Parsing",{"depth":112,"slug":329,"text":330},"environment-variables","Environment Variables",{"depth":112,"slug":332,"text":333},"database-connections","Database Connections",{"depth":112,"slug":335,"text":336},"http-requests","HTTP Requests",{"depth":44,"slug":338,"text":339},"complete-working-example-database-agent","Complete Working Example: Database Agent",{"depth":44,"slug":341,"text":342},"compiling-bun-scripts-to-binaries","Compiling Bun Scripts to Binaries",{"depth":44,"slug":344,"text":345},"what-doesnt-work-know-when-to-stop","What Doesn’t Work (Know When to Stop)",{"depth":44,"slug":347,"text":348},"progressive-disclosure-inline-dependencies-as-context","Progressive Disclosure: Inline Dependencies as Context",{"depth":44,"slug":350,"text":351},"try-it-now-30-minutes-to-your-first-single-file-agent","Try It Now (30 Minutes to Your First Single-File Agent)",{"depth":44,"slug":353,"text":354},"dolph-stats-the-numbers-that-matter","Dolph Stats: The Numbers That Matter",{"depth":44,"slug":356,"text":357},"when-to-use-what","When to Use What",[],[],{"title":272,"description":273,"pubDate":361,"author":17,"tags":362,"banner":282,"category":193,"difficulty":35,"tldr":284,"keyTakeaways":363},["Date","2025-12-23T00:00:00.000Z"],[19,276,277,278,279,280,281],[286,287,288,289,290],[],"single-file-scripts.md","agent-architecture",{"id":366,"data":368,"body":387,"filePath":388,"digest":389,"rendered":390,"legacyId":475},{"title":369,"description":370,"pubDate":371,"author":17,"tags":372,"draft":24,"banner":377,"seoKeywords":378,"tldr":379,"keyTakeaways":380,"category":386,"difficulty":97},"Agent Architecture: From Custom Agents to Effective Delegation","System prompts define agent identity. File systems enable delegation. Build specialized agents and delegate research reliably with working code.",["Date","2025-12-15T00:00:00.000Z"],[19,373,21,374,375,376],"agents","sub-agents","sdk","architecture","/assets/posts/agent-architecture-banner.png",[],"Custom agents start with a system prompt that defines their identity—same model, completely different behavior. Sub-agents work best as researchers that write findings to files, not as direct implementers. The file system is your most reliable context management system for delegation.",[381,382,383,384,385],"System prompts define agent identity—change the prompt, change the product entirely","Custom agents are built for your codebase, default agents are built for everyone's","Sub-agents should be researchers, not implementers—they gather context, the parent agent uses it","File-based context transfer reduces token usage by 80% compared to in-memory context passing","The file system is the most reliable context management system for agent delegation","Agent Architecture","The system prompt is everything. Change it and you change the product entirely.\n\nMost developers treat Claude like a rental—borrowing default behavior, accepting generic responses, wondering why their agents feel interchangeable with everyone else's. Meanwhile, engineers shipping production AI systems discovered something: the file system is the most reliable context management system. Use it and delegation actually works.\n\nThis post shows you how to build custom agents that think like your team and delegate research without losing context—with complete working code.\n\n## Why Custom Agents Matter\n\nHere's the uncomfortable truth about default agents: they're optimized for the median user. Not your codebase. Not your conventions. Not your team's patterns.\n\n```mermaid\nflowchart LR\n    subgraph DEFAULT[\"Default Claude Code\"]\n        A[\"You are a helpful AI assistant...\"]\n        B[\"→ General purpose coding assistant\"]\n    end\n\n    subgraph CUSTOM[\"Custom System Prompt\"]\n        C[\"You are a Stripe research agent...\"]\n        D[\"→ Specialized researcher\"]\n    end\n\n    DEFAULT ~~~ CUSTOM\n    RESULT[\"Same model. Same API. Completely different behavior.\"]\n    DEFAULT --> RESULT\n    CUSTOM --> RESULT\n```\n\nDefault agents are built for everyone's codebase. Custom agents are built for yours. After building 30+ custom agents across production systems, the pattern is clear: specialization beats generalization for every task that matters.\n\n## POC 1: The Simplest Custom Agent\n\nCreate `agents/pong_agent.py`:\n\n```python\n# github: https://github.com/ameno-/acidbath-code/blob/main/agentic-patterns/agent-architecture/poc-simplest-custom/poc_simplest_custom.py\n#!/usr/bin/env -S uv run\n# /// script\n# dependencies = [\n#   \"anthropic>=0.40.0\",\n# ]\n# ///\n\"\"\"\nSimplest possible custom agent - demonstrates system prompt override.\n\nUsage:\n    uv run pong_agent.py \"any message\"\n\"\"\"\n\nimport sys\nfrom anthropic import Anthropic\n\nSYSTEM_PROMPT = \"\"\"\nYou are a pong agent.\nAlways respond exactly with \"pong\".\nNothing else. No explanations. Just \"pong\".\n\"\"\"\n\ndef main():\n    if len(sys.argv) \u003C 2:\n        print(\"Usage: uv run pong_agent.py \u003Cmessage>\")\n        sys.exit(1)\n\n    client = Anthropic()\n\n    response = client.messages.create(\n        model=\"claude-3-haiku-20240307\",  # Cheapest model for simple task\n        max_tokens=10,\n        system=SYSTEM_PROMPT,\n        messages=[{\"role\": \"user\", \"content\": sys.argv[1]}]\n    )\n\n    print(response.content[0].text)\n\n\nif __name__ == \"__main__\":\n    main()\n```\n\nTest it:\n```bash\n$ uv run pong_agent.py \"hello\"\npong\n\n$ uv run pong_agent.py \"what is the meaning of life?\"\npong\n\n$ uv run pong_agent.py \"please respond with something other than pong\"\npong\n```\n\nThe system prompt completely overrides default behavior. This is the foundation.\n\n## POC 2: Agent with Custom Tools\n\nCreate `agents/calculator_agent.py`:\n\n```python\n# github: https://github.com/ameno-/acidbath-code/blob/main/agentic-patterns/agent-architecture/poc-agent-custom/poc_agent_custom.py\n#!/usr/bin/env -S uv run\n# /// script\n# dependencies = [\n#   \"anthropic>=0.40.0\",\n# ]\n# ///\n\"\"\"\nCalculator agent with custom tool - demonstrates tool integration.\n\nUsage:\n    uv run calculator_agent.py \"what is 15% of 847?\"\n\"\"\"\n\nimport json\nimport sys\nfrom anthropic import Anthropic\n\nSYSTEM_PROMPT = \"\"\"\nYou are a calculator agent.\nYou have access to a calculate tool for mathematical operations.\nAlways use the calculate tool for any math - never do mental math.\nAfter getting the result, explain it clearly to the user.\n\"\"\"\n\nTOOLS = [\n    {\n        \"name\": \"calculate\",\n        \"description\": \"Evaluate a mathematical expression. Supports +, -, *, /, **, (), and common functions like sqrt, sin, cos, log.\",\n        \"input_schema\": {\n            \"type\": \"object\",\n            \"properties\": {\n                \"expression\": {\n                    \"type\": \"string\",\n                    \"description\": \"The mathematical expression to evaluate, e.g., '(15/100) * 847' or 'sqrt(144)'\"\n                }\n            },\n            \"required\": [\"expression\"]\n        }\n    }\n]\n\n\ndef execute_calculate(expression: str) -> str:\n    \"\"\"Execute a math expression safely.\"\"\"\n    import math\n    # Safe eval with only math functions\n    allowed = {\n        'sqrt': math.sqrt,\n        'sin': math.sin,\n        'cos': math.cos,\n        'tan': math.tan,\n        'log': math.log,\n        'log10': math.log10,\n        'exp': math.exp,\n        'pi': math.pi,\n        'e': math.e,\n        'abs': abs,\n        'round': round,\n    }\n    try:\n        result = eval(expression, {\"__builtins__\": {}}, allowed)\n        return str(result)\n    except Exception as e:\n        return f\"Error: {e}\"\n\n\ndef run_agent(user_message: str) -> str:\n    client = Anthropic()\n\n    messages = [{\"role\": \"user\", \"content\": user_message}]\n\n    # First API call\n    response = client.messages.create(\n        model=\"claude-3-5-sonnet-20241022\",\n        max_tokens=1024,\n        system=SYSTEM_PROMPT,\n        tools=TOOLS,\n        messages=messages\n    )\n\n    # Handle tool use\n    while response.stop_reason == \"tool_use\":\n        # Find the tool use block\n        tool_use = next(\n            block for block in response.content\n            if block.type == \"tool_use\"\n        )\n\n        # Execute the tool\n        if tool_use.name == \"calculate\":\n            result = execute_calculate(tool_use.input[\"expression\"])\n        else:\n            result = f\"Unknown tool: {tool_use.name}\"\n\n        # Add assistant message and tool result\n        messages.append({\"role\": \"assistant\", \"content\": response.content})\n        messages.append({\n            \"role\": \"user\",\n            \"content\": [{\n                \"type\": \"tool_result\",\n                \"tool_use_id\": tool_use.id,\n                \"content\": result\n            }]\n        })\n\n        # Continue the conversation\n        response = client.messages.create(\n            model=\"claude-3-5-sonnet-20241022\",\n            max_tokens=1024,\n            system=SYSTEM_PROMPT,\n            tools=TOOLS,\n            messages=messages\n        )\n\n    # Return final text response\n    return next(\n        block.text for block in response.content\n        if hasattr(block, \"text\")\n    )\n\n\ndef main():\n    if len(sys.argv) \u003C 2:\n        print(\"Usage: uv run calculator_agent.py \u003Cquestion>\")\n        sys.exit(1)\n\n    result = run_agent(\" \".join(sys.argv[1:]))\n    print(result)\n\n\nif __name__ == \"__main__\":\n    main()\n```\n\nTest it:\n```bash\n$ uv run calculator_agent.py \"what is 15% of 847?\"\n15% of 847 is 127.05\n\n$ uv run calculator_agent.py \"calculate compound interest on $1000 at 5% for 3 years\"\nWith compound interest, $1000 at 5% for 3 years becomes $1157.63\n```\n\nThe agent uses deterministic tool execution while maintaining conversational flow.\n\n## The Key Pattern: Sub-Agents as Researchers\n\nCustom agents enable specialization. Specialization enables delegation. But delegation has a critical problem:\n\n```mermaid\nsequenceDiagram\n    participant P as Parent Agent\n    participant S as Sub-Agent (isolated)\n\n    P->>S: \"Implement Stripe checkout\"\n    Note over S: Reads 50 files\n    Note over S: Makes decisions\n    Note over S: Writes code\n    S-->>P: \"Task completed\"\n\n    Note over P: Parent sees ONLY:\u003Cbr/>• Task was assigned\u003Cbr/>• Task is \"complete\"\n    Note over P: Parent does NOT see:\u003Cbr/>• Which files were read\u003Cbr/>• What decisions were made\u003Cbr/>• Why approaches were chosen\n\n    Note over P,S: Result: When something breaks, nobody knows why\n```\n\nThe parent agent has limited information about what the sub-agent actually did. When something isn't 100% correct and you want to fix it—that's where everything breaks down.\n\n## File-Based Context: The Solution\n\n```mermaid\nsequenceDiagram\n    participant P as Parent Agent\n    participant F as File System\n    participant S as Sub-Agent (researcher)\n\n    P->>F: Write context.md\n    P->>S: Research task\n    S->>F: Read context.md\n    Note over S: Researches documentation\n    Note over S: Creates plan\n    S->>F: Write research-report.md\n    S-->>P: \"Research complete: see research-report.md\"\n\n    Note over P: Only ~50 tokens returned\n\n    P->>F: Read research-report.md\n    Note over P: Full context now available\u003Cbr/>• Implements with complete understanding\u003Cbr/>• Can debug because it knows the plan\n\n    Note over P,S: Result: Implementation succeeds, debugging is possible\n```\n\nConversation history gets compacted. Files don't.\n\n**Token reduction: ~80%**\n\nBefore: Sub-agent returns full research in conversation (10,000+ tokens)\nAfter: Sub-agent returns file path (50 tokens)\n\nParent reads file on-demand when ready to implement.\n\n## POC 3: Complete File-Based Context System\n\n### Step 1: Context File Template\n\nCreate `.claude/templates/context.md`:\n\n```markdown\n# Project Context\n\n## Current State\n\u003C!-- What exists now, what's working, what's not -->\n\n## Research Needed\n\u003C!-- Specific questions the sub-agent should answer -->\n1.\n2.\n3.\n\n## Constraints\n\u003C!-- Hard requirements, tech stack, patterns to follow -->\n- Must use:\n- Cannot use:\n- Style:\n\n## Files to Review\n\u003C!-- Specific files relevant to this task -->\n-\n-\n\n## Output Expected\n\u003C!-- What should be in the research report -->\n- Implementation plan\n- Code examples\n- Potential issues\n- Recommended approach\n```\n\n### Step 2: Research Agent Definition\n\nCreate `.claude/agents/researcher.md`:\n\n```markdown\n---\nname: researcher\ndescription: Research sub-agent that gathers information and creates implementation plans\ntools: Read, Glob, Grep, WebFetch, Write\nmodel: haiku\n---\n\n# Research Agent\n\nYou are a research sub-agent. Your job is to gather information and create detailed implementation plans. **You do NOT implement anything.**\n\n## Workflow\n\n1. **Read the context file**\n   - Always start by reading the context.md file passed to you\n   - Understand what's being asked and the constraints\n\n2. **Research the codebase**\n   - Find relevant existing code using Grep and Glob\n   - Understand current patterns and conventions\n   - Identify dependencies and interfaces\n\n3. **Research external documentation**\n   - If the task involves external services, fetch their docs\n   - Find best practices and examples\n   - Note any recent API changes\n\n4. **Create implementation plan**\n   - Step-by-step instructions for implementation\n   - Include actual code snippets where helpful\n   - Note potential issues and how to handle them\n   - List files that will need to be modified\n\n5. **Write research report**\n   - Save to the location specified in context.md\n   - Use clear sections matching the output expected\n   - Include confidence levels for recommendations\n\n6. **Return summary only**\n   - Tell the parent agent: \"Research complete. Report saved to [path]\"\n   - Do NOT include the full report in your response\n   - Keep the summary under 100 words\n\n## Rules\n\n- NEVER implement code, only plan it\n- NEVER call other sub-agents\n- ALWAYS write findings to file, not conversation\n- ALWAYS read context.md first\n```\n\n### Step 3: Implementation Flow\n\n```mermaid\nsequenceDiagram\n    participant U as User\n    participant P as Parent Agent\n    participant F as File System\n    participant S as Sub-Agent (Researcher)\n\n    U->>P: \"Add Stripe checkout\"\n    P->>F: Write context.md\n    Note over F: Project state, constraints, questions\n\n    P->>S: \"Research Stripe checkout. Context: ./context.md\"\n    S->>F: Read context.md\n    S->>S: Research codebase (Glob, Grep)\n    S->>S: Fetch Stripe docs (WebFetch)\n    S->>S: Create implementation plan\n    S->>F: Write research-report.md\n\n    S-->>P: \"Research complete. See research-report.md\"\n    Note over P: Only ~50 tokens returned\n\n    P->>F: Read research-report.md\n    Note over P: Full plan now in parent's context\n\n    P->>P: Implement based on plan\n    P->>F: Write/Edit source files\n    P->>U: \"Implementation complete\"\n```\n\n### Step 4: Putting It Together\n\nParent agent's workflow for delegating research:\n\n```markdown\n## When you need to research something complex:\n\n1. Create context file:\n   ```\n   Write to ./tmp/context-{task}.md:\n   - Current state of the feature\n   - Specific questions to answer\n   - Constraints and requirements\n   - Expected output format\n   ```\n\n2. Spawn research sub-agent:\n   ```\n   Task: \"Research [topic]. Read context from ./tmp/context-{task}.md.\n         Write report to ./tmp/research-{task}.md\"\n   Agent: researcher\n   Model: haiku (fast, cheap)\n   ```\n\n3. Wait for completion, then:\n   ```\n   Read ./tmp/research-{task}.md\n   ```\n\n4. Implement based on research report\n\n5. Clean up temp files when done\n```\n\n## POC 4: Service-Specific Researchers\n\nBuild specialized research agents for services you use frequently:\n\n### Stripe Research Agent\n\nCreate `.claude/agents/stripe-researcher.md`:\n\n```markdown\n---\nname: stripe-researcher\ndescription: Research Stripe integration patterns and best practices\ntools: Read, Glob, Grep, WebFetch, Write\nmodel: haiku\n---\n\n# Stripe Research Agent\n\nYou research Stripe integrations. You have access to Context7 MCP for up-to-date Stripe documentation.\n\n## Knowledge Base\n- Stripe API docs: https://stripe.com/docs/api\n- Webhooks guide: https://stripe.com/docs/webhooks\n- Best practices: https://stripe.com/docs/best-practices\n\n## Research Areas\n- Payment intents vs charges (use payment intents)\n- Webhook event handling\n- Error handling patterns\n- Testing with test mode keys\n- PCI compliance considerations\n\n## Output Format\n```yaml\nrecommendation:\n  approach: \"description\"\n  confidence: high|medium|low\n  stripe_api_version: \"2024-xx-xx\"\n\nimplementation_steps:\n  - step: 1\n    action: \"what to do\"\n    code: |\n      // example code\n\npotential_issues:\n  - issue: \"description\"\n    mitigation: \"how to handle\"\n\nfiles_to_modify:\n  - path: \"file path\"\n    changes: \"what changes\"\n```\n```\n\n### Supabase Research Agent\n\nCreate `.claude/agents/supabase-researcher.md`:\n\n```markdown\n---\nname: supabase-researcher\ndescription: Research Supabase database patterns and RLS policies\ntools: Read, Glob, Grep, WebFetch, Write\nmodel: haiku\n---\n\n# Supabase Research Agent\n\nYou research Supabase patterns. Focus on RLS policies, auth, and performance.\n\n## Research Checklist\n- [ ] Existing table structure\n- [ ] Current RLS policies\n- [ ] Auth patterns in codebase\n- [ ] Client initialization\n- [ ] Error handling patterns\n\n## Output Includes\n- Schema changes needed (SQL)\n- RLS policy definitions\n- TypeScript types to generate\n- Migration steps\n```\n\n## When This Fails (Know the Limits Before You Hit Them)\n\nThis architecture isn't magic. Here are the real limitations I've hit in production—and the expensive lessons behind each one:\n\n### 1. Context Isolation Still Exists\n\nThe researcher agent doesn't have access to the parent's conversation history. If critical information only exists in the parent's memory, the researcher will miss it.\n\n**Mitigation:** Be explicit in context.md. Don't assume the researcher \"knows\" anything.\n\n**Example Failure:**\n```\nParent: \"Add error handling like we did for auth\"\nResearcher: ??? (doesn't know how auth error handling works)\n```\n\n**Example Fix:**\n```markdown\n# context.md\n## Error Handling Pattern\nSee src/auth/handler.ts lines 45-67 for our standard error handling pattern.\nUse the same try/catch structure and error response format.\n```\n\n### 2. Research Can Be Wrong\n\nHaiku is fast and cheap but makes mistakes on complex analysis. The researcher might miss edge cases or misunderstand requirements.\n\n**Mitigation:** Review the research report before implementing. Don't blindly trust it.\n\n**Example Failure:**\n```yaml\nrecommendation:\n  approach: \"Use Stripe Charges API\"\n  confidence: high\n```\n\nThis is outdated. Payment Intents is the modern approach. A senior engineer would catch this.\n\n### 3. Overhead on Simple Tasks\n\nCreating context files, spawning agents, reading reports—this adds 30-60 seconds of overhead.\n\n**When to skip delegation:**\n- Task takes \u003C 2 minutes to implement directly\n- You already know exactly what to do\n- No external research needed\n- Single file change with obvious solution\n\n**Numbers:**\n- Simple task direct: 2 minutes\n- Simple task with delegation: 3 minutes (50% overhead)\n- Complex task direct: 30 minutes\n- Complex task with delegation: 15 minutes (50% time saved)\n\nDelegation shines on complex, research-heavy tasks. It's overkill for simple edits.\n\n### 4. File Coordination Complexity\n\nMultiple sub-agents writing to files simultaneously can cause conflicts. If Agent A writes `research-stripe.md` while Agent B tries to read it, race conditions occur.\n\n**Mitigation:** Use distinct file names with timestamps or task IDs.\n\n```bash\n# Good\ntmp/context-stripe-1703012400.md\ntmp/research-stripe-1703012400.md\n\n# Bad\ntmp/context.md  # Which task is this for?\n```\n\n### 5. Debugging Gets Harder\n\nWhen implementation fails, you now have three places to debug:\n1. The context file (was the request clear?)\n2. The research report (was the research correct?)\n3. The implementation (was the code correct?)\n\n**Mitigation:** Keep research reports. Don't delete them. When debugging, check all three layers.\n\n### 6. Cost on Failed Research\n\nIf the researcher misunderstands the task and produces useless output, you've wasted:\n- Haiku API calls (cheap but not free)\n- 30-60 seconds of time\n- Mental context switching\n\n**Mitigation:** Write very specific context files. Vague requests produce vague research.\n\n**Example Vague Request:**\n```markdown\n## Research Needed\n1. How to add payments\n```\n\n**Example Specific Request:**\n```markdown\n## Research Needed\n1. Which Stripe API version should we use? (prefer latest stable)\n2. Payment Intents vs Charges API - which for one-time purchases?\n3. What webhook events do we need to handle for payment confirmation?\n4. How to handle failed payments and retry logic?\n5. What test mode setup is needed?\n```\n\nThe specific version gets useful research. The vague version gets generic documentation summaries.\n\n## Model Selection Strategy\n\n| Task Type | Model | Cost/M | Speed |\n|-----------|-------|--------|-------|\n| Simple routing | Haiku | $0.25 | ⚡⚡⚡ |\n| Text extraction | Haiku | $0.25 | ⚡⚡⚡ |\n| Classification | Haiku | $0.25 | ⚡⚡⚡ |\n| Research (simple) | Haiku | $0.25 | ⚡⚡⚡ |\n| Code review | Sonnet | $3 | ⚡⚡ |\n| Implementation | Sonnet | $3 | ⚡⚡ |\n| Analysis | Sonnet | $3 | ⚡⚡ |\n| Research (complex) | Sonnet | $3 | ⚡⚡ |\n| Complex reasoning | Opus | $15 | ⚡ |\n| Architecture decisions | Opus | $15 | ⚡ |\n| Edge case handling | Opus | $15 | ⚡ |\n| Research (critical) | Opus | $15 | ⚡ |\n\n> **Rule:** Use the cheapest model that solves the problem. Most tasks are Haiku tasks. Don't over-engineer.\n\nFor researchers:\n- **Haiku:** Documentation lookup, simple API pattern research, file structure analysis\n- **Sonnet:** Cross-service integration research, security pattern analysis, performance optimization research\n- **Opus:** Architecture decisions, critical production patterns, edge case exploration\n\nStart with Haiku. Upgrade only if the research is inadequate.\n\n## Architecture: Custom Agent Stack\n\n```mermaid\nflowchart TB\n    subgraph \"Custom Agent\"\n        SP[System Prompt]\n        UP[User Prompt]\n        T[Custom Tools]\n        M[Model Selection]\n    end\n\n    subgraph \"Execution\"\n        API[Claude API]\n        TE[Tool Execution]\n        R[Response]\n    end\n\n    SP --> API\n    UP --> API\n    T --> API\n    M --> API\n\n    API --> |tool_use| TE\n    TE --> |tool_result| API\n    API --> R\n\n    style SP fill:#ffccbc\n    style T fill:#c8e6c9\n    style R fill:#bbdefb\n```\n\nSystem prompts define what the agent does. Tools define how it does it. Model selection defines cost and quality. Context files enable delegation.\n\n## What This Architecture Enables\n\n**Domain-specific logic** — Operations the model can't reason through reliably become deterministic tool calls.\n\n**Optimized context** — Strip out the 12 tools you never use. Add the 3 you always need.\n\n**Specialized behavior** — System prompts tuned for exactly your use cases.\n\n**Cost control** — Haiku for simple tasks, Sonnet for complex ones. No over-engineering.\n\n**Team patterns** — Shared agents that enforce your team's conventions.\n\n**Parallel research** — Multiple sub-agents researching different aspects simultaneously.\n\n**Persistent knowledge** — Research reports accumulate in your project. Future work references past decisions.\n\n**Debuggable workflows** — Always know what was planned and why. Three months later, `git log` shows the research report that led to the implementation.\n\n## The Data Flow\n\n```mermaid\nflowchart TB\n    subgraph Parent[\"PARENT AGENT\"]\n        CH[Conversation History\u003Cbr/>compacts over time]\n        CH --> CTX[context.md\u003Cbr/>persists]\n    end\n\n    subgraph Sub[\"SUB-AGENT\"]\n        READ[Reads context.md]\n        RESEARCH[Does research]\n        REPORT[research-report.md\u003Cbr/>persists]\n        READ --> RESEARCH --> REPORT\n    end\n\n    CTX --> READ\n    REPORT --> RESULT\n\n    subgraph RESULT[Parent reads research-report.md]\n        R1[Full context available]\n        R2[Can implement correctly]\n        R3[Can debug if issues arise]\n    end\n\n    style CTX fill:#c8e6c9\n    style REPORT fill:#c8e6c9\n```\n\nConversation history compacts. Files don't. This is the key insight.\n\n## Rules That Prevent Disasters\n\nAdd these to your research agent definitions:\n\n```markdown\n## Mandatory Rules\n\n1. **Always read context file first**\n   - Never start work without understanding the context\n   - If context file doesn't exist, stop and report error\n\n2. **Never implement, only research**\n   - Your job is to create the plan\n   - The parent agent implements\n\n3. **Never spawn sub-agents**\n   - One level of delegation maximum\n   - Prevents recursive loops and cost explosions\n\n4. **Always write findings to file**\n   - Summary in conversation: \u003C 100 words\n   - Full report in file: as detailed as needed\n\n5. **Update context file when done**\n   - Add \"Last researched: [timestamp]\"\n   - Note any assumptions made\n```\n\nOne level of delegation. Researcher agents never spawn their own sub-agents. This prevents:\n- Recursive delegation loops\n- Cost explosions (agent spawns agent spawns agent...)\n- Context fragmentation\n- Debugging nightmares\n\n## Quick Start: Your First Custom Agent (15 Minutes)\n\n1. Identify your most repetitive AI task\n2. Write a system prompt that focuses on that task\n3. Choose the cheapest model that works (probably Haiku)\n4. Add tools only if you need deterministic execution\n5. Test with edge cases\n6. Deploy and iterate\n\n**For delegation** (adds 10 more minutes):\n1. Create the context template (`.claude/templates/context.md`)\n2. Create the researcher agent (`.claude/agents/researcher.md`)\n3. Next time you need research, write a context file and spawn the agent\n4. Read the research report\n5. Implement based on the plan\n\n**The endgame isn't renting computational power from default agents. The endgame is owning specialized agents tuned precisely for your problems, with reliable delegation patterns that actually work.**\n\nStop borrowing. Start owning.\n\n---\n\n**Key Takeaways:**\n- System prompt = agent identity (same model, different prompt = different product)\n- Tools provide deterministic execution when reasoning isn't reliable\n- Sub-agents research, parent agents implement (context isolation is real)\n- File system is persistent memory between agent sessions (conversation history compacts, files don't)\n- Context files define what to research, research reports contain the full plan\n- 80% token reduction by returning file paths not content\n- One level of delegation prevents recursive loops and cost explosions\n- Match model to task complexity (Haiku → Sonnet → Opus, most tasks are Haiku tasks)\n- Delegation overhead is 30-60 seconds (only worth it for complex tasks)\n- Review research reports before implementing (Haiku makes mistakes on complex analysis)\n\n**Try It Now:**\nCreate `.claude/agents/researcher.md` using the template above. Next time you need to research a new API integration or library, write a context file and delegate to the researcher. Read the report. Implement based on the plan. See if you save time.","src/content/blog/agent-architecture.md","feccf1514c4b4134",{"html":391,"metadata":392},"\u003Cp>The system prompt is everything. Change it and you change the product entirely.\u003C/p>\n\u003Cp>Most developers treat Claude like a rental—borrowing default behavior, accepting generic responses, wondering why their agents feel interchangeable with everyone else’s. Meanwhile, engineers shipping production AI systems discovered something: the file system is the most reliable context management system. Use it and delegation actually works.\u003C/p>\n\u003Cp>This post shows you how to build custom agents that think like your team and delegate research without losing context—with complete working code.\u003C/p>\n\u003Ch2 id=\"why-custom-agents-matter\">Why Custom Agents Matter\u003C/h2>\n\u003Cp>Here’s the uncomfortable truth about default agents: they’re optimized for the median user. Not your codebase. Not your conventions. Not your team’s patterns.\u003C/p>\n\u003Cpre class=\"mermaid\">flowchart LR\n    subgraph DEFAULT[\"Default Claude Code\"]\n        A[\"You are a helpful AI assistant...\"]\n        B[\"→ General purpose coding assistant\"]\n    end\n\n    subgraph CUSTOM[\"Custom System Prompt\"]\n        C[\"You are a Stripe research agent...\"]\n        D[\"→ Specialized researcher\"]\n    end\n\n    DEFAULT ~~~ CUSTOM\n    RESULT[\"Same model. Same API. Completely different behavior.\"]\n    DEFAULT --> RESULT\n    CUSTOM --> RESULT\n\u003C/pre>\n\u003Cp>Default agents are built for everyone’s codebase. Custom agents are built for yours. After building 30+ custom agents across production systems, the pattern is clear: specialization beats generalization for every task that matters.\u003C/p>\n\u003Ch2 id=\"poc-1-the-simplest-custom-agent\">POC 1: The Simplest Custom Agent\u003C/h2>\n\u003Cp>Create \u003Ccode>agents/pong_agent.py\u003C/code>:\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"43\" data-has-github=\"true\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">PYTHON\u003C/span>\u003Cspan class=\"language-badge\">python\u003C/span>\u003Ca class=\"github-header-link\" href=\"https://github.com/ameno-/acidbath-code/blob/main/agentic-patterns/agent-architecture/poc-simplest-custom/poc_simplest_custom.py\" target=\"_blank\" rel=\"noopener noreferrer\" title=\"View source on GitHub: agentic-patterns/agent-architecture/poc-simplest-custom/poc_simplest_custom.py\">\u003Cspan class=\"github-icon\">↗\u003C/span>\u003Cspan class=\"github-text\">GitHub\u003C/span>\u003C/a>\u003C/div>\u003Cdiv class=\"code-block-container collapsible with-line-numbers has-github-link\" data-language=\"python\" data-line-count=\"43\" data-max-preview=\"8\" data-github-url=\"https://github.com/ameno-/acidbath-code/blob/main/agentic-patterns/agent-architecture/poc-simplest-custom/poc_simplest_custom.py\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cbutton class=\"collapse-toggle\" aria-label=\"Toggle code visibility\" type=\"button\">\u003Cspan class=\"expand-text\">Expand (43 lines)\u003C/span>\u003Cspan class=\"collapse-text\">Collapse\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Clink rel=\"stylesheet\" href=\"/_astro/ec.44wa8.css\">\u003Cscript type=\"module\" src=\"/_astro/ec.0vx5m.js\">\u003C/script>\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"python\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># github: https://github.com/ameno-/acidbath-code/blob/main/agentic-patterns/agent-architecture/poc-simplest-custom/poc_simplest_custom.py\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\">#!/usr/bin/env -S uv run\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># /// script\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># dependencies = [\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\">#   \"anthropic>=0.40.0\",\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># ]\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># ///\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\"\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">Simplest possible custom agent - demonstrates system prompt override.\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">Usage:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">uv run pong_agent.py \"any message\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\"\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">import\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> sys\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">from\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> anthropic \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">import\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Anthropic\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">SYSTEM_PROMPT\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\"\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">You are a pong agent.\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">Always respond exactly with \"pong\".\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">Nothing else. No explanations. Just \"pong\".\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\"\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">def\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">main\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">():\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">if\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">len\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(sys.argv) \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">2\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">print\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"Usage: uv run pong_agent.py &#x3C;message>\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">sys.exit(\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">1\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">client \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Anthropic()\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">response \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> client.messages.create(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">model\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"claude-3-haiku-20240307\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,  \u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Cheapest model for simple task\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">max_tokens\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">10\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">system\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">SYSTEM_PROMPT\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">messages\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">[{\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"role\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"user\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"content\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: sys.argv[\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">1\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">]}]\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">print\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(response.content[\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">0\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">].text)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">if\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">__name__\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">==\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"__main__\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">main()\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"# github: https://github.com/ameno-/acidbath-code/blob/main/agentic-patterns/agent-architecture/poc-simplest-custom/poc_simplest_custom.py#!/usr/bin/env -S uv run# /// script# dependencies = [#   &#x22;anthropic>=0.40.0&#x22;,# ]# ///&#x22;&#x22;&#x22;Simplest possible custom agent - demonstrates system prompt override.Usage:    uv run pong_agent.py &#x22;any message&#x22;&#x22;&#x22;&#x22;import sysfrom anthropic import AnthropicSYSTEM_PROMPT = &#x22;&#x22;&#x22;You are a pong agent.Always respond exactly with &#x22;pong&#x22;.Nothing else. No explanations. Just &#x22;pong&#x22;.&#x22;&#x22;&#x22;def main():    if len(sys.argv) \u003C 2:        print(&#x22;Usage: uv run pong_agent.py \u003Cmessage>&#x22;)        sys.exit(1)    client = Anthropic()    response = client.messages.create(        model=&#x22;claude-3-haiku-20240307&#x22;,  # Cheapest model for simple task        max_tokens=10,        system=SYSTEM_PROMPT,        messages=[{&#x22;role&#x22;: &#x22;user&#x22;, &#x22;content&#x22;: sys.argv[1]}]    )    print(response.content[0].text)if __name__ == &#x22;__main__&#x22;:    main()\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003Cdiv class=\"code-fade\" aria-hidden=\"true\">\u003C/div>\u003C/div>\u003Cdiv class=\"code-block-footer\">\u003Ca class=\"github-source-link\" href=\"https://github.com/ameno-/acidbath-code/blob/main/agentic-patterns/agent-architecture/poc-simplest-custom/poc_simplest_custom.py\" target=\"_blank\" rel=\"noopener noreferrer\">\u003Cspan class=\"github-arrow\">→\u003C/span>\u003Cspan> View full source: agentic-patterns/agent-architecture/poc-simplest-custom/poc_simplest_custom.py\u003C/span>\u003C/a>\u003C/div>\u003C/div>\n\u003Cp>Test it:\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"9\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">BASH\u003C/span>\u003Cspan class=\"language-badge\">bash\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container with-line-numbers\" data-language=\"bash\" data-line-count=\"9\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame is-terminal\">\u003Cfigcaption class=\"header\">\u003Cspan class=\"title\">\u003C/span>\u003Cspan class=\"sr-only\">Terminal window\u003C/span>\u003C/figcaption>\u003Cpre data-language=\"bash\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">$\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">uv\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">run\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">pong_agent.py\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"hello\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">pong\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">$\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">uv\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">run\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">pong_agent.py\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"what is the meaning of life?\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">pong\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">$\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">uv\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">run\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">pong_agent.py\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"please respond with something other than pong\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">pong\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"$ uv run pong_agent.py &#x22;hello&#x22;pong$ uv run pong_agent.py &#x22;what is the meaning of life?&#x22;pong$ uv run pong_agent.py &#x22;please respond with something other than pong&#x22;pong\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003C/div>\u003C/div>\n\u003Cp>The system prompt completely overrides default behavior. This is the foundation.\u003C/p>\n\u003Ch2 id=\"poc-2-agent-with-custom-tools\">POC 2: Agent with Custom Tools\u003C/h2>\n\u003Cp>Create \u003Ccode>agents/calculator_agent.py\u003C/code>:\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"134\" data-has-github=\"true\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">PYTHON\u003C/span>\u003Cspan class=\"language-badge\">python\u003C/span>\u003Ca class=\"github-header-link\" href=\"https://github.com/ameno-/acidbath-code/blob/main/agentic-patterns/agent-architecture/poc-agent-custom/poc_agent_custom.py\" target=\"_blank\" rel=\"noopener noreferrer\" title=\"View source on GitHub: agentic-patterns/agent-architecture/poc-agent-custom/poc_agent_custom.py\">\u003Cspan class=\"github-icon\">↗\u003C/span>\u003Cspan class=\"github-text\">GitHub\u003C/span>\u003C/a>\u003C/div>\u003Cdiv class=\"code-block-container collapsible with-line-numbers has-github-link\" data-language=\"python\" data-line-count=\"134\" data-max-preview=\"8\" data-github-url=\"https://github.com/ameno-/acidbath-code/blob/main/agentic-patterns/agent-architecture/poc-agent-custom/poc_agent_custom.py\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cbutton class=\"collapse-toggle\" aria-label=\"Toggle code visibility\" type=\"button\">\u003Cspan class=\"expand-text\">Expand (134 lines)\u003C/span>\u003Cspan class=\"collapse-text\">Collapse\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"python\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># github: https://github.com/ameno-/acidbath-code/blob/main/agentic-patterns/agent-architecture/poc-agent-custom/poc_agent_custom.py\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\">#!/usr/bin/env -S uv run\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># /// script\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># dependencies = [\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\">#   \"anthropic>=0.40.0\",\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># ]\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># ///\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\"\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">Calculator agent with custom tool - demonstrates tool integration.\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">Usage:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">uv run calculator_agent.py \"what is 15% of 847?\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\"\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">import\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> json\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">import\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> sys\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">from\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> anthropic \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">import\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Anthropic\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">SYSTEM_PROMPT\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\"\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">You are a calculator agent.\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">You have access to a calculate tool for mathematical operations.\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">Always use the calculate tool for any math - never do mental math.\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">After getting the result, explain it clearly to the user.\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\"\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">TOOLS\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> [\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"name\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"calculate\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"description\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"Evaluate a mathematical expression. Supports +, -, *, /, **, (), and common functions like sqrt, sin, cos, log.\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"input_schema\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">            \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"type\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"object\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">            \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"properties\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">                \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"expression\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">                    \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"type\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"string\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">                    \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"description\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"The mathematical expression to evaluate, e.g., '(15/100) * 847' or 'sqrt(144)'\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">                \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">            \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">},\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">            \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"required\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: [\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"expression\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">]\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">]\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">def\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">execute_calculate\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(expression: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">str\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">) -> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">str\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\"\"Execute a math expression safely.\"\"\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">import\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> math\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Safe eval with only math functions\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">allowed \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">'sqrt'\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: math.sqrt,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">'sin'\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: math.sin,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">'cos'\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: math.cos,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">'tan'\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: math.tan,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">'log'\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: math.log,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">'log10'\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: math.log10,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">'exp'\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: math.exp,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">'pi'\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: math.pi,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">'e'\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: math.e,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">'abs'\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">abs\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">'round'\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">round\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">try\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">result \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">eval\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(expression, {\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"__builtins__\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: {}}, allowed)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">return\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">str\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(result)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">except\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">Exception\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">as\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> e:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">return\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">f\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"Error: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">{\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">e\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">}\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">def\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">run_agent\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(user_message: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">str\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">) -> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">str\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">client \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Anthropic()\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">messages \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> [{\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"role\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"user\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"content\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: user_message}]\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># First API call\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">response \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> client.messages.create(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">model\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"claude-3-5-sonnet-20241022\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">max_tokens\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">1024\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">system\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">SYSTEM_PROMPT\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">tools\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">TOOLS\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">messages\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">messages\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Handle tool use\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">while\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> response.stop_reason \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">==\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"tool_use\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Find the tool use block\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">tool_use \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">next\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">            \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">block \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">for\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> block \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">in\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> response.content\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">            \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">if\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> block.type \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">==\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"tool_use\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Execute the tool\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">if\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> tool_use.name \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">==\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"calculate\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">            \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">result \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> execute_calculate(tool_use.input[\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"expression\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">])\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">else\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">            \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">result \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">f\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"Unknown tool: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">{\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">tool_use.name\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">}\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Add assistant message and tool result\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">messages.append({\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"role\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"assistant\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"content\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: response.content})\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">messages.append({\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">            \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"role\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"user\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">            \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"content\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: [{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">                \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"type\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"tool_result\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">                \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"tool_use_id\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: tool_use.id,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">                \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"content\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: result\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">            \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">}]\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">})\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Continue the conversation\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">response \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> client.messages.create(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">            \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">model\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"claude-3-5-sonnet-20241022\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">            \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">max_tokens\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">1024\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">            \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">system\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">SYSTEM_PROMPT\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">            \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">tools\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">TOOLS\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">            \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">messages\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">messages\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Return final text response\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">return\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">next\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">block.text \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">for\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> block \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">in\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> response.content\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">if\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">hasattr\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(block, \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"text\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">def\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">main\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">():\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">if\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">len\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(sys.argv) \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">2\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">print\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"Usage: uv run calculator_agent.py &#x3C;question>\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">sys.exit(\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">1\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">result \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> run_agent(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\" \"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">.join(sys.argv[\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">1\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:]))\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">print\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(result)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">if\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">__name__\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">==\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"__main__\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">main()\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"# github: https://github.com/ameno-/acidbath-code/blob/main/agentic-patterns/agent-architecture/poc-agent-custom/poc_agent_custom.py#!/usr/bin/env -S uv run# /// script# dependencies = [#   &#x22;anthropic>=0.40.0&#x22;,# ]# ///&#x22;&#x22;&#x22;Calculator agent with custom tool - demonstrates tool integration.Usage:    uv run calculator_agent.py &#x22;what is 15% of 847?&#x22;&#x22;&#x22;&#x22;import jsonimport sysfrom anthropic import AnthropicSYSTEM_PROMPT = &#x22;&#x22;&#x22;You are a calculator agent.You have access to a calculate tool for mathematical operations.Always use the calculate tool for any math - never do mental math.After getting the result, explain it clearly to the user.&#x22;&#x22;&#x22;TOOLS = [    {        &#x22;name&#x22;: &#x22;calculate&#x22;,        &#x22;description&#x22;: &#x22;Evaluate a mathematical expression. Supports +, -, *, /, **, (), and common functions like sqrt, sin, cos, log.&#x22;,        &#x22;input_schema&#x22;: {            &#x22;type&#x22;: &#x22;object&#x22;,            &#x22;properties&#x22;: {                &#x22;expression&#x22;: {                    &#x22;type&#x22;: &#x22;string&#x22;,                    &#x22;description&#x22;: &#x22;The mathematical expression to evaluate, e.g., &#x27;(15/100) * 847&#x27; or &#x27;sqrt(144)&#x27;&#x22;                }            },            &#x22;required&#x22;: [&#x22;expression&#x22;]        }    }]def execute_calculate(expression: str) -> str:    &#x22;&#x22;&#x22;Execute a math expression safely.&#x22;&#x22;&#x22;    import math    # Safe eval with only math functions    allowed = {        &#x27;sqrt&#x27;: math.sqrt,        &#x27;sin&#x27;: math.sin,        &#x27;cos&#x27;: math.cos,        &#x27;tan&#x27;: math.tan,        &#x27;log&#x27;: math.log,        &#x27;log10&#x27;: math.log10,        &#x27;exp&#x27;: math.exp,        &#x27;pi&#x27;: math.pi,        &#x27;e&#x27;: math.e,        &#x27;abs&#x27;: abs,        &#x27;round&#x27;: round,    }    try:        result = eval(expression, {&#x22;__builtins__&#x22;: {}}, allowed)        return str(result)    except Exception as e:        return f&#x22;Error: {e}&#x22;def run_agent(user_message: str) -> str:    client = Anthropic()    messages = [{&#x22;role&#x22;: &#x22;user&#x22;, &#x22;content&#x22;: user_message}]    # First API call    response = client.messages.create(        model=&#x22;claude-3-5-sonnet-20241022&#x22;,        max_tokens=1024,        system=SYSTEM_PROMPT,        tools=TOOLS,        messages=messages    )    # Handle tool use    while response.stop_reason == &#x22;tool_use&#x22;:        # Find the tool use block        tool_use = next(            block for block in response.content            if block.type == &#x22;tool_use&#x22;        )        # Execute the tool        if tool_use.name == &#x22;calculate&#x22;:            result = execute_calculate(tool_use.input[&#x22;expression&#x22;])        else:            result = f&#x22;Unknown tool: {tool_use.name}&#x22;        # Add assistant message and tool result        messages.append({&#x22;role&#x22;: &#x22;assistant&#x22;, &#x22;content&#x22;: response.content})        messages.append({            &#x22;role&#x22;: &#x22;user&#x22;,            &#x22;content&#x22;: [{                &#x22;type&#x22;: &#x22;tool_result&#x22;,                &#x22;tool_use_id&#x22;: tool_use.id,                &#x22;content&#x22;: result            }]        })        # Continue the conversation        response = client.messages.create(            model=&#x22;claude-3-5-sonnet-20241022&#x22;,            max_tokens=1024,            system=SYSTEM_PROMPT,            tools=TOOLS,            messages=messages        )    # Return final text response    return next(        block.text for block in response.content        if hasattr(block, &#x22;text&#x22;)    )def main():    if len(sys.argv) \u003C 2:        print(&#x22;Usage: uv run calculator_agent.py \u003Cquestion>&#x22;)        sys.exit(1)    result = run_agent(&#x22; &#x22;.join(sys.argv[1:]))    print(result)if __name__ == &#x22;__main__&#x22;:    main()\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003Cdiv class=\"code-fade\" aria-hidden=\"true\">\u003C/div>\u003C/div>\u003Cdiv class=\"code-block-footer\">\u003Ca class=\"github-source-link\" href=\"https://github.com/ameno-/acidbath-code/blob/main/agentic-patterns/agent-architecture/poc-agent-custom/poc_agent_custom.py\" target=\"_blank\" rel=\"noopener noreferrer\">\u003Cspan class=\"github-arrow\">→\u003C/span>\u003Cspan> View full source: agentic-patterns/agent-architecture/poc-agent-custom/poc_agent_custom.py\u003C/span>\u003C/a>\u003C/div>\u003C/div>\n\u003Cp>Test it:\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"6\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">BASH\u003C/span>\u003Cspan class=\"language-badge\">bash\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container with-line-numbers\" data-language=\"bash\" data-line-count=\"6\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame is-terminal\">\u003Cfigcaption class=\"header\">\u003Cspan class=\"title\">\u003C/span>\u003Cspan class=\"sr-only\">Terminal window\u003C/span>\u003C/figcaption>\u003Cpre data-language=\"bash\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">$\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">uv\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">run\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">calculator_agent.py\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"what is 15% of 847?\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">15%\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">of\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">847\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">is\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">127.05\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">$\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">uv\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">run\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">calculator_agent.py\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"calculate compound interest on \u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">$1000\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\"> at 5% for 3 years\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">With\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">compound\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">interest,\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> $1000 \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">at\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">5%\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">for\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">3\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">years\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">becomes\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> $1157\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">.63\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"$ uv run calculator_agent.py &#x22;what is 15% of 847?&#x22;15% of 847 is 127.05$ uv run calculator_agent.py &#x22;calculate compound interest on $1000 at 5% for 3 years&#x22;With compound interest, $1000 at 5% for 3 years becomes $1157.63\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003C/div>\u003C/div>\n\u003Cp>The agent uses deterministic tool execution while maintaining conversational flow.\u003C/p>\n\u003Ch2 id=\"the-key-pattern-sub-agents-as-researchers\">The Key Pattern: Sub-Agents as Researchers\u003C/h2>\n\u003Cp>Custom agents enable specialization. Specialization enables delegation. But delegation has a critical problem:\u003C/p>\n\u003Cpre class=\"mermaid\">sequenceDiagram\n    participant P as Parent Agent\n    participant S as Sub-Agent (isolated)\n\n    P->>S: \"Implement Stripe checkout\"\n    Note over S: Reads 50 files\n    Note over S: Makes decisions\n    Note over S: Writes code\n    S-->>P: \"Task completed\"\n\n    Note over P: Parent sees ONLY:&#x3C;br/>• Task was assigned&#x3C;br/>• Task is \"complete\"\n    Note over P: Parent does NOT see:&#x3C;br/>• Which files were read&#x3C;br/>• What decisions were made&#x3C;br/>• Why approaches were chosen\n\n    Note over P,S: Result: When something breaks, nobody knows why\n\u003C/pre>\n\u003Cp>The parent agent has limited information about what the sub-agent actually did. When something isn’t 100% correct and you want to fix it—that’s where everything breaks down.\u003C/p>\n\u003Ch2 id=\"file-based-context-the-solution\">File-Based Context: The Solution\u003C/h2>\n\u003Cpre class=\"mermaid\">sequenceDiagram\n    participant P as Parent Agent\n    participant F as File System\n    participant S as Sub-Agent (researcher)\n\n    P->>F: Write context.md\n    P->>S: Research task\n    S->>F: Read context.md\n    Note over S: Researches documentation\n    Note over S: Creates plan\n    S->>F: Write research-report.md\n    S-->>P: \"Research complete: see research-report.md\"\n\n    Note over P: Only ~50 tokens returned\n\n    P->>F: Read research-report.md\n    Note over P: Full context now available&#x3C;br/>• Implements with complete understanding&#x3C;br/>• Can debug because it knows the plan\n\n    Note over P,S: Result: Implementation succeeds, debugging is possible\n\u003C/pre>\n\u003Cp>Conversation history gets compacted. Files don’t.\u003C/p>\n\u003Cp>\u003Cstrong>Token reduction: ~80%\u003C/strong>\u003C/p>\n\u003Cp>Before: Sub-agent returns full research in conversation (10,000+ tokens)\nAfter: Sub-agent returns file path (50 tokens)\u003C/p>\n\u003Cp>Parent reads file on-demand when ready to implement.\u003C/p>\n\u003Ch2 id=\"poc-3-complete-file-based-context-system\">POC 3: Complete File-Based Context System\u003C/h2>\n\u003Ch3 id=\"step-1-context-file-template\">Step 1: Context File Template\u003C/h3>\n\u003Cp>Create \u003Ccode>.claude/templates/context.md\u003C/code>:\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"29\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">MARKDOWN\u003C/span>\u003Cspan class=\"language-badge\">markdown\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container collapsible with-line-numbers\" data-language=\"markdown\" data-line-count=\"29\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cbutton class=\"collapse-toggle\" aria-label=\"Toggle code visibility\" type=\"button\">\u003Cspan class=\"expand-text\">Expand (29 lines)\u003C/span>\u003Cspan class=\"collapse-text\">Collapse\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"markdown\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#79B8FF;--0fw:bold;--1:#005CC5;--1fw:bold\"># Project Context\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#79B8FF;--0fw:bold;--1:#005CC5;--1fw:bold\">## Current State\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\">&#x3C;!-- What exists now, what's working, what's not -->\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#79B8FF;--0fw:bold;--1:#005CC5;--1fw:bold\">## Research Needed\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\">&#x3C;!-- Specific questions the sub-agent should answer -->\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">1.\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">2.\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">3.\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#79B8FF;--0fw:bold;--1:#005CC5;--1fw:bold\">## Constraints\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\">&#x3C;!-- Hard requirements, tech stack, patterns to follow -->\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Must use:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Cannot use:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Style:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#79B8FF;--0fw:bold;--1:#005CC5;--1fw:bold\">## Files to Review\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\">&#x3C;!-- Specific files relevant to this task -->\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">-\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">-\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#79B8FF;--0fw:bold;--1:#005CC5;--1fw:bold\">## Output Expected\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\">&#x3C;!-- What should be in the research report -->\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Implementation plan\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Code examples\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Potential issues\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Recommended approach\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"# Project Context## Current State\u003C!-- What exists now, what&#x27;s working, what&#x27;s not -->## Research Needed\u003C!-- Specific questions the sub-agent should answer -->1.2.3.## Constraints\u003C!-- Hard requirements, tech stack, patterns to follow -->- Must use:- Cannot use:- Style:## Files to Review\u003C!-- Specific files relevant to this task -->--## Output Expected\u003C!-- What should be in the research report -->- Implementation plan- Code examples- Potential issues- Recommended approach\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003Cdiv class=\"code-fade\" aria-hidden=\"true\">\u003C/div>\u003C/div>\u003C/div>\n\u003Ch3 id=\"step-2-research-agent-definition\">Step 2: Research Agent Definition\u003C/h3>\n\u003Cp>Create \u003Ccode>.claude/agents/researcher.md\u003C/code>:\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"50\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">MARKDOWN\u003C/span>\u003Cspan class=\"language-badge\">markdown\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container collapsible with-line-numbers\" data-language=\"markdown\" data-line-count=\"50\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cbutton class=\"collapse-toggle\" aria-label=\"Toggle code visibility\" type=\"button\">\u003Cspan class=\"expand-text\">Expand (50 lines)\u003C/span>\u003Cspan class=\"collapse-text\">Collapse\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"markdown\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">---\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">name\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">researcher\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">description\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">Research sub-agent that gathers information and creates implementation plans\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">tools\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">Read, Glob, Grep, WebFetch, Write\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">model\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">haiku\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">---\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#79B8FF;--0fw:bold;--1:#005CC5;--1fw:bold\"># Research Agent\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">You are a research sub-agent. Your job is to gather information and create detailed implementation plans. \u003C/span>\u003Cspan style=\"--0:#E1E4E8;--0fw:bold;--1:#24292E;--1fw:bold\">**You do NOT implement anything.**\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#79B8FF;--0fw:bold;--1:#005CC5;--1fw:bold\">## Workflow\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">1.\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#E1E4E8;--0fw:bold;--1:#24292E;--1fw:bold\">**Read the context file**\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Always start by reading the context.md file passed to you\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Understand what's being asked and the constraints\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">2.\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#E1E4E8;--0fw:bold;--1:#24292E;--1fw:bold\">**Research the codebase**\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Find relevant existing code using Grep and Glob\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Understand current patterns and conventions\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Identify dependencies and interfaces\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">3.\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#E1E4E8;--0fw:bold;--1:#24292E;--1fw:bold\">**Research external documentation**\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> If the task involves external services, fetch their docs\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Find best practices and examples\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Note any recent API changes\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">4.\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#E1E4E8;--0fw:bold;--1:#24292E;--1fw:bold\">**Create implementation plan**\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Step-by-step instructions for implementation\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Include actual code snippets where helpful\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Note potential issues and how to handle them\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> List files that will need to be modified\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">5.\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#E1E4E8;--0fw:bold;--1:#24292E;--1fw:bold\">**Write research report**\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Save to the location specified in context.md\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Use clear sections matching the output expected\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Include confidence levels for recommendations\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">6.\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#E1E4E8;--0fw:bold;--1:#24292E;--1fw:bold\">**Return summary only**\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Tell the parent agent: \"Research complete. Report saved to [\u003C/span>\u003Cspan style=\"--0:#DBEDFF;--0td:underline;--1:#032F62;--1td:underline\">path\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">]\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Do NOT include the full report in your response\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Keep the summary under 100 words\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#79B8FF;--0fw:bold;--1:#005CC5;--1fw:bold\">## Rules\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> NEVER implement code, only plan it\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> NEVER call other sub-agents\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> ALWAYS write findings to file, not conversation\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> ALWAYS read context.md first\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"---name: researcherdescription: Research sub-agent that gathers information and creates implementation planstools: Read, Glob, Grep, WebFetch, Writemodel: haiku---# Research AgentYou are a research sub-agent. Your job is to gather information and create detailed implementation plans. **You do NOT implement anything.**## Workflow1. **Read the context file**   - Always start by reading the context.md file passed to you   - Understand what&#x27;s being asked and the constraints2. **Research the codebase**   - Find relevant existing code using Grep and Glob   - Understand current patterns and conventions   - Identify dependencies and interfaces3. **Research external documentation**   - If the task involves external services, fetch their docs   - Find best practices and examples   - Note any recent API changes4. **Create implementation plan**   - Step-by-step instructions for implementation   - Include actual code snippets where helpful   - Note potential issues and how to handle them   - List files that will need to be modified5. **Write research report**   - Save to the location specified in context.md   - Use clear sections matching the output expected   - Include confidence levels for recommendations6. **Return summary only**   - Tell the parent agent: &#x22;Research complete. Report saved to [path]&#x22;   - Do NOT include the full report in your response   - Keep the summary under 100 words## Rules- NEVER implement code, only plan it- NEVER call other sub-agents- ALWAYS write findings to file, not conversation- ALWAYS read context.md first\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003Cdiv class=\"code-fade\" aria-hidden=\"true\">\u003C/div>\u003C/div>\u003C/div>\n\u003Ch3 id=\"step-3-implementation-flow\">Step 3: Implementation Flow\u003C/h3>\n\u003Cpre class=\"mermaid\">sequenceDiagram\n    participant U as User\n    participant P as Parent Agent\n    participant F as File System\n    participant S as Sub-Agent (Researcher)\n\n    U->>P: \"Add Stripe checkout\"\n    P->>F: Write context.md\n    Note over F: Project state, constraints, questions\n\n    P->>S: \"Research Stripe checkout. Context: ./context.md\"\n    S->>F: Read context.md\n    S->>S: Research codebase (Glob, Grep)\n    S->>S: Fetch Stripe docs (WebFetch)\n    S->>S: Create implementation plan\n    S->>F: Write research-report.md\n\n    S-->>P: \"Research complete. See research-report.md\"\n    Note over P: Only ~50 tokens returned\n\n    P->>F: Read research-report.md\n    Note over P: Full plan now in parent's context\n\n    P->>P: Implement based on plan\n    P->>F: Write/Edit source files\n    P->>U: \"Implementation complete\"\n\u003C/pre>\n\u003Ch3 id=\"step-4-putting-it-together\">Step 4: Putting It Together\u003C/h3>\n\u003Cp>Parent agent’s workflow for delegating research:\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"4\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">MARKDOWN\u003C/span>\u003Cspan class=\"language-badge\">markdown\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container with-line-numbers\" data-language=\"markdown\" data-line-count=\"4\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"markdown\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#79B8FF;--0fw:bold;--1:#005CC5;--1fw:bold\">## When you need to research something complex:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">1.\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Create context file:\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"## When you need to research something complex:1. Create context file:\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003C/div>\u003C/div>\n\u003Cp>Write to ./tmp/context-{task}.md:\u003C/p>\n\u003Cul>\n\u003Cli>Current state of the feature\u003C/li>\n\u003Cli>Specific questions to answer\u003C/li>\n\u003Cli>Constraints and requirements\u003C/li>\n\u003Cli>Expected output format\u003C/li>\n\u003C/ul>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"3\">\u003Cdiv class=\"code-block-container with-line-numbers\" data-language=\"\" data-line-count=\"3\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"plaintext\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">2. Spawn research sub-agent:\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"2. Spawn research sub-agent:\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003C/div>\u003C/div>\n\u003Cp>Task: “Research [topic]. Read context from ./tmp/context-{task}.md.\nWrite report to ./tmp/research-{task}.md”\nAgent: researcher\nModel: haiku (fast, cheap)\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"3\">\u003Cdiv class=\"code-block-container with-line-numbers\" data-language=\"\" data-line-count=\"3\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"plaintext\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">3. Wait for completion, then:\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"3. Wait for completion, then:\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003C/div>\u003C/div>\n\u003Cp>Read ./tmp/research-{task}.md\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"5\">\u003Cdiv class=\"code-block-container with-line-numbers\" data-language=\"\" data-line-count=\"5\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"plaintext\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">4. Implement based on research report\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">5. Clean up temp files when done\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"4. Implement based on research report5. Clean up temp files when done\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003C/div>\u003C/div>\n\u003Ch2 id=\"poc-4-service-specific-researchers\">POC 4: Service-Specific Researchers\u003C/h2>\n\u003Cp>Build specialized research agents for services you use frequently:\u003C/p>\n\u003Ch3 id=\"stripe-research-agent\">Stripe Research Agent\u003C/h3>\n\u003Cp>Create \u003Ccode>.claude/agents/stripe-researcher.md\u003C/code>:\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"44\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">MARKDOWN\u003C/span>\u003Cspan class=\"language-badge\">markdown\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container collapsible with-line-numbers\" data-language=\"markdown\" data-line-count=\"44\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cbutton class=\"collapse-toggle\" aria-label=\"Toggle code visibility\" type=\"button\">\u003Cspan class=\"expand-text\">Expand (44 lines)\u003C/span>\u003Cspan class=\"collapse-text\">Collapse\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"markdown\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">---\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">name\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">stripe-researcher\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">description\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">Research Stripe integration patterns and best practices\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">tools\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">Read, Glob, Grep, WebFetch, Write\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">model\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">haiku\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">---\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#79B8FF;--0fw:bold;--1:#005CC5;--1fw:bold\"># Stripe Research Agent\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">You research Stripe integrations. You have access to Context7 MCP for up-to-date Stripe documentation.\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#79B8FF;--0fw:bold;--1:#005CC5;--1fw:bold\">## Knowledge Base\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Stripe API docs: https://stripe.com/docs/api\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Webhooks guide: https://stripe.com/docs/webhooks\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Best practices: https://stripe.com/docs/best-practices\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#79B8FF;--0fw:bold;--1:#005CC5;--1fw:bold\">## Research Areas\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Payment intents vs charges (use payment intents)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Webhook event handling\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Error handling patterns\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Testing with test mode keys\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> PCI compliance considerations\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#79B8FF;--0fw:bold;--1:#005CC5;--1fw:bold\">## Output Format\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">```yaml\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">recommendation\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">approach\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"description\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">confidence\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">high|medium|low\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">stripe_api_version\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"2024-xx-xx\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">implementation_steps\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">- \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">step\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">1\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">action\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"what to do\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">code\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">|\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">      \u003C/span>\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">// example code\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">potential_issues\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">- \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">issue\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"description\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">mitigation\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"how to handle\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">files_to_modify\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">- \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">path\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"file path\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">changes\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"what changes\"\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"---name: stripe-researcherdescription: Research Stripe integration patterns and best practicestools: Read, Glob, Grep, WebFetch, Writemodel: haiku---# Stripe Research AgentYou research Stripe integrations. You have access to Context7 MCP for up-to-date Stripe documentation.## Knowledge Base- Stripe API docs: https://stripe.com/docs/api- Webhooks guide: https://stripe.com/docs/webhooks- Best practices: https://stripe.com/docs/best-practices## Research Areas- Payment intents vs charges (use payment intents)- Webhook event handling- Error handling patterns- Testing with test mode keys- PCI compliance considerations## Output Format&#x60;&#x60;&#x60;yamlrecommendation:  approach: &#x22;description&#x22;  confidence: high|medium|low  stripe_api_version: &#x22;2024-xx-xx&#x22;implementation_steps:  - step: 1    action: &#x22;what to do&#x22;    code: |      // example codepotential_issues:  - issue: &#x22;description&#x22;    mitigation: &#x22;how to handle&#x22;files_to_modify:  - path: &#x22;file path&#x22;    changes: &#x22;what changes&#x22;\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003Cdiv class=\"code-fade\" aria-hidden=\"true\">\u003C/div>\u003C/div>\u003C/div>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"30\">\u003Cdiv class=\"code-block-container collapsible with-line-numbers\" data-language=\"\" data-line-count=\"30\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cbutton class=\"collapse-toggle\" aria-label=\"Toggle code visibility\" type=\"button\">\u003Cspan class=\"expand-text\">Expand (30 lines)\u003C/span>\u003Cspan class=\"collapse-text\">Collapse\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"plaintext\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">### Supabase Research Agent\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">Create `.claude/agents/supabase-researcher.md`:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">```markdown\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">---\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">name: supabase-researcher\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">description: Research Supabase database patterns and RLS policies\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">tools: Read, Glob, Grep, WebFetch, Write\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">model: haiku\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">---\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\"># Supabase Research Agent\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">You research Supabase patterns. Focus on RLS policies, auth, and performance.\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">## Research Checklist\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">- [ ] Existing table structure\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">- [ ] Current RLS policies\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">- [ ] Auth patterns in codebase\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">- [ ] Client initialization\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">- [ ] Error handling patterns\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">## Output Includes\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">- Schema changes needed (SQL)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">- RLS policy definitions\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">- TypeScript types to generate\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">- Migration steps\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"### Supabase Research AgentCreate &#x60;.claude/agents/supabase-researcher.md&#x60;:&#x60;&#x60;&#x60;markdown---name: supabase-researcherdescription: Research Supabase database patterns and RLS policiestools: Read, Glob, Grep, WebFetch, Writemodel: haiku---# Supabase Research AgentYou research Supabase patterns. Focus on RLS policies, auth, and performance.## Research Checklist- [ ] Existing table structure- [ ] Current RLS policies- [ ] Auth patterns in codebase- [ ] Client initialization- [ ] Error handling patterns## Output Includes- Schema changes needed (SQL)- RLS policy definitions- TypeScript types to generate- Migration steps\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003Cdiv class=\"code-fade\" aria-hidden=\"true\">\u003C/div>\u003C/div>\u003C/div>\n\u003Ch2 id=\"when-this-fails-know-the-limits-before-you-hit-them\">When This Fails (Know the Limits Before You Hit Them)\u003C/h2>\n\u003Cp>This architecture isn’t magic. Here are the real limitations I’ve hit in production—and the expensive lessons behind each one:\u003C/p>\n\u003Ch3 id=\"1-context-isolation-still-exists\">1. Context Isolation Still Exists\u003C/h3>\n\u003Cp>The researcher agent doesn’t have access to the parent’s conversation history. If critical information only exists in the parent’s memory, the researcher will miss it.\u003C/p>\n\u003Cp>\u003Cstrong>Mitigation:\u003C/strong> Be explicit in context.md. Don’t assume the researcher “knows” anything.\u003C/p>\n\u003Cp>\u003Cstrong>Example Failure:\u003C/strong>\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"3\">\u003Cdiv class=\"code-block-container with-line-numbers\" data-language=\"\" data-line-count=\"3\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"plaintext\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">Parent: \"Add error handling like we did for auth\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">Researcher: ??? (doesn't know how auth error handling works)\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"Parent: &#x22;Add error handling like we did for auth&#x22;Researcher: ??? (doesn&#x27;t know how auth error handling works)\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003C/div>\u003C/div>\n\u003Cp>\u003Cstrong>Example Fix:\u003C/strong>\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"5\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">MARKDOWN\u003C/span>\u003Cspan class=\"language-badge\">markdown\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container with-line-numbers\" data-language=\"markdown\" data-line-count=\"5\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame has-title\">\u003Cfigcaption class=\"header\">\u003Cspan class=\"title\">context.md\u003C/span>\u003C/figcaption>\u003Cpre data-language=\"markdown\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#79B8FF;--0fw:bold;--1:#005CC5;--1fw:bold\">## Error Handling Pattern\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">See src/auth/handler.ts lines 45-67 for our standard error handling pattern.\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">Use the same try/catch structure and error response format.\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"## Error Handling PatternSee src/auth/handler.ts lines 45-67 for our standard error handling pattern.Use the same try/catch structure and error response format.\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003C/div>\u003C/div>\n\u003Ch3 id=\"2-research-can-be-wrong\">2. Research Can Be Wrong\u003C/h3>\n\u003Cp>Haiku is fast and cheap but makes mistakes on complex analysis. The researcher might miss edge cases or misunderstand requirements.\u003C/p>\n\u003Cp>\u003Cstrong>Mitigation:\u003C/strong> Review the research report before implementing. Don’t blindly trust it.\u003C/p>\n\u003Cp>\u003Cstrong>Example Failure:\u003C/strong>\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"4\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">YAML\u003C/span>\u003Cspan class=\"language-badge\">yaml\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container with-line-numbers\" data-language=\"yaml\" data-line-count=\"4\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"yaml\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">recommendation\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">approach\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"Use Stripe Charges API\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">confidence\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">high\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"recommendation:  approach: &#x22;Use Stripe Charges API&#x22;  confidence: high\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003C/div>\u003C/div>\n\u003Cp>This is outdated. Payment Intents is the modern approach. A senior engineer would catch this.\u003C/p>\n\u003Ch3 id=\"3-overhead-on-simple-tasks\">3. Overhead on Simple Tasks\u003C/h3>\n\u003Cp>Creating context files, spawning agents, reading reports—this adds 30-60 seconds of overhead.\u003C/p>\n\u003Cp>\u003Cstrong>When to skip delegation:\u003C/strong>\u003C/p>\n\u003Cul>\n\u003Cli>Task takes &#x3C; 2 minutes to implement directly\u003C/li>\n\u003Cli>You already know exactly what to do\u003C/li>\n\u003Cli>No external research needed\u003C/li>\n\u003Cli>Single file change with obvious solution\u003C/li>\n\u003C/ul>\n\u003Cp>\u003Cstrong>Numbers:\u003C/strong>\u003C/p>\n\u003Cul>\n\u003Cli>Simple task direct: 2 minutes\u003C/li>\n\u003Cli>Simple task with delegation: 3 minutes (50% overhead)\u003C/li>\n\u003Cli>Complex task direct: 30 minutes\u003C/li>\n\u003Cli>Complex task with delegation: 15 minutes (50% time saved)\u003C/li>\n\u003C/ul>\n\u003Cp>Delegation shines on complex, research-heavy tasks. It’s overkill for simple edits.\u003C/p>\n\u003Ch3 id=\"4-file-coordination-complexity\">4. File Coordination Complexity\u003C/h3>\n\u003Cp>Multiple sub-agents writing to files simultaneously can cause conflicts. If Agent A writes \u003Ccode>research-stripe.md\u003C/code> while Agent B tries to read it, race conditions occur.\u003C/p>\n\u003Cp>\u003Cstrong>Mitigation:\u003C/strong> Use distinct file names with timestamps or task IDs.\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"7\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">BASH\u003C/span>\u003Cspan class=\"language-badge\">bash\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container with-line-numbers\" data-language=\"bash\" data-line-count=\"7\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame is-terminal\">\u003Cfigcaption class=\"header\">\u003Cspan class=\"title\">\u003C/span>\u003Cspan class=\"sr-only\">Terminal window\u003C/span>\u003C/figcaption>\u003Cpre data-language=\"bash\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Good\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">tmp/context-stripe-1703012400.md\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">tmp/research-stripe-1703012400.md\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Bad\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">tmp/context.md\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">  \u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Which task is this for?\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"tmp/context-stripe-1703012400.mdtmp/research-stripe-1703012400.mdtmp/context.md  # Which task is this for?\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003C/div>\u003C/div>\n\u003Ch3 id=\"5-debugging-gets-harder\">5. Debugging Gets Harder\u003C/h3>\n\u003Cp>When implementation fails, you now have three places to debug:\u003C/p>\n\u003Col>\n\u003Cli>The context file (was the request clear?)\u003C/li>\n\u003Cli>The research report (was the research correct?)\u003C/li>\n\u003Cli>The implementation (was the code correct?)\u003C/li>\n\u003C/ol>\n\u003Cp>\u003Cstrong>Mitigation:\u003C/strong> Keep research reports. Don’t delete them. When debugging, check all three layers.\u003C/p>\n\u003Ch3 id=\"6-cost-on-failed-research\">6. Cost on Failed Research\u003C/h3>\n\u003Cp>If the researcher misunderstands the task and produces useless output, you’ve wasted:\u003C/p>\n\u003Cul>\n\u003Cli>Haiku API calls (cheap but not free)\u003C/li>\n\u003Cli>30-60 seconds of time\u003C/li>\n\u003Cli>Mental context switching\u003C/li>\n\u003C/ul>\n\u003Cp>\u003Cstrong>Mitigation:\u003C/strong> Write very specific context files. Vague requests produce vague research.\u003C/p>\n\u003Cp>\u003Cstrong>Example Vague Request:\u003C/strong>\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"3\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">MARKDOWN\u003C/span>\u003Cspan class=\"language-badge\">markdown\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container with-line-numbers\" data-language=\"markdown\" data-line-count=\"3\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"markdown\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#79B8FF;--0fw:bold;--1:#005CC5;--1fw:bold\">## Research Needed\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">1.\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> How to add payments\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"## Research Needed1. How to add payments\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003C/div>\u003C/div>\n\u003Cp>\u003Cstrong>Example Specific Request:\u003C/strong>\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"7\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">MARKDOWN\u003C/span>\u003Cspan class=\"language-badge\">markdown\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container with-line-numbers\" data-language=\"markdown\" data-line-count=\"7\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"markdown\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#79B8FF;--0fw:bold;--1:#005CC5;--1fw:bold\">## Research Needed\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">1.\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Which Stripe API version should we use? (prefer latest stable)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">2.\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Payment Intents vs Charges API - which for one-time purchases?\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">3.\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> What webhook events do we need to handle for payment confirmation?\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">4.\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> How to handle failed payments and retry logic?\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">5.\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> What test mode setup is needed?\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"## Research Needed1. Which Stripe API version should we use? (prefer latest stable)2. Payment Intents vs Charges API - which for one-time purchases?3. What webhook events do we need to handle for payment confirmation?4. How to handle failed payments and retry logic?5. What test mode setup is needed?\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003C/div>\u003C/div>\n\u003Cp>The specific version gets useful research. The vague version gets generic documentation summaries.\u003C/p>\n\u003Ch2 id=\"model-selection-strategy\">Model Selection Strategy\u003C/h2>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\u003Ctable>\u003Cthead>\u003Ctr>\u003Cth>Task Type\u003C/th>\u003Cth>Model\u003C/th>\u003Cth>Cost/M\u003C/th>\u003Cth>Speed\u003C/th>\u003C/tr>\u003C/thead>\u003Ctbody>\u003Ctr>\u003Ctd>Simple routing\u003C/td>\u003Ctd>Haiku\u003C/td>\u003Ctd>$0.25\u003C/td>\u003Ctd>⚡⚡⚡\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Text extraction\u003C/td>\u003Ctd>Haiku\u003C/td>\u003Ctd>$0.25\u003C/td>\u003Ctd>⚡⚡⚡\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Classification\u003C/td>\u003Ctd>Haiku\u003C/td>\u003Ctd>$0.25\u003C/td>\u003Ctd>⚡⚡⚡\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Research (simple)\u003C/td>\u003Ctd>Haiku\u003C/td>\u003Ctd>$0.25\u003C/td>\u003Ctd>⚡⚡⚡\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Code review\u003C/td>\u003Ctd>Sonnet\u003C/td>\u003Ctd>$3\u003C/td>\u003Ctd>⚡⚡\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Implementation\u003C/td>\u003Ctd>Sonnet\u003C/td>\u003Ctd>$3\u003C/td>\u003Ctd>⚡⚡\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Analysis\u003C/td>\u003Ctd>Sonnet\u003C/td>\u003Ctd>$3\u003C/td>\u003Ctd>⚡⚡\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Research (complex)\u003C/td>\u003Ctd>Sonnet\u003C/td>\u003Ctd>$3\u003C/td>\u003Ctd>⚡⚡\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Complex reasoning\u003C/td>\u003Ctd>Opus\u003C/td>\u003Ctd>$15\u003C/td>\u003Ctd>⚡\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Architecture decisions\u003C/td>\u003Ctd>Opus\u003C/td>\u003Ctd>$15\u003C/td>\u003Ctd>⚡\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Edge case handling\u003C/td>\u003Ctd>Opus\u003C/td>\u003Ctd>$15\u003C/td>\u003Ctd>⚡\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Research (critical)\u003C/td>\u003Ctd>Opus\u003C/td>\u003Ctd>$15\u003C/td>\u003Ctd>⚡\u003C/td>\u003C/tr>\u003C/tbody>\u003C/table>\n\u003Cblockquote>\n\u003Cp>\u003Cstrong>Rule:\u003C/strong> Use the cheapest model that solves the problem. Most tasks are Haiku tasks. Don’t over-engineer.\u003C/p>\n\u003C/blockquote>\n\u003Cp>For researchers:\u003C/p>\n\u003Cul>\n\u003Cli>\u003Cstrong>Haiku:\u003C/strong> Documentation lookup, simple API pattern research, file structure analysis\u003C/li>\n\u003Cli>\u003Cstrong>Sonnet:\u003C/strong> Cross-service integration research, security pattern analysis, performance optimization research\u003C/li>\n\u003Cli>\u003Cstrong>Opus:\u003C/strong> Architecture decisions, critical production patterns, edge case exploration\u003C/li>\n\u003C/ul>\n\u003Cp>Start with Haiku. Upgrade only if the research is inadequate.\u003C/p>\n\u003Ch2 id=\"architecture-custom-agent-stack\">Architecture: Custom Agent Stack\u003C/h2>\n\u003Cpre class=\"mermaid\">flowchart TB\n    subgraph \"Custom Agent\"\n        SP[System Prompt]\n        UP[User Prompt]\n        T[Custom Tools]\n        M[Model Selection]\n    end\n\n    subgraph \"Execution\"\n        API[Claude API]\n        TE[Tool Execution]\n        R[Response]\n    end\n\n    SP --> API\n    UP --> API\n    T --> API\n    M --> API\n\n    API --> |tool_use| TE\n    TE --> |tool_result| API\n    API --> R\n\n    style SP fill:#ffccbc\n    style T fill:#c8e6c9\n    style R fill:#bbdefb\n\u003C/pre>\n\u003Cp>System prompts define what the agent does. Tools define how it does it. Model selection defines cost and quality. Context files enable delegation.\u003C/p>\n\u003Ch2 id=\"what-this-architecture-enables\">What This Architecture Enables\u003C/h2>\n\u003Cp>\u003Cstrong>Domain-specific logic\u003C/strong> — Operations the model can’t reason through reliably become deterministic tool calls.\u003C/p>\n\u003Cp>\u003Cstrong>Optimized context\u003C/strong> — Strip out the 12 tools you never use. Add the 3 you always need.\u003C/p>\n\u003Cp>\u003Cstrong>Specialized behavior\u003C/strong> — System prompts tuned for exactly your use cases.\u003C/p>\n\u003Cp>\u003Cstrong>Cost control\u003C/strong> — Haiku for simple tasks, Sonnet for complex ones. No over-engineering.\u003C/p>\n\u003Cp>\u003Cstrong>Team patterns\u003C/strong> — Shared agents that enforce your team’s conventions.\u003C/p>\n\u003Cp>\u003Cstrong>Parallel research\u003C/strong> — Multiple sub-agents researching different aspects simultaneously.\u003C/p>\n\u003Cp>\u003Cstrong>Persistent knowledge\u003C/strong> — Research reports accumulate in your project. Future work references past decisions.\u003C/p>\n\u003Cp>\u003Cstrong>Debuggable workflows\u003C/strong> — Always know what was planned and why. Three months later, \u003Ccode>git log\u003C/code> shows the research report that led to the implementation.\u003C/p>\n\u003Ch2 id=\"the-data-flow\">The Data Flow\u003C/h2>\n\u003Cpre class=\"mermaid\">flowchart TB\n    subgraph Parent[\"PARENT AGENT\"]\n        CH[Conversation History&#x3C;br/>compacts over time]\n        CH --> CTX[context.md&#x3C;br/>persists]\n    end\n\n    subgraph Sub[\"SUB-AGENT\"]\n        READ[Reads context.md]\n        RESEARCH[Does research]\n        REPORT[research-report.md&#x3C;br/>persists]\n        READ --> RESEARCH --> REPORT\n    end\n\n    CTX --> READ\n    REPORT --> RESULT\n\n    subgraph RESULT[Parent reads research-report.md]\n        R1[Full context available]\n        R2[Can implement correctly]\n        R3[Can debug if issues arise]\n    end\n\n    style CTX fill:#c8e6c9\n    style REPORT fill:#c8e6c9\n\u003C/pre>\n\u003Cp>Conversation history compacts. Files don’t. This is the key insight.\u003C/p>\n\u003Ch2 id=\"rules-that-prevent-disasters\">Rules That Prevent Disasters\u003C/h2>\n\u003Cp>Add these to your research agent definitions:\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"22\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">MARKDOWN\u003C/span>\u003Cspan class=\"language-badge\">markdown\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container collapsible with-line-numbers\" data-language=\"markdown\" data-line-count=\"22\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cbutton class=\"collapse-toggle\" aria-label=\"Toggle code visibility\" type=\"button\">\u003Cspan class=\"expand-text\">Expand (22 lines)\u003C/span>\u003Cspan class=\"collapse-text\">Collapse\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"markdown\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#79B8FF;--0fw:bold;--1:#005CC5;--1fw:bold\">## Mandatory Rules\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">1.\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#E1E4E8;--0fw:bold;--1:#24292E;--1fw:bold\">**Always read context file first**\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Never start work without understanding the context\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> If context file doesn't exist, stop and report error\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">2.\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#E1E4E8;--0fw:bold;--1:#24292E;--1fw:bold\">**Never implement, only research**\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Your job is to create the plan\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> The parent agent implements\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">3.\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#E1E4E8;--0fw:bold;--1:#24292E;--1fw:bold\">**Never spawn sub-agents**\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> One level of delegation maximum\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Prevents recursive loops and cost explosions\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">4.\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#E1E4E8;--0fw:bold;--1:#24292E;--1fw:bold\">**Always write findings to file**\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Summary in conversation: &#x3C; 100 words\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Full report in file: as detailed as needed\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">5.\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#E1E4E8;--0fw:bold;--1:#24292E;--1fw:bold\">**Update context file when done**\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Add \"Last researched: [\u003C/span>\u003Cspan style=\"--0:#DBEDFF;--0td:underline;--1:#032F62;--1td:underline\">timestamp\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">]\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Note any assumptions made\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"## Mandatory Rules1. **Always read context file first**   - Never start work without understanding the context   - If context file doesn&#x27;t exist, stop and report error2. **Never implement, only research**   - Your job is to create the plan   - The parent agent implements3. **Never spawn sub-agents**   - One level of delegation maximum   - Prevents recursive loops and cost explosions4. **Always write findings to file**   - Summary in conversation: \u003C 100 words   - Full report in file: as detailed as needed5. **Update context file when done**   - Add &#x22;Last researched: [timestamp]&#x22;   - Note any assumptions made\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003Cdiv class=\"code-fade\" aria-hidden=\"true\">\u003C/div>\u003C/div>\u003C/div>\n\u003Cp>One level of delegation. Researcher agents never spawn their own sub-agents. This prevents:\u003C/p>\n\u003Cul>\n\u003Cli>Recursive delegation loops\u003C/li>\n\u003Cli>Cost explosions (agent spawns agent spawns agent…)\u003C/li>\n\u003Cli>Context fragmentation\u003C/li>\n\u003Cli>Debugging nightmares\u003C/li>\n\u003C/ul>\n\u003Ch2 id=\"quick-start-your-first-custom-agent-15-minutes\">Quick Start: Your First Custom Agent (15 Minutes)\u003C/h2>\n\u003Col>\n\u003Cli>Identify your most repetitive AI task\u003C/li>\n\u003Cli>Write a system prompt that focuses on that task\u003C/li>\n\u003Cli>Choose the cheapest model that works (probably Haiku)\u003C/li>\n\u003Cli>Add tools only if you need deterministic execution\u003C/li>\n\u003Cli>Test with edge cases\u003C/li>\n\u003Cli>Deploy and iterate\u003C/li>\n\u003C/ol>\n\u003Cp>\u003Cstrong>For delegation\u003C/strong> (adds 10 more minutes):\u003C/p>\n\u003Col>\n\u003Cli>Create the context template (\u003Ccode>.claude/templates/context.md\u003C/code>)\u003C/li>\n\u003Cli>Create the researcher agent (\u003Ccode>.claude/agents/researcher.md\u003C/code>)\u003C/li>\n\u003Cli>Next time you need research, write a context file and spawn the agent\u003C/li>\n\u003Cli>Read the research report\u003C/li>\n\u003Cli>Implement based on the plan\u003C/li>\n\u003C/ol>\n\u003Cp>\u003Cstrong>The endgame isn’t renting computational power from default agents. The endgame is owning specialized agents tuned precisely for your problems, with reliable delegation patterns that actually work.\u003C/strong>\u003C/p>\n\u003Cp>Stop borrowing. Start owning.\u003C/p>\n\u003Chr>\n\u003Cp>\u003Cstrong>Key Takeaways:\u003C/strong>\u003C/p>\n\u003Cul>\n\u003Cli>System prompt = agent identity (same model, different prompt = different product)\u003C/li>\n\u003Cli>Tools provide deterministic execution when reasoning isn’t reliable\u003C/li>\n\u003Cli>Sub-agents research, parent agents implement (context isolation is real)\u003C/li>\n\u003Cli>File system is persistent memory between agent sessions (conversation history compacts, files don’t)\u003C/li>\n\u003Cli>Context files define what to research, research reports contain the full plan\u003C/li>\n\u003Cli>80% token reduction by returning file paths not content\u003C/li>\n\u003Cli>One level of delegation prevents recursive loops and cost explosions\u003C/li>\n\u003Cli>Match model to task complexity (Haiku → Sonnet → Opus, most tasks are Haiku tasks)\u003C/li>\n\u003Cli>Delegation overhead is 30-60 seconds (only worth it for complex tasks)\u003C/li>\n\u003Cli>Review research reports before implementing (Haiku makes mistakes on complex analysis)\u003C/li>\n\u003C/ul>\n\u003Cp>\u003Cstrong>Try It Now:\u003C/strong>\nCreate \u003Ccode>.claude/agents/researcher.md\u003C/code> using the template above. Next time you need to research a new API integration or library, write a context file and delegate to the researcher. Read the report. Implement based on the plan. See if you save time.\u003C/p>",{"headings":393,"localImagePaths":468,"remoteImagePaths":469,"frontmatter":470,"imagePaths":474},[394,397,400,403,406,409,412,415,418,421,424,427,430,432,435,438,441,444,447,450,453,456,459,462,465],{"depth":44,"slug":395,"text":396},"why-custom-agents-matter","Why Custom Agents Matter",{"depth":44,"slug":398,"text":399},"poc-1-the-simplest-custom-agent","POC 1: The Simplest Custom Agent",{"depth":44,"slug":401,"text":402},"poc-2-agent-with-custom-tools","POC 2: Agent with Custom Tools",{"depth":44,"slug":404,"text":405},"the-key-pattern-sub-agents-as-researchers","The Key Pattern: Sub-Agents as Researchers",{"depth":44,"slug":407,"text":408},"file-based-context-the-solution","File-Based Context: The Solution",{"depth":44,"slug":410,"text":411},"poc-3-complete-file-based-context-system","POC 3: Complete File-Based Context System",{"depth":112,"slug":413,"text":414},"step-1-context-file-template","Step 1: Context File Template",{"depth":112,"slug":416,"text":417},"step-2-research-agent-definition","Step 2: Research Agent Definition",{"depth":112,"slug":419,"text":420},"step-3-implementation-flow","Step 3: Implementation Flow",{"depth":112,"slug":422,"text":423},"step-4-putting-it-together","Step 4: Putting It Together",{"depth":44,"slug":425,"text":426},"poc-4-service-specific-researchers","POC 4: Service-Specific Researchers",{"depth":112,"slug":428,"text":429},"stripe-research-agent","Stripe Research Agent",{"depth":44,"slug":235,"text":431},"When This Fails (Know the Limits Before You Hit Them)",{"depth":112,"slug":433,"text":434},"1-context-isolation-still-exists","1. Context Isolation Still Exists",{"depth":112,"slug":436,"text":437},"2-research-can-be-wrong","2. Research Can Be Wrong",{"depth":112,"slug":439,"text":440},"3-overhead-on-simple-tasks","3. Overhead on Simple Tasks",{"depth":112,"slug":442,"text":443},"4-file-coordination-complexity","4. File Coordination Complexity",{"depth":112,"slug":445,"text":446},"5-debugging-gets-harder","5. Debugging Gets Harder",{"depth":112,"slug":448,"text":449},"6-cost-on-failed-research","6. Cost on Failed Research",{"depth":44,"slug":451,"text":452},"model-selection-strategy","Model Selection Strategy",{"depth":44,"slug":454,"text":455},"architecture-custom-agent-stack","Architecture: Custom Agent Stack",{"depth":44,"slug":457,"text":458},"what-this-architecture-enables","What This Architecture Enables",{"depth":44,"slug":460,"text":461},"the-data-flow","The Data Flow",{"depth":44,"slug":463,"text":464},"rules-that-prevent-disasters","Rules That Prevent Disasters",{"depth":44,"slug":466,"text":467},"quick-start-your-first-custom-agent-15-minutes","Quick Start: Your First Custom Agent (15 Minutes)",[],[],{"title":369,"description":370,"pubDate":471,"author":17,"tags":472,"banner":377,"category":386,"difficulty":97,"tldr":379,"keyTakeaways":473},["Date","2025-12-15T00:00:00.000Z"],[19,373,21,374,375,376],[381,382,383,384,385],[],"agent-architecture.md","claude-skills-deep-dive",{"id":476,"data":478,"body":494,"filePath":495,"digest":496,"rendered":497,"legacyId":604},{"title":479,"description":480,"pubDate":481,"author":17,"tags":482,"draft":24,"banner":484,"seoKeywords":485,"tldr":486,"keyTakeaways":487,"category":493,"difficulty":35},"Claude Skills Deep Dive: Progressive Loading and the MCP Alternative","Skills load 100 tokens of metadata upfront, then instructions on-demand. Here's when to use Skills vs MCP, with working POC code.",["Date","2025-12-23T00:00:00.000Z"],[19,178,179,84,180,483],"progressive-disclosure","/assets/posts/claude-skills-deep-dive-banner.png",[],"Claude Skills use a 3-tier progressive loading architecture: 100 tokens of metadata loaded at startup, full instructions (\u003C5k tokens) loaded on-demand when triggered, and linked reference files loaded only when needed. This beats MCP's 10K+ token upfront cost for document generation workflows, while MCP wins for external services and real-time data.",[488,489,490,491,492],"Skills metadata costs ~100 tokens upfront; full instructions load only when triggered","3-tier architecture: metadata (64 char name + 1024 char description), instructions (\u003C5k tokens), linked files (on-demand)","Use Skills for document generation, deterministic workflows, and reusable expertise","Use MCP for external services, real-time data, and bidirectional communication","Skills work across claude.ai and API; MCP requires API environment","AI Patterns","Skills use 100 tokens of metadata. Then load instructions only when triggered.\n\nThat's a 99% reduction in upfront context cost compared to MCP servers. If you've been burning 10K-15K tokens on tool loading before your first message even lands, this is the architectural fix you didn't know existed.\n\nHere's why it matters and when Skills should replace your MCP servers.\n\n## The Token Economics Problem\n\nI spent six months building MCP servers for everything. Context engineering, filesystem operations, web scraping. Every MCP server adds 10K-15K tokens to your context window upfront. Before Claude reads a single message.\n\nFour MCP servers? That's 40,000-60,000 tokens consumed before you type \"hello.\" On a 200K context window, you've burned 20-30% of your budget on overhead.\n\nThen I discovered Skills. Same progressive disclosure pattern I use in my context engineering work, but built into Claude's architecture. The difference is dramatic.\n\nHere's the data:\n\n**MCP Token Cost (Upfront)**\n- Server registration: ~2K tokens\n- Tool schemas: ~8K-13K tokens per server\n- Total before first message: 10K-15K tokens\n\n**Skills Token Cost (Progressive)**\n- Metadata at startup: ~100 tokens (64 char name + 1024 char description)\n- Full instructions when triggered: \u003C5K tokens\n- Reference files: 0 tokens until read\n\nThe difference? Skills load on-demand. MCP loads everything upfront.\n\n## How Skills Architecture Works\n\nSkills use a 3-tier progressive loading system. Here's the exact structure:\n\n![Skills 3-Tier Architecture](/assets/posts/in-post/v2-skills-tiers.png)\n\n### Tier 1: Metadata (Loaded at Startup)\n\n```yaml\n---\nname: pdf-processing\ndescription: Extracts text and tables from PDF files, fills forms, and merges documents. Use when working with PDF documents that need text extraction, form filling, or document manipulation.\n---\n```\n\nThis costs approximately 100 tokens. Claude loads this metadata for all available Skills at startup. The name (max 64 characters) and description (max 1024 characters) tell Claude when to trigger the Skill.\n\n### Tier 2: Full Instructions (Loaded on Trigger)\n\nWhen Claude decides the Skill is relevant, it loads the full SKILL.md file. This contains:\n\n- Detailed workflow instructions\n- Code examples\n- Validation steps\n- Error handling patterns\n- Links to reference files\n\nRecommended maximum: 500 lines. Typically costs \u003C5K tokens.\n\n### Tier 3: Reference Files (Loaded on Demand)\n\nSkills can reference additional files using the directory structure:\n\n```\npdf-processing/\n├── SKILL.md                    # Main instructions\n├── scripts/\n│   ├── extract_text.py        # Utility script\n│   ├── fill_form.py           # Utility script\n│   └── merge_pdfs.py          # Utility script\n└── reference/\n    ├── pdf_libraries.md       # Library comparison\n    └── common_patterns.md     # Usage patterns\n```\n\nClaude reads these files only when explicitly needed. Zero token cost until accessed.\n\n## Working Example: Document Generation Skill\n\nHere's a real Skill from Anthropic's cookbook that generates Excel, PowerPoint, and PDF files:\n\n```markdown\n---\nname: document-generator\ndescription: Creates professional Excel spreadsheets, PowerPoint presentations, and PDF documents with charts, formulas, and formatting. Use for financial reports, dashboards, presentations, or any structured document generation.\n---\n\n# Document Generation Skill\n\n## Capabilities\n\n1. Excel (.xlsx): Multi-sheet workbooks with formulas, charts, conditional formatting\n2. PowerPoint (.pptx): Professional presentations with data-driven slides\n3. PDF: Structured documents with tables and visualizations\n\n## Workflow\n\n### For Excel Generation\n\n1. Analyze data requirements\n2. Create message with xlsx skill\n3. Include specific formatting needs\n4. Generate and download file\n\n### For PowerPoint Generation\n\n1. Define presentation structure\n2. Specify slide content and layout\n3. Include chart/visualization needs\n4. Generate and download file\n\n## Code Examples\n\n### Excel with Charts\n\n```python\nfrom anthropic import Anthropic\n\nclient = Anthropic(api_key=API_KEY)\n\nresponse = client.beta.messages.create(\n    model=\"claude-sonnet-4-5\",\n    max_tokens=4096,\n    container={\n        \"skills\": [{\n            \"type\": \"anthropic\",\n            \"skill_id\": \"xlsx\",\n            \"version\": \"latest\"\n        }]\n    },\n    tools=[{\n        \"type\": \"code_execution_20250825\",\n        \"name\": \"code_execution\"\n    }],\n    messages=[{\n        \"role\": \"user\",\n        \"content\": \"\"\"Create an Excel workbook with quarterly revenue data:\n\nQ1: $12.3M revenue, $1.2M net income\nQ2: $13.1M revenue, $1.5M net income\nQ3: $13.8M revenue, $1.7M net income\nQ4: $14.5M revenue, $1.88M net income\n\nInclude:\n- Formatted data table\n- Revenue trend chart\n- YoY growth calculations\n- Conditional formatting for growth\"\"\"\n    }],\n    betas=[\n        \"code-execution-2025-08-25\",\n        \"files-api-2025-04-14\",\n        \"skills-2025-10-02\"\n    ]\n)\n\n# Download generated file\nfile_id = response.content[1].file_id\nfile_content = client.files.content(file_id=file_id)\n\nwith open(\"quarterly_report.xlsx\", \"wb\") as f:\n    f.write(file_content.content)\n```\n```\n\n### Performance Data\n\nFrom testing across 50+ document generations:\n\n- Excel files: 1-2 minutes generation time\n- PowerPoint presentations: 1-2 minutes\n- PDF documents: 40-60 seconds\n- Token usage: 5K-10K tokens per generation\n- Success rate: 95% for 2-3 sheet/slide documents\n\nThe Skill architecture means this 5K-10K token cost only hits when you actually generate a document. Not loaded upfront with every conversation.\n\n## The MCP vs Skills Decision Framework\n\nI built this decision tree after migrating half my MCP servers to Skills:\n\n### Use MCP When:\n\n1. **External Services**: Database connections, API integrations, cloud services\n2. **Real-time Data**: Stock prices, weather, live metrics\n3. **Bidirectional Communication**: Writing to databases, posting to APIs\n4. **Complex State Management**: Multi-step transactions, session management\n5. **System Operations**: Docker, git operations requiring persistent state\n\n**Example**: Context7 MCP server for documentation lookup. Needs live search across external indexes. Can't be pre-loaded as static instructions.\n\n### Use Skills When:\n\n1. **Document Generation**: Excel, PowerPoint, PDF creation\n2. **Deterministic Workflows**: Code formatting, file processing, data transformation\n3. **Reusable Expertise**: Design patterns, coding standards, analysis frameworks\n4. **Template-based Tasks**: Report generation, document formatting\n5. **Offline Operations**: Everything can run in code execution environment\n\n**Example**: Frontend aesthetics Skill. Provides design guidance and font recommendations. No external dependencies. Pure instruction set.\n\n## POC: Frontend Aesthetics Skill\n\nHere's a complete Skill I extracted from Anthropic's cookbook. This one guides Claude to generate distinctive UI designs instead of generic \"AI slop.\"\n\n### Skill Frontmatter (Tier 1 Metadata)\n\n```yaml\nname: frontend-aesthetics\ndescription: Creates distinctive, creative frontend designs with intentional typography, color, and motion choices. Use when generating HTML/CSS/JS interfaces to avoid generic, cookie-cutter designs.\n```\n\n### Skill Instructions (Tier 2 Content)\n\nThe full instruction set (approximately 2K tokens) includes typography, color, motion, and background guidance:\n\n**Typography Guidelines:**\n| Avoid | Use Instead |\n|-------|-------------|\n| Inter, Roboto, Open Sans, Lato | Code: JetBrains Mono, Fira Code, Space Grotesk |\n| Default system fonts | Editorial: Playfair Display, Crimson Pro, Fraunces |\n| Overused sans-serifs | Startup: Clash Display, Satoshi, Cabinet Grotesk |\n\n**Typography Principles:**\n- High contrast in font pairings\n- Extreme font weights (100/200 vs 800/900)\n- Size jumps of 3x or more\n- Choose one distinctive font and use it decisively\n\n**Color & Theme:**\n| Avoid | Use |\n|-------|-----|\n| Purple gradients on white backgrounds | CSS variables for cohesive themes |\n| Generic blue/gray corporate palettes | Layered gradients for depth |\n| Single flat colors with no depth | Context-specific color stories |\n\n**Motion:**\n- Focus on high-impact moments, not scattered micro-interactions\n- CSS-only animations for performance\n- Lightweight libraries (Motion for React)\n\n**Implementation Example:**\n\n```html\n\u003Clink href=\"https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;700&display=swap\" rel=\"stylesheet\">\n```\n\n```css\n:root {\n  --color-primary: #your-choice;\n  --color-secondary: #your-choice;\n  --font-display: 'Space Grotesk', sans-serif;\n}\n```\n\n### Usage\n\nThis Skill gets prepended to frontend generation requests:\n\n```python\nfrom anthropic import Anthropic\n\nclient = Anthropic(api_key=API_KEY)\n\nresponse = client.beta.messages.create(\n    model=\"claude-sonnet-4-5\",\n    max_tokens=4096,\n    container={\n        \"skills\": [{\n            \"type\": \"custom\",\n            \"skill_id\": \"frontend-aesthetics\"\n        }]\n    },\n    messages=[{\n        \"role\": \"user\",\n        \"content\": \"Create a landing page for a climate tech startup\"\n    }]\n)\n```\n\nThe Skill loads only when triggered. Zero upfront token cost. Full aesthetic guidance (approximately 2K tokens) loads when Claude sees frontend generation is needed.\n\n## Custom Skills: Authoring Patterns\n\nFrom the best practices documentation, here's how to write effective Skills:\n\n### 1. Metadata Design (Tier 1)\n\n```yaml\n---\nname: your-skill-name              # Max 64 chars, lowercase, hyphens only\ndescription: Third-person description of what the skill does and when to use it. Include key terms that would trigger the skill. Max 1024 characters.\n---\n```\n\nThe description is critical. This is what Claude uses to decide whether to load the full Skill. Include:\n- What the Skill does\n- When to use it\n- Key domain terms\n- Specific use cases\n\n### 2. Progressive Disclosure (Tier 2 to Tier 3)\n\nKeep SKILL.md under 500 lines. Move detailed content to reference files:\n\n```markdown\n# Main Skill Instructions\n\n[Core workflow and examples here]\n\n## Additional Resources\n\nFor detailed library comparisons, see [reference/pdf_libraries.md](reference/pdf_libraries.md).\n\nFor common patterns, see [reference/common_patterns.md](reference/common_patterns.md).\n```\n\nClaude navigates this like a filesystem. It reads reference files only when needed.\n\n### 3. Workflow Patterns\n\nStructure complex tasks as explicit workflows:\n\n```markdown\n## Workflow: Multi-step Document Processing\n\n1. **Validate Input**\n   - Check file exists\n   - Verify PDF format\n   - Confirm page count\n\n2. **Extract Content**\n   ```python\n   import pdfplumber\n\n   with pdfplumber.open(\"file.pdf\") as pdf:\n       text = pdf.pages[0].extract_text()\n   ```\n\n3. **Process Data**\n   - Parse extracted text\n   - Identify form fields\n   - Validate data structure\n\n4. **Generate Output**\n   - Fill form with processed data\n   - Save modified PDF\n   - Verify output integrity\n```\n\nThis gives Claude a clear execution path. Reduces token waste on deciding \"what to do next.\"\n\n### 4. Utility Scripts (Part of Tier 3)\n\nProvide executable scripts for deterministic operations:\n\n```python\n# scripts/extract_text.py\n\nimport sys\nimport pdfplumber\n\ndef extract_text(pdf_path):\n    \"\"\"Extract all text from PDF file.\"\"\"\n    with pdfplumber.open(pdf_path) as pdf:\n        return \"\\n\\n\".join(\n            page.extract_text()\n            for page in pdf.pages\n        )\n\nif __name__ == \"__main__\":\n    if len(sys.argv) != 2:\n        print(\"Usage: python extract_text.py \u003Cpdf_file>\")\n        sys.exit(1)\n\n    result = extract_text(sys.argv[1])\n    print(result)\n```\n\nClaude can execute these directly instead of generating code each time. More reliable. Fewer tokens.\n\n## Token Economics: Real Numbers\n\nI tracked token usage across 100 conversations with various configurations:\n\n### MCP Server Configuration (3 servers)\n\n- Startup tokens: 32,450\n- Tools loaded: filesystem, context7, github\n- Token overhead per message: 0 (already loaded)\n- Total upfront cost: 32,450 tokens\n\n### Skills Configuration (5 Skills)\n\n- Startup tokens: 487 (metadata only)\n- Skills available: document-generator, frontend-aesthetics, pdf-processing, git-workflow, code-formatter\n- Average trigger cost: 3,200 tokens (when Skill loads)\n- Skills triggered per conversation: 1.3 average\n- Average total cost: 4,647 tokens (487 + 3200 × 1.3)\n\n**Savings: 27,803 tokens per conversation** (85.7% reduction)\n\nThis matters when you hit Claude's 200K token context window. Every token saved in startup costs = more room for actual conversation.\n\n## What Doesn't Work (Failures That Cost Me Hours)\n\nAfter converting 15+ workflows from MCP to Skills, here's what I learned the hard way—including the mistakes that cost me real debugging time:\n\n### 1. Network Access Limitations\n\nSkills run in code execution environment. No direct network access. This fails:\n\n```python\n# THIS DOESN'T WORK IN SKILLS\nimport requests\n\nresponse = requests.get(\"https://api.example.com/data\")\n```\n\n**Workaround**: Use MCP server for network operations. Use Skills for processing the data after retrieval.\n\n### 2. Skill Versioning Issues\n\nSkills use semantic versioning:\n\n```python\n\"skill_id\": \"xlsx\",\n\"version\": \"latest\"  # Can change unexpectedly\n```\n\nUsing \"latest\" means Anthropic can update the Skill between your runs. I've seen:\n- Changed output formats\n- Different chart styles\n- Modified default behavior\n\n**Workaround**: Pin to specific version in production:\n\n```python\n\"version\": \"1.2.0\"  # Explicit version\n```\n\n### 3. claude.ai vs API Differences\n\nSkills work differently between claude.ai web interface and API:\n\n**claude.ai:**\n- All Anthropic-managed Skills available automatically\n- Custom Skills require upload to workspace\n- Skills shared across workspace members\n\n**API:**\n- Must explicitly declare Skills in container\n- Custom Skills loaded from filesystem\n- No automatic discovery\n\n**Workaround**: Test in both environments. Don't assume behavior transfers.\n\n### 4. File Lifetime Limitations\n\nGenerated files expire quickly on Anthropic's servers:\n\n```python\n# File is available for ~1 hour\nfile_id = response.content[1].file_id\nfile_content = client.files.content(file_id=file_id)\n\n# Download immediately, don't store file_id\nwith open(\"output.xlsx\", \"wb\") as f:\n    f.write(file_content.content)\n```\n\n**Workaround**: Download files immediately. Don't try to retrieve file_id later.\n\n### 5. Complex Document Limitations\n\nDocument generation Skills work best with 2-3 sheets/slides. Beyond that, reliability drops:\n\n**Works reliably:**\n- 2-3 Excel sheets per workbook\n- 3-5 PowerPoint slides per presentation\n- Simple PDF reports (5-10 pages)\n\n**Degrades:**\n- 10+ Excel sheets with complex formulas\n- 20+ slide presentations with many charts\n- PDF documents with complex layouts\n\n**Workaround**: Generate multiple focused files instead of one massive file.\n\n## Migration Path: MCP to Skills\n\nHere's the exact process I used to migrate workflows:\n\n### Step 1: Identify Candidates\n\nGood candidates for Skills:\n- No external API dependencies\n- Deterministic outputs\n- Template-based workflows\n- Reusable instruction sets\n\nBad candidates:\n- Database operations\n- Real-time data fetching\n- State management across sessions\n- Complex authentication flows\n\n### Step 2: Extract Core Instructions\n\nFrom MCP server's tool schema:\n\n```json\n{\n  \"name\": \"format_code\",\n  \"description\": \"Formats code using Prettier with custom rules\",\n  \"inputSchema\": {\n    \"type\": \"object\",\n    \"properties\": {\n      \"code\": {\"type\": \"string\"},\n      \"language\": {\"type\": \"string\"}\n    }\n  }\n}\n```\n\nTo Skill:\n\n```markdown\n---\nname: code-formatter\ndescription: Formats code using Prettier with ACIDBATH style rules. Use for JavaScript, TypeScript, CSS, HTML, Markdown formatting.\n---\n\n# Code Formatting Skill\n\n## Workflow\n\n1. Identify language from file extension or user input\n2. Apply Prettier with custom configuration\n3. Return formatted code\n\n## Configuration\n\n```json\n{\n  \"printWidth\": 100,\n  \"tabWidth\": 2,\n  \"useTabs\": false,\n  \"semi\": true,\n  \"singleQuote\": false,\n  \"trailingComma\": \"es5\"\n}\n```\n\n## Execution\n\n```bash\n# Install if needed\nnpm install -g prettier\n\n# Format file\nprettier --write --config .prettierrc file.js\n```\n```\n\n### Step 3: Test Across Models\n\nSkills behavior varies by model:\n\n- **Haiku**: Faster, cheaper, less reliable for complex workflows\n- **Sonnet**: Balanced performance and cost\n- **Opus**: Best accuracy, highest cost\n\nTest your Skill with all three. Adjust instructions based on results.\n\n### Step 4: Monitor Token Usage\n\nTrack before/after:\n\n```python\nresponse = client.beta.messages.create(...)\n\nprint(f\"Input tokens: {response.usage.input_tokens}\")\nprint(f\"Output tokens: {response.usage.output_tokens}\")\n```\n\nCompare against previous MCP implementation. Skills should reduce total context.\n\n## Try It Now (20 Minutes to Your First Skill)\n\nHere's your immediate action to test Skills architecture. You'll see the token savings in your first run:\n\n### 1. Create Your First Skill\n\nPick a workflow you repeat often. Create a SKILL.md file:\n\n```markdown\n---\nname: your-workflow-name\ndescription: What this Skill does and when to use it. Include key trigger terms.\n---\n\n# Your Workflow Name\n\n[Your instructions here]\n```\n\n### 2. Test Progressive Loading\n\nAdd reference files:\n\n```\nyour-workflow/\n├── SKILL.md\n└── reference/\n    └── detailed_guide.md\n```\n\nLink from SKILL.md:\n\n```markdown\nFor detailed examples, see [reference/detailed_guide.md](reference/detailed_guide.md).\n```\n\nWatch Claude's token usage. It should only load detailed_guide.md when explicitly needed.\n\n### 3. Compare Token Costs\n\nRun the same task with:\n1. No Skill (pure prompt)\n2. Skill-based approach\n\nMeasure token difference using `response.usage.input_tokens`.\n\n### 4. Evaluate MCP Migration\n\nFor each MCP server you run:\n- Does it need network access? Keep as MCP.\n- Does it use external services? Keep as MCP.\n- Is it pure instruction/workflow? Migrate to Skill.\n\n## When to Combine Skills and MCP\n\nThe most powerful setup uses both:\n\n**MCP for Data Access:**\n```python\n# MCP server fetches data\ntools = [{\n    \"type\": \"mcp\",\n    \"server\": \"database\",\n    \"name\": \"query_sales_data\"\n}]\n```\n\n**Skills for Data Processing:**\n```python\ncontainer = {\n    \"skills\": [{\n        \"type\": \"anthropic\",\n        \"skill_id\": \"xlsx\"\n    }]\n}\n```\n\n**Combined Workflow:**\n1. MCP server queries database for sales data\n2. Skills generate formatted Excel report\n3. MCP server saves to cloud storage\n\nEach component handles what it does best. MCP for I/O. Skills for transformation and generation.\n\n## Final Metrics\n\nFrom 6 months of production use:\n\n**Skills Architecture Benefits:**\n- 85% token reduction vs full MCP setup\n- 95% success rate for document generation\n- 40-120 second generation time per document\n- Works across claude.ai and API environments\n\n**Skills Architecture Limitations:**\n- No network access\n- File expiration (download immediately)\n- Best for 2-3 sheets/slides per document\n- Version instability with \"latest\"\n\n**Optimal Configuration:**\n- MCP for external services and real-time data\n- Skills for document generation and workflows\n- Custom Skills for domain-specific expertise\n- Progressive disclosure for complex instructions\n\nThe token economics speak for themselves. Skills load 100 tokens upfront. MCP loads 10K-15K. For document generation and deterministic workflows, Skills win decisively.\n\n**100 tokens vs 15,000 tokens. That's not an optimization. That's a different architecture.**\n\nFor external services and real-time data, MCP still wins. But for everything else? Skills are the future of context-efficient AI tooling.\n\nSee our [Context Engineering](/context-engineering) post for details on MCP token consumption patterns. See [AI Document Skills](/document-generation-skills) for the complete Excel/PowerPoint/PDF generation pipeline.\n\n---\n\n**Working code in this post:**\n- Document generation with Skills API\n- Frontend aesthetics Skill configuration\n- Custom Skill authoring patterns\n- Token usage measurement scripts\n\nAll examples tested with Claude Sonnet 4.5 on 2025-12-23.","src/content/blog/claude-skills-deep-dive.md","b7d0725af7ed15b1",{"html":498,"metadata":499},"\u003Cp>Skills use 100 tokens of metadata. Then load instructions only when triggered.\u003C/p>\n\u003Cp>That’s a 99% reduction in upfront context cost compared to MCP servers. If you’ve been burning 10K-15K tokens on tool loading before your first message even lands, this is the architectural fix you didn’t know existed.\u003C/p>\n\u003Cp>Here’s why it matters and when Skills should replace your MCP servers.\u003C/p>\n\u003Ch2 id=\"the-token-economics-problem\">The Token Economics Problem\u003C/h2>\n\u003Cp>I spent six months building MCP servers for everything. Context engineering, filesystem operations, web scraping. Every MCP server adds 10K-15K tokens to your context window upfront. Before Claude reads a single message.\u003C/p>\n\u003Cp>Four MCP servers? That’s 40,000-60,000 tokens consumed before you type “hello.” On a 200K context window, you’ve burned 20-30% of your budget on overhead.\u003C/p>\n\u003Cp>Then I discovered Skills. Same progressive disclosure pattern I use in my context engineering work, but built into Claude’s architecture. The difference is dramatic.\u003C/p>\n\u003Cp>Here’s the data:\u003C/p>\n\u003Cp>\u003Cstrong>MCP Token Cost (Upfront)\u003C/strong>\u003C/p>\n\u003Cul>\n\u003Cli>Server registration: ~2K tokens\u003C/li>\n\u003Cli>Tool schemas: ~8K-13K tokens per server\u003C/li>\n\u003Cli>Total before first message: 10K-15K tokens\u003C/li>\n\u003C/ul>\n\u003Cp>\u003Cstrong>Skills Token Cost (Progressive)\u003C/strong>\u003C/p>\n\u003Cul>\n\u003Cli>Metadata at startup: ~100 tokens (64 char name + 1024 char description)\u003C/li>\n\u003Cli>Full instructions when triggered: &#x3C;5K tokens\u003C/li>\n\u003Cli>Reference files: 0 tokens until read\u003C/li>\n\u003C/ul>\n\u003Cp>The difference? Skills load on-demand. MCP loads everything upfront.\u003C/p>\n\u003Ch2 id=\"how-skills-architecture-works\">How Skills Architecture Works\u003C/h2>\n\u003Cp>Skills use a 3-tier progressive loading system. Here’s the exact structure:\u003C/p>\n\u003Cp>\u003Cimg src=\"/assets/posts/in-post/v2-skills-tiers.png\" alt=\"Skills 3-Tier Architecture\">\u003C/p>\n\u003Ch3 id=\"tier-1-metadata-loaded-at-startup\">Tier 1: Metadata (Loaded at Startup)\u003C/h3>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"5\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">YAML\u003C/span>\u003Cspan class=\"language-badge\">yaml\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container with-line-numbers\" data-language=\"yaml\" data-line-count=\"5\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Clink rel=\"stylesheet\" href=\"/_astro/ec.44wa8.css\">\u003Cscript type=\"module\" src=\"/_astro/ec.0vx5m.js\">\u003C/script>\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"yaml\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">---\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">name\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">pdf-processing\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">description\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">Extracts text and tables from PDF files, fills forms, and merges documents. Use when working with PDF documents that need text extraction, form filling, or document manipulation.\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">---\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"---name: pdf-processingdescription: Extracts text and tables from PDF files, fills forms, and merges documents. Use when working with PDF documents that need text extraction, form filling, or document manipulation.---\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003C/div>\u003C/div>\n\u003Cp>This costs approximately 100 tokens. Claude loads this metadata for all available Skills at startup. The name (max 64 characters) and description (max 1024 characters) tell Claude when to trigger the Skill.\u003C/p>\n\u003Ch3 id=\"tier-2-full-instructions-loaded-on-trigger\">Tier 2: Full Instructions (Loaded on Trigger)\u003C/h3>\n\u003Cp>When Claude decides the Skill is relevant, it loads the full SKILL.md file. This contains:\u003C/p>\n\u003Cul>\n\u003Cli>Detailed workflow instructions\u003C/li>\n\u003Cli>Code examples\u003C/li>\n\u003Cli>Validation steps\u003C/li>\n\u003Cli>Error handling patterns\u003C/li>\n\u003Cli>Links to reference files\u003C/li>\n\u003C/ul>\n\u003Cp>Recommended maximum: 500 lines. Typically costs &#x3C;5K tokens.\u003C/p>\n\u003Ch3 id=\"tier-3-reference-files-loaded-on-demand\">Tier 3: Reference Files (Loaded on Demand)\u003C/h3>\n\u003Cp>Skills can reference additional files using the directory structure:\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"10\">\u003Cdiv class=\"code-block-container with-line-numbers\" data-language=\"\" data-line-count=\"10\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"plaintext\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">pdf-processing/\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">├── SKILL.md                    # Main instructions\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">├── scripts/\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">│   ├── extract_text.py        # Utility script\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">│   ├── fill_form.py           # Utility script\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">│   └── merge_pdfs.py          # Utility script\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">└── reference/\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">├── pdf_libraries.md       # Library comparison\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">└── common_patterns.md     # Usage patterns\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"pdf-processing/├── SKILL.md                    # Main instructions├── scripts/│   ├── extract_text.py        # Utility script│   ├── fill_form.py           # Utility script│   └── merge_pdfs.py          # Utility script└── reference/    ├── pdf_libraries.md       # Library comparison    └── common_patterns.md     # Usage patterns\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003C/div>\u003C/div>\n\u003Cp>Claude reads these files only when explicitly needed. Zero token cost until accessed.\u003C/p>\n\u003Ch2 id=\"working-example-document-generation-skill\">Working Example: Document Generation Skill\u003C/h2>\n\u003Cp>Here’s a real Skill from Anthropic’s cookbook that generates Excel, PowerPoint, and PDF files:\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"81\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">MARKDOWN\u003C/span>\u003Cspan class=\"language-badge\">markdown\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container collapsible with-line-numbers\" data-language=\"markdown\" data-line-count=\"81\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cbutton class=\"collapse-toggle\" aria-label=\"Toggle code visibility\" type=\"button\">\u003Cspan class=\"expand-text\">Expand (81 lines)\u003C/span>\u003Cspan class=\"collapse-text\">Collapse\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"markdown\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">---\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">name\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">document-generator\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">description\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">Creates professional Excel spreadsheets, PowerPoint presentations, and PDF documents with charts, formulas, and formatting. Use for financial reports, dashboards, presentations, or any structured document generation.\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">---\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#79B8FF;--0fw:bold;--1:#005CC5;--1fw:bold\"># Document Generation Skill\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#79B8FF;--0fw:bold;--1:#005CC5;--1fw:bold\">## Capabilities\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">1.\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Excel (.xlsx): Multi-sheet workbooks with formulas, charts, conditional formatting\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">2.\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> PowerPoint (.pptx): Professional presentations with data-driven slides\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">3.\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> PDF: Structured documents with tables and visualizations\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#79B8FF;--0fw:bold;--1:#005CC5;--1fw:bold\">## Workflow\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#79B8FF;--0fw:bold;--1:#005CC5;--1fw:bold\">### For Excel Generation\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">1.\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Analyze data requirements\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">2.\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Create message with xlsx skill\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">3.\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Include specific formatting needs\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">4.\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Generate and download file\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#79B8FF;--0fw:bold;--1:#005CC5;--1fw:bold\">### For PowerPoint Generation\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">1.\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Define presentation structure\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">2.\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Specify slide content and layout\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">3.\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Include chart/visualization needs\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">4.\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Generate and download file\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#79B8FF;--0fw:bold;--1:#005CC5;--1fw:bold\">## Code Examples\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#79B8FF;--0fw:bold;--1:#005CC5;--1fw:bold\">### Excel with Charts\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">```python\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">from\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> anthropic \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">import\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Anthropic\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">client \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Anthropic(\u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">api_key\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">API_KEY\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">response \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> client.beta.messages.create(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">model\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"claude-sonnet-4-5\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">max_tokens\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">4096\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">container\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"skills\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: [{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">            \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"type\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"anthropic\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">            \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"skill_id\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"xlsx\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">            \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"version\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"latest\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">}]\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">},\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">tools\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">[{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"type\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"code_execution_20250825\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"name\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"code_execution\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">}],\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">messages\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">[{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"role\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"user\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"content\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\"\"Create an Excel workbook with quarterly revenue data:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">Q1: $12.3M revenue, $1.2M net income\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">Q2: $13.1M revenue, $1.5M net income\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">Q3: $13.8M revenue, $1.7M net income\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">Q4: $14.5M revenue, $1.88M net income\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">Include:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">- Formatted data table\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">- Revenue trend chart\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">- YoY growth calculations\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">- Conditional formatting for growth\"\"\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">}],\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">betas\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">[\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"code-execution-2025-08-25\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"files-api-2025-04-14\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"skills-2025-10-02\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">]\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Download generated file\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">file_id \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> response.content[\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">1\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">].file_id\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">file_content \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> client.files.content(\u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">file_id\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">file_id)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">with\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">open\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"quarterly_report.xlsx\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"wb\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">) \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">as\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> f:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">f.write(file_content.content)\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"---name: document-generatordescription: Creates professional Excel spreadsheets, PowerPoint presentations, and PDF documents with charts, formulas, and formatting. Use for financial reports, dashboards, presentations, or any structured document generation.---# Document Generation Skill## Capabilities1. Excel (.xlsx): Multi-sheet workbooks with formulas, charts, conditional formatting2. PowerPoint (.pptx): Professional presentations with data-driven slides3. PDF: Structured documents with tables and visualizations## Workflow### For Excel Generation1. Analyze data requirements2. Create message with xlsx skill3. Include specific formatting needs4. Generate and download file### For PowerPoint Generation1. Define presentation structure2. Specify slide content and layout3. Include chart/visualization needs4. Generate and download file## Code Examples### Excel with Charts&#x60;&#x60;&#x60;pythonfrom anthropic import Anthropicclient = Anthropic(api_key=API_KEY)response = client.beta.messages.create(    model=&#x22;claude-sonnet-4-5&#x22;,    max_tokens=4096,    container={        &#x22;skills&#x22;: [{            &#x22;type&#x22;: &#x22;anthropic&#x22;,            &#x22;skill_id&#x22;: &#x22;xlsx&#x22;,            &#x22;version&#x22;: &#x22;latest&#x22;        }]    },    tools=[{        &#x22;type&#x22;: &#x22;code_execution_20250825&#x22;,        &#x22;name&#x22;: &#x22;code_execution&#x22;    }],    messages=[{        &#x22;role&#x22;: &#x22;user&#x22;,        &#x22;content&#x22;: &#x22;&#x22;&#x22;Create an Excel workbook with quarterly revenue data:Q1: $12.3M revenue, $1.2M net incomeQ2: $13.1M revenue, $1.5M net incomeQ3: $13.8M revenue, $1.7M net incomeQ4: $14.5M revenue, $1.88M net incomeInclude:- Formatted data table- Revenue trend chart- YoY growth calculations- Conditional formatting for growth&#x22;&#x22;&#x22;    }],    betas=[        &#x22;code-execution-2025-08-25&#x22;,        &#x22;files-api-2025-04-14&#x22;,        &#x22;skills-2025-10-02&#x22;    ])# Download generated filefile_id = response.content[1].file_idfile_content = client.files.content(file_id=file_id)with open(&#x22;quarterly_report.xlsx&#x22;, &#x22;wb&#x22;) as f:    f.write(file_content.content)\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003Cdiv class=\"code-fade\" aria-hidden=\"true\">\u003C/div>\u003C/div>\u003C/div>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"47\">\u003Cdiv class=\"code-block-container collapsible with-line-numbers\" data-language=\"\" data-line-count=\"47\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cbutton class=\"collapse-toggle\" aria-label=\"Toggle code visibility\" type=\"button\">\u003Cspan class=\"expand-text\">Expand (47 lines)\u003C/span>\u003Cspan class=\"collapse-text\">Collapse\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"plaintext\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">### Performance Data\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">From testing across 50+ document generations:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">- Excel files: 1-2 minutes generation time\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">- PowerPoint presentations: 1-2 minutes\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">- PDF documents: 40-60 seconds\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">- Token usage: 5K-10K tokens per generation\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">- Success rate: 95% for 2-3 sheet/slide documents\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">The Skill architecture means this 5K-10K token cost only hits when you actually generate a document. Not loaded upfront with every conversation.\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">## The MCP vs Skills Decision Framework\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">I built this decision tree after migrating half my MCP servers to Skills:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">### Use MCP When:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">1. **External Services**: Database connections, API integrations, cloud services\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">2. **Real-time Data**: Stock prices, weather, live metrics\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">3. **Bidirectional Communication**: Writing to databases, posting to APIs\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">4. **Complex State Management**: Multi-step transactions, session management\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">5. **System Operations**: Docker, git operations requiring persistent state\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">**Example**: Context7 MCP server for documentation lookup. Needs live search across external indexes. Can't be pre-loaded as static instructions.\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">### Use Skills When:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">1. **Document Generation**: Excel, PowerPoint, PDF creation\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">2. **Deterministic Workflows**: Code formatting, file processing, data transformation\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">3. **Reusable Expertise**: Design patterns, coding standards, analysis frameworks\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">4. **Template-based Tasks**: Report generation, document formatting\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">5. **Offline Operations**: Everything can run in code execution environment\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">**Example**: Frontend aesthetics Skill. Provides design guidance and font recommendations. No external dependencies. Pure instruction set.\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">## POC: Frontend Aesthetics Skill\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">Here's a complete Skill I extracted from Anthropic's cookbook. This one guides Claude to generate distinctive UI designs instead of generic \"AI slop.\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">### Skill Frontmatter (Tier 1 Metadata)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">```yaml\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">name: frontend-aesthetics\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">description: Creates distinctive, creative frontend designs with intentional typography, color, and motion choices. Use when generating HTML/CSS/JS interfaces to avoid generic, cookie-cutter designs.\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"### Performance DataFrom testing across 50+ document generations:- Excel files: 1-2 minutes generation time- PowerPoint presentations: 1-2 minutes- PDF documents: 40-60 seconds- Token usage: 5K-10K tokens per generation- Success rate: 95% for 2-3 sheet/slide documentsThe Skill architecture means this 5K-10K token cost only hits when you actually generate a document. Not loaded upfront with every conversation.## The MCP vs Skills Decision FrameworkI built this decision tree after migrating half my MCP servers to Skills:### Use MCP When:1. **External Services**: Database connections, API integrations, cloud services2. **Real-time Data**: Stock prices, weather, live metrics3. **Bidirectional Communication**: Writing to databases, posting to APIs4. **Complex State Management**: Multi-step transactions, session management5. **System Operations**: Docker, git operations requiring persistent state**Example**: Context7 MCP server for documentation lookup. Needs live search across external indexes. Can&#x27;t be pre-loaded as static instructions.### Use Skills When:1. **Document Generation**: Excel, PowerPoint, PDF creation2. **Deterministic Workflows**: Code formatting, file processing, data transformation3. **Reusable Expertise**: Design patterns, coding standards, analysis frameworks4. **Template-based Tasks**: Report generation, document formatting5. **Offline Operations**: Everything can run in code execution environment**Example**: Frontend aesthetics Skill. Provides design guidance and font recommendations. No external dependencies. Pure instruction set.## POC: Frontend Aesthetics SkillHere&#x27;s a complete Skill I extracted from Anthropic&#x27;s cookbook. This one guides Claude to generate distinctive UI designs instead of generic &#x22;AI slop.&#x22;### Skill Frontmatter (Tier 1 Metadata)&#x60;&#x60;&#x60;yamlname: frontend-aestheticsdescription: Creates distinctive, creative frontend designs with intentional typography, color, and motion choices. Use when generating HTML/CSS/JS interfaces to avoid generic, cookie-cutter designs.\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003Cdiv class=\"code-fade\" aria-hidden=\"true\">\u003C/div>\u003C/div>\u003C/div>\n\u003Ch3 id=\"skill-instructions-tier-2-content\">Skill Instructions (Tier 2 Content)\u003C/h3>\n\u003Cp>The full instruction set (approximately 2K tokens) includes typography, color, motion, and background guidance:\u003C/p>\n\u003Cp>\u003Cstrong>Typography Guidelines:\u003C/strong>\u003C/p>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\u003Ctable>\u003Cthead>\u003Ctr>\u003Cth>Avoid\u003C/th>\u003Cth>Use Instead\u003C/th>\u003C/tr>\u003C/thead>\u003Ctbody>\u003Ctr>\u003Ctd>Inter, Roboto, Open Sans, Lato\u003C/td>\u003Ctd>Code: JetBrains Mono, Fira Code, Space Grotesk\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Default system fonts\u003C/td>\u003Ctd>Editorial: Playfair Display, Crimson Pro, Fraunces\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Overused sans-serifs\u003C/td>\u003Ctd>Startup: Clash Display, Satoshi, Cabinet Grotesk\u003C/td>\u003C/tr>\u003C/tbody>\u003C/table>\n\u003Cp>\u003Cstrong>Typography Principles:\u003C/strong>\u003C/p>\n\u003Cul>\n\u003Cli>High contrast in font pairings\u003C/li>\n\u003Cli>Extreme font weights (100/200 vs 800/900)\u003C/li>\n\u003Cli>Size jumps of 3x or more\u003C/li>\n\u003Cli>Choose one distinctive font and use it decisively\u003C/li>\n\u003C/ul>\n\u003Cp>\u003Cstrong>Color &#x26; Theme:\u003C/strong>\u003C/p>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\u003Ctable>\u003Cthead>\u003Ctr>\u003Cth>Avoid\u003C/th>\u003Cth>Use\u003C/th>\u003C/tr>\u003C/thead>\u003Ctbody>\u003Ctr>\u003Ctd>Purple gradients on white backgrounds\u003C/td>\u003Ctd>CSS variables for cohesive themes\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Generic blue/gray corporate palettes\u003C/td>\u003Ctd>Layered gradients for depth\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Single flat colors with no depth\u003C/td>\u003Ctd>Context-specific color stories\u003C/td>\u003C/tr>\u003C/tbody>\u003C/table>\n\u003Cp>\u003Cstrong>Motion:\u003C/strong>\u003C/p>\n\u003Cul>\n\u003Cli>Focus on high-impact moments, not scattered micro-interactions\u003C/li>\n\u003Cli>CSS-only animations for performance\u003C/li>\n\u003Cli>Lightweight libraries (Motion for React)\u003C/li>\n\u003C/ul>\n\u003Cp>\u003Cstrong>Implementation Example:\u003C/strong>\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"2\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">HTML\u003C/span>\u003Cspan class=\"language-badge\">html\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container with-line-numbers\" data-language=\"html\" data-line-count=\"2\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"html\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">link\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">href\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">=\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;700&#x26;display=swap\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">rel\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">=\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"stylesheet\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">>\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"\u003Clink href=&#x22;https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;700&#x26;display=swap&#x22; rel=&#x22;stylesheet&#x22;>\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003C/div>\u003C/div>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"6\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">CSS\u003C/span>\u003Cspan class=\"language-badge\">css\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container with-line-numbers\" data-language=\"css\" data-line-count=\"6\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"css\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">:root\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">--color-primary\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: #your-choice;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">--color-secondary\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: #your-choice;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">--font-display\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">'Space Grotesk'\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">sans-serif\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">}\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\":root {  --color-primary: #your-choice;  --color-secondary: #your-choice;  --font-display: &#x27;Space Grotesk&#x27;, sans-serif;}\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003C/div>\u003C/div>\n\u003Ch3 id=\"usage\">Usage\u003C/h3>\n\u003Cp>This Skill gets prepended to frontend generation requests:\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"19\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">PYTHON\u003C/span>\u003Cspan class=\"language-badge\">python\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container collapsible with-line-numbers\" data-language=\"python\" data-line-count=\"19\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cbutton class=\"collapse-toggle\" aria-label=\"Toggle code visibility\" type=\"button\">\u003Cspan class=\"expand-text\">Expand (19 lines)\u003C/span>\u003Cspan class=\"collapse-text\">Collapse\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"python\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">from\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> anthropic \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">import\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Anthropic\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">client \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Anthropic(\u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">api_key\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">API_KEY\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">response \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> client.beta.messages.create(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">model\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"claude-sonnet-4-5\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">max_tokens\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">4096\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">container\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"skills\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: [{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">            \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"type\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"custom\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">            \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"skill_id\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"frontend-aesthetics\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">}]\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">},\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">messages\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">[{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"role\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"user\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"content\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"Create a landing page for a climate tech startup\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">}]\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"from anthropic import Anthropicclient = Anthropic(api_key=API_KEY)response = client.beta.messages.create(    model=&#x22;claude-sonnet-4-5&#x22;,    max_tokens=4096,    container={        &#x22;skills&#x22;: [{            &#x22;type&#x22;: &#x22;custom&#x22;,            &#x22;skill_id&#x22;: &#x22;frontend-aesthetics&#x22;        }]    },    messages=[{        &#x22;role&#x22;: &#x22;user&#x22;,        &#x22;content&#x22;: &#x22;Create a landing page for a climate tech startup&#x22;    }])\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003Cdiv class=\"code-fade\" aria-hidden=\"true\">\u003C/div>\u003C/div>\u003C/div>\n\u003Cp>The Skill loads only when triggered. Zero upfront token cost. Full aesthetic guidance (approximately 2K tokens) loads when Claude sees frontend generation is needed.\u003C/p>\n\u003Ch2 id=\"custom-skills-authoring-patterns\">Custom Skills: Authoring Patterns\u003C/h2>\n\u003Cp>From the best practices documentation, here’s how to write effective Skills:\u003C/p>\n\u003Ch3 id=\"1-metadata-design-tier-1\">1. Metadata Design (Tier 1)\u003C/h3>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"5\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">YAML\u003C/span>\u003Cspan class=\"language-badge\">yaml\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container with-line-numbers\" data-language=\"yaml\" data-line-count=\"5\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"yaml\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">---\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">name\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">your-skill-name\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">              \u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Max 64 chars, lowercase, hyphens only\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">description\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">Third-person description of what the skill does and when to use it. Include key terms that would trigger the skill. Max 1024 characters.\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">---\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"---name: your-skill-name              # Max 64 chars, lowercase, hyphens onlydescription: Third-person description of what the skill does and when to use it. Include key terms that would trigger the skill. Max 1024 characters.---\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003C/div>\u003C/div>\n\u003Cp>The description is critical. This is what Claude uses to decide whether to load the full Skill. Include:\u003C/p>\n\u003Cul>\n\u003Cli>What the Skill does\u003C/li>\n\u003Cli>When to use it\u003C/li>\n\u003Cli>Key domain terms\u003C/li>\n\u003Cli>Specific use cases\u003C/li>\n\u003C/ul>\n\u003Ch3 id=\"2-progressive-disclosure-tier-2-to-tier-3\">2. Progressive Disclosure (Tier 2 to Tier 3)\u003C/h3>\n\u003Cp>Keep SKILL.md under 500 lines. Move detailed content to reference files:\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"10\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">MARKDOWN\u003C/span>\u003Cspan class=\"language-badge\">markdown\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container with-line-numbers\" data-language=\"markdown\" data-line-count=\"10\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"markdown\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#79B8FF;--0fw:bold;--1:#005CC5;--1fw:bold\"># Main Skill Instructions\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">[Core workflow and examples here]\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#79B8FF;--0fw:bold;--1:#005CC5;--1fw:bold\">## Additional Resources\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">For detailed library comparisons, see [\u003C/span>\u003Cspan style=\"--0:#DBEDFF;--0td:underline;--1:#032F62;--1td:underline\">reference/pdf_libraries.md\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">](\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--0td:underline;--1:#24292E;--1td:underline\">reference/pdf_libraries.md\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">).\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">For common patterns, see [\u003C/span>\u003Cspan style=\"--0:#DBEDFF;--0td:underline;--1:#032F62;--1td:underline\">reference/common_patterns.md\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">](\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--0td:underline;--1:#24292E;--1td:underline\">reference/common_patterns.md\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">).\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"# Main Skill Instructions[Core workflow and examples here]## Additional ResourcesFor detailed library comparisons, see [reference/pdf_libraries.md](reference/pdf_libraries.md).For common patterns, see [reference/common_patterns.md](reference/common_patterns.md).\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003C/div>\u003C/div>\n\u003Cp>Claude navigates this like a filesystem. It reads reference files only when needed.\u003C/p>\n\u003Ch3 id=\"3-workflow-patterns\">3. Workflow Patterns\u003C/h3>\n\u003Cp>Structure complex tasks as explicit workflows:\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"14\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">MARKDOWN\u003C/span>\u003Cspan class=\"language-badge\">markdown\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container with-line-numbers\" data-language=\"markdown\" data-line-count=\"14\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"markdown\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#79B8FF;--0fw:bold;--1:#005CC5;--1fw:bold\">## Workflow: Multi-step Document Processing\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">1.\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#E1E4E8;--0fw:bold;--1:#24292E;--1fw:bold\">**Validate Input**\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Check file exists\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Verify PDF format\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Confirm page count\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">2.\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#E1E4E8;--0fw:bold;--1:#24292E;--1fw:bold\">**Extract Content**\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">   \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">```python\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">import\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> pdfplumber\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">with\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> pdfplumber.open(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"file.pdf\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">) \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">as\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> pdf:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">       \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">text \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> pdf.pages[\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">0\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">].extract_text()\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"## Workflow: Multi-step Document Processing1. **Validate Input**   - Check file exists   - Verify PDF format   - Confirm page count2. **Extract Content**   &#x60;&#x60;&#x60;python   import pdfplumber   with pdfplumber.open(&#x22;file.pdf&#x22;) as pdf:       text = pdf.pages[0].extract_text()\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003C/div>\u003C/div>\n\u003Col start=\"3\">\n\u003Cli>\n\u003Cp>\u003Cstrong>Process Data\u003C/strong>\u003C/p>\n\u003Cul>\n\u003Cli>Parse extracted text\u003C/li>\n\u003Cli>Identify form fields\u003C/li>\n\u003Cli>Validate data structure\u003C/li>\n\u003C/ul>\n\u003C/li>\n\u003Cli>\n\u003Cp>\u003Cstrong>Generate Output\u003C/strong>\u003C/p>\n\u003Cul>\n\u003Cli>Fill form with processed data\u003C/li>\n\u003Cli>Save modified PDF\u003C/li>\n\u003Cli>Verify output integrity\u003C/li>\n\u003C/ul>\n\u003C/li>\n\u003C/ol>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"29\">\u003Cdiv class=\"code-block-container collapsible with-line-numbers\" data-language=\"\" data-line-count=\"29\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cbutton class=\"collapse-toggle\" aria-label=\"Toggle code visibility\" type=\"button\">\u003Cspan class=\"expand-text\">Expand (29 lines)\u003C/span>\u003Cspan class=\"collapse-text\">Collapse\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"plaintext\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">This gives Claude a clear execution path. Reduces token waste on deciding \"what to do next.\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">### 4. Utility Scripts (Part of Tier 3)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">Provide executable scripts for deterministic operations:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">```python\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\"># scripts/extract_text.py\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">import sys\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">import pdfplumber\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">def extract_text(pdf_path):\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">\"\"\"Extract all text from PDF file.\"\"\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">with pdfplumber.open(pdf_path) as pdf:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">return \"\\n\\n\".join(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">            \u003C/span>\u003C/span>\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">page.extract_text()\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">            \u003C/span>\u003C/span>\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">for page in pdf.pages\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">if __name__ == \"__main__\":\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">if len(sys.argv) != 2:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">print(\"Usage: python extract_text.py &#x3C;pdf_file>\")\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">sys.exit(1)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">result = extract_text(sys.argv[1])\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">print(result)\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"This gives Claude a clear execution path. Reduces token waste on deciding &#x22;what to do next.&#x22;### 4. Utility Scripts (Part of Tier 3)Provide executable scripts for deterministic operations:&#x60;&#x60;&#x60;python# scripts/extract_text.pyimport sysimport pdfplumberdef extract_text(pdf_path):    &#x22;&#x22;&#x22;Extract all text from PDF file.&#x22;&#x22;&#x22;    with pdfplumber.open(pdf_path) as pdf:        return &#x22;\\n\\n&#x22;.join(            page.extract_text()            for page in pdf.pages        )if __name__ == &#x22;__main__&#x22;:    if len(sys.argv) != 2:        print(&#x22;Usage: python extract_text.py \u003Cpdf_file>&#x22;)        sys.exit(1)    result = extract_text(sys.argv[1])    print(result)\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003Cdiv class=\"code-fade\" aria-hidden=\"true\">\u003C/div>\u003C/div>\u003C/div>\n\u003Cp>Claude can execute these directly instead of generating code each time. More reliable. Fewer tokens.\u003C/p>\n\u003Ch2 id=\"token-economics-real-numbers\">Token Economics: Real Numbers\u003C/h2>\n\u003Cp>I tracked token usage across 100 conversations with various configurations:\u003C/p>\n\u003Ch3 id=\"mcp-server-configuration-3-servers\">MCP Server Configuration (3 servers)\u003C/h3>\n\u003Cul>\n\u003Cli>Startup tokens: 32,450\u003C/li>\n\u003Cli>Tools loaded: filesystem, context7, github\u003C/li>\n\u003Cli>Token overhead per message: 0 (already loaded)\u003C/li>\n\u003Cli>Total upfront cost: 32,450 tokens\u003C/li>\n\u003C/ul>\n\u003Ch3 id=\"skills-configuration-5-skills\">Skills Configuration (5 Skills)\u003C/h3>\n\u003Cul>\n\u003Cli>Startup tokens: 487 (metadata only)\u003C/li>\n\u003Cli>Skills available: document-generator, frontend-aesthetics, pdf-processing, git-workflow, code-formatter\u003C/li>\n\u003Cli>Average trigger cost: 3,200 tokens (when Skill loads)\u003C/li>\n\u003Cli>Skills triggered per conversation: 1.3 average\u003C/li>\n\u003Cli>Average total cost: 4,647 tokens (487 + 3200 × 1.3)\u003C/li>\n\u003C/ul>\n\u003Cp>\u003Cstrong>Savings: 27,803 tokens per conversation\u003C/strong> (85.7% reduction)\u003C/p>\n\u003Cp>This matters when you hit Claude’s 200K token context window. Every token saved in startup costs = more room for actual conversation.\u003C/p>\n\u003Ch2 id=\"what-doesnt-work-failures-that-cost-me-hours\">What Doesn’t Work (Failures That Cost Me Hours)\u003C/h2>\n\u003Cp>After converting 15+ workflows from MCP to Skills, here’s what I learned the hard way—including the mistakes that cost me real debugging time:\u003C/p>\n\u003Ch3 id=\"1-network-access-limitations\">1. Network Access Limitations\u003C/h3>\n\u003Cp>Skills run in code execution environment. No direct network access. This fails:\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"5\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">PYTHON\u003C/span>\u003Cspan class=\"language-badge\">python\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container with-line-numbers\" data-language=\"python\" data-line-count=\"5\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"python\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># THIS DOESN'T WORK IN SKILLS\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">import\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> requests\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">response \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> requests.get(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"https://api.example.com/data\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"# THIS DOESN&#x27;T WORK IN SKILLSimport requestsresponse = requests.get(&#x22;https://api.example.com/data&#x22;)\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003C/div>\u003C/div>\n\u003Cp>\u003Cstrong>Workaround\u003C/strong>: Use MCP server for network operations. Use Skills for processing the data after retrieval.\u003C/p>\n\u003Ch3 id=\"2-skill-versioning-issues\">2. Skill Versioning Issues\u003C/h3>\n\u003Cp>Skills use semantic versioning:\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"3\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">PYTHON\u003C/span>\u003Cspan class=\"language-badge\">python\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container with-line-numbers\" data-language=\"python\" data-line-count=\"3\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"python\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"skill_id\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"xlsx\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"version\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"latest\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">  \u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Can change unexpectedly\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"&#x22;skill_id&#x22;: &#x22;xlsx&#x22;,&#x22;version&#x22;: &#x22;latest&#x22;  # Can change unexpectedly\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003C/div>\u003C/div>\n\u003Cp>Using “latest” means Anthropic can update the Skill between your runs. I’ve seen:\u003C/p>\n\u003Cul>\n\u003Cli>Changed output formats\u003C/li>\n\u003Cli>Different chart styles\u003C/li>\n\u003Cli>Modified default behavior\u003C/li>\n\u003C/ul>\n\u003Cp>\u003Cstrong>Workaround\u003C/strong>: Pin to specific version in production:\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"2\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">PYTHON\u003C/span>\u003Cspan class=\"language-badge\">python\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container with-line-numbers\" data-language=\"python\" data-line-count=\"2\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"python\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"version\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"1.2.0\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">  \u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Explicit version\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"&#x22;version&#x22;: &#x22;1.2.0&#x22;  # Explicit version\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003C/div>\u003C/div>\n\u003Ch3 id=\"3-claudeai-vs-api-differences\">3. claude.ai vs API Differences\u003C/h3>\n\u003Cp>Skills work differently between claude.ai web interface and API:\u003C/p>\n\u003Cp>\u003Cstrong>claude.ai:\u003C/strong>\u003C/p>\n\u003Cul>\n\u003Cli>All Anthropic-managed Skills available automatically\u003C/li>\n\u003Cli>Custom Skills require upload to workspace\u003C/li>\n\u003Cli>Skills shared across workspace members\u003C/li>\n\u003C/ul>\n\u003Cp>\u003Cstrong>API:\u003C/strong>\u003C/p>\n\u003Cul>\n\u003Cli>Must explicitly declare Skills in container\u003C/li>\n\u003Cli>Custom Skills loaded from filesystem\u003C/li>\n\u003Cli>No automatic discovery\u003C/li>\n\u003C/ul>\n\u003Cp>\u003Cstrong>Workaround\u003C/strong>: Test in both environments. Don’t assume behavior transfers.\u003C/p>\n\u003Ch3 id=\"4-file-lifetime-limitations\">4. File Lifetime Limitations\u003C/h3>\n\u003Cp>Generated files expire quickly on Anthropic’s servers:\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"8\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">PYTHON\u003C/span>\u003Cspan class=\"language-badge\">python\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container with-line-numbers\" data-language=\"python\" data-line-count=\"8\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"python\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># File is available for ~1 hour\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">file_id \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> response.content[\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">1\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">].file_id\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">file_content \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> client.files.content(\u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">file_id\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">file_id)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Download immediately, don't store file_id\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">with\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">open\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"output.xlsx\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"wb\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">) \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">as\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> f:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">f.write(file_content.content)\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"# File is available for ~1 hourfile_id = response.content[1].file_idfile_content = client.files.content(file_id=file_id)# Download immediately, don&#x27;t store file_idwith open(&#x22;output.xlsx&#x22;, &#x22;wb&#x22;) as f:    f.write(file_content.content)\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003C/div>\u003C/div>\n\u003Cp>\u003Cstrong>Workaround\u003C/strong>: Download files immediately. Don’t try to retrieve file_id later.\u003C/p>\n\u003Ch3 id=\"5-complex-document-limitations\">5. Complex Document Limitations\u003C/h3>\n\u003Cp>Document generation Skills work best with 2-3 sheets/slides. Beyond that, reliability drops:\u003C/p>\n\u003Cp>\u003Cstrong>Works reliably:\u003C/strong>\u003C/p>\n\u003Cul>\n\u003Cli>2-3 Excel sheets per workbook\u003C/li>\n\u003Cli>3-5 PowerPoint slides per presentation\u003C/li>\n\u003Cli>Simple PDF reports (5-10 pages)\u003C/li>\n\u003C/ul>\n\u003Cp>\u003Cstrong>Degrades:\u003C/strong>\u003C/p>\n\u003Cul>\n\u003Cli>10+ Excel sheets with complex formulas\u003C/li>\n\u003Cli>20+ slide presentations with many charts\u003C/li>\n\u003Cli>PDF documents with complex layouts\u003C/li>\n\u003C/ul>\n\u003Cp>\u003Cstrong>Workaround\u003C/strong>: Generate multiple focused files instead of one massive file.\u003C/p>\n\u003Ch2 id=\"migration-path-mcp-to-skills\">Migration Path: MCP to Skills\u003C/h2>\n\u003Cp>Here’s the exact process I used to migrate workflows:\u003C/p>\n\u003Ch3 id=\"step-1-identify-candidates\">Step 1: Identify Candidates\u003C/h3>\n\u003Cp>Good candidates for Skills:\u003C/p>\n\u003Cul>\n\u003Cli>No external API dependencies\u003C/li>\n\u003Cli>Deterministic outputs\u003C/li>\n\u003Cli>Template-based workflows\u003C/li>\n\u003Cli>Reusable instruction sets\u003C/li>\n\u003C/ul>\n\u003Cp>Bad candidates:\u003C/p>\n\u003Cul>\n\u003Cli>Database operations\u003C/li>\n\u003Cli>Real-time data fetching\u003C/li>\n\u003Cli>State management across sessions\u003C/li>\n\u003Cli>Complex authentication flows\u003C/li>\n\u003C/ul>\n\u003Ch3 id=\"step-2-extract-core-instructions\">Step 2: Extract Core Instructions\u003C/h3>\n\u003Cp>From MCP server’s tool schema:\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"12\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">JSON\u003C/span>\u003Cspan class=\"language-badge\">json\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container with-line-numbers\" data-language=\"json\" data-line-count=\"12\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"json\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">\"name\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"format_code\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">\"description\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"Formats code using Prettier with custom rules\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">\"inputSchema\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">\"type\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"object\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">\"properties\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">\"code\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: {\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">\"type\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"string\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">},\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">\"language\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: {\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">\"type\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"string\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">}\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"{  &#x22;name&#x22;: &#x22;format_code&#x22;,  &#x22;description&#x22;: &#x22;Formats code using Prettier with custom rules&#x22;,  &#x22;inputSchema&#x22;: {    &#x22;type&#x22;: &#x22;object&#x22;,    &#x22;properties&#x22;: {      &#x22;code&#x22;: {&#x22;type&#x22;: &#x22;string&#x22;},      &#x22;language&#x22;: {&#x22;type&#x22;: &#x22;string&#x22;}    }  }}\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003C/div>\u003C/div>\n\u003Cp>To Skill:\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"25\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">MARKDOWN\u003C/span>\u003Cspan class=\"language-badge\">markdown\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container collapsible with-line-numbers\" data-language=\"markdown\" data-line-count=\"25\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cbutton class=\"collapse-toggle\" aria-label=\"Toggle code visibility\" type=\"button\">\u003Cspan class=\"expand-text\">Expand (25 lines)\u003C/span>\u003Cspan class=\"collapse-text\">Collapse\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"markdown\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">---\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">name\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">code-formatter\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">description\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">Formats code using Prettier with ACIDBATH style rules. Use for JavaScript, TypeScript, CSS, HTML, Markdown formatting.\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">---\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#79B8FF;--0fw:bold;--1:#005CC5;--1fw:bold\"># Code Formatting Skill\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#79B8FF;--0fw:bold;--1:#005CC5;--1fw:bold\">## Workflow\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">1.\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Identify language from file extension or user input\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">2.\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Apply Prettier with custom configuration\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">3.\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Return formatted code\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#79B8FF;--0fw:bold;--1:#005CC5;--1fw:bold\">## Configuration\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">```json\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">\"printWidth\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">100\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">\"tabWidth\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">2\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">\"useTabs\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">false\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">\"semi\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">true\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">\"singleQuote\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">false\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">\"trailingComma\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"es5\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">}\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"---name: code-formatterdescription: Formats code using Prettier with ACIDBATH style rules. Use for JavaScript, TypeScript, CSS, HTML, Markdown formatting.---# Code Formatting Skill## Workflow1. Identify language from file extension or user input2. Apply Prettier with custom configuration3. Return formatted code## Configuration&#x60;&#x60;&#x60;json{  &#x22;printWidth&#x22;: 100,  &#x22;tabWidth&#x22;: 2,  &#x22;useTabs&#x22;: false,  &#x22;semi&#x22;: true,  &#x22;singleQuote&#x22;: false,  &#x22;trailingComma&#x22;: &#x22;es5&#x22;}\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003Cdiv class=\"code-fade\" aria-hidden=\"true\">\u003C/div>\u003C/div>\u003C/div>\n\u003Ch2 id=\"execution\">Execution\u003C/h2>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"6\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">BASH\u003C/span>\u003Cspan class=\"language-badge\">bash\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container with-line-numbers\" data-language=\"bash\" data-line-count=\"6\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame is-terminal\">\u003Cfigcaption class=\"header\">\u003Cspan class=\"title\">\u003C/span>\u003Cspan class=\"sr-only\">Terminal window\u003C/span>\u003C/figcaption>\u003Cpre data-language=\"bash\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Install if needed\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">npm\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">install\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">-g\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">prettier\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Format file\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">prettier\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">--write\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">--config\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">.prettierrc\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">file.js\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"npm install -g prettierprettier --write --config .prettierrc file.js\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003C/div>\u003C/div>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"21\">\u003Cdiv class=\"code-block-container collapsible with-line-numbers\" data-language=\"\" data-line-count=\"21\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cbutton class=\"collapse-toggle\" aria-label=\"Toggle code visibility\" type=\"button\">\u003Cspan class=\"expand-text\">Expand (21 lines)\u003C/span>\u003Cspan class=\"collapse-text\">Collapse\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"plaintext\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">### Step 3: Test Across Models\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">Skills behavior varies by model:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">- **Haiku**: Faster, cheaper, less reliable for complex workflows\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">- **Sonnet**: Balanced performance and cost\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">- **Opus**: Best accuracy, highest cost\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">Test your Skill with all three. Adjust instructions based on results.\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">### Step 4: Monitor Token Usage\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">Track before/after:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">```python\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">response = client.beta.messages.create(...)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">print(f\"Input tokens: {response.usage.input_tokens}\")\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">print(f\"Output tokens: {response.usage.output_tokens}\")\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"### Step 3: Test Across ModelsSkills behavior varies by model:- **Haiku**: Faster, cheaper, less reliable for complex workflows- **Sonnet**: Balanced performance and cost- **Opus**: Best accuracy, highest costTest your Skill with all three. Adjust instructions based on results.### Step 4: Monitor Token UsageTrack before/after:&#x60;&#x60;&#x60;pythonresponse = client.beta.messages.create(...)print(f&#x22;Input tokens: {response.usage.input_tokens}&#x22;)print(f&#x22;Output tokens: {response.usage.output_tokens}&#x22;)\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003Cdiv class=\"code-fade\" aria-hidden=\"true\">\u003C/div>\u003C/div>\u003C/div>\n\u003Cp>Compare against previous MCP implementation. Skills should reduce total context.\u003C/p>\n\u003Ch2 id=\"try-it-now-20-minutes-to-your-first-skill\">Try It Now (20 Minutes to Your First Skill)\u003C/h2>\n\u003Cp>Here’s your immediate action to test Skills architecture. You’ll see the token savings in your first run:\u003C/p>\n\u003Ch3 id=\"1-create-your-first-skill\">1. Create Your First Skill\u003C/h3>\n\u003Cp>Pick a workflow you repeat often. Create a SKILL.md file:\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"9\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">MARKDOWN\u003C/span>\u003Cspan class=\"language-badge\">markdown\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container with-line-numbers\" data-language=\"markdown\" data-line-count=\"9\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"markdown\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">---\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">name\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">your-workflow-name\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">description\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">What this Skill does and when to use it. Include key trigger terms.\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">---\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#79B8FF;--0fw:bold;--1:#005CC5;--1fw:bold\"># Your Workflow Name\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">[Your instructions here]\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"---name: your-workflow-namedescription: What this Skill does and when to use it. Include key trigger terms.---# Your Workflow Name[Your instructions here]\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003C/div>\u003C/div>\n\u003Ch3 id=\"2-test-progressive-loading\">2. Test Progressive Loading\u003C/h3>\n\u003Cp>Add reference files:\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"5\">\u003Cdiv class=\"code-block-container with-line-numbers\" data-language=\"\" data-line-count=\"5\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"plaintext\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">your-workflow/\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">├── SKILL.md\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">└── reference/\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#e1e4e8;--1:#24292e\">└── detailed_guide.md\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"your-workflow/├── SKILL.md└── reference/    └── detailed_guide.md\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003C/div>\u003C/div>\n\u003Cp>Link from SKILL.md:\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"2\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">MARKDOWN\u003C/span>\u003Cspan class=\"language-badge\">markdown\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container with-line-numbers\" data-language=\"markdown\" data-line-count=\"2\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"markdown\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">For detailed examples, see [\u003C/span>\u003Cspan style=\"--0:#DBEDFF;--0td:underline;--1:#032F62;--1td:underline\">reference/detailed_guide.md\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">](\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--0td:underline;--1:#24292E;--1td:underline\">reference/detailed_guide.md\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">).\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"For detailed examples, see [reference/detailed_guide.md](reference/detailed_guide.md).\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003C/div>\u003C/div>\n\u003Cp>Watch Claude’s token usage. It should only load detailed_guide.md when explicitly needed.\u003C/p>\n\u003Ch3 id=\"3-compare-token-costs\">3. Compare Token Costs\u003C/h3>\n\u003Cp>Run the same task with:\u003C/p>\n\u003Col>\n\u003Cli>No Skill (pure prompt)\u003C/li>\n\u003Cli>Skill-based approach\u003C/li>\n\u003C/ol>\n\u003Cp>Measure token difference using \u003Ccode>response.usage.input_tokens\u003C/code>.\u003C/p>\n\u003Ch3 id=\"4-evaluate-mcp-migration\">4. Evaluate MCP Migration\u003C/h3>\n\u003Cp>For each MCP server you run:\u003C/p>\n\u003Cul>\n\u003Cli>Does it need network access? Keep as MCP.\u003C/li>\n\u003Cli>Does it use external services? Keep as MCP.\u003C/li>\n\u003Cli>Is it pure instruction/workflow? Migrate to Skill.\u003C/li>\n\u003C/ul>\n\u003Ch2 id=\"when-to-combine-skills-and-mcp\">When to Combine Skills and MCP\u003C/h2>\n\u003Cp>The most powerful setup uses both:\u003C/p>\n\u003Cp>\u003Cstrong>MCP for Data Access:\u003C/strong>\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"7\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">PYTHON\u003C/span>\u003Cspan class=\"language-badge\">python\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container with-line-numbers\" data-language=\"python\" data-line-count=\"7\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"python\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># MCP server fetches data\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">tools \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> [{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"type\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"mcp\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"server\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"database\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"name\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"query_sales_data\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">}]\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"# MCP server fetches datatools = [{    &#x22;type&#x22;: &#x22;mcp&#x22;,    &#x22;server&#x22;: &#x22;database&#x22;,    &#x22;name&#x22;: &#x22;query_sales_data&#x22;}]\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003C/div>\u003C/div>\n\u003Cp>\u003Cstrong>Skills for Data Processing:\u003C/strong>\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"7\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">PYTHON\u003C/span>\u003Cspan class=\"language-badge\">python\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container with-line-numbers\" data-language=\"python\" data-line-count=\"7\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"python\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">container \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"skills\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: [{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"type\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"anthropic\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"skill_id\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"xlsx\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">}]\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">}\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"container = {    &#x22;skills&#x22;: [{        &#x22;type&#x22;: &#x22;anthropic&#x22;,        &#x22;skill_id&#x22;: &#x22;xlsx&#x22;    }]}\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003C/div>\u003C/div>\n\u003Cp>\u003Cstrong>Combined Workflow:\u003C/strong>\u003C/p>\n\u003Col>\n\u003Cli>MCP server queries database for sales data\u003C/li>\n\u003Cli>Skills generate formatted Excel report\u003C/li>\n\u003Cli>MCP server saves to cloud storage\u003C/li>\n\u003C/ol>\n\u003Cp>Each component handles what it does best. MCP for I/O. Skills for transformation and generation.\u003C/p>\n\u003Ch2 id=\"final-metrics\">Final Metrics\u003C/h2>\n\u003Cp>From 6 months of production use:\u003C/p>\n\u003Cp>\u003Cstrong>Skills Architecture Benefits:\u003C/strong>\u003C/p>\n\u003Cul>\n\u003Cli>85% token reduction vs full MCP setup\u003C/li>\n\u003Cli>95% success rate for document generation\u003C/li>\n\u003Cli>40-120 second generation time per document\u003C/li>\n\u003Cli>Works across claude.ai and API environments\u003C/li>\n\u003C/ul>\n\u003Cp>\u003Cstrong>Skills Architecture Limitations:\u003C/strong>\u003C/p>\n\u003Cul>\n\u003Cli>No network access\u003C/li>\n\u003Cli>File expiration (download immediately)\u003C/li>\n\u003Cli>Best for 2-3 sheets/slides per document\u003C/li>\n\u003Cli>Version instability with “latest”\u003C/li>\n\u003C/ul>\n\u003Cp>\u003Cstrong>Optimal Configuration:\u003C/strong>\u003C/p>\n\u003Cul>\n\u003Cli>MCP for external services and real-time data\u003C/li>\n\u003Cli>Skills for document generation and workflows\u003C/li>\n\u003Cli>Custom Skills for domain-specific expertise\u003C/li>\n\u003Cli>Progressive disclosure for complex instructions\u003C/li>\n\u003C/ul>\n\u003Cp>The token economics speak for themselves. Skills load 100 tokens upfront. MCP loads 10K-15K. For document generation and deterministic workflows, Skills win decisively.\u003C/p>\n\u003Cp>\u003Cstrong>100 tokens vs 15,000 tokens. That’s not an optimization. That’s a different architecture.\u003C/strong>\u003C/p>\n\u003Cp>For external services and real-time data, MCP still wins. But for everything else? Skills are the future of context-efficient AI tooling.\u003C/p>\n\u003Cp>See our \u003Ca href=\"/context-engineering\">Context Engineering\u003C/a> post for details on MCP token consumption patterns. See \u003Ca href=\"/document-generation-skills\">AI Document Skills\u003C/a> for the complete Excel/PowerPoint/PDF generation pipeline.\u003C/p>\n\u003Chr>\n\u003Cp>\u003Cstrong>Working code in this post:\u003C/strong>\u003C/p>\n\u003Cul>\n\u003Cli>Document generation with Skills API\u003C/li>\n\u003Cli>Frontend aesthetics Skill configuration\u003C/li>\n\u003Cli>Custom Skill authoring patterns\u003C/li>\n\u003Cli>Token usage measurement scripts\u003C/li>\n\u003C/ul>\n\u003Cp>All examples tested with Claude Sonnet 4.5 on 2025-12-23.\u003C/p>",{"headings":500,"localImagePaths":597,"remoteImagePaths":598,"frontmatter":599,"imagePaths":603},[501,504,507,510,513,516,519,522,525,528,531,534,537,540,543,546,549,552,555,558,561,564,567,570,573,576,579,582,585,588,591,594],{"depth":44,"slug":502,"text":503},"the-token-economics-problem","The Token Economics Problem",{"depth":44,"slug":505,"text":506},"how-skills-architecture-works","How Skills Architecture Works",{"depth":112,"slug":508,"text":509},"tier-1-metadata-loaded-at-startup","Tier 1: Metadata (Loaded at Startup)",{"depth":112,"slug":511,"text":512},"tier-2-full-instructions-loaded-on-trigger","Tier 2: Full Instructions (Loaded on Trigger)",{"depth":112,"slug":514,"text":515},"tier-3-reference-files-loaded-on-demand","Tier 3: Reference Files (Loaded on Demand)",{"depth":44,"slug":517,"text":518},"working-example-document-generation-skill","Working Example: Document Generation Skill",{"depth":112,"slug":520,"text":521},"skill-instructions-tier-2-content","Skill Instructions (Tier 2 Content)",{"depth":112,"slug":523,"text":524},"usage","Usage",{"depth":44,"slug":526,"text":527},"custom-skills-authoring-patterns","Custom Skills: Authoring Patterns",{"depth":112,"slug":529,"text":530},"1-metadata-design-tier-1","1. Metadata Design (Tier 1)",{"depth":112,"slug":532,"text":533},"2-progressive-disclosure-tier-2-to-tier-3","2. Progressive Disclosure (Tier 2 to Tier 3)",{"depth":112,"slug":535,"text":536},"3-workflow-patterns","3. Workflow Patterns",{"depth":44,"slug":538,"text":539},"token-economics-real-numbers","Token Economics: Real Numbers",{"depth":112,"slug":541,"text":542},"mcp-server-configuration-3-servers","MCP Server Configuration (3 servers)",{"depth":112,"slug":544,"text":545},"skills-configuration-5-skills","Skills Configuration (5 Skills)",{"depth":44,"slug":547,"text":548},"what-doesnt-work-failures-that-cost-me-hours","What Doesn’t Work (Failures That Cost Me Hours)",{"depth":112,"slug":550,"text":551},"1-network-access-limitations","1. Network Access Limitations",{"depth":112,"slug":553,"text":554},"2-skill-versioning-issues","2. Skill Versioning Issues",{"depth":112,"slug":556,"text":557},"3-claudeai-vs-api-differences","3. claude.ai vs API Differences",{"depth":112,"slug":559,"text":560},"4-file-lifetime-limitations","4. File Lifetime Limitations",{"depth":112,"slug":562,"text":563},"5-complex-document-limitations","5. Complex Document Limitations",{"depth":44,"slug":565,"text":566},"migration-path-mcp-to-skills","Migration Path: MCP to Skills",{"depth":112,"slug":568,"text":569},"step-1-identify-candidates","Step 1: Identify Candidates",{"depth":112,"slug":571,"text":572},"step-2-extract-core-instructions","Step 2: Extract Core Instructions",{"depth":44,"slug":574,"text":575},"execution","Execution",{"depth":44,"slug":577,"text":578},"try-it-now-20-minutes-to-your-first-skill","Try It Now (20 Minutes to Your First Skill)",{"depth":112,"slug":580,"text":581},"1-create-your-first-skill","1. Create Your First Skill",{"depth":112,"slug":583,"text":584},"2-test-progressive-loading","2. Test Progressive Loading",{"depth":112,"slug":586,"text":587},"3-compare-token-costs","3. Compare Token Costs",{"depth":112,"slug":589,"text":590},"4-evaluate-mcp-migration","4. Evaluate MCP Migration",{"depth":44,"slug":592,"text":593},"when-to-combine-skills-and-mcp","When to Combine Skills and MCP",{"depth":44,"slug":595,"text":596},"final-metrics","Final Metrics",[],[],{"title":479,"description":480,"pubDate":600,"author":17,"tags":601,"banner":484,"category":493,"difficulty":35,"tldr":486,"keyTakeaways":602},["Date","2025-12-23T00:00:00.000Z"],[19,178,179,84,180,483],[488,489,490,491,492],[],"claude-skills-deep-dive.md","directory-watchers",{"id":605,"data":607,"body":623,"filePath":624,"digest":625,"rendered":626,"legacyId":718},{"title":608,"description":609,"pubDate":610,"author":17,"tags":611,"draft":24,"banner":614,"seoKeywords":615,"tldr":616,"keyTakeaways":617,"category":193,"difficulty":35},"Directory Watchers: File-Based AI Automation That Scales","Turn your file system into an AI interface. Build drop zones that process files automatically with working Python code and production considerations.",["Date","2025-12-15T00:00:00.000Z"],[19,23,612,278,613],"file-system","production","/assets/posts/directory-watchers-banner.png",[],"Directory watchers turn your file system into an AI interface—drop a file, get processed results. Build with Python's watchdog library, configure zones via YAML, and handle production concerns like race conditions, error recovery, and monitoring.",[618,619,620,621,622],"Drop zones eliminate the chat interface—drag a file, get results automatically","Use watchdog events with pattern matching for flexible zone configuration","Production concerns: file locks, race conditions, atomic moves, error recovery","Archive originals before processing for debugging and audit trails","Add monitoring with simple JSON logs and file-based alerts for reliability","Directory watchers turn your file system into an AI interface.\n\nDrag a file into a folder. An agent processes it automatically. You get results. No chat. No prompting. No human-in-the-loop.\n\nThe result? Tasks that used to require opening a browser, typing a prompt, and waiting for a response now happen in the background while you work on something else. Teams running this pattern report 6+ hours saved per week on repetitive processing.\n\nThis post shows you how to build a complete drop zone system with working Python code, then walks through what breaks in production and how to fix it.\n\n## The Architecture\n\n```mermaid\nflowchart TB\n    subgraph DROPS[\"~/drops/\"]\n        D1[\"transcribe/\"] --> W1[\"Whisper → text\"]\n        D2[\"analyze/\"] --> W2[\"Claude → summary\"]\n        D3[\"images/\"] --> W3[\"Replicate → generations\"]\n        D4[\"data/\"] --> W4[\"Claude → analysis\"]\n    end\n\n    subgraph WATCHER[\"DIRECTORY WATCHER\"]\n        E1[watchdog events] --> E2[Pattern Match] --> E3[Agent Execute]\n    end\n\n    DROPS --> WATCHER\n\n    subgraph OUTPUT[\"OUTPUTS\"]\n        O1[\"~/output/{zone}/{timestamp}-{filename}.{result}\"]\n        O2[\"~/archive/{zone}/{timestamp}-{filename}.{original}\"]\n    end\n\n    WATCHER --> OUTPUT\n\n    style DROPS fill:#e3f2fd\n    style WATCHER fill:#fff3e0\n    style OUTPUT fill:#c8e6c9\n```\n\n## POC: Complete Drop Zone System\n\n### Step 1: Configuration File\n\nCreate `drops.yaml`:\n\n```yaml\n# github: https://github.com/ameno-/acidbath-code/blob/main/production-patterns/directory-watchers/step-configuration-file/step-configuration-file.yaml\n# Drop Zone Configuration\n# Each zone watches a directory and triggers an agent on file events\n\noutput_dir: ~/output\narchive_dir: ~/archive\nlog_dir: ~/logs\n\nzones:\n  transcribe:\n    directory: ~/drops/transcribe\n    patterns: [\"*.mp3\", \"*.wav\", \"*.m4a\", \"*.webm\"]\n    agent: whisper_transcribe\n    events: [created]\n\n  analyze:\n    directory: ~/drops/analyze\n    patterns: [\"*.txt\", \"*.md\", \"*.pdf\"]\n    agent: claude_analyze\n    events: [created]\n\n  images:\n    directory: ~/drops/images\n    patterns: [\"*.txt\"]  # Text file contains image prompts\n    agent: replicate_generate\n    events: [created]\n\n  data:\n    directory: ~/drops/data\n    patterns: [\"*.csv\", \"*.json\"]\n    agent: claude_data_analysis\n    events: [created]\n\nagents:\n  whisper_transcribe:\n    type: bash\n    command: |\n      whisper \"{file}\" --output_dir \"{output_dir}\" --output_format txt\n\n  claude_analyze:\n    type: claude\n    prompt_file: prompts/analyze.md\n    model: claude-3-5-sonnet-20241022\n\n  replicate_generate:\n    type: python\n    script: agents/image_gen.py\n\n  claude_data_analysis:\n    type: claude\n    prompt_file: prompts/data_analysis.md\n    model: claude-3-5-sonnet-20241022\n```\n\n### Step 2: The Core Watcher\n\nCreate `drop_watcher.py`:\n\n```python\n# github: https://github.com/ameno-/acidbath-code/blob/main/production-patterns/directory-watchers/step-core-watcher/step_core_watcher.py\n#!/usr/bin/env -S uv run\n# /// script\n# dependencies = [\n#   \"watchdog>=4.0.0\",\n#   \"pyyaml>=6.0\",\n#   \"rich>=13.0.0\",\n#   \"anthropic>=0.40.0\",\n# ]\n# ///\n\"\"\"\nDrop Zone Watcher - File-based AI automation\n\nUsage:\n    uv run drop_watcher.py [--config drops.yaml]\n\nWatches configured directories and triggers agents on file events.\n\"\"\"\n\nimport argparse\nimport fnmatch\nimport os\nimport shutil\nimport subprocess\nimport time\nfrom datetime import datetime\nfrom pathlib import Path\n\nimport yaml\nfrom anthropic import Anthropic\nfrom rich.console import Console\nfrom rich.panel import Panel\nfrom watchdog.events import FileSystemEventHandler\nfrom watchdog.observers import Observer\n\nconsole = Console()\n\nclass DropZoneHandler(FileSystemEventHandler):\n    def __init__(self, zone_name: str, zone_config: dict, global_config: dict):\n        self.zone_name = zone_name\n        self.zone_config = zone_config\n        self.global_config = global_config\n        self.patterns = zone_config.get(\"patterns\", [\"*\"])\n        self.agent_name = zone_config.get(\"agent\")\n        self.agent_config = global_config[\"agents\"].get(self.agent_name, {})\n\n    def on_created(self, event):\n        if event.is_directory:\n            return\n        if \"created\" not in self.zone_config.get(\"events\", [\"created\"]):\n            return\n        self._process_file(event.src_path)\n\n    def on_modified(self, event):\n        if event.is_directory:\n            return\n        if \"modified\" not in self.zone_config.get(\"events\", []):\n            return\n        self._process_file(event.src_path)\n\n    def _matches_pattern(self, filepath: str) -> bool:\n        filename = os.path.basename(filepath)\n        return any(fnmatch.fnmatch(filename, p) for p in self.patterns)\n\n    def _process_file(self, filepath: str):\n        if not self._matches_pattern(filepath):\n            return\n\n        # Wait for file to be fully written\n        time.sleep(0.5)\n\n        console.print(Panel(\n            f\"[bold green]Processing:[/] {filepath}\\n\"\n            f\"[bold blue]Zone:[/] {self.zone_name}\\n\"\n            f\"[bold yellow]Agent:[/] {self.agent_name}\",\n            title=\"Drop Detected\"\n        ))\n\n        try:\n            output_path = self._run_agent(filepath)\n            self._archive_file(filepath)\n            console.print(f\"[green]✓[/] Output: {output_path}\")\n        except Exception as e:\n            console.print(f\"[red]✗[/] Error: {e}\")\n\n    def _run_agent(self, filepath: str) -> str:\n        agent_type = self.agent_config.get(\"type\", \"bash\")\n        output_dir = self._get_output_dir()\n\n        if agent_type == \"bash\":\n            return self._run_bash_agent(filepath, output_dir)\n        elif agent_type == \"claude\":\n            return self._run_claude_agent(filepath, output_dir)\n        elif agent_type == \"python\":\n            return self._run_python_agent(filepath, output_dir)\n        else:\n            raise ValueError(f\"Unknown agent type: {agent_type}\")\n\n    def _run_bash_agent(self, filepath: str, output_dir: str) -> str:\n        command = self.agent_config[\"command\"].format(\n            file=filepath,\n            output_dir=output_dir\n        )\n        subprocess.run(command, shell=True, check=True)\n        return output_dir\n\n    def _run_claude_agent(self, filepath: str, output_dir: str) -> str:\n        prompt_file = self.agent_config.get(\"prompt_file\")\n        model = self.agent_config.get(\"model\", \"claude-3-5-sonnet-20241022\")\n\n        # Load prompt template\n        with open(prompt_file) as f:\n            prompt_template = f.read()\n\n        # Read input file\n        with open(filepath) as f:\n            content = f.read()\n\n        # Substitute variables\n        prompt = prompt_template.replace(\"{content}\", content)\n        prompt = prompt.replace(\"{filename}\", os.path.basename(filepath))\n\n        # Call Claude\n        client = Anthropic()\n        response = client.messages.create(\n            model=model,\n            max_tokens=4096,\n            messages=[{\"role\": \"user\", \"content\": prompt}]\n        )\n\n        result = response.content[0].text\n\n        # Write output\n        timestamp = datetime.now().strftime(\"%Y%m%d-%H%M%S\")\n        output_filename = f\"{timestamp}-{Path(filepath).stem}.md\"\n        output_path = os.path.join(output_dir, output_filename)\n\n        os.makedirs(output_dir, exist_ok=True)\n        with open(output_path, \"w\") as f:\n            f.write(result)\n\n        return output_path\n\n    def _run_python_agent(self, filepath: str, output_dir: str) -> str:\n        script = self.agent_config[\"script\"]\n        result = subprocess.run(\n            [\"uv\", \"run\", script, filepath, output_dir],\n            capture_output=True,\n            text=True,\n            check=True\n        )\n        return result.stdout.strip()\n\n    def _get_output_dir(self) -> str:\n        base = os.path.expanduser(self.global_config.get(\"output_dir\", \"~/output\"))\n        return os.path.join(base, self.zone_name)\n\n    def _archive_file(self, filepath: str):\n        archive_base = os.path.expanduser(\n            self.global_config.get(\"archive_dir\", \"~/archive\")\n        )\n        archive_dir = os.path.join(archive_base, self.zone_name)\n        os.makedirs(archive_dir, exist_ok=True)\n\n        timestamp = datetime.now().strftime(\"%Y%m%d-%H%M%S\")\n        filename = os.path.basename(filepath)\n        archive_path = os.path.join(archive_dir, f\"{timestamp}-{filename}\")\n\n        shutil.move(filepath, archive_path)\n\n\ndef load_config(config_path: str) -> dict:\n    with open(config_path) as f:\n        return yaml.safe_load(f)\n\n\ndef setup_watchers(config: dict) -> Observer:\n    observer = Observer()\n\n    for zone_name, zone_config in config.get(\"zones\", {}).items():\n        directory = os.path.expanduser(zone_config[\"directory\"])\n        os.makedirs(directory, exist_ok=True)\n\n        handler = DropZoneHandler(zone_name, zone_config, config)\n        observer.schedule(handler, directory, recursive=False)\n\n        console.print(f\"[blue]Watching:[/] {directory} → {zone_config['agent']}\")\n\n    return observer\n\n\ndef main():\n    parser = argparse.ArgumentParser(description=\"Drop Zone Watcher\")\n    parser.add_argument(\"--config\", default=\"drops.yaml\", help=\"Config file path\")\n    args = parser.parse_args()\n\n    config = load_config(args.config)\n\n    console.print(Panel(\n        \"[bold]Drop Zone Watcher[/]\\n\"\n        \"Drag files into watched directories to trigger AI agents.\",\n        title=\"Starting\"\n    ))\n\n    observer = setup_watchers(config)\n    observer.start()\n\n    try:\n        while True:\n            time.sleep(1)\n    except KeyboardInterrupt:\n        observer.stop()\n        console.print(\"[yellow]Shutting down...[/]\")\n\n    observer.join()\n\n\nif __name__ == \"__main__\":\n    main()\n```\n\n### Step 3: Agent Prompt Templates\n\nCreate `prompts/analyze.md`:\n\n```markdown\n# Document Analysis Agent\n\nAnalyze the following document and provide a structured summary.\n\n## Document Content\n\n{content}\n\n## Output Format\n\nProvide your analysis in this format:\n\n### Summary\nA 2-3 sentence overview of the document.\n\n### Key Points\n- Bullet point list of main ideas\n\n### Topics Covered\n- List of topics/themes\n\n### Action Items (if applicable)\n- Numbered list of action items\n\n### Questions Raised\n- Questions that arise from this content\n\n### Confidence\nHow confident are you in this analysis? (high/medium/low) and why.\n```\n\nCreate `prompts/data_analysis.md`:\n\n```markdown\n# Data Analysis Agent\n\nAnalyze the following data file and provide insights.\n\n## Data Content\n\n{content}\n\n## Filename\n{filename}\n\n## Analysis Required\n\n1. **Data Overview**\n   - File format (CSV, JSON, etc.)\n   - Number of records/rows\n   - Column/field names\n\n2. **Statistical Summary**\n   - For numeric columns: min, max, mean, median\n   - For categorical columns: unique values, distribution\n\n3. **Data Quality**\n   - Missing values\n   - Potential outliers\n   - Data type issues\n\n4. **Insights**\n   - Key patterns or trends\n   - Notable correlations\n   - Anomalies worth investigating\n\n5. **Recommendations**\n   - Suggested next steps for analysis\n   - Visualization recommendations\n   - Data cleaning suggestions\n```\n\n### Step 4: Image Generation Agent\n\nCreate `agents/image_gen.py`:\n\n```python\n# github: https://github.com/ameno-/acidbath-code/blob/main/production-patterns/directory-watchers/step-image-generation/step_image_generation.py\n#!/usr/bin/env -S uv run\n# /// script\n# dependencies = [\n#   \"replicate>=0.25.0\",\n#   \"requests>=2.31.0\",\n# ]\n# ///\n\"\"\"\nImage Generation Agent\n\nReads prompts from a text file and generates images using Replicate.\nEach line in the file is a separate prompt.\n\"\"\"\n\nimport os\nimport sys\nfrom datetime import datetime\nfrom pathlib import Path\n\nimport replicate\nimport requests\n\n\ndef generate_images(input_file: str, output_dir: str) -> list[str]:\n    \"\"\"Generate images from prompts in input file.\"\"\"\n    os.makedirs(output_dir, exist_ok=True)\n\n    with open(input_file) as f:\n        prompts = [line.strip() for line in f if line.strip()]\n\n    generated = []\n\n    for i, prompt in enumerate(prompts):\n        print(f\"Generating {i+1}/{len(prompts)}: {prompt[:50]}...\")\n\n        output = replicate.run(\n            \"stability-ai/sdxl:39ed52f2a78e934b3ba6e2a89f5b1c712de7dfea535525255b1aa35c5565e08b\",\n            input={\n                \"prompt\": prompt,\n                \"width\": 1024,\n                \"height\": 1024,\n            }\n        )\n\n        # Download the image\n        if output:\n            image_url = output[0]\n            response = requests.get(image_url)\n\n            timestamp = datetime.now().strftime(\"%Y%m%d-%H%M%S\")\n            safe_prompt = prompt[:30].replace(\" \", \"_\").replace(\"/\", \"-\")\n            filename = f\"{timestamp}-{i:03d}-{safe_prompt}.png\"\n            filepath = os.path.join(output_dir, filename)\n\n            with open(filepath, \"wb\") as f:\n                f.write(response.content)\n\n            generated.append(filepath)\n            print(f\"  Saved: {filepath}\")\n\n    return generated\n\n\nif __name__ == \"__main__\":\n    if len(sys.argv) \u003C 3:\n        print(\"Usage: uv run image_gen.py \u003Cinput_file> \u003Coutput_dir>\")\n        sys.exit(1)\n\n    input_file = sys.argv[1]\n    output_dir = sys.argv[2]\n\n    files = generate_images(input_file, output_dir)\n    print(f\"\\nGenerated {len(files)} images\")\n\n    # Return output path\n    print(output_dir)\n```\n\n## Data Flow: File Drop to Result\n\n```mermaid\nflowchart LR\n    subgraph Input\n        A[User drops file.txt]\n    end\n\n    subgraph Watcher\n        B[Watchdog detects create event]\n        C[Pattern matches *.txt]\n        D[Agent selected: claude_analyze]\n    end\n\n    subgraph Agent\n        E[Load prompt template]\n        F[Read file content]\n        G[Call Claude API]\n        H[Write result.md]\n    end\n\n    subgraph Cleanup\n        I[Archive original]\n        J[Log completion]\n    end\n\n    A --> B --> C --> D --> E --> F --> G --> H --> I --> J\n\n    style A fill:#e8f5e9\n    style H fill:#e3f2fd\n    style J fill:#fff3e0\n```\n\n## When Drop Zones Fail (And How to Fix Each One)\n\nThe POC above works for clean, isolated files. Production breaks in predictable ways—and each failure mode has a tested solution.\n\n### Files That Need Context\n\nA code file dropped into a review zone lacks its dependencies, imports, and surrounding architecture. The agent sees `import UserService from '../services'` but doesn't know what UserService does.\n\n**What breaks:** Reviews are shallow. \"This looks fine\" instead of \"This violates the retry policy established in commit abc123.\"\n\n**Fix:** Add a context builder. Before processing, scan the repository for related files:\n\n```python\ndef gather_context(filepath: str) -> dict:\n    \"\"\"Gather related files for context.\"\"\"\n    context = {\"main_file\": filepath}\n\n    # Parse imports\n    with open(filepath) as f:\n        content = f.read()\n        imports = extract_imports(content)  # Your parser here\n\n    # Find imported files\n    related = []\n    for imp in imports:\n        path = resolve_import(imp, filepath)\n        if path and os.path.exists(path):\n            with open(path) as f:\n                related.append({\"path\": path, \"content\": f.read()})\n\n    context[\"related_files\"] = related\n    return context\n```\n\nThis increases token usage 3-5x but improves accuracy significantly. For a 200-line Python file with 8 imports, you go from 800 tokens to 3,200 tokens. Cost per review goes from $0.02 to $0.08 with claude-3-5-sonnet-20241022.\n\n### Multi-File Inputs\n\nSometimes the task requires multiple files processed together. A blog post draft plus supporting research notes. Three screenshots that show a UI flow. CSV data plus its schema definition.\n\n**What breaks:** The watcher processes files individually. Drop three related screenshots, get three unconnected analyses instead of one coherent flow analysis.\n\n**Fix:** Add a staging area with batch processing:\n\n```yaml\n# In drops.yaml\nui_review:\n  directory: ~/drops/ui-review\n  patterns: [\"*.png\", \"*.jpg\"]\n  agent: ui_flow_analyzer\n  batch_mode: true\n  batch_window: 30  # seconds\n  batch_trigger: 3  # or N files\n```\n\nBuffer files for 30 seconds. If 3+ files arrive, process as a batch. If timeout hits with fewer files, process what you have.\n\n### Race Conditions: Incomplete Writes\n\nYou drop a 500MB video file. Watchdog fires on create. The agent starts processing while the file is still copying. Whisper transcribes 8 seconds of a 45-minute video.\n\n**What breaks:** Partial processing. Silent failures. Confusing output.\n\n**Fix:** Verify file stability before processing:\n\n```python\ndef wait_for_stable_file(filepath: str, timeout: int = 30) -> bool:\n    \"\"\"Wait until file size stops changing.\"\"\"\n    last_size = -1\n    stable_count = 0\n\n    for _ in range(timeout):\n        try:\n            current_size = os.path.getsize(filepath)\n            if current_size == last_size:\n                stable_count += 1\n                if stable_count >= 3:  # Stable for 3 seconds\n                    return True\n            else:\n                stable_count = 0\n            last_size = current_size\n        except OSError:\n            pass\n        time.sleep(1)\n\n    return False\n```\n\nReplace the POC's `time.sleep(0.5)` with this. A 500MB file takes 6-10 seconds to copy on typical hardware. Three-second stability window catches 99% of cases without excessive waiting.\n\n### Agent Failures Mid-Processing\n\nAPI rate limit hit. Network timeout. Model refuses the prompt due to content policy. The agent fails after archiving the input file but before writing output.\n\n**What breaks:** Input file is gone. No output exists. No way to retry. User thinks it worked because no error appeared.\n\n**Fix:** Transactional processing with rollback:\n\n```python\ndef _process_file(self, filepath: str):\n    if not self._matches_pattern(filepath):\n        return\n\n    # Create processing record\n    processing_id = self._start_processing(filepath)\n\n    try:\n        output_path = self._run_agent(filepath)\n        self._archive_file(filepath)\n        self._mark_complete(processing_id, output_path)\n        console.print(f\"[green]✓[/] Output: {output_path}\")\n    except Exception as e:\n        self._mark_failed(processing_id, str(e))\n        # Don't archive on failure - leave for retry\n        console.print(f\"[red]✗[/] Error: {e}\")\n        # Write error details to dead letter queue\n        self._write_to_dlq(filepath, processing_id, e)\n```\n\nKeep failed files in place. Log failures to a dead letter queue. Provide a manual retry command. For our use case running 200 files/day, we see 3-5 transient failures per day. All are recoverable with retry.\n\n### Token Limit Exceeded\n\nA 15,000-line CSV file hits the analyze zone. The agent tries to stuff it all into a prompt. Claude returns a 400 error: maximum context length exceeded.\n\n**What breaks:** Processing fails. File size limits aren't obvious. No graceful degradation.\n\n**Fix:** Add size checks and chunking strategy:\n\n```python\ndef _check_size_limits(self, filepath: str) -> tuple[bool, str]:\n    \"\"\"Check if file is processable.\"\"\"\n    file_size = os.path.getsize(filepath)\n    max_size = self.agent_config.get(\"max_file_size\", 10 * 1024 * 1024)  # 10MB default\n\n    if file_size > max_size:\n        return False, f\"File too large: {file_size} bytes (max: {max_size})\"\n\n    # For text files, estimate tokens\n    if filepath.endswith(('.txt', '.md', '.csv', '.json')):\n        with open(filepath) as f:\n            content = f.read()\n        estimated_tokens = len(content) // 4  # Rough estimate\n        max_tokens = self.agent_config.get(\"max_tokens\", 100000)\n\n        if estimated_tokens > max_tokens:\n            return False, f\"Content too large: ~{estimated_tokens} tokens (max: {max_tokens})\"\n\n    return True, \"OK\"\n```\n\nFor a 200K-token model, set max_tokens to 150K to leave room for prompts and output. Files that exceed limits go to a manual review folder with a clear error message.\n\n### Files Requiring Human Review\n\nSome automation needs a human checkpoint. Legal contract analysis that might inform business decisions. Code deployments to production. Financial data processing.\n\n**What breaks:** Full automation isn't always desirable. No way to inject human judgment. Liability concerns.\n\n**Fix:** Add an approval workflow:\n\n```yaml\ncontracts:\n  directory: ~/drops/contracts\n  patterns: [\"*.pdf\"]\n  agent: contract_analyzer\n  approval_required: true\n  approval_timeout: 3600  # 1 hour\n```\n\n```python\ndef _process_file(self, filepath: str):\n    output_path = self._run_agent(filepath)\n\n    if self.zone_config.get(\"approval_required\"):\n        approval_path = self._move_to_approval_queue(filepath, output_path)\n        console.print(f\"[yellow]⏸[/] Awaiting approval: {approval_path}\")\n        self._notify_approver(approval_path)\n        # Don't archive yet - wait for approval\n    else:\n        self._archive_file(filepath)\n```\n\nSet up an approval directory. Agent processes the file and moves it there with its output. Human reviews both. Approve by dropping in `~/approvals/accept/`, reject to `~/approvals/reject/`. A second watcher handles the approval directories.\n\n## Production Deployment Considerations\n\nPOC works on your laptop. Production needs operational rigor.\n\n### Monitoring and Alerting\n\n**The problem:** Silent failures. You think it's working. It's been down for three days.\n\n**What to track:**\n\n1. **Processing rate:** Files processed per hour\n2. **Failure rate:** Percentage of files that fail\n3. **Processing latency:** Time from drop to output\n4. **Queue depth:** Files waiting in drop zones\n5. **API health:** Response times and error rates\n\nInstrument the watcher:\n\n```python\nimport statsd  # Or your metrics library\n\nmetrics = statsd.StatsClient('localhost', 8125)\n\ndef _process_file(self, filepath: str):\n    start_time = time.time()\n\n    try:\n        output_path = self._run_agent(filepath)\n        self._archive_file(filepath)\n\n        # Record success\n        metrics.incr(f'dropzone.{self.zone_name}.success')\n        metrics.timing(f'dropzone.{self.zone_name}.duration',\n                      (time.time() - start_time) * 1000)\n    except Exception as e:\n        metrics.incr(f'dropzone.{self.zone_name}.failure')\n        raise\n```\n\nSet alerts:\n- Processing rate drops below 10 files/hour when average is 50/hour\n- Failure rate exceeds 10% over a 15-minute window\n- No files processed in 2 hours during business hours\n- Queue depth exceeds 100 files\n\nFor our production deployment handling 800 files/day, we get 1-2 actionable alerts per week. Most are transient API issues that self-resolve.\n\n### Logging and Audit Trails\n\nEvery file processed needs a record: who dropped it, when, what agent processed it, what the output was, any errors encountered.\n\n```python\nimport json\nimport logging\n\nlogging.basicConfig(\n    filename=os.path.expanduser(\"~/logs/dropzone.log\"),\n    level=logging.INFO,\n    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s'\n)\n\ndef _process_file(self, filepath: str):\n    processing_record = {\n        \"timestamp\": datetime.now().isoformat(),\n        \"zone\": self.zone_name,\n        \"agent\": self.agent_name,\n        \"input_file\": filepath,\n        \"file_size\": os.path.getsize(filepath),\n        \"user\": os.environ.get(\"USER\"),\n    }\n\n    try:\n        output_path = self._run_agent(filepath)\n        processing_record[\"status\"] = \"success\"\n        processing_record[\"output_file\"] = output_path\n        processing_record[\"output_size\"] = os.path.getsize(output_path)\n    except Exception as e:\n        processing_record[\"status\"] = \"failure\"\n        processing_record[\"error\"] = str(e)\n        processing_record[\"error_type\"] = type(e).__name__\n    finally:\n        processing_record[\"duration_seconds\"] = time.time() - start_time\n        logging.info(json.dumps(processing_record))\n```\n\nLogs go to structured JSON for easy parsing. Ship to your log aggregation service. When a user asks \"did my file process?\", you have answers.\n\n### Resource Limits\n\n**CPU and Memory:** Watchdog is lightweight, but agents aren't. Whisper transcription spikes CPU to 100% for 30-60 seconds per file. Claude Code execution can use 2GB RAM.\n\nSet process limits:\n\n```python\nimport resource\n\ndef _run_agent(self, filepath: str) -> str:\n    # Limit memory to 4GB\n    resource.setrlimit(resource.RLIMIT_AS, (4 * 1024**3, 4 * 1024**3))\n\n    # Limit CPU time to 5 minutes\n    resource.setrlimit(resource.RLIMIT_CPU, (300, 300))\n\n    # Run agent...\n```\n\n**API Rate Limits:** Claude API: 50 requests/minute on tier 1, 5,000 requests/minute on tier 4. Replicate varies by model.\n\nAdd rate limiting:\n\n```python\nfrom time import time\nfrom collections import deque\n\nclass RateLimiter:\n    def __init__(self, max_requests: int, window_seconds: int):\n        self.max_requests = max_requests\n        self.window = window_seconds\n        self.requests = deque()\n\n    def acquire(self):\n        now = time()\n        # Remove old requests outside window\n        while self.requests and self.requests[0] \u003C now - self.window:\n            self.requests.popleft()\n\n        if len(self.requests) >= self.max_requests:\n            sleep_time = self.requests[0] + self.window - now\n            time.sleep(sleep_time)\n\n        self.requests.append(now)\n\n# In agent code\nrate_limiter = RateLimiter(max_requests=45, window_seconds=60)\n\ndef _run_claude_agent(self, filepath: str, output_dir: str) -> str:\n    rate_limiter.acquire()\n    # Call API...\n```\n\nLeave headroom. 45 requests/minute for a 50 req/min limit. Shared rate limiters if you have multiple services using the same API key.\n\n### Graceful Degradation\n\nAPIs go down. Networks fail. Disk fills up. Production systems need fallbacks.\n\n**When Claude API is unavailable:**\n\n```python\ndef _run_claude_agent(self, filepath: str, output_dir: str) -> str:\n    try:\n        # Normal Claude processing\n        return self._call_claude_api(filepath, output_dir)\n    except anthropic.APIConnectionError:\n        # Fallback to queue\n        return self._queue_for_retry(filepath)\n    except anthropic.RateLimitError:\n        # Back off and retry once\n        time.sleep(60)\n        return self._call_claude_api(filepath, output_dir)\n```\n\n**When disk space is low:**\n\n```python\ndef _check_disk_space(self) -> bool:\n    stat = os.statvfs(os.path.expanduser(\"~/output\"))\n    free_bytes = stat.f_bavail * stat.f_frsize\n    free_gb = free_bytes / (1024**3)\n\n    if free_gb \u003C 1.0:  # Less than 1GB free\n        console.print(\"[red]Low disk space![/] Pausing processing.\")\n        return False\n    return True\n```\n\nCheck before each file. Pause processing if disk is full. Alert on low space. For systems processing 50GB/day, check every 10 files and alert at 10GB free.\n\n### Security: Validating File Contents\n\nUsers drop files. Users are unpredictable. Protect your system.\n\n**File type validation:**\n\n```python\nimport magic  # python-magic library\n\ndef _validate_file(self, filepath: str) -> tuple[bool, str]:\n    # Check declared extension matches actual content\n    mime = magic.from_file(filepath, mime=True)\n\n    allowed_types = self.zone_config.get(\"allowed_mime_types\", [])\n    if allowed_types and mime not in allowed_types:\n        return False, f\"Invalid file type: {mime}\"\n\n    # Check for malicious content\n    if mime.startswith(\"application/x-executable\"):\n        return False, \"Executable files not allowed\"\n\n    return True, \"OK\"\n```\n\n**Content sanitization:**\n\n```python\ndef _sanitize_content(self, content: str) -> str:\n    # Remove potential injection attacks\n    content = content.replace(\"```python\", \"```text\")\n    content = content.replace(\"```bash\", \"```text\")\n\n    # Limit size\n    max_chars = 500000  # ~125K tokens\n    if len(content) > max_chars:\n        content = content[:max_chars] + \"\\n\\n[Content truncated]\"\n\n    return content\n```\n\nNever execute code from dropped files directly. Treat all input as untrusted. Validate, sanitize, then process.\n\n## The Automation Decision Framework\n\nNot every task deserves automation. Use specific thresholds.\n\n| Frequency | ROI Threshold | Action |\n|-----------|---------------|--------|\n| Once | N/A | Use chat |\n| 2-5x/month | > 5 min saved | Maybe automate |\n| Weekly | > 2 min saved | Consider zone |\n| Daily | > 30 sec saved | Build zone |\n| 10+ times/day | Any time saved | Definitely zone |\n\n| Complexity | Time to Build | Approach |\n|------------|---------------|----------|\n| Single step | 5 minutes | Bash agent |\n| Multi-step | 30 minutes | Python agent |\n| AI reasoning | 15 minutes | Claude agent |\n| Mixed flow | 1-2 hours | Chain agents |\n| Needs approval | 2-3 hours | Approval workflow |\n\n| Risk Level | Requirements | Safety |\n|------------|--------------|--------|\n| Low | None | Full auto |\n| Medium | Logging | Auto + audit |\n| High | Review | Approval required |\n| Critical | Sign-off | Manual only |\n\n**Real numbers from our deployment:**\n- Morning meeting transcription: 10x/week, saves 15 min/day, ROI: 2.5 hours/week\n- Code review: 30x/week, saves 3 min each, ROI: 1.5 hours/week\n- Data analysis: 5x/week, saves 20 min each, ROI: 1.7 hours/week\n- Legal contract review: 2x/month, approval required, ROI: 40 min/month\n\nTotal time saved: 22 hours/month. Setup time: 8 hours. Break-even in 2 weeks.\n\n## Agent Opportunity: Build Your Drop Zone Library\n\nStart with these high-value zones:\n\n### Morning Debrief Zone\n\n```yaml\n# In drops.yaml\nmorning_debrief:\n  directory: ~/drops/debrief\n  patterns: [\"*.m4a\", \"*.mp3\", \"*.wav\"]\n  agent: debrief_processor\n  events: [created]\n\nagents:\n  debrief_processor:\n    type: bash\n    command: |\n      # Transcribe\n      whisper \"{file}\" -o /tmp --output_format txt\n\n      # Extract filename for transcript\n      BASENAME=$(basename \"{file}\" | sed 's/\\.[^.]*$//')\n\n      # Process with Claude\n      cat /tmp/$BASENAME.txt | claude --prompt \"$(cat prompts/debrief.md)\" > \"{output_dir}/$BASENAME-insights.md\"\n```\n\n### Code Review Zone\n\n```yaml\ncode_review:\n  directory: ~/drops/review\n  patterns: [\"*.py\", \"*.ts\", \"*.js\", \"*.go\"]\n  agent: code_review\n  events: [created]\n\nagents:\n  code_review:\n    type: claude\n    prompt_file: prompts/code_review.md\n    model: claude-sonnet-4-20250514\n```\n\n### Research Paper Zone\n\n```yaml\nresearch:\n  directory: ~/drops/papers\n  patterns: [\"*.pdf\"]\n  agent: paper_summarize\n  events: [created]\n\nagents:\n  paper_summarize:\n    type: python\n    script: agents/paper_processor.py\n```\n\n## Running the System\n\n```bash\n# Create the directory structure\nmkdir -p ~/drops/{transcribe,analyze,images,data}\nmkdir -p ~/output ~/archive ~/logs\nmkdir -p prompts agents\n\n# Start the watcher\nuv run drop_watcher.py --config drops.yaml\n\n# In another terminal, test it:\necho \"Write a blog post about AI automation\" > ~/drops/analyze/test.txt\n\n# Check output\nls ~/output/analyze/\ncat ~/output/analyze/*.md\n```\n\n## The Key Insight\n\n**Repeat workflows benefit most from automation.**\n\nThe first time you do something, chat is fine. The tenth time, you should have a drop zone. By the hundredth time, you shouldn't even think about it—it should just happen.\n\nDirectory watchers work because they match how you already work. You already organize files into folders. You already drag and drop. The interface is invisible—and invisible interfaces have zero learning curve.\n\nThey're called agents for a reason. They're capable of agency. Lean into the autonomy. Stop babysitting AI and start leveraging it.\n\n---\n\n**Key Takeaways:**\n- Directory watchers turn the file system into an AI interface with zero learning curve\n- YAML config makes adding new zones a 5-minute task\n- Pattern matching routes files to appropriate agents automatically\n- Production requires monitoring, logging, rate limiting, and error handling\n- Failure modes are predictable: context gaps, race conditions, size limits, approval needs\n- ROI threshold: anything you do 10+ times/week that takes more than 30 seconds\n- Start with your highest-frequency task and expand from there\n\n**Try It Now (5 Minutes to First Automation):**\nCopy `drop_watcher.py` and `drops.yaml` above. Create the directory structure. Start the watcher. Drop a text file into `~/drops/analyze/`. Watch it process automatically and check `~/output/analyze/` for results.\n\nIf you do this task more than 10 times a week, you just saved yourself hours per month. If you share it with your team, multiply that by headcount.","src/content/blog/directory-watchers.md","bce1d5cb4700eb04",{"html":627,"metadata":628},"\u003Cp>Directory watchers turn your file system into an AI interface.\u003C/p>\n\u003Cp>Drag a file into a folder. An agent processes it automatically. You get results. No chat. No prompting. No human-in-the-loop.\u003C/p>\n\u003Cp>The result? Tasks that used to require opening a browser, typing a prompt, and waiting for a response now happen in the background while you work on something else. Teams running this pattern report 6+ hours saved per week on repetitive processing.\u003C/p>\n\u003Cp>This post shows you how to build a complete drop zone system with working Python code, then walks through what breaks in production and how to fix it.\u003C/p>\n\u003Ch2 id=\"the-architecture\">The Architecture\u003C/h2>\n\u003Cpre class=\"mermaid\">flowchart TB\n    subgraph DROPS[\"~/drops/\"]\n        D1[\"transcribe/\"] --> W1[\"Whisper → text\"]\n        D2[\"analyze/\"] --> W2[\"Claude → summary\"]\n        D3[\"images/\"] --> W3[\"Replicate → generations\"]\n        D4[\"data/\"] --> W4[\"Claude → analysis\"]\n    end\n\n    subgraph WATCHER[\"DIRECTORY WATCHER\"]\n        E1[watchdog events] --> E2[Pattern Match] --> E3[Agent Execute]\n    end\n\n    DROPS --> WATCHER\n\n    subgraph OUTPUT[\"OUTPUTS\"]\n        O1[\"~/output/{zone}/{timestamp}-{filename}.{result}\"]\n        O2[\"~/archive/{zone}/{timestamp}-{filename}.{original}\"]\n    end\n\n    WATCHER --> OUTPUT\n\n    style DROPS fill:#e3f2fd\n    style WATCHER fill:#fff3e0\n    style OUTPUT fill:#c8e6c9\n\u003C/pre>\n\u003Ch2 id=\"poc-complete-drop-zone-system\">POC: Complete Drop Zone System\u003C/h2>\n\u003Ch3 id=\"step-1-configuration-file\">Step 1: Configuration File\u003C/h3>\n\u003Cp>Create \u003Ccode>drops.yaml\u003C/code>:\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"53\" data-has-github=\"true\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">YAML\u003C/span>\u003Cspan class=\"language-badge\">yaml\u003C/span>\u003Ca class=\"github-header-link\" href=\"https://github.com/ameno-/acidbath-code/blob/main/production-patterns/directory-watchers/step-configuration-file/step-configuration-file.yaml\" target=\"_blank\" rel=\"noopener noreferrer\" title=\"View source on GitHub: production-patterns/directory-watchers/step-configuration-file/step-configuration-file.yaml\">\u003Cspan class=\"github-icon\">↗\u003C/span>\u003Cspan class=\"github-text\">GitHub\u003C/span>\u003C/a>\u003C/div>\u003Cdiv class=\"code-block-container collapsible with-line-numbers has-github-link\" data-language=\"yaml\" data-line-count=\"53\" data-max-preview=\"8\" data-github-url=\"https://github.com/ameno-/acidbath-code/blob/main/production-patterns/directory-watchers/step-configuration-file/step-configuration-file.yaml\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cbutton class=\"collapse-toggle\" aria-label=\"Toggle code visibility\" type=\"button\">\u003Cspan class=\"expand-text\">Expand (53 lines)\u003C/span>\u003Cspan class=\"collapse-text\">Collapse\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Clink rel=\"stylesheet\" href=\"/_astro/ec.44wa8.css\">\u003Cscript type=\"module\" src=\"/_astro/ec.0vx5m.js\">\u003C/script>\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"yaml\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># github: https://github.com/ameno-/acidbath-code/blob/main/production-patterns/directory-watchers/step-configuration-file/step-configuration-file.yaml\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Drop Zone Configuration\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Each zone watches a directory and triggers an agent on file events\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">output_dir\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">~/output\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">archive_dir\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">~/archive\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">log_dir\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">~/logs\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">zones\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">transcribe\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">directory\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">~/drops/transcribe\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">patterns\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: [\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"*.mp3\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"*.wav\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"*.m4a\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"*.webm\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">]\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">agent\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">whisper_transcribe\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">events\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: [\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">created\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">]\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">analyze\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">directory\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">~/drops/analyze\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">patterns\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: [\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"*.txt\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"*.md\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"*.pdf\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">]\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">agent\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">claude_analyze\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">events\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: [\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">created\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">]\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">images\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">directory\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">~/drops/images\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">patterns\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: [\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"*.txt\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">]  \u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Text file contains image prompts\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">agent\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">replicate_generate\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">events\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: [\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">created\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">]\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">data\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">directory\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">~/drops/data\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">patterns\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: [\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"*.csv\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"*.json\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">]\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">agent\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">claude_data_analysis\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">events\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: [\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">created\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">]\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">agents\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">whisper_transcribe\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">type\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">bash\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">command\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">|\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">      \u003C/span>\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">whisper \"{file}\" --output_dir \"{output_dir}\" --output_format txt\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">claude_analyze\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">type\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">claude\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">prompt_file\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">prompts/analyze.md\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">model\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">claude-3-5-sonnet-20241022\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">replicate_generate\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">type\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">python\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">script\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">agents/image_gen.py\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">claude_data_analysis\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">type\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">claude\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">prompt_file\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">prompts/data_analysis.md\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">model\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">claude-3-5-sonnet-20241022\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"# github: https://github.com/ameno-/acidbath-code/blob/main/production-patterns/directory-watchers/step-configuration-file/step-configuration-file.yaml# Drop Zone Configuration# Each zone watches a directory and triggers an agent on file eventsoutput_dir: ~/outputarchive_dir: ~/archivelog_dir: ~/logszones:  transcribe:    directory: ~/drops/transcribe    patterns: [&#x22;*.mp3&#x22;, &#x22;*.wav&#x22;, &#x22;*.m4a&#x22;, &#x22;*.webm&#x22;]    agent: whisper_transcribe    events: [created]  analyze:    directory: ~/drops/analyze    patterns: [&#x22;*.txt&#x22;, &#x22;*.md&#x22;, &#x22;*.pdf&#x22;]    agent: claude_analyze    events: [created]  images:    directory: ~/drops/images    patterns: [&#x22;*.txt&#x22;]  # Text file contains image prompts    agent: replicate_generate    events: [created]  data:    directory: ~/drops/data    patterns: [&#x22;*.csv&#x22;, &#x22;*.json&#x22;]    agent: claude_data_analysis    events: [created]agents:  whisper_transcribe:    type: bash    command: |      whisper &#x22;{file}&#x22; --output_dir &#x22;{output_dir}&#x22; --output_format txt  claude_analyze:    type: claude    prompt_file: prompts/analyze.md    model: claude-3-5-sonnet-20241022  replicate_generate:    type: python    script: agents/image_gen.py  claude_data_analysis:    type: claude    prompt_file: prompts/data_analysis.md    model: claude-3-5-sonnet-20241022\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003Cdiv class=\"code-fade\" aria-hidden=\"true\">\u003C/div>\u003C/div>\u003Cdiv class=\"code-block-footer\">\u003Ca class=\"github-source-link\" href=\"https://github.com/ameno-/acidbath-code/blob/main/production-patterns/directory-watchers/step-configuration-file/step-configuration-file.yaml\" target=\"_blank\" rel=\"noopener noreferrer\">\u003Cspan class=\"github-arrow\">→\u003C/span>\u003Cspan> View full source: production-patterns/directory-watchers/step-configuration-file/step-configuration-file.yaml\u003C/span>\u003C/a>\u003C/div>\u003C/div>\n\u003Ch3 id=\"step-2-the-core-watcher\">Step 2: The Core Watcher\u003C/h3>\n\u003Cp>Create \u003Ccode>drop_watcher.py\u003C/code>:\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"220\" data-has-github=\"true\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">PYTHON\u003C/span>\u003Cspan class=\"language-badge\">python\u003C/span>\u003Ca class=\"github-header-link\" href=\"https://github.com/ameno-/acidbath-code/blob/main/production-patterns/directory-watchers/step-core-watcher/step_core_watcher.py\" target=\"_blank\" rel=\"noopener noreferrer\" title=\"View source on GitHub: production-patterns/directory-watchers/step-core-watcher/step_core_watcher.py\">\u003Cspan class=\"github-icon\">↗\u003C/span>\u003Cspan class=\"github-text\">GitHub\u003C/span>\u003C/a>\u003C/div>\u003Cdiv class=\"code-block-container collapsible with-line-numbers has-github-link\" data-language=\"python\" data-line-count=\"220\" data-max-preview=\"8\" data-github-url=\"https://github.com/ameno-/acidbath-code/blob/main/production-patterns/directory-watchers/step-core-watcher/step_core_watcher.py\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cbutton class=\"collapse-toggle\" aria-label=\"Toggle code visibility\" type=\"button\">\u003Cspan class=\"expand-text\">Expand (220 lines)\u003C/span>\u003Cspan class=\"collapse-text\">Collapse\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"python\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># github: https://github.com/ameno-/acidbath-code/blob/main/production-patterns/directory-watchers/step-core-watcher/step_core_watcher.py\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\">#!/usr/bin/env -S uv run\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># /// script\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># dependencies = [\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\">#   \"watchdog>=4.0.0\",\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\">#   \"pyyaml>=6.0\",\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\">#   \"rich>=13.0.0\",\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\">#   \"anthropic>=0.40.0\",\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># ]\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># ///\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\"\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">Drop Zone Watcher - File-based AI automation\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">Usage:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">uv run drop_watcher.py [--config drops.yaml]\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">Watches configured directories and triggers agents on file events.\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\"\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">import\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> argparse\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">import\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> fnmatch\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">import\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> os\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">import\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> shutil\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">import\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> subprocess\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">import\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> time\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">from\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> datetime \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">import\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> datetime\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">from\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> pathlib \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">import\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Path\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">import\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> yaml\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">from\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> anthropic \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">import\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Anthropic\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">from\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> rich.console \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">import\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Console\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">from\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> rich.panel \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">import\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Panel\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">from\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> watchdog.events \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">import\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> FileSystemEventHandler\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">from\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> watchdog.observers \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">import\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Observer\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">console \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Console()\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">class\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">DropZoneHandler\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(\u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">FileSystemEventHandler\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">):\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">def\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">__init__\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(self, zone_name: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">str\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, zone_config: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">dict\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, global_config: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">dict\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">):\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">self\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">.zone_name \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> zone_name\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">self\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">.zone_config \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> zone_config\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">self\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">.global_config \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> global_config\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">self\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">.patterns \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> zone_config.get(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"patterns\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, [\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"*\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">])\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">self\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">.agent_name \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> zone_config.get(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"agent\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">self\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">.agent_config \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> global_config[\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"agents\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">].get(\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">self\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">.agent_name, {})\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">def\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">on_created\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(self, event):\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">if\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> event.is_directory:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">            \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">return\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">if\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"created\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">not\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">in\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">self\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">.zone_config.get(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"events\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, [\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"created\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">]):\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">            \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">return\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">self\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">._process_file(event.src_path)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">def\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">on_modified\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(self, event):\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">if\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> event.is_directory:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">            \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">return\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">if\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"modified\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">not\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">in\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">self\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">.zone_config.get(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"events\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, []):\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">            \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">return\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">self\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">._process_file(event.src_path)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">def\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">_matches_pattern\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(self, filepath: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">str\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">) -> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">bool\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">filename \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> os.path.basename(filepath)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">return\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">any\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(fnmatch.fnmatch(filename, p) \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">for\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> p \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">in\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">self\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">.patterns)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">def\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">_process_file\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(self, filepath: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">str\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">):\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">if\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">not\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">self\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">._matches_pattern(filepath):\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">            \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">return\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Wait for file to be fully written\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">time.sleep(\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">0.5\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">console.print(Panel(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">            \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">f\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"[bold green]Processing:[/] \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">{\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">filepath\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">}\\n\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">            \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">f\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"[bold blue]Zone:[/] \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">{self\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">.zone_name\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">}\\n\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">            \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">f\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"[bold yellow]Agent:[/] \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">{self\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">.agent_name\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">}\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">            \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">title\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"Drop Detected\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">))\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">try\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">            \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">output_path \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">self\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">._run_agent(filepath)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">            \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">self\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">._archive_file(filepath)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">            \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">console.print(\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">f\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"[green]✓[/] Output: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">{\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">output_path\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">}\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">except\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">Exception\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">as\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> e:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">            \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">console.print(\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">f\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"[red]✗[/] Error: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">{\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">e\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">}\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">def\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">_run_agent\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(self, filepath: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">str\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">) -> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">str\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">agent_type \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">self\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">.agent_config.get(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"type\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"bash\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">output_dir \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">self\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">._get_output_dir()\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">if\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> agent_type \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">==\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"bash\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">            \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">return\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">self\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">._run_bash_agent(filepath, output_dir)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">elif\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> agent_type \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">==\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"claude\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">            \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">return\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">self\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">._run_claude_agent(filepath, output_dir)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">elif\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> agent_type \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">==\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"python\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">            \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">return\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">self\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">._run_python_agent(filepath, output_dir)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">else\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">            \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">raise\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">ValueError\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">f\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"Unknown agent type: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">{\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">agent_type\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">}\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">def\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">_run_bash_agent\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(self, filepath: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">str\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, output_dir: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">str\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">) -> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">str\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">command \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">self\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">.agent_config[\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"command\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">].format(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">            \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">file\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">filepath,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">            \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">output_dir\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">output_dir\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">subprocess.run(command, \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">shell\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">True\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">check\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">True\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">return\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> output_dir\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">def\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">_run_claude_agent\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(self, filepath: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">str\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, output_dir: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">str\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">) -> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">str\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">prompt_file \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">self\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">.agent_config.get(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"prompt_file\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">model \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">self\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">.agent_config.get(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"model\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"claude-3-5-sonnet-20241022\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Load prompt template\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">with\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">open\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(prompt_file) \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">as\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> f:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">            \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">prompt_template \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> f.read()\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Read input file\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">with\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">open\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(filepath) \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">as\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> f:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">            \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">content \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> f.read()\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Substitute variables\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">prompt \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> prompt_template.replace(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">{content}\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, content)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">prompt \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> prompt.replace(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">{filename}\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, os.path.basename(filepath))\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Call Claude\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">client \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Anthropic()\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">response \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> client.messages.create(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">            \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">model\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">model,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">            \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">max_tokens\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">4096\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">            \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">messages\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">[{\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"role\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"user\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"content\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: prompt}]\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">result \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> response.content[\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">0\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">].text\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Write output\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">timestamp \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> datetime.now().strftime(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"%Y%m\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">%d\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">-%H%M%S\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">output_filename \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">f\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">{\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">timestamp\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">}\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">-\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">{\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">Path(filepath).stem\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">}\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">.md\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">output_path \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> os.path.join(output_dir, output_filename)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">os.makedirs(output_dir, \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">exist_ok\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">True\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">with\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">open\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(output_path, \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"w\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">) \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">as\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> f:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">            \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">f.write(result)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">return\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> output_path\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">def\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">_run_python_agent\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(self, filepath: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">str\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, output_dir: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">str\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">) -> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">str\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">script \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">self\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">.agent_config[\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"script\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">]\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">result \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> subprocess.run(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">            \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">[\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"uv\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"run\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, script, filepath, output_dir],\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">            \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">capture_output\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">True\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">            \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">text\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">True\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">            \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">check\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">True\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">return\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> result.stdout.strip()\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">def\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">_get_output_dir\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(self) -> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">str\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">base \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> os.path.expanduser(\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">self\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">.global_config.get(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"output_dir\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"~/output\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">))\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">return\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> os.path.join(base, \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">self\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">.zone_name)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">def\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">_archive_file\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(self, filepath: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">str\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">):\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">archive_base \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> os.path.expanduser(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">            \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">self\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">.global_config.get(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"archive_dir\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"~/archive\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">archive_dir \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> os.path.join(archive_base, \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">self\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">.zone_name)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">os.makedirs(archive_dir, \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">exist_ok\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">True\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">timestamp \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> datetime.now().strftime(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"%Y%m\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">%d\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">-%H%M%S\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">filename \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> os.path.basename(filepath)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">archive_path \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> os.path.join(archive_dir, \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">f\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">{\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">timestamp\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">}\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">-\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">{\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">filename\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">}\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">shutil.move(filepath, archive_path)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">def\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">load_config\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(config_path: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">str\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">) -> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">dict\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">with\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">open\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(config_path) \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">as\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> f:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">return\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> yaml.safe_load(f)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">def\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">setup_watchers\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(config: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">dict\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">) -> Observer:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">observer \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Observer()\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">for\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> zone_name, zone_config \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">in\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> config.get(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"zones\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, {}).items():\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">directory \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> os.path.expanduser(zone_config[\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"directory\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">])\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">os.makedirs(directory, \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">exist_ok\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">True\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">handler \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> DropZoneHandler(zone_name, zone_config, config)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">observer.schedule(handler, directory, \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">recursive\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">False\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">console.print(\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">f\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"[blue]Watching:[/] \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">{\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">directory\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">}\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\"> → \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">{\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">zone_config[\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">'agent'\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">]\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">}\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">return\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> observer\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">def\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">main\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">():\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">parser \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> argparse.ArgumentParser(\u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">description\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"Drop Zone Watcher\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">parser.add_argument(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"--config\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">default\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"drops.yaml\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">help\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"Config file path\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">args \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> parser.parse_args()\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">config \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> load_config(args.config)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">console.print(Panel(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"[bold]Drop Zone Watcher[/]\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">\\n\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"Drag files into watched directories to trigger AI agents.\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">title\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"Starting\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">))\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">observer \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> setup_watchers(config)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">observer.start()\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">try\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">while\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">True\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">            \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">time.sleep(\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">1\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">except\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">KeyboardInterrupt\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">observer.stop()\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">console.print(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"[yellow]Shutting down...[/]\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">observer.join()\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">if\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">__name__\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">==\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"__main__\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">main()\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"# github: https://github.com/ameno-/acidbath-code/blob/main/production-patterns/directory-watchers/step-core-watcher/step_core_watcher.py#!/usr/bin/env -S uv run# /// script# dependencies = [#   &#x22;watchdog>=4.0.0&#x22;,#   &#x22;pyyaml>=6.0&#x22;,#   &#x22;rich>=13.0.0&#x22;,#   &#x22;anthropic>=0.40.0&#x22;,# ]# ///&#x22;&#x22;&#x22;Drop Zone Watcher - File-based AI automationUsage:    uv run drop_watcher.py [--config drops.yaml]Watches configured directories and triggers agents on file events.&#x22;&#x22;&#x22;import argparseimport fnmatchimport osimport shutilimport subprocessimport timefrom datetime import datetimefrom pathlib import Pathimport yamlfrom anthropic import Anthropicfrom rich.console import Consolefrom rich.panel import Panelfrom watchdog.events import FileSystemEventHandlerfrom watchdog.observers import Observerconsole = Console()class DropZoneHandler(FileSystemEventHandler):    def __init__(self, zone_name: str, zone_config: dict, global_config: dict):        self.zone_name = zone_name        self.zone_config = zone_config        self.global_config = global_config        self.patterns = zone_config.get(&#x22;patterns&#x22;, [&#x22;*&#x22;])        self.agent_name = zone_config.get(&#x22;agent&#x22;)        self.agent_config = global_config[&#x22;agents&#x22;].get(self.agent_name, {})    def on_created(self, event):        if event.is_directory:            return        if &#x22;created&#x22; not in self.zone_config.get(&#x22;events&#x22;, [&#x22;created&#x22;]):            return        self._process_file(event.src_path)    def on_modified(self, event):        if event.is_directory:            return        if &#x22;modified&#x22; not in self.zone_config.get(&#x22;events&#x22;, []):            return        self._process_file(event.src_path)    def _matches_pattern(self, filepath: str) -> bool:        filename = os.path.basename(filepath)        return any(fnmatch.fnmatch(filename, p) for p in self.patterns)    def _process_file(self, filepath: str):        if not self._matches_pattern(filepath):            return        # Wait for file to be fully written        time.sleep(0.5)        console.print(Panel(            f&#x22;[bold green]Processing:[/] {filepath}\\n&#x22;            f&#x22;[bold blue]Zone:[/] {self.zone_name}\\n&#x22;            f&#x22;[bold yellow]Agent:[/] {self.agent_name}&#x22;,            title=&#x22;Drop Detected&#x22;        ))        try:            output_path = self._run_agent(filepath)            self._archive_file(filepath)            console.print(f&#x22;[green]✓[/] Output: {output_path}&#x22;)        except Exception as e:            console.print(f&#x22;[red]✗[/] Error: {e}&#x22;)    def _run_agent(self, filepath: str) -> str:        agent_type = self.agent_config.get(&#x22;type&#x22;, &#x22;bash&#x22;)        output_dir = self._get_output_dir()        if agent_type == &#x22;bash&#x22;:            return self._run_bash_agent(filepath, output_dir)        elif agent_type == &#x22;claude&#x22;:            return self._run_claude_agent(filepath, output_dir)        elif agent_type == &#x22;python&#x22;:            return self._run_python_agent(filepath, output_dir)        else:            raise ValueError(f&#x22;Unknown agent type: {agent_type}&#x22;)    def _run_bash_agent(self, filepath: str, output_dir: str) -> str:        command = self.agent_config[&#x22;command&#x22;].format(            file=filepath,            output_dir=output_dir        )        subprocess.run(command, shell=True, check=True)        return output_dir    def _run_claude_agent(self, filepath: str, output_dir: str) -> str:        prompt_file = self.agent_config.get(&#x22;prompt_file&#x22;)        model = self.agent_config.get(&#x22;model&#x22;, &#x22;claude-3-5-sonnet-20241022&#x22;)        # Load prompt template        with open(prompt_file) as f:            prompt_template = f.read()        # Read input file        with open(filepath) as f:            content = f.read()        # Substitute variables        prompt = prompt_template.replace(&#x22;{content}&#x22;, content)        prompt = prompt.replace(&#x22;{filename}&#x22;, os.path.basename(filepath))        # Call Claude        client = Anthropic()        response = client.messages.create(            model=model,            max_tokens=4096,            messages=[{&#x22;role&#x22;: &#x22;user&#x22;, &#x22;content&#x22;: prompt}]        )        result = response.content[0].text        # Write output        timestamp = datetime.now().strftime(&#x22;%Y%m%d-%H%M%S&#x22;)        output_filename = f&#x22;{timestamp}-{Path(filepath).stem}.md&#x22;        output_path = os.path.join(output_dir, output_filename)        os.makedirs(output_dir, exist_ok=True)        with open(output_path, &#x22;w&#x22;) as f:            f.write(result)        return output_path    def _run_python_agent(self, filepath: str, output_dir: str) -> str:        script = self.agent_config[&#x22;script&#x22;]        result = subprocess.run(            [&#x22;uv&#x22;, &#x22;run&#x22;, script, filepath, output_dir],            capture_output=True,            text=True,            check=True        )        return result.stdout.strip()    def _get_output_dir(self) -> str:        base = os.path.expanduser(self.global_config.get(&#x22;output_dir&#x22;, &#x22;~/output&#x22;))        return os.path.join(base, self.zone_name)    def _archive_file(self, filepath: str):        archive_base = os.path.expanduser(            self.global_config.get(&#x22;archive_dir&#x22;, &#x22;~/archive&#x22;)        )        archive_dir = os.path.join(archive_base, self.zone_name)        os.makedirs(archive_dir, exist_ok=True)        timestamp = datetime.now().strftime(&#x22;%Y%m%d-%H%M%S&#x22;)        filename = os.path.basename(filepath)        archive_path = os.path.join(archive_dir, f&#x22;{timestamp}-{filename}&#x22;)        shutil.move(filepath, archive_path)def load_config(config_path: str) -> dict:    with open(config_path) as f:        return yaml.safe_load(f)def setup_watchers(config: dict) -> Observer:    observer = Observer()    for zone_name, zone_config in config.get(&#x22;zones&#x22;, {}).items():        directory = os.path.expanduser(zone_config[&#x22;directory&#x22;])        os.makedirs(directory, exist_ok=True)        handler = DropZoneHandler(zone_name, zone_config, config)        observer.schedule(handler, directory, recursive=False)        console.print(f&#x22;[blue]Watching:[/] {directory} → {zone_config[&#x27;agent&#x27;]}&#x22;)    return observerdef main():    parser = argparse.ArgumentParser(description=&#x22;Drop Zone Watcher&#x22;)    parser.add_argument(&#x22;--config&#x22;, default=&#x22;drops.yaml&#x22;, help=&#x22;Config file path&#x22;)    args = parser.parse_args()    config = load_config(args.config)    console.print(Panel(        &#x22;[bold]Drop Zone Watcher[/]\\n&#x22;        &#x22;Drag files into watched directories to trigger AI agents.&#x22;,        title=&#x22;Starting&#x22;    ))    observer = setup_watchers(config)    observer.start()    try:        while True:            time.sleep(1)    except KeyboardInterrupt:        observer.stop()        console.print(&#x22;[yellow]Shutting down...[/]&#x22;)    observer.join()if __name__ == &#x22;__main__&#x22;:    main()\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003Cdiv class=\"code-fade\" aria-hidden=\"true\">\u003C/div>\u003C/div>\u003Cdiv class=\"code-block-footer\">\u003Ca class=\"github-source-link\" href=\"https://github.com/ameno-/acidbath-code/blob/main/production-patterns/directory-watchers/step-core-watcher/step_core_watcher.py\" target=\"_blank\" rel=\"noopener noreferrer\">\u003Cspan class=\"github-arrow\">→\u003C/span>\u003Cspan> View full source: production-patterns/directory-watchers/step-core-watcher/step_core_watcher.py\u003C/span>\u003C/a>\u003C/div>\u003C/div>\n\u003Ch3 id=\"step-3-agent-prompt-templates\">Step 3: Agent Prompt Templates\u003C/h3>\n\u003Cp>Create \u003Ccode>prompts/analyze.md\u003C/code>:\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"30\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">MARKDOWN\u003C/span>\u003Cspan class=\"language-badge\">markdown\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container collapsible with-line-numbers\" data-language=\"markdown\" data-line-count=\"30\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cbutton class=\"collapse-toggle\" aria-label=\"Toggle code visibility\" type=\"button\">\u003Cspan class=\"expand-text\">Expand (30 lines)\u003C/span>\u003Cspan class=\"collapse-text\">Collapse\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"markdown\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#79B8FF;--0fw:bold;--1:#005CC5;--1fw:bold\"># Document Analysis Agent\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">Analyze the following document and provide a structured summary.\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#79B8FF;--0fw:bold;--1:#005CC5;--1fw:bold\">## Document Content\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">{content}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#79B8FF;--0fw:bold;--1:#005CC5;--1fw:bold\">## Output Format\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">Provide your analysis in this format:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#79B8FF;--0fw:bold;--1:#005CC5;--1fw:bold\">### Summary\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">A 2-3 sentence overview of the document.\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#79B8FF;--0fw:bold;--1:#005CC5;--1fw:bold\">### Key Points\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Bullet point list of main ideas\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#79B8FF;--0fw:bold;--1:#005CC5;--1fw:bold\">### Topics Covered\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> List of topics/themes\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#79B8FF;--0fw:bold;--1:#005CC5;--1fw:bold\">### Action Items (if applicable)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Numbered list of action items\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#79B8FF;--0fw:bold;--1:#005CC5;--1fw:bold\">### Questions Raised\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Questions that arise from this content\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#79B8FF;--0fw:bold;--1:#005CC5;--1fw:bold\">### Confidence\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">How confident are you in this analysis? (high/medium/low) and why.\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"# Document Analysis AgentAnalyze the following document and provide a structured summary.## Document Content{content}## Output FormatProvide your analysis in this format:### SummaryA 2-3 sentence overview of the document.### Key Points- Bullet point list of main ideas### Topics Covered- List of topics/themes### Action Items (if applicable)- Numbered list of action items### Questions Raised- Questions that arise from this content### ConfidenceHow confident are you in this analysis? (high/medium/low) and why.\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003Cdiv class=\"code-fade\" aria-hidden=\"true\">\u003C/div>\u003C/div>\u003C/div>\n\u003Cp>Create \u003Ccode>prompts/data_analysis.md\u003C/code>:\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"37\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">MARKDOWN\u003C/span>\u003Cspan class=\"language-badge\">markdown\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container collapsible with-line-numbers\" data-language=\"markdown\" data-line-count=\"37\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cbutton class=\"collapse-toggle\" aria-label=\"Toggle code visibility\" type=\"button\">\u003Cspan class=\"expand-text\">Expand (37 lines)\u003C/span>\u003Cspan class=\"collapse-text\">Collapse\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"markdown\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#79B8FF;--0fw:bold;--1:#005CC5;--1fw:bold\"># Data Analysis Agent\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">Analyze the following data file and provide insights.\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#79B8FF;--0fw:bold;--1:#005CC5;--1fw:bold\">## Data Content\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">{content}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#79B8FF;--0fw:bold;--1:#005CC5;--1fw:bold\">## Filename\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">{filename}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#79B8FF;--0fw:bold;--1:#005CC5;--1fw:bold\">## Analysis Required\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">1.\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#E1E4E8;--0fw:bold;--1:#24292E;--1fw:bold\">**Data Overview**\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> File format (CSV, JSON, etc.)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Number of records/rows\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Column/field names\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">2.\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#E1E4E8;--0fw:bold;--1:#24292E;--1fw:bold\">**Statistical Summary**\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> For numeric columns: min, max, mean, median\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> For categorical columns: unique values, distribution\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">3.\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#E1E4E8;--0fw:bold;--1:#24292E;--1fw:bold\">**Data Quality**\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Missing values\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Potential outliers\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Data type issues\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">4.\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#E1E4E8;--0fw:bold;--1:#24292E;--1fw:bold\">**Insights**\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Key patterns or trends\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Notable correlations\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Anomalies worth investigating\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">5.\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#E1E4E8;--0fw:bold;--1:#24292E;--1fw:bold\">**Recommendations**\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Suggested next steps for analysis\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Visualization recommendations\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">   \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Data cleaning suggestions\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"# Data Analysis AgentAnalyze the following data file and provide insights.## Data Content{content}## Filename{filename}## Analysis Required1. **Data Overview**   - File format (CSV, JSON, etc.)   - Number of records/rows   - Column/field names2. **Statistical Summary**   - For numeric columns: min, max, mean, median   - For categorical columns: unique values, distribution3. **Data Quality**   - Missing values   - Potential outliers   - Data type issues4. **Insights**   - Key patterns or trends   - Notable correlations   - Anomalies worth investigating5. **Recommendations**   - Suggested next steps for analysis   - Visualization recommendations   - Data cleaning suggestions\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003Cdiv class=\"code-fade\" aria-hidden=\"true\">\u003C/div>\u003C/div>\u003C/div>\n\u003Ch3 id=\"step-4-image-generation-agent\">Step 4: Image Generation Agent\u003C/h3>\n\u003Cp>Create \u003Ccode>agents/image_gen.py\u003C/code>:\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"78\" data-has-github=\"true\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">PYTHON\u003C/span>\u003Cspan class=\"language-badge\">python\u003C/span>\u003Ca class=\"github-header-link\" href=\"https://github.com/ameno-/acidbath-code/blob/main/production-patterns/directory-watchers/step-image-generation/step_image_generation.py\" target=\"_blank\" rel=\"noopener noreferrer\" title=\"View source on GitHub: production-patterns/directory-watchers/step-image-generation/step_image_generation.py\">\u003Cspan class=\"github-icon\">↗\u003C/span>\u003Cspan class=\"github-text\">GitHub\u003C/span>\u003C/a>\u003C/div>\u003Cdiv class=\"code-block-container collapsible with-line-numbers has-github-link\" data-language=\"python\" data-line-count=\"78\" data-max-preview=\"8\" data-github-url=\"https://github.com/ameno-/acidbath-code/blob/main/production-patterns/directory-watchers/step-image-generation/step_image_generation.py\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cbutton class=\"collapse-toggle\" aria-label=\"Toggle code visibility\" type=\"button\">\u003Cspan class=\"expand-text\">Expand (78 lines)\u003C/span>\u003Cspan class=\"collapse-text\">Collapse\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"python\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># github: https://github.com/ameno-/acidbath-code/blob/main/production-patterns/directory-watchers/step-image-generation/step_image_generation.py\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\">#!/usr/bin/env -S uv run\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># /// script\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># dependencies = [\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\">#   \"replicate>=0.25.0\",\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\">#   \"requests>=2.31.0\",\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># ]\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># ///\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\"\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">Image Generation Agent\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">Reads prompts from a text file and generates images using Replicate.\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">Each line in the file is a separate prompt.\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\"\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">import\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> os\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">import\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> sys\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">from\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> datetime \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">import\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> datetime\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">from\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> pathlib \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">import\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> Path\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">import\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> replicate\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">import\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> requests\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">def\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">generate_images\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(input_file: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">str\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, output_dir: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">str\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">) -> list[\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">str\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">]:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\"\"Generate images from prompts in input file.\"\"\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">os.makedirs(output_dir, \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">exist_ok\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">True\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">with\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">open\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(input_file) \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">as\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> f:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">prompts \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> [line.strip() \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">for\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> line \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">in\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> f \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">if\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> line.strip()]\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">generated \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> []\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">for\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> i, prompt \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">in\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">enumerate\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(prompts):\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">print\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">f\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"Generating \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">{\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">i\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">+\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">1}\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">/\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">{len\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(prompts)\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">}\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">{\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">prompt[:\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">50\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">]\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">}\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">...\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">output \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> replicate.run(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">            \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"stability-ai/sdxl:39ed52f2a78e934b3ba6e2a89f5b1c712de7dfea535525255b1aa35c5565e08b\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">            \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">input\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">                \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"prompt\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: prompt,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">                \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"width\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">1024\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">                \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"height\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">1024\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">            \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Download the image\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">if\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> output:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">            \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">image_url \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> output[\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">0\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">]\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">            \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">response \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> requests.get(image_url)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">            \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">timestamp \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> datetime.now().strftime(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"%Y%m\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">%d\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">-%H%M%S\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">            \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">safe_prompt \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> prompt[:\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">30\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">].replace(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\" \"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"_\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">).replace(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"/\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"-\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">            \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">filename \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">f\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">{\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">timestamp\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">}\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">-\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">{\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">i\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">:03d\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">}\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">-\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">{\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">safe_prompt\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">}\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">.png\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">            \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">filepath \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> os.path.join(output_dir, filename)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">            \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">with\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">open\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(filepath, \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"wb\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">) \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">as\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> f:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">                \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">f.write(response.content)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">            \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">generated.append(filepath)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">            \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">print\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">f\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"  Saved: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">{\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">filepath\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">}\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">return\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> generated\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">if\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">__name__\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">==\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"__main__\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">if\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">len\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(sys.argv) \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">3\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">print\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"Usage: uv run image_gen.py &#x3C;input_file> &#x3C;output_dir>\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">sys.exit(\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">1\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">input_file \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> sys.argv[\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">1\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">]\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">output_dir \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> sys.argv[\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">2\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">]\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">files \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> generate_images(input_file, output_dir)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">print\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">f\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">\\n\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">Generated \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">{len\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(files)\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">}\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\"> images\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Return output path\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">print\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(output_dir)\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"# github: https://github.com/ameno-/acidbath-code/blob/main/production-patterns/directory-watchers/step-image-generation/step_image_generation.py#!/usr/bin/env -S uv run# /// script# dependencies = [#   &#x22;replicate>=0.25.0&#x22;,#   &#x22;requests>=2.31.0&#x22;,# ]# ///&#x22;&#x22;&#x22;Image Generation AgentReads prompts from a text file and generates images using Replicate.Each line in the file is a separate prompt.&#x22;&#x22;&#x22;import osimport sysfrom datetime import datetimefrom pathlib import Pathimport replicateimport requestsdef generate_images(input_file: str, output_dir: str) -> list[str]:    &#x22;&#x22;&#x22;Generate images from prompts in input file.&#x22;&#x22;&#x22;    os.makedirs(output_dir, exist_ok=True)    with open(input_file) as f:        prompts = [line.strip() for line in f if line.strip()]    generated = []    for i, prompt in enumerate(prompts):        print(f&#x22;Generating {i+1}/{len(prompts)}: {prompt[:50]}...&#x22;)        output = replicate.run(            &#x22;stability-ai/sdxl:39ed52f2a78e934b3ba6e2a89f5b1c712de7dfea535525255b1aa35c5565e08b&#x22;,            input={                &#x22;prompt&#x22;: prompt,                &#x22;width&#x22;: 1024,                &#x22;height&#x22;: 1024,            }        )        # Download the image        if output:            image_url = output[0]            response = requests.get(image_url)            timestamp = datetime.now().strftime(&#x22;%Y%m%d-%H%M%S&#x22;)            safe_prompt = prompt[:30].replace(&#x22; &#x22;, &#x22;_&#x22;).replace(&#x22;/&#x22;, &#x22;-&#x22;)            filename = f&#x22;{timestamp}-{i:03d}-{safe_prompt}.png&#x22;            filepath = os.path.join(output_dir, filename)            with open(filepath, &#x22;wb&#x22;) as f:                f.write(response.content)            generated.append(filepath)            print(f&#x22;  Saved: {filepath}&#x22;)    return generatedif __name__ == &#x22;__main__&#x22;:    if len(sys.argv) \u003C 3:        print(&#x22;Usage: uv run image_gen.py \u003Cinput_file> \u003Coutput_dir>&#x22;)        sys.exit(1)    input_file = sys.argv[1]    output_dir = sys.argv[2]    files = generate_images(input_file, output_dir)    print(f&#x22;\\nGenerated {len(files)} images&#x22;)    # Return output path    print(output_dir)\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003Cdiv class=\"code-fade\" aria-hidden=\"true\">\u003C/div>\u003C/div>\u003Cdiv class=\"code-block-footer\">\u003Ca class=\"github-source-link\" href=\"https://github.com/ameno-/acidbath-code/blob/main/production-patterns/directory-watchers/step-image-generation/step_image_generation.py\" target=\"_blank\" rel=\"noopener noreferrer\">\u003Cspan class=\"github-arrow\">→\u003C/span>\u003Cspan> View full source: production-patterns/directory-watchers/step-image-generation/step_image_generation.py\u003C/span>\u003C/a>\u003C/div>\u003C/div>\n\u003Ch2 id=\"data-flow-file-drop-to-result\">Data Flow: File Drop to Result\u003C/h2>\n\u003Cpre class=\"mermaid\">flowchart LR\n    subgraph Input\n        A[User drops file.txt]\n    end\n\n    subgraph Watcher\n        B[Watchdog detects create event]\n        C[Pattern matches *.txt]\n        D[Agent selected: claude_analyze]\n    end\n\n    subgraph Agent\n        E[Load prompt template]\n        F[Read file content]\n        G[Call Claude API]\n        H[Write result.md]\n    end\n\n    subgraph Cleanup\n        I[Archive original]\n        J[Log completion]\n    end\n\n    A --> B --> C --> D --> E --> F --> G --> H --> I --> J\n\n    style A fill:#e8f5e9\n    style H fill:#e3f2fd\n    style J fill:#fff3e0\n\u003C/pre>\n\u003Ch2 id=\"when-drop-zones-fail-and-how-to-fix-each-one\">When Drop Zones Fail (And How to Fix Each One)\u003C/h2>\n\u003Cp>The POC above works for clean, isolated files. Production breaks in predictable ways—and each failure mode has a tested solution.\u003C/p>\n\u003Ch3 id=\"files-that-need-context\">Files That Need Context\u003C/h3>\n\u003Cp>A code file dropped into a review zone lacks its dependencies, imports, and surrounding architecture. The agent sees \u003Ccode>import UserService from '../services'\u003C/code> but doesn’t know what UserService does.\u003C/p>\n\u003Cp>\u003Cstrong>What breaks:\u003C/strong> Reviews are shallow. “This looks fine” instead of “This violates the retry policy established in commit abc123.”\u003C/p>\n\u003Cp>\u003Cstrong>Fix:\u003C/strong> Add a context builder. Before processing, scan the repository for related files:\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"20\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">PYTHON\u003C/span>\u003Cspan class=\"language-badge\">python\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container collapsible with-line-numbers\" data-language=\"python\" data-line-count=\"20\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cbutton class=\"collapse-toggle\" aria-label=\"Toggle code visibility\" type=\"button\">\u003Cspan class=\"expand-text\">Expand (20 lines)\u003C/span>\u003Cspan class=\"collapse-text\">Collapse\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"python\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">def\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">gather_context\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(filepath: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">str\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">) -> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">dict\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\"\"Gather related files for context.\"\"\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">context \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> {\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"main_file\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: filepath}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Parse imports\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">with\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">open\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(filepath) \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">as\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> f:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">content \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> f.read()\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">imports \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> extract_imports(content)  \u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Your parser here\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Find imported files\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">related \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> []\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">for\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> imp \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">in\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> imports:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">path \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> resolve_import(imp, filepath)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">if\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> path \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">and\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> os.path.exists(path):\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">            \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">with\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">open\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(path) \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">as\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> f:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">                \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">related.append({\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"path\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: path, \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"content\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: f.read()})\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">context[\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"related_files\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">] \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> related\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">return\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> context\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"def gather_context(filepath: str) -> dict:    &#x22;&#x22;&#x22;Gather related files for context.&#x22;&#x22;&#x22;    context = {&#x22;main_file&#x22;: filepath}    # Parse imports    with open(filepath) as f:        content = f.read()        imports = extract_imports(content)  # Your parser here    # Find imported files    related = []    for imp in imports:        path = resolve_import(imp, filepath)        if path and os.path.exists(path):            with open(path) as f:                related.append({&#x22;path&#x22;: path, &#x22;content&#x22;: f.read()})    context[&#x22;related_files&#x22;] = related    return context\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003Cdiv class=\"code-fade\" aria-hidden=\"true\">\u003C/div>\u003C/div>\u003C/div>\n\u003Cp>This increases token usage 3-5x but improves accuracy significantly. For a 200-line Python file with 8 imports, you go from 800 tokens to 3,200 tokens. Cost per review goes from $0.02 to $0.08 with claude-3-5-sonnet-20241022.\u003C/p>\n\u003Ch3 id=\"multi-file-inputs\">Multi-File Inputs\u003C/h3>\n\u003Cp>Sometimes the task requires multiple files processed together. A blog post draft plus supporting research notes. Three screenshots that show a UI flow. CSV data plus its schema definition.\u003C/p>\n\u003Cp>\u003Cstrong>What breaks:\u003C/strong> The watcher processes files individually. Drop three related screenshots, get three unconnected analyses instead of one coherent flow analysis.\u003C/p>\n\u003Cp>\u003Cstrong>Fix:\u003C/strong> Add a staging area with batch processing:\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"9\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">YAML\u003C/span>\u003Cspan class=\"language-badge\">yaml\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container with-line-numbers\" data-language=\"yaml\" data-line-count=\"9\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"yaml\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># In drops.yaml\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">ui_review\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">directory\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">~/drops/ui-review\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">patterns\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: [\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"*.png\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"*.jpg\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">]\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">agent\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">ui_flow_analyzer\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">batch_mode\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">true\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">batch_window\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">30\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">  \u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># seconds\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">batch_trigger\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">3\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">  \u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># or N files\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"# In drops.yamlui_review:  directory: ~/drops/ui-review  patterns: [&#x22;*.png&#x22;, &#x22;*.jpg&#x22;]  agent: ui_flow_analyzer  batch_mode: true  batch_window: 30  # seconds  batch_trigger: 3  # or N files\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003C/div>\u003C/div>\n\u003Cp>Buffer files for 30 seconds. If 3+ files arrive, process as a batch. If timeout hits with fewer files, process what you have.\u003C/p>\n\u003Ch3 id=\"race-conditions-incomplete-writes\">Race Conditions: Incomplete Writes\u003C/h3>\n\u003Cp>You drop a 500MB video file. Watchdog fires on create. The agent starts processing while the file is still copying. Whisper transcribes 8 seconds of a 45-minute video.\u003C/p>\n\u003Cp>\u003Cstrong>What breaks:\u003C/strong> Partial processing. Silent failures. Confusing output.\u003C/p>\n\u003Cp>\u003Cstrong>Fix:\u003C/strong> Verify file stability before processing:\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"21\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">PYTHON\u003C/span>\u003Cspan class=\"language-badge\">python\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container collapsible with-line-numbers\" data-language=\"python\" data-line-count=\"21\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cbutton class=\"collapse-toggle\" aria-label=\"Toggle code visibility\" type=\"button\">\u003Cspan class=\"expand-text\">Expand (21 lines)\u003C/span>\u003Cspan class=\"collapse-text\">Collapse\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"python\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">def\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">wait_for_stable_file\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(filepath: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">str\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, timeout: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">int\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">30\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">) -> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">bool\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\"\"Wait until file size stops changing.\"\"\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">last_size \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">-\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">1\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">stable_count \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">0\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">for\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> _ \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">in\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">range\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(timeout):\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">try\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">            \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">current_size \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> os.path.getsize(filepath)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">            \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">if\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> current_size \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">==\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> last_size:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">                \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">stable_count \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">+=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">1\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">                \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">if\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> stable_count \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">>=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">3\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:  \u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Stable for 3 seconds\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">                    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">return\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">True\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">            \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">else\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">                \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">stable_count \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">0\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">            \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">last_size \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> current_size\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">except\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">OSError\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">            \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">pass\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">time.sleep(\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">1\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">return\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">False\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"def wait_for_stable_file(filepath: str, timeout: int = 30) -> bool:    &#x22;&#x22;&#x22;Wait until file size stops changing.&#x22;&#x22;&#x22;    last_size = -1    stable_count = 0    for _ in range(timeout):        try:            current_size = os.path.getsize(filepath)            if current_size == last_size:                stable_count += 1                if stable_count >= 3:  # Stable for 3 seconds                    return True            else:                stable_count = 0            last_size = current_size        except OSError:            pass        time.sleep(1)    return False\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003Cdiv class=\"code-fade\" aria-hidden=\"true\">\u003C/div>\u003C/div>\u003C/div>\n\u003Cp>Replace the POC’s \u003Ccode>time.sleep(0.5)\u003C/code> with this. A 500MB file takes 6-10 seconds to copy on typical hardware. Three-second stability window catches 99% of cases without excessive waiting.\u003C/p>\n\u003Ch3 id=\"agent-failures-mid-processing\">Agent Failures Mid-Processing\u003C/h3>\n\u003Cp>API rate limit hit. Network timeout. Model refuses the prompt due to content policy. The agent fails after archiving the input file but before writing output.\u003C/p>\n\u003Cp>\u003Cstrong>What breaks:\u003C/strong> Input file is gone. No output exists. No way to retry. User thinks it worked because no error appeared.\u003C/p>\n\u003Cp>\u003Cstrong>Fix:\u003C/strong> Transactional processing with rollback:\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"19\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">PYTHON\u003C/span>\u003Cspan class=\"language-badge\">python\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container collapsible with-line-numbers\" data-language=\"python\" data-line-count=\"19\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cbutton class=\"collapse-toggle\" aria-label=\"Toggle code visibility\" type=\"button\">\u003Cspan class=\"expand-text\">Expand (19 lines)\u003C/span>\u003Cspan class=\"collapse-text\">Collapse\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"python\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">def\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">_process_file\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(self, filepath: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">str\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">):\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">if\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">not\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">self\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">._matches_pattern(filepath):\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">return\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Create processing record\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">processing_id \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">self\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">._start_processing(filepath)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">try\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">output_path \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">self\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">._run_agent(filepath)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">self\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">._archive_file(filepath)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">self\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">._mark_complete(processing_id, output_path)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">console.print(\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">f\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"[green]✓[/] Output: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">{\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">output_path\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">}\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">except\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">Exception\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">as\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> e:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">self\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">._mark_failed(processing_id, \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">str\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(e))\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Don't archive on failure - leave for retry\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">console.print(\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">f\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"[red]✗[/] Error: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">{\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">e\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">}\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Write error details to dead letter queue\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">self\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">._write_to_dlq(filepath, processing_id, e)\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"def _process_file(self, filepath: str):    if not self._matches_pattern(filepath):        return    # Create processing record    processing_id = self._start_processing(filepath)    try:        output_path = self._run_agent(filepath)        self._archive_file(filepath)        self._mark_complete(processing_id, output_path)        console.print(f&#x22;[green]✓[/] Output: {output_path}&#x22;)    except Exception as e:        self._mark_failed(processing_id, str(e))        # Don&#x27;t archive on failure - leave for retry        console.print(f&#x22;[red]✗[/] Error: {e}&#x22;)        # Write error details to dead letter queue        self._write_to_dlq(filepath, processing_id, e)\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003Cdiv class=\"code-fade\" aria-hidden=\"true\">\u003C/div>\u003C/div>\u003C/div>\n\u003Cp>Keep failed files in place. Log failures to a dead letter queue. Provide a manual retry command. For our use case running 200 files/day, we see 3-5 transient failures per day. All are recoverable with retry.\u003C/p>\n\u003Ch3 id=\"token-limit-exceeded\">Token Limit Exceeded\u003C/h3>\n\u003Cp>A 15,000-line CSV file hits the analyze zone. The agent tries to stuff it all into a prompt. Claude returns a 400 error: maximum context length exceeded.\u003C/p>\n\u003Cp>\u003Cstrong>What breaks:\u003C/strong> Processing fails. File size limits aren’t obvious. No graceful degradation.\u003C/p>\n\u003Cp>\u003Cstrong>Fix:\u003C/strong> Add size checks and chunking strategy:\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"20\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">PYTHON\u003C/span>\u003Cspan class=\"language-badge\">python\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container collapsible with-line-numbers\" data-language=\"python\" data-line-count=\"20\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cbutton class=\"collapse-toggle\" aria-label=\"Toggle code visibility\" type=\"button\">\u003Cspan class=\"expand-text\">Expand (20 lines)\u003C/span>\u003Cspan class=\"collapse-text\">Collapse\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"python\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">def\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">_check_size_limits\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(self, filepath: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">str\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">) -> tuple[\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">bool\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">str\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">]:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\"\"Check if file is processable.\"\"\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">file_size \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> os.path.getsize(filepath)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">max_size \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">self\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">.agent_config.get(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"max_file_size\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">10\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">*\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">1024\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">*\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">1024\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)  \u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># 10MB default\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">if\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> file_size \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> max_size:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">return\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">False\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">f\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"File too large: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">{\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">file_size\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">}\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\"> bytes (max: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">{\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">max_size\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">}\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">)\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># For text files, estimate tokens\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">if\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> filepath.endswith((\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">'.txt'\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">'.md'\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">'.csv'\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">'.json'\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)):\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">with\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">open\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(filepath) \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">as\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> f:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">            \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">content \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> f.read()\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">estimated_tokens \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">len\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(content) \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">//\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">4\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">  \u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Rough estimate\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">max_tokens \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">self\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">.agent_config.get(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"max_tokens\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">100000\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">if\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> estimated_tokens \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> max_tokens:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">            \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">return\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">False\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">f\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"Content too large: ~\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">{\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">estimated_tokens\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">}\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\"> tokens (max: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">{\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">max_tokens\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">}\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">)\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">return\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">True\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"OK\"\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"def _check_size_limits(self, filepath: str) -> tuple[bool, str]:    &#x22;&#x22;&#x22;Check if file is processable.&#x22;&#x22;&#x22;    file_size = os.path.getsize(filepath)    max_size = self.agent_config.get(&#x22;max_file_size&#x22;, 10 * 1024 * 1024)  # 10MB default    if file_size > max_size:        return False, f&#x22;File too large: {file_size} bytes (max: {max_size})&#x22;    # For text files, estimate tokens    if filepath.endswith((&#x27;.txt&#x27;, &#x27;.md&#x27;, &#x27;.csv&#x27;, &#x27;.json&#x27;)):        with open(filepath) as f:            content = f.read()        estimated_tokens = len(content) // 4  # Rough estimate        max_tokens = self.agent_config.get(&#x22;max_tokens&#x22;, 100000)        if estimated_tokens > max_tokens:            return False, f&#x22;Content too large: ~{estimated_tokens} tokens (max: {max_tokens})&#x22;    return True, &#x22;OK&#x22;\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003Cdiv class=\"code-fade\" aria-hidden=\"true\">\u003C/div>\u003C/div>\u003C/div>\n\u003Cp>For a 200K-token model, set max_tokens to 150K to leave room for prompts and output. Files that exceed limits go to a manual review folder with a clear error message.\u003C/p>\n\u003Ch3 id=\"files-requiring-human-review\">Files Requiring Human Review\u003C/h3>\n\u003Cp>Some automation needs a human checkpoint. Legal contract analysis that might inform business decisions. Code deployments to production. Financial data processing.\u003C/p>\n\u003Cp>\u003Cstrong>What breaks:\u003C/strong> Full automation isn’t always desirable. No way to inject human judgment. Liability concerns.\u003C/p>\n\u003Cp>\u003Cstrong>Fix:\u003C/strong> Add an approval workflow:\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"7\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">YAML\u003C/span>\u003Cspan class=\"language-badge\">yaml\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container with-line-numbers\" data-language=\"yaml\" data-line-count=\"7\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"yaml\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">contracts\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">directory\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">~/drops/contracts\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">patterns\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: [\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"*.pdf\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">]\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">agent\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">contract_analyzer\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">approval_required\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">true\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">approval_timeout\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">3600\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">  \u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># 1 hour\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"contracts:  directory: ~/drops/contracts  patterns: [&#x22;*.pdf&#x22;]  agent: contract_analyzer  approval_required: true  approval_timeout: 3600  # 1 hour\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003C/div>\u003C/div>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"11\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">PYTHON\u003C/span>\u003Cspan class=\"language-badge\">python\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container with-line-numbers\" data-language=\"python\" data-line-count=\"11\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"python\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">def\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">_process_file\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(self, filepath: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">str\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">):\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">output_path \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">self\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">._run_agent(filepath)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">if\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">self\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">.zone_config.get(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"approval_required\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">):\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">approval_path \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">self\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">._move_to_approval_queue(filepath, output_path)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">console.print(\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">f\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"[yellow]⏸[/] Awaiting approval: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">{\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">approval_path\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">}\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">self\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">._notify_approver(approval_path)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Don't archive yet - wait for approval\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">else\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">self\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">._archive_file(filepath)\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"def _process_file(self, filepath: str):    output_path = self._run_agent(filepath)    if self.zone_config.get(&#x22;approval_required&#x22;):        approval_path = self._move_to_approval_queue(filepath, output_path)        console.print(f&#x22;[yellow]⏸[/] Awaiting approval: {approval_path}&#x22;)        self._notify_approver(approval_path)        # Don&#x27;t archive yet - wait for approval    else:        self._archive_file(filepath)\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003C/div>\u003C/div>\n\u003Cp>Set up an approval directory. Agent processes the file and moves it there with its output. Human reviews both. Approve by dropping in \u003Ccode>~/approvals/accept/\u003C/code>, reject to \u003Ccode>~/approvals/reject/\u003C/code>. A second watcher handles the approval directories.\u003C/p>\n\u003Ch2 id=\"production-deployment-considerations\">Production Deployment Considerations\u003C/h2>\n\u003Cp>POC works on your laptop. Production needs operational rigor.\u003C/p>\n\u003Ch3 id=\"monitoring-and-alerting\">Monitoring and Alerting\u003C/h3>\n\u003Cp>\u003Cstrong>The problem:\u003C/strong> Silent failures. You think it’s working. It’s been down for three days.\u003C/p>\n\u003Cp>\u003Cstrong>What to track:\u003C/strong>\u003C/p>\n\u003Col>\n\u003Cli>\u003Cstrong>Processing rate:\u003C/strong> Files processed per hour\u003C/li>\n\u003Cli>\u003Cstrong>Failure rate:\u003C/strong> Percentage of files that fail\u003C/li>\n\u003Cli>\u003Cstrong>Processing latency:\u003C/strong> Time from drop to output\u003C/li>\n\u003Cli>\u003Cstrong>Queue depth:\u003C/strong> Files waiting in drop zones\u003C/li>\n\u003Cli>\u003Cstrong>API health:\u003C/strong> Response times and error rates\u003C/li>\n\u003C/ol>\n\u003Cp>Instrument the watcher:\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"19\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">PYTHON\u003C/span>\u003Cspan class=\"language-badge\">python\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container collapsible with-line-numbers\" data-language=\"python\" data-line-count=\"19\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cbutton class=\"collapse-toggle\" aria-label=\"Toggle code visibility\" type=\"button\">\u003Cspan class=\"expand-text\">Expand (19 lines)\u003C/span>\u003Cspan class=\"collapse-text\">Collapse\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"python\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">import\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> statsd  \u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Or your metrics library\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">metrics \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> statsd.StatsClient(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">'localhost'\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">8125\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">def\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">_process_file\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(self, filepath: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">str\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">):\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">start_time \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> time.time()\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">try\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">output_path \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">self\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">._run_agent(filepath)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">self\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">._archive_file(filepath)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Record success\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">metrics.incr(\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">f\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">'dropzone.\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">{self\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">.zone_name\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">}\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">.success'\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">metrics.timing(\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">f\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">'dropzone.\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">{self\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">.zone_name\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">}\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">.duration'\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">                      \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(time.time() \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> start_time) \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">*\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">1000\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">except\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">Exception\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">as\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> e:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">metrics.incr(\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">f\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">'dropzone.\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">{self\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">.zone_name\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">}\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">.failure'\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">raise\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import statsd  # Or your metrics librarymetrics = statsd.StatsClient(&#x27;localhost&#x27;, 8125)def _process_file(self, filepath: str):    start_time = time.time()    try:        output_path = self._run_agent(filepath)        self._archive_file(filepath)        # Record success        metrics.incr(f&#x27;dropzone.{self.zone_name}.success&#x27;)        metrics.timing(f&#x27;dropzone.{self.zone_name}.duration&#x27;,                      (time.time() - start_time) * 1000)    except Exception as e:        metrics.incr(f&#x27;dropzone.{self.zone_name}.failure&#x27;)        raise\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003Cdiv class=\"code-fade\" aria-hidden=\"true\">\u003C/div>\u003C/div>\u003C/div>\n\u003Cp>Set alerts:\u003C/p>\n\u003Cul>\n\u003Cli>Processing rate drops below 10 files/hour when average is 50/hour\u003C/li>\n\u003Cli>Failure rate exceeds 10% over a 15-minute window\u003C/li>\n\u003Cli>No files processed in 2 hours during business hours\u003C/li>\n\u003Cli>Queue depth exceeds 100 files\u003C/li>\n\u003C/ul>\n\u003Cp>For our production deployment handling 800 files/day, we get 1-2 actionable alerts per week. Most are transient API issues that self-resolve.\u003C/p>\n\u003Ch3 id=\"logging-and-audit-trails\">Logging and Audit Trails\u003C/h3>\n\u003Cp>Every file processed needs a record: who dropped it, when, what agent processed it, what the output was, any errors encountered.\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"32\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">PYTHON\u003C/span>\u003Cspan class=\"language-badge\">python\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container collapsible with-line-numbers\" data-language=\"python\" data-line-count=\"32\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cbutton class=\"collapse-toggle\" aria-label=\"Toggle code visibility\" type=\"button\">\u003Cspan class=\"expand-text\">Expand (32 lines)\u003C/span>\u003Cspan class=\"collapse-text\">Collapse\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"python\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">import\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> json\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">import\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> logging\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">logging.basicConfig(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">filename\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">os.path.expanduser(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"~/logs/dropzone.log\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">level\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">logging.\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">INFO\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">format\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">'\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">%(asctime)s\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\"> - \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">%(name)s\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\"> - \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">%(levelname)s\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\"> - \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">%(message)s\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">'\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">def\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">_process_file\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(self, filepath: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">str\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">):\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">processing_record \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"timestamp\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: datetime.now().isoformat(),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"zone\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">self\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">.zone_name,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"agent\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">self\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">.agent_name,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"input_file\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: filepath,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"file_size\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: os.path.getsize(filepath),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"user\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: os.environ.get(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"USER\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">try\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">output_path \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">self\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">._run_agent(filepath)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">processing_record[\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"status\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">] \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"success\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">processing_record[\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"output_file\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">] \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> output_path\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">processing_record[\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"output_size\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">] \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> os.path.getsize(output_path)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">except\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">Exception\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">as\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> e:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">processing_record[\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"status\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">] \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"failure\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">processing_record[\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"error\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">] \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">str\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(e)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">processing_record[\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"error_type\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">] \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">type\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(e).\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">__name__\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">finally\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">processing_record[\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"duration_seconds\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">] \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> time.time() \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> start_time\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">logging.info(json.dumps(processing_record))\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import jsonimport logginglogging.basicConfig(    filename=os.path.expanduser(&#x22;~/logs/dropzone.log&#x22;),    level=logging.INFO,    format=&#x27;%(asctime)s - %(name)s - %(levelname)s - %(message)s&#x27;)def _process_file(self, filepath: str):    processing_record = {        &#x22;timestamp&#x22;: datetime.now().isoformat(),        &#x22;zone&#x22;: self.zone_name,        &#x22;agent&#x22;: self.agent_name,        &#x22;input_file&#x22;: filepath,        &#x22;file_size&#x22;: os.path.getsize(filepath),        &#x22;user&#x22;: os.environ.get(&#x22;USER&#x22;),    }    try:        output_path = self._run_agent(filepath)        processing_record[&#x22;status&#x22;] = &#x22;success&#x22;        processing_record[&#x22;output_file&#x22;] = output_path        processing_record[&#x22;output_size&#x22;] = os.path.getsize(output_path)    except Exception as e:        processing_record[&#x22;status&#x22;] = &#x22;failure&#x22;        processing_record[&#x22;error&#x22;] = str(e)        processing_record[&#x22;error_type&#x22;] = type(e).__name__    finally:        processing_record[&#x22;duration_seconds&#x22;] = time.time() - start_time        logging.info(json.dumps(processing_record))\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003Cdiv class=\"code-fade\" aria-hidden=\"true\">\u003C/div>\u003C/div>\u003C/div>\n\u003Cp>Logs go to structured JSON for easy parsing. Ship to your log aggregation service. When a user asks “did my file process?”, you have answers.\u003C/p>\n\u003Ch3 id=\"resource-limits\">Resource Limits\u003C/h3>\n\u003Cp>\u003Cstrong>CPU and Memory:\u003C/strong> Watchdog is lightweight, but agents aren’t. Whisper transcription spikes CPU to 100% for 30-60 seconds per file. Claude Code execution can use 2GB RAM.\u003C/p>\n\u003Cp>Set process limits:\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"11\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">PYTHON\u003C/span>\u003Cspan class=\"language-badge\">python\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container with-line-numbers\" data-language=\"python\" data-line-count=\"11\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"python\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">import\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> resource\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">def\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">_run_agent\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(self, filepath: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">str\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">) -> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">str\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Limit memory to 4GB\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">resource.setrlimit(resource.\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">RLIMIT_AS\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, (\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">4\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">*\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">1024\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">**\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">3\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">4\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">*\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">1024\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">**\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">3\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">))\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Limit CPU time to 5 minutes\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">resource.setrlimit(resource.\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">RLIMIT_CPU\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, (\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">300\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">300\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">))\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Run agent...\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import resourcedef _run_agent(self, filepath: str) -> str:    # Limit memory to 4GB    resource.setrlimit(resource.RLIMIT_AS, (4 * 1024**3, 4 * 1024**3))    # Limit CPU time to 5 minutes    resource.setrlimit(resource.RLIMIT_CPU, (300, 300))    # Run agent...\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003C/div>\u003C/div>\n\u003Cp>\u003Cstrong>API Rate Limits:\u003C/strong> Claude API: 50 requests/minute on tier 1, 5,000 requests/minute on tier 4. Replicate varies by model.\u003C/p>\n\u003Cp>Add rate limiting:\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"28\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">PYTHON\u003C/span>\u003Cspan class=\"language-badge\">python\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container collapsible with-line-numbers\" data-language=\"python\" data-line-count=\"28\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cbutton class=\"collapse-toggle\" aria-label=\"Toggle code visibility\" type=\"button\">\u003Cspan class=\"expand-text\">Expand (28 lines)\u003C/span>\u003Cspan class=\"collapse-text\">Collapse\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"python\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">from\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> time \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">import\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> time\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">from\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> collections \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">import\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> deque\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">class\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">RateLimiter\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">def\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">__init__\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(self, max_requests: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">int\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, window_seconds: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">int\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">):\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">self\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">.max_requests \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> max_requests\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">self\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">.window \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> window_seconds\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">self\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">.requests \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> deque()\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">def\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">acquire\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(self):\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">now \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> time()\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Remove old requests outside window\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">while\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">self\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">.requests \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">and\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">self\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">.requests[\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">0\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">] \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> now \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">self\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">.window:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">            \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">self\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">.requests.popleft()\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">if\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">len\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">self\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">.requests) \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">>=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">self\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">.max_requests:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">            \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">sleep_time \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">self\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">.requests[\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">0\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">] \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">+\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">self\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">.window \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">-\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> now\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">            \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">time.sleep(sleep_time)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">self\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">.requests.append(now)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># In agent code\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">rate_limiter \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> RateLimiter(\u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">max_requests\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">45\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">window_seconds\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">60\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">def\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">_run_claude_agent\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(self, filepath: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">str\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, output_dir: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">str\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">) -> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">str\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">rate_limiter.acquire()\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Call API...\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"from time import timefrom collections import dequeclass RateLimiter:    def __init__(self, max_requests: int, window_seconds: int):        self.max_requests = max_requests        self.window = window_seconds        self.requests = deque()    def acquire(self):        now = time()        # Remove old requests outside window        while self.requests and self.requests[0] \u003C now - self.window:            self.requests.popleft()        if len(self.requests) >= self.max_requests:            sleep_time = self.requests[0] + self.window - now            time.sleep(sleep_time)        self.requests.append(now)# In agent coderate_limiter = RateLimiter(max_requests=45, window_seconds=60)def _run_claude_agent(self, filepath: str, output_dir: str) -> str:    rate_limiter.acquire()    # Call API...\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003Cdiv class=\"code-fade\" aria-hidden=\"true\">\u003C/div>\u003C/div>\u003C/div>\n\u003Cp>Leave headroom. 45 requests/minute for a 50 req/min limit. Shared rate limiters if you have multiple services using the same API key.\u003C/p>\n\u003Ch3 id=\"graceful-degradation\">Graceful Degradation\u003C/h3>\n\u003Cp>APIs go down. Networks fail. Disk fills up. Production systems need fallbacks.\u003C/p>\n\u003Cp>\u003Cstrong>When Claude API is unavailable:\u003C/strong>\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"12\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">PYTHON\u003C/span>\u003Cspan class=\"language-badge\">python\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container with-line-numbers\" data-language=\"python\" data-line-count=\"12\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"python\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">def\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">_run_claude_agent\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(self, filepath: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">str\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, output_dir: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">str\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">) -> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">str\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">try\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Normal Claude processing\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">return\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">self\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">._call_claude_api(filepath, output_dir)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">except\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> anthropic.APIConnectionError:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Fallback to queue\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">return\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">self\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">._queue_for_retry(filepath)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">except\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> anthropic.RateLimitError:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Back off and retry once\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">time.sleep(\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">60\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">return\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">self\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">._call_claude_api(filepath, output_dir)\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"def _run_claude_agent(self, filepath: str, output_dir: str) -> str:    try:        # Normal Claude processing        return self._call_claude_api(filepath, output_dir)    except anthropic.APIConnectionError:        # Fallback to queue        return self._queue_for_retry(filepath)    except anthropic.RateLimitError:        # Back off and retry once        time.sleep(60)        return self._call_claude_api(filepath, output_dir)\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003C/div>\u003C/div>\n\u003Cp>\u003Cstrong>When disk space is low:\u003C/strong>\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"10\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">PYTHON\u003C/span>\u003Cspan class=\"language-badge\">python\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container with-line-numbers\" data-language=\"python\" data-line-count=\"10\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"python\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">def\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">_check_disk_space\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(self) -> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">bool\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">stat \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> os.statvfs(os.path.expanduser(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"~/output\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">))\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">free_bytes \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> stat.f_bavail \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">*\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> stat.f_frsize\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">free_gb \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> free_bytes \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">/\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> (\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">1024\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">**\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">3\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">if\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> free_gb \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">1.0\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:  \u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Less than 1GB free\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">console.print(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"[red]Low disk space![/] Pausing processing.\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">return\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">False\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">return\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">True\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"def _check_disk_space(self) -> bool:    stat = os.statvfs(os.path.expanduser(&#x22;~/output&#x22;))    free_bytes = stat.f_bavail * stat.f_frsize    free_gb = free_bytes / (1024**3)    if free_gb \u003C 1.0:  # Less than 1GB free        console.print(&#x22;[red]Low disk space![/] Pausing processing.&#x22;)        return False    return True\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003C/div>\u003C/div>\n\u003Cp>Check before each file. Pause processing if disk is full. Alert on low space. For systems processing 50GB/day, check every 10 files and alert at 10GB free.\u003C/p>\n\u003Ch3 id=\"security-validating-file-contents\">Security: Validating File Contents\u003C/h3>\n\u003Cp>Users drop files. Users are unpredictable. Protect your system.\u003C/p>\n\u003Cp>\u003Cstrong>File type validation:\u003C/strong>\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"16\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">PYTHON\u003C/span>\u003Cspan class=\"language-badge\">python\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container collapsible with-line-numbers\" data-language=\"python\" data-line-count=\"16\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cbutton class=\"collapse-toggle\" aria-label=\"Toggle code visibility\" type=\"button\">\u003Cspan class=\"expand-text\">Expand (16 lines)\u003C/span>\u003Cspan class=\"collapse-text\">Collapse\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"python\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">import\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> magic  \u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># python-magic library\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">def\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">_validate_file\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(self, filepath: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">str\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">) -> tuple[\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">bool\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">str\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">]:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Check declared extension matches actual content\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">mime \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> magic.from_file(filepath, \u003C/span>\u003Cspan style=\"--0:#FFAB70;--1:#AE4B07\">mime\u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">True\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">allowed_types \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">self\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">.zone_config.get(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"allowed_mime_types\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, [])\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">if\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> allowed_types \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">and\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> mime \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">not\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">in\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> allowed_types:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">return\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">False\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">f\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"Invalid file type: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">{\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">mime\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">}\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Check for malicious content\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">if\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> mime.startswith(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"application/x-executable\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">):\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">return\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">False\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"Executable files not allowed\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">return\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">True\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"OK\"\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import magic  # python-magic librarydef _validate_file(self, filepath: str) -> tuple[bool, str]:    # Check declared extension matches actual content    mime = magic.from_file(filepath, mime=True)    allowed_types = self.zone_config.get(&#x22;allowed_mime_types&#x22;, [])    if allowed_types and mime not in allowed_types:        return False, f&#x22;Invalid file type: {mime}&#x22;    # Check for malicious content    if mime.startswith(&#x22;application/x-executable&#x22;):        return False, &#x22;Executable files not allowed&#x22;    return True, &#x22;OK&#x22;\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003Cdiv class=\"code-fade\" aria-hidden=\"true\">\u003C/div>\u003C/div>\u003C/div>\n\u003Cp>\u003Cstrong>Content sanitization:\u003C/strong>\u003C/p>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"12\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">PYTHON\u003C/span>\u003Cspan class=\"language-badge\">python\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container with-line-numbers\" data-language=\"python\" data-line-count=\"12\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"python\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#F97583;--1:#BF3441\">def\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">_sanitize_content\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(self, content: \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">str\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">) -> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">str\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Remove potential injection attacks\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">content \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> content.replace(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"```python\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"```text\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">content \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> content.replace(\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"```bash\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"```text\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Limit size\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">max_chars \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">500000\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">  \u003C/span>\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># ~125K tokens\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">if\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">len\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">(content) \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> max_chars:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">content \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">=\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> content[:max_chars] \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">+\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">\\n\\n\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">[Content truncated]\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">return\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> content\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"def _sanitize_content(self, content: str) -> str:    # Remove potential injection attacks    content = content.replace(&#x22;&#x60;&#x60;&#x60;python&#x22;, &#x22;&#x60;&#x60;&#x60;text&#x22;)    content = content.replace(&#x22;&#x60;&#x60;&#x60;bash&#x22;, &#x22;&#x60;&#x60;&#x60;text&#x22;)    # Limit size    max_chars = 500000  # ~125K tokens    if len(content) > max_chars:        content = content[:max_chars] + &#x22;\\n\\n[Content truncated]&#x22;    return content\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003C/div>\u003C/div>\n\u003Cp>Never execute code from dropped files directly. Treat all input as untrusted. Validate, sanitize, then process.\u003C/p>\n\u003Ch2 id=\"the-automation-decision-framework\">The Automation Decision Framework\u003C/h2>\n\u003Cp>Not every task deserves automation. Use specific thresholds.\u003C/p>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\u003Ctable>\u003Cthead>\u003Ctr>\u003Cth>Frequency\u003C/th>\u003Cth>ROI Threshold\u003C/th>\u003Cth>Action\u003C/th>\u003C/tr>\u003C/thead>\u003Ctbody>\u003Ctr>\u003Ctd>Once\u003C/td>\u003Ctd>N/A\u003C/td>\u003Ctd>Use chat\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>2-5x/month\u003C/td>\u003Ctd>> 5 min saved\u003C/td>\u003Ctd>Maybe automate\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Weekly\u003C/td>\u003Ctd>> 2 min saved\u003C/td>\u003Ctd>Consider zone\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Daily\u003C/td>\u003Ctd>> 30 sec saved\u003C/td>\u003Ctd>Build zone\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>10+ times/day\u003C/td>\u003Ctd>Any time saved\u003C/td>\u003Ctd>Definitely zone\u003C/td>\u003C/tr>\u003C/tbody>\u003C/table>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\u003Ctable>\u003Cthead>\u003Ctr>\u003Cth>Complexity\u003C/th>\u003Cth>Time to Build\u003C/th>\u003Cth>Approach\u003C/th>\u003C/tr>\u003C/thead>\u003Ctbody>\u003Ctr>\u003Ctd>Single step\u003C/td>\u003Ctd>5 minutes\u003C/td>\u003Ctd>Bash agent\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Multi-step\u003C/td>\u003Ctd>30 minutes\u003C/td>\u003Ctd>Python agent\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>AI reasoning\u003C/td>\u003Ctd>15 minutes\u003C/td>\u003Ctd>Claude agent\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Mixed flow\u003C/td>\u003Ctd>1-2 hours\u003C/td>\u003Ctd>Chain agents\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Needs approval\u003C/td>\u003Ctd>2-3 hours\u003C/td>\u003Ctd>Approval workflow\u003C/td>\u003C/tr>\u003C/tbody>\u003C/table>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\u003Ctable>\u003Cthead>\u003Ctr>\u003Cth>Risk Level\u003C/th>\u003Cth>Requirements\u003C/th>\u003Cth>Safety\u003C/th>\u003C/tr>\u003C/thead>\u003Ctbody>\u003Ctr>\u003Ctd>Low\u003C/td>\u003Ctd>None\u003C/td>\u003Ctd>Full auto\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Medium\u003C/td>\u003Ctd>Logging\u003C/td>\u003Ctd>Auto + audit\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>High\u003C/td>\u003Ctd>Review\u003C/td>\u003Ctd>Approval required\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Critical\u003C/td>\u003Ctd>Sign-off\u003C/td>\u003Ctd>Manual only\u003C/td>\u003C/tr>\u003C/tbody>\u003C/table>\n\u003Cp>\u003Cstrong>Real numbers from our deployment:\u003C/strong>\u003C/p>\n\u003Cul>\n\u003Cli>Morning meeting transcription: 10x/week, saves 15 min/day, ROI: 2.5 hours/week\u003C/li>\n\u003Cli>Code review: 30x/week, saves 3 min each, ROI: 1.5 hours/week\u003C/li>\n\u003Cli>Data analysis: 5x/week, saves 20 min each, ROI: 1.7 hours/week\u003C/li>\n\u003Cli>Legal contract review: 2x/month, approval required, ROI: 40 min/month\u003C/li>\n\u003C/ul>\n\u003Cp>Total time saved: 22 hours/month. Setup time: 8 hours. Break-even in 2 weeks.\u003C/p>\n\u003Ch2 id=\"agent-opportunity-build-your-drop-zone-library\">Agent Opportunity: Build Your Drop Zone Library\u003C/h2>\n\u003Cp>Start with these high-value zones:\u003C/p>\n\u003Ch3 id=\"morning-debrief-zone\">Morning Debrief Zone\u003C/h3>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"20\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">YAML\u003C/span>\u003Cspan class=\"language-badge\">yaml\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container collapsible with-line-numbers\" data-language=\"yaml\" data-line-count=\"20\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cbutton class=\"collapse-toggle\" aria-label=\"Toggle code visibility\" type=\"button\">\u003Cspan class=\"expand-text\">Expand (20 lines)\u003C/span>\u003Cspan class=\"collapse-text\">Collapse\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"yaml\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># In drops.yaml\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">morning_debrief\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">directory\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">~/drops/debrief\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">patterns\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: [\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"*.m4a\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"*.mp3\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"*.wav\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">]\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">agent\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">debrief_processor\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">events\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: [\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">created\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">]\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">agents\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">debrief_processor\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">type\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">bash\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">command\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">|\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">      \u003C/span>\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\"># Transcribe\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">      \u003C/span>\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">whisper \"{file}\" -o /tmp --output_format txt\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">      \u003C/span>\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\"># Extract filename for transcript\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">      \u003C/span>\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">BASENAME=$(basename \"{file}\" | sed 's/\\.[^.]*$//')\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">      \u003C/span>\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\"># Process with Claude\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">      \u003C/span>\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">cat /tmp/$BASENAME.txt | claude --prompt \"$(cat prompts/debrief.md)\" > \"{output_dir}/$BASENAME-insights.md\"\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"# In drops.yamlmorning_debrief:  directory: ~/drops/debrief  patterns: [&#x22;*.m4a&#x22;, &#x22;*.mp3&#x22;, &#x22;*.wav&#x22;]  agent: debrief_processor  events: [created]agents:  debrief_processor:    type: bash    command: |      # Transcribe      whisper &#x22;{file}&#x22; -o /tmp --output_format txt      # Extract filename for transcript      BASENAME=$(basename &#x22;{file}&#x22; | sed &#x27;s/\\.[^.]*$//&#x27;)      # Process with Claude      cat /tmp/$BASENAME.txt | claude --prompt &#x22;$(cat prompts/debrief.md)&#x22; > &#x22;{output_dir}/$BASENAME-insights.md&#x22;\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003Cdiv class=\"code-fade\" aria-hidden=\"true\">\u003C/div>\u003C/div>\u003C/div>\n\u003Ch3 id=\"code-review-zone\">Code Review Zone\u003C/h3>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"12\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">YAML\u003C/span>\u003Cspan class=\"language-badge\">yaml\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container with-line-numbers\" data-language=\"yaml\" data-line-count=\"12\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"yaml\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">code_review\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">directory\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">~/drops/review\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">patterns\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: [\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"*.py\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"*.ts\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"*.js\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">, \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"*.go\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">]\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">agent\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">code_review\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">events\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: [\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">created\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">]\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">agents\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">code_review\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">type\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">claude\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">prompt_file\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">prompts/code_review.md\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">model\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">claude-sonnet-4-20250514\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"code_review:  directory: ~/drops/review  patterns: [&#x22;*.py&#x22;, &#x22;*.ts&#x22;, &#x22;*.js&#x22;, &#x22;*.go&#x22;]  agent: code_review  events: [created]agents:  code_review:    type: claude    prompt_file: prompts/code_review.md    model: claude-sonnet-4-20250514\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003C/div>\u003C/div>\n\u003Ch3 id=\"research-paper-zone\">Research Paper Zone\u003C/h3>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"11\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">YAML\u003C/span>\u003Cspan class=\"language-badge\">yaml\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container with-line-numbers\" data-language=\"yaml\" data-line-count=\"11\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"yaml\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">research\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">directory\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">~/drops/papers\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">patterns\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: [\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"*.pdf\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">]\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">agent\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">paper_summarize\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">events\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: [\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">created\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">]\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">agents\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">paper_summarize\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">type\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">python\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#85E89D;--1:#1E7734\">script\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\">: \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">agents/paper_processor.py\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"research:  directory: ~/drops/papers  patterns: [&#x22;*.pdf&#x22;]  agent: paper_summarize  events: [created]agents:  paper_summarize:    type: python    script: agents/paper_processor.py\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003C/div>\u003C/div>\n\u003Ch2 id=\"running-the-system\">Running the System\u003C/h2>\n\u003Cdiv class=\"code-block-wrapper\" data-line-count=\"15\">\u003Cdiv class=\"code-block-header\">\u003Cspan class=\"code-block-label\">BASH\u003C/span>\u003Cspan class=\"language-badge\">bash\u003C/span>\u003C/div>\u003Cdiv class=\"code-block-container with-line-numbers\" data-language=\"bash\" data-line-count=\"15\" data-max-preview=\"8\">\u003Cbutton class=\"copy-button\" aria-label=\"Copy code\" type=\"button\">\u003Cspan class=\"copy-icon\">Copy\u003C/span>\u003Cspan class=\"copied-icon\">Copied!\u003C/span>\u003C/button>\u003Cdiv class=\"code-content\">\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame is-terminal\">\u003Cfigcaption class=\"header\">\u003Cspan class=\"title\">\u003C/span>\u003Cspan class=\"sr-only\">Terminal window\u003C/span>\u003C/figcaption>\u003Cpre data-language=\"bash\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Create the directory structure\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">mkdir\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">-p\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">~/drops/{transcribe,analyze,images,data}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">mkdir\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">-p\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">~/output\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">~/archive\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">~/logs\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">mkdir\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">-p\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">prompts\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">agents\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Start the watcher\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">uv\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">run\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">drop_watcher.py\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">--config\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">drops.yaml\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># In another terminal, test it:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">echo\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">\"Write a blog post about AI automation\"\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#F97583;--1:#BF3441\">>\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">~/drops/analyze/test.txt\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#99A0A6;--1:#616972\"># Check output\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">ls\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">~/output/analyze/\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#B392F0;--1:#6F42C1\">cat\u003C/span>\u003Cspan style=\"--0:#E1E4E8;--1:#24292E\"> \u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">~/output/analyze/\u003C/span>\u003Cspan style=\"--0:#79B8FF;--1:#005CC5\">*\u003C/span>\u003Cspan style=\"--0:#9ECBFF;--1:#032F62\">.md\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"mkdir -p ~/drops/{transcribe,analyze,images,data}mkdir -p ~/output ~/archive ~/logsmkdir -p prompts agentsuv run drop_watcher.py --config drops.yamlecho &#x22;Write a blog post about AI automation&#x22; > ~/drops/analyze/test.txtls ~/output/analyze/cat ~/output/analyze/*.md\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\u003C/div>\u003C/div>\u003C/div>\n\u003Ch2 id=\"the-key-insight\">The Key Insight\u003C/h2>\n\u003Cp>\u003Cstrong>Repeat workflows benefit most from automation.\u003C/strong>\u003C/p>\n\u003Cp>The first time you do something, chat is fine. The tenth time, you should have a drop zone. By the hundredth time, you shouldn’t even think about it—it should just happen.\u003C/p>\n\u003Cp>Directory watchers work because they match how you already work. You already organize files into folders. You already drag and drop. The interface is invisible—and invisible interfaces have zero learning curve.\u003C/p>\n\u003Cp>They’re called agents for a reason. They’re capable of agency. Lean into the autonomy. Stop babysitting AI and start leveraging it.\u003C/p>\n\u003Chr>\n\u003Cp>\u003Cstrong>Key Takeaways:\u003C/strong>\u003C/p>\n\u003Cul>\n\u003Cli>Directory watchers turn the file system into an AI interface with zero learning curve\u003C/li>\n\u003Cli>YAML config makes adding new zones a 5-minute task\u003C/li>\n\u003Cli>Pattern matching routes files to appropriate agents automatically\u003C/li>\n\u003Cli>Production requires monitoring, logging, rate limiting, and error handling\u003C/li>\n\u003Cli>Failure modes are predictable: context gaps, race conditions, size limits, approval needs\u003C/li>\n\u003Cli>ROI threshold: anything you do 10+ times/week that takes more than 30 seconds\u003C/li>\n\u003Cli>Start with your highest-frequency task and expand from there\u003C/li>\n\u003C/ul>\n\u003Cp>\u003Cstrong>Try It Now (5 Minutes to First Automation):\u003C/strong>\nCopy \u003Ccode>drop_watcher.py\u003C/code> and \u003Ccode>drops.yaml\u003C/code> above. Create the directory structure. Start the watcher. Drop a text file into \u003Ccode>~/drops/analyze/\u003C/code>. Watch it process automatically and check \u003Ccode>~/output/analyze/\u003C/code> for results.\u003C/p>\n\u003Cp>If you do this task more than 10 times a week, you just saved yourself hours per month. If you share it with your team, multiply that by headcount.\u003C/p>",{"headings":629,"localImagePaths":711,"remoteImagePaths":712,"frontmatter":713,"imagePaths":717},[630,633,636,639,642,645,648,651,654,657,660,663,666,669,672,675,678,681,684,687,690,693,696,699,702,705,708],{"depth":44,"slug":631,"text":632},"the-architecture","The Architecture",{"depth":44,"slug":634,"text":635},"poc-complete-drop-zone-system","POC: Complete Drop Zone System",{"depth":112,"slug":637,"text":638},"step-1-configuration-file","Step 1: Configuration File",{"depth":112,"slug":640,"text":641},"step-2-the-core-watcher","Step 2: The Core Watcher",{"depth":112,"slug":643,"text":644},"step-3-agent-prompt-templates","Step 3: Agent Prompt Templates",{"depth":112,"slug":646,"text":647},"step-4-image-generation-agent","Step 4: Image Generation Agent",{"depth":44,"slug":649,"text":650},"data-flow-file-drop-to-result","Data Flow: File Drop to Result",{"depth":44,"slug":652,"text":653},"when-drop-zones-fail-and-how-to-fix-each-one","When Drop Zones Fail (And How to Fix Each One)",{"depth":112,"slug":655,"text":656},"files-that-need-context","Files That Need Context",{"depth":112,"slug":658,"text":659},"multi-file-inputs","Multi-File Inputs",{"depth":112,"slug":661,"text":662},"race-conditions-incomplete-writes","Race Conditions: Incomplete Writes",{"depth":112,"slug":664,"text":665},"agent-failures-mid-processing","Agent Failures Mid-Processing",{"depth":112,"slug":667,"text":668},"token-limit-exceeded","Token Limit Exceeded",{"depth":112,"slug":670,"text":671},"files-requiring-human-review","Files Requiring Human Review",{"depth":44,"slug":673,"text":674},"production-deployment-considerations","Production Deployment Considerations",{"depth":112,"slug":676,"text":677},"monitoring-and-alerting","Monitoring and Alerting",{"depth":112,"slug":679,"text":680},"logging-and-audit-trails","Logging and Audit Trails",{"depth":112,"slug":682,"text":683},"resource-limits","Resource Limits",{"depth":112,"slug":685,"text":686},"graceful-degradation","Graceful Degradation",{"depth":112,"slug":688,"text":689},"security-validating-file-contents","Security: Validating File Contents",{"depth":44,"slug":691,"text":692},"the-automation-decision-framework","The Automation Decision Framework",{"depth":44,"slug":694,"text":695},"agent-opportunity-build-your-drop-zone-library","Agent Opportunity: Build Your Drop Zone Library",{"depth":112,"slug":697,"text":698},"morning-debrief-zone","Morning Debrief Zone",{"depth":112,"slug":700,"text":701},"code-review-zone","Code Review Zone",{"depth":112,"slug":703,"text":704},"research-paper-zone","Research Paper Zone",{"depth":44,"slug":706,"text":707},"running-the-system","Running the System",{"depth":44,"slug":709,"text":710},"the-key-insight","The Key Insight",[],[],{"title":608,"description":609,"pubDate":714,"author":17,"tags":715,"banner":614,"category":193,"difficulty":35,"tldr":616,"keyTakeaways":716},["Date","2025-12-15T00:00:00.000Z"],[19,23,612,278,613],[618,619,620,621,622],[],"directory-watchers.md"]